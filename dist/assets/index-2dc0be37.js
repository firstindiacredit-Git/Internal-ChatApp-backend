function My(e,t){for(var n=0;n<t.length;n++){const s=t[n];if(typeof s!="string"&&!Array.isArray(s)){for(const o in s)if(o!=="default"&&!(o in e)){const i=Object.getOwnPropertyDescriptor(s,o);i&&Object.defineProperty(e,o,i.get?i:{enumerable:!0,get:()=>s[o]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function Ay(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Np={exports:{}},Fl={},kp={exports:{}},Ve={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ea=Symbol.for("react.element"),Ry=Symbol.for("react.portal"),Py=Symbol.for("react.fragment"),Ly=Symbol.for("react.strict_mode"),Uy=Symbol.for("react.profiler"),Oy=Symbol.for("react.provider"),$y=Symbol.for("react.context"),Dy=Symbol.for("react.forward_ref"),Fy=Symbol.for("react.suspense"),zy=Symbol.for("react.memo"),By=Symbol.for("react.lazy"),pm=Symbol.iterator;function Vy(e){return e===null||typeof e!="object"?null:(e=pm&&e[pm]||e["@@iterator"],typeof e=="function"?e:null)}var Sp={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Cp=Object.assign,Ep={};function Uo(e,t,n){this.props=e,this.context=t,this.refs=Ep,this.updater=n||Sp}Uo.prototype.isReactComponent={};Uo.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Uo.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Ip(){}Ip.prototype=Uo.prototype;function $u(e,t,n){this.props=e,this.context=t,this.refs=Ep,this.updater=n||Sp}var Du=$u.prototype=new Ip;Du.constructor=$u;Cp(Du,Uo.prototype);Du.isPureReactComponent=!0;var gm=Array.isArray,Tp=Object.prototype.hasOwnProperty,Fu={current:null},_p={key:!0,ref:!0,__self:!0,__source:!0};function Mp(e,t,n){var s,o={},i=null,a=null;if(t!=null)for(s in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(i=""+t.key),t)Tp.call(t,s)&&!_p.hasOwnProperty(s)&&(o[s]=t[s]);var c=arguments.length-2;if(c===1)o.children=n;else if(1<c){for(var d=Array(c),f=0;f<c;f++)d[f]=arguments[f+2];o.children=d}if(e&&e.defaultProps)for(s in c=e.defaultProps,c)o[s]===void 0&&(o[s]=c[s]);return{$$typeof:ea,type:e,key:i,ref:a,props:o,_owner:Fu.current}}function Hy(e,t){return{$$typeof:ea,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function zu(e){return typeof e=="object"&&e!==null&&e.$$typeof===ea}function Wy(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var xm=/\/+/g;function kc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Wy(""+e.key):t.toString(36)}function Fa(e,t,n,s,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case ea:case Ry:a=!0}}if(a)return a=e,o=o(a),e=s===""?"."+kc(a,0):s,gm(o)?(n="",e!=null&&(n=e.replace(xm,"$&/")+"/"),Fa(o,t,n,"",function(f){return f})):o!=null&&(zu(o)&&(o=Hy(o,n+(!o.key||a&&a.key===o.key?"":(""+o.key).replace(xm,"$&/")+"/")+e)),t.push(o)),1;if(a=0,s=s===""?".":s+":",gm(e))for(var c=0;c<e.length;c++){i=e[c];var d=s+kc(i,c);a+=Fa(i,t,n,d,o)}else if(d=Vy(e),typeof d=="function")for(e=d.call(e),c=0;!(i=e.next()).done;)i=i.value,d=s+kc(i,c++),a+=Fa(i,t,n,d,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function va(e,t,n){if(e==null)return e;var s=[],o=0;return Fa(e,s,"","",function(i){return t.call(n,i,o++)}),s}function Gy(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var dn={current:null},za={transition:null},qy={ReactCurrentDispatcher:dn,ReactCurrentBatchConfig:za,ReactCurrentOwner:Fu};function Ap(){throw Error("act(...) is not supported in production builds of React.")}Ve.Children={map:va,forEach:function(e,t,n){va(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return va(e,function(){t++}),t},toArray:function(e){return va(e,function(t){return t})||[]},only:function(e){if(!zu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ve.Component=Uo;Ve.Fragment=Py;Ve.Profiler=Uy;Ve.PureComponent=$u;Ve.StrictMode=Ly;Ve.Suspense=Fy;Ve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qy;Ve.act=Ap;Ve.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=Cp({},e.props),o=e.key,i=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,a=Fu.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(d in t)Tp.call(t,d)&&!_p.hasOwnProperty(d)&&(s[d]=t[d]===void 0&&c!==void 0?c[d]:t[d])}var d=arguments.length-2;if(d===1)s.children=n;else if(1<d){c=Array(d);for(var f=0;f<d;f++)c[f]=arguments[f+2];s.children=c}return{$$typeof:ea,type:e.type,key:o,ref:i,props:s,_owner:a}};Ve.createContext=function(e){return e={$$typeof:$y,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Oy,_context:e},e.Consumer=e};Ve.createElement=Mp;Ve.createFactory=function(e){var t=Mp.bind(null,e);return t.type=e,t};Ve.createRef=function(){return{current:null}};Ve.forwardRef=function(e){return{$$typeof:Dy,render:e}};Ve.isValidElement=zu;Ve.lazy=function(e){return{$$typeof:By,_payload:{_status:-1,_result:e},_init:Gy}};Ve.memo=function(e,t){return{$$typeof:zy,type:e,compare:t===void 0?null:t}};Ve.startTransition=function(e){var t=za.transition;za.transition={};try{e()}finally{za.transition=t}};Ve.unstable_act=Ap;Ve.useCallback=function(e,t){return dn.current.useCallback(e,t)};Ve.useContext=function(e){return dn.current.useContext(e)};Ve.useDebugValue=function(){};Ve.useDeferredValue=function(e){return dn.current.useDeferredValue(e)};Ve.useEffect=function(e,t){return dn.current.useEffect(e,t)};Ve.useId=function(){return dn.current.useId()};Ve.useImperativeHandle=function(e,t,n){return dn.current.useImperativeHandle(e,t,n)};Ve.useInsertionEffect=function(e,t){return dn.current.useInsertionEffect(e,t)};Ve.useLayoutEffect=function(e,t){return dn.current.useLayoutEffect(e,t)};Ve.useMemo=function(e,t){return dn.current.useMemo(e,t)};Ve.useReducer=function(e,t,n){return dn.current.useReducer(e,t,n)};Ve.useRef=function(e){return dn.current.useRef(e)};Ve.useState=function(e){return dn.current.useState(e)};Ve.useSyncExternalStore=function(e,t,n){return dn.current.useSyncExternalStore(e,t,n)};Ve.useTransition=function(){return dn.current.useTransition()};Ve.version="18.3.1";kp.exports=Ve;var h=kp.exports;const zl=Ay(h),Ky=My({__proto__:null,default:zl},[h]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yy=h,Jy=Symbol.for("react.element"),Qy=Symbol.for("react.fragment"),Xy=Object.prototype.hasOwnProperty,Zy=Yy.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ev={key:!0,ref:!0,__self:!0,__source:!0};function Rp(e,t,n){var s,o={},i=null,a=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(s in t)Xy.call(t,s)&&!ev.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)o[s]===void 0&&(o[s]=t[s]);return{$$typeof:Jy,type:e,key:i,ref:a,props:o,_owner:Zy.current}}Fl.Fragment=Qy;Fl.jsx=Rp;Fl.jsxs=Rp;Np.exports=Fl;var r=Np.exports,pd={},Pp={exports:{}},Rn={},Lp={exports:{}},Up={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(O,S){var E=O.length;O.push(S);e:for(;0<E;){var X=E-1>>>1,z=O[X];if(0<o(z,S))O[X]=S,O[E]=z,E=X;else break e}}function n(O){return O.length===0?null:O[0]}function s(O){if(O.length===0)return null;var S=O[0],E=O.pop();if(E!==S){O[0]=E;e:for(var X=0,z=O.length,G=z>>>1;X<G;){var V=2*(X+1)-1,$=O[V],J=V+1,B=O[J];if(0>o($,E))J<z&&0>o(B,$)?(O[X]=B,O[J]=E,X=J):(O[X]=$,O[V]=E,X=V);else if(J<z&&0>o(B,E))O[X]=B,O[J]=E,X=J;else break e}}return S}function o(O,S){var E=O.sortIndex-S.sortIndex;return E!==0?E:O.id-S.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,c=a.now();e.unstable_now=function(){return a.now()-c}}var d=[],f=[],x=1,g=null,b=3,_=!1,I=!1,M=!1,v=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(O){for(var S=n(f);S!==null;){if(S.callback===null)s(f);else if(S.startTime<=O)s(f),S.sortIndex=S.expirationTime,t(d,S);else break;S=n(f)}}function R(O){if(M=!1,y(O),!I)if(n(d)!==null)I=!0,q(U);else{var S=n(f);S!==null&&Q(R,S.startTime-O)}}function U(O,S){I=!1,M&&(M=!1,w(Z),Z=-1),_=!0;var E=b;try{for(y(S),g=n(d);g!==null&&(!(g.expirationTime>S)||O&&!te());){var X=g.callback;if(typeof X=="function"){g.callback=null,b=g.priorityLevel;var z=X(g.expirationTime<=S);S=e.unstable_now(),typeof z=="function"?g.callback=z:g===n(d)&&s(d),y(S)}else s(d);g=n(d)}if(g!==null)var G=!0;else{var V=n(f);V!==null&&Q(R,V.startTime-S),G=!1}return G}finally{g=null,b=E,_=!1}}var W=!1,F=null,Z=-1,ae=5,se=-1;function te(){return!(e.unstable_now()-se<ae)}function fe(){if(F!==null){var O=e.unstable_now();se=O;var S=!0;try{S=F(!0,O)}finally{S?L():(W=!1,F=null)}}else W=!1}var L;if(typeof m=="function")L=function(){m(fe)};else if(typeof MessageChannel<"u"){var oe=new MessageChannel,P=oe.port2;oe.port1.onmessage=fe,L=function(){P.postMessage(null)}}else L=function(){v(fe,0)};function q(O){F=O,W||(W=!0,L())}function Q(O,S){Z=v(function(){O(e.unstable_now())},S)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(O){O.callback=null},e.unstable_continueExecution=function(){I||_||(I=!0,q(U))},e.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ae=0<O?Math.floor(1e3/O):5},e.unstable_getCurrentPriorityLevel=function(){return b},e.unstable_getFirstCallbackNode=function(){return n(d)},e.unstable_next=function(O){switch(b){case 1:case 2:case 3:var S=3;break;default:S=b}var E=b;b=S;try{return O()}finally{b=E}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(O,S){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var E=b;b=O;try{return S()}finally{b=E}},e.unstable_scheduleCallback=function(O,S,E){var X=e.unstable_now();switch(typeof E=="object"&&E!==null?(E=E.delay,E=typeof E=="number"&&0<E?X+E:X):E=X,O){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=E+z,O={id:x++,callback:S,priorityLevel:O,startTime:E,expirationTime:z,sortIndex:-1},E>X?(O.sortIndex=E,t(f,O),n(d)===null&&O===n(f)&&(M?(w(Z),Z=-1):M=!0,Q(R,E-X))):(O.sortIndex=z,t(d,O),I||_||(I=!0,q(U))),O},e.unstable_shouldYield=te,e.unstable_wrapCallback=function(O){var S=b;return function(){var E=b;b=S;try{return O.apply(this,arguments)}finally{b=E}}}})(Up);Lp.exports=Up;var tv=Lp.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nv=h,An=tv;function ce(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Op=new Set,Ii={};function Ys(e,t){Co(e,t),Co(e+"Capture",t)}function Co(e,t){for(Ii[e]=t,e=0;e<t.length;e++)Op.add(t[e])}var Ar=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),gd=Object.prototype.hasOwnProperty,rv=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ym={},vm={};function sv(e){return gd.call(vm,e)?!0:gd.call(ym,e)?!1:rv.test(e)?vm[e]=!0:(ym[e]=!0,!1)}function ov(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function iv(e,t,n,s){if(t===null||typeof t>"u"||ov(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function un(e,t,n,s,o,i,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var Vt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Vt[e]=new un(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Vt[t]=new un(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Vt[e]=new un(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Vt[e]=new un(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Vt[e]=new un(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Vt[e]=new un(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Vt[e]=new un(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Vt[e]=new un(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Vt[e]=new un(e,5,!1,e.toLowerCase(),null,!1,!1)});var Bu=/[\-:]([a-z])/g;function Vu(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Bu,Vu);Vt[t]=new un(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Bu,Vu);Vt[t]=new un(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Bu,Vu);Vt[t]=new un(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Vt[e]=new un(e,1,!1,e.toLowerCase(),null,!1,!1)});Vt.xlinkHref=new un("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Vt[e]=new un(e,1,!1,e.toLowerCase(),null,!0,!0)});function Hu(e,t,n,s){var o=Vt.hasOwnProperty(t)?Vt[t]:null;(o!==null?o.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(iv(t,n,o,s)&&(n=null),s||o===null?sv(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=n===null?o.type===3?!1:"":n:(t=o.attributeName,s=o.attributeNamespace,n===null?e.removeAttribute(t):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var $r=nv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,wa=Symbol.for("react.element"),oo=Symbol.for("react.portal"),io=Symbol.for("react.fragment"),Wu=Symbol.for("react.strict_mode"),xd=Symbol.for("react.profiler"),$p=Symbol.for("react.provider"),Dp=Symbol.for("react.context"),Gu=Symbol.for("react.forward_ref"),yd=Symbol.for("react.suspense"),vd=Symbol.for("react.suspense_list"),qu=Symbol.for("react.memo"),Wr=Symbol.for("react.lazy"),Fp=Symbol.for("react.offscreen"),wm=Symbol.iterator;function ei(e){return e===null||typeof e!="object"?null:(e=wm&&e[wm]||e["@@iterator"],typeof e=="function"?e:null)}var pt=Object.assign,Sc;function di(e){if(Sc===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Sc=t&&t[1]||""}return`
`+Sc+e}var Cc=!1;function Ec(e,t){if(!e||Cc)return"";Cc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(f){var s=f}Reflect.construct(e,[],t)}else{try{t.call()}catch(f){s=f}e.call(t.prototype)}else{try{throw Error()}catch(f){s=f}e()}}catch(f){if(f&&s&&typeof f.stack=="string"){for(var o=f.stack.split(`
`),i=s.stack.split(`
`),a=o.length-1,c=i.length-1;1<=a&&0<=c&&o[a]!==i[c];)c--;for(;1<=a&&0<=c;a--,c--)if(o[a]!==i[c]){if(a!==1||c!==1)do if(a--,c--,0>c||o[a]!==i[c]){var d=`
`+o[a].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}while(1<=a&&0<=c);break}}}finally{Cc=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?di(e):""}function av(e){switch(e.tag){case 5:return di(e.type);case 16:return di("Lazy");case 13:return di("Suspense");case 19:return di("SuspenseList");case 0:case 2:case 15:return e=Ec(e.type,!1),e;case 11:return e=Ec(e.type.render,!1),e;case 1:return e=Ec(e.type,!0),e;default:return""}}function wd(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case io:return"Fragment";case oo:return"Portal";case xd:return"Profiler";case Wu:return"StrictMode";case yd:return"Suspense";case vd:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Dp:return(e.displayName||"Context")+".Consumer";case $p:return(e._context.displayName||"Context")+".Provider";case Gu:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case qu:return t=e.displayName||null,t!==null?t:wd(e.type)||"Memo";case Wr:t=e._payload,e=e._init;try{return wd(e(t))}catch{}}return null}function lv(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return wd(t);case 8:return t===Wu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ps(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function zp(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function cv(e){var t=zp(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(a){s=""+a,i.call(this,a)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function ba(e){e._valueTracker||(e._valueTracker=cv(e))}function Bp(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=zp(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function il(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function bd(e,t){var n=t.checked;return pt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function bm(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=ps(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Vp(e,t){t=t.checked,t!=null&&Hu(e,"checked",t,!1)}function jd(e,t){Vp(e,t);var n=ps(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Nd(e,t.type,n):t.hasOwnProperty("defaultValue")&&Nd(e,t.type,ps(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function jm(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Nd(e,t,n){(t!=="number"||il(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var ui=Array.isArray;function yo(e,t,n,s){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&s&&(e[n].defaultSelected=!0)}else{for(n=""+ps(n),t=null,o=0;o<e.length;o++){if(e[o].value===n){e[o].selected=!0,s&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function kd(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ce(91));return pt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Nm(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(ce(92));if(ui(n)){if(1<n.length)throw Error(ce(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:ps(n)}}function Hp(e,t){var n=ps(t.value),s=ps(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function km(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Wp(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Sd(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Wp(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var ja,Gp=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(ja=ja||document.createElement("div"),ja.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ja.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ti(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var pi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},dv=["Webkit","ms","Moz","O"];Object.keys(pi).forEach(function(e){dv.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pi[t]=pi[e]})});function qp(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||pi.hasOwnProperty(e)&&pi[e]?(""+t).trim():t+"px"}function Kp(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,o=qp(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,o):e[n]=o}}var uv=pt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Cd(e,t){if(t){if(uv[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ce(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ce(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ce(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ce(62))}}function Ed(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Id=null;function Ku(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Td=null,vo=null,wo=null;function Sm(e){if(e=ra(e)){if(typeof Td!="function")throw Error(ce(280));var t=e.stateNode;t&&(t=Gl(t),Td(e.stateNode,e.type,t))}}function Yp(e){vo?wo?wo.push(e):wo=[e]:vo=e}function Jp(){if(vo){var e=vo,t=wo;if(wo=vo=null,Sm(e),t)for(e=0;e<t.length;e++)Sm(t[e])}}function Qp(e,t){return e(t)}function Xp(){}var Ic=!1;function Zp(e,t,n){if(Ic)return e(t,n);Ic=!0;try{return Qp(e,t,n)}finally{Ic=!1,(vo!==null||wo!==null)&&(Xp(),Jp())}}function _i(e,t){var n=e.stateNode;if(n===null)return null;var s=Gl(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(ce(231,t,typeof n));return n}var _d=!1;if(Ar)try{var ti={};Object.defineProperty(ti,"passive",{get:function(){_d=!0}}),window.addEventListener("test",ti,ti),window.removeEventListener("test",ti,ti)}catch{_d=!1}function fv(e,t,n,s,o,i,a,c,d){var f=Array.prototype.slice.call(arguments,3);try{t.apply(n,f)}catch(x){this.onError(x)}}var gi=!1,al=null,ll=!1,Md=null,mv={onError:function(e){gi=!0,al=e}};function hv(e,t,n,s,o,i,a,c,d){gi=!1,al=null,fv.apply(mv,arguments)}function pv(e,t,n,s,o,i,a,c,d){if(hv.apply(this,arguments),gi){if(gi){var f=al;gi=!1,al=null}else throw Error(ce(198));ll||(ll=!0,Md=f)}}function Js(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function eg(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Cm(e){if(Js(e)!==e)throw Error(ce(188))}function gv(e){var t=e.alternate;if(!t){if(t=Js(e),t===null)throw Error(ce(188));return t!==e?null:e}for(var n=e,s=t;;){var o=n.return;if(o===null)break;var i=o.alternate;if(i===null){if(s=o.return,s!==null){n=s;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return Cm(o),e;if(i===s)return Cm(o),t;i=i.sibling}throw Error(ce(188))}if(n.return!==s.return)n=o,s=i;else{for(var a=!1,c=o.child;c;){if(c===n){a=!0,n=o,s=i;break}if(c===s){a=!0,s=o,n=i;break}c=c.sibling}if(!a){for(c=i.child;c;){if(c===n){a=!0,n=i,s=o;break}if(c===s){a=!0,s=i,n=o;break}c=c.sibling}if(!a)throw Error(ce(189))}}if(n.alternate!==s)throw Error(ce(190))}if(n.tag!==3)throw Error(ce(188));return n.stateNode.current===n?e:t}function tg(e){return e=gv(e),e!==null?ng(e):null}function ng(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=ng(e);if(t!==null)return t;e=e.sibling}return null}var rg=An.unstable_scheduleCallback,Em=An.unstable_cancelCallback,xv=An.unstable_shouldYield,yv=An.unstable_requestPaint,Nt=An.unstable_now,vv=An.unstable_getCurrentPriorityLevel,Yu=An.unstable_ImmediatePriority,sg=An.unstable_UserBlockingPriority,cl=An.unstable_NormalPriority,wv=An.unstable_LowPriority,og=An.unstable_IdlePriority,Bl=null,fr=null;function bv(e){if(fr&&typeof fr.onCommitFiberRoot=="function")try{fr.onCommitFiberRoot(Bl,e,void 0,(e.current.flags&128)===128)}catch{}}var Qn=Math.clz32?Math.clz32:kv,jv=Math.log,Nv=Math.LN2;function kv(e){return e>>>=0,e===0?32:31-(jv(e)/Nv|0)|0}var Na=64,ka=4194304;function fi(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dl(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,o=e.suspendedLanes,i=e.pingedLanes,a=n&268435455;if(a!==0){var c=a&~o;c!==0?s=fi(c):(i&=a,i!==0&&(s=fi(i)))}else a=n&~o,a!==0?s=fi(a):i!==0&&(s=fi(i));if(s===0)return 0;if(t!==0&&t!==s&&!(t&o)&&(o=s&-s,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-Qn(t),o=1<<n,s|=e[n],t&=~o;return s}function Sv(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Cv(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-Qn(i),c=1<<a,d=o[a];d===-1?(!(c&n)||c&s)&&(o[a]=Sv(c,t)):d<=t&&(e.expiredLanes|=c),i&=~c}}function Ad(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function ig(){var e=Na;return Na<<=1,!(Na&4194240)&&(Na=64),e}function Tc(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ta(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Qn(t),e[t]=n}function Ev(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-Qn(n),i=1<<o;t[o]=0,s[o]=-1,e[o]=-1,n&=~i}}function Ju(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-Qn(n),o=1<<s;o&t|e[s]&t&&(e[s]|=t),n&=~o}}var et=0;function ag(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var lg,Qu,cg,dg,ug,Rd=!1,Sa=[],ts=null,ns=null,rs=null,Mi=new Map,Ai=new Map,qr=[],Iv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Im(e,t){switch(e){case"focusin":case"focusout":ts=null;break;case"dragenter":case"dragleave":ns=null;break;case"mouseover":case"mouseout":rs=null;break;case"pointerover":case"pointerout":Mi.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ai.delete(t.pointerId)}}function ni(e,t,n,s,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[o]},t!==null&&(t=ra(t),t!==null&&Qu(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function Tv(e,t,n,s,o){switch(t){case"focusin":return ts=ni(ts,e,t,n,s,o),!0;case"dragenter":return ns=ni(ns,e,t,n,s,o),!0;case"mouseover":return rs=ni(rs,e,t,n,s,o),!0;case"pointerover":var i=o.pointerId;return Mi.set(i,ni(Mi.get(i)||null,e,t,n,s,o)),!0;case"gotpointercapture":return i=o.pointerId,Ai.set(i,ni(Ai.get(i)||null,e,t,n,s,o)),!0}return!1}function fg(e){var t=As(e.target);if(t!==null){var n=Js(t);if(n!==null){if(t=n.tag,t===13){if(t=eg(n),t!==null){e.blockedOn=t,ug(e.priority,function(){cg(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ba(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Pd(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);Id=s,n.target.dispatchEvent(s),Id=null}else return t=ra(n),t!==null&&Qu(t),e.blockedOn=n,!1;t.shift()}return!0}function Tm(e,t,n){Ba(e)&&n.delete(t)}function _v(){Rd=!1,ts!==null&&Ba(ts)&&(ts=null),ns!==null&&Ba(ns)&&(ns=null),rs!==null&&Ba(rs)&&(rs=null),Mi.forEach(Tm),Ai.forEach(Tm)}function ri(e,t){e.blockedOn===t&&(e.blockedOn=null,Rd||(Rd=!0,An.unstable_scheduleCallback(An.unstable_NormalPriority,_v)))}function Ri(e){function t(o){return ri(o,e)}if(0<Sa.length){ri(Sa[0],e);for(var n=1;n<Sa.length;n++){var s=Sa[n];s.blockedOn===e&&(s.blockedOn=null)}}for(ts!==null&&ri(ts,e),ns!==null&&ri(ns,e),rs!==null&&ri(rs,e),Mi.forEach(t),Ai.forEach(t),n=0;n<qr.length;n++)s=qr[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<qr.length&&(n=qr[0],n.blockedOn===null);)fg(n),n.blockedOn===null&&qr.shift()}var bo=$r.ReactCurrentBatchConfig,ul=!0;function Mv(e,t,n,s){var o=et,i=bo.transition;bo.transition=null;try{et=1,Xu(e,t,n,s)}finally{et=o,bo.transition=i}}function Av(e,t,n,s){var o=et,i=bo.transition;bo.transition=null;try{et=4,Xu(e,t,n,s)}finally{et=o,bo.transition=i}}function Xu(e,t,n,s){if(ul){var o=Pd(e,t,n,s);if(o===null)Dc(e,t,s,fl,n),Im(e,s);else if(Tv(o,e,t,n,s))s.stopPropagation();else if(Im(e,s),t&4&&-1<Iv.indexOf(e)){for(;o!==null;){var i=ra(o);if(i!==null&&lg(i),i=Pd(e,t,n,s),i===null&&Dc(e,t,s,fl,n),i===o)break;o=i}o!==null&&s.stopPropagation()}else Dc(e,t,s,null,n)}}var fl=null;function Pd(e,t,n,s){if(fl=null,e=Ku(s),e=As(e),e!==null)if(t=Js(e),t===null)e=null;else if(n=t.tag,n===13){if(e=eg(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return fl=e,null}function mg(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(vv()){case Yu:return 1;case sg:return 4;case cl:case wv:return 16;case og:return 536870912;default:return 16}default:return 16}}var Jr=null,Zu=null,Va=null;function hg(){if(Va)return Va;var e,t=Zu,n=t.length,s,o="value"in Jr?Jr.value:Jr.textContent,i=o.length;for(e=0;e<n&&t[e]===o[e];e++);var a=n-e;for(s=1;s<=a&&t[n-s]===o[i-s];s++);return Va=o.slice(e,1<s?1-s:void 0)}function Ha(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Ca(){return!0}function _m(){return!1}function Pn(e){function t(n,s,o,i,a){this._reactName=n,this._targetInst=o,this.type=s,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(n=e[c],this[c]=n?n(i):i[c]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ca:_m,this.isPropagationStopped=_m,this}return pt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ca)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ca)},persist:function(){},isPersistent:Ca}),t}var Oo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ef=Pn(Oo),na=pt({},Oo,{view:0,detail:0}),Rv=Pn(na),_c,Mc,si,Vl=pt({},na,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:tf,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==si&&(si&&e.type==="mousemove"?(_c=e.screenX-si.screenX,Mc=e.screenY-si.screenY):Mc=_c=0,si=e),_c)},movementY:function(e){return"movementY"in e?e.movementY:Mc}}),Mm=Pn(Vl),Pv=pt({},Vl,{dataTransfer:0}),Lv=Pn(Pv),Uv=pt({},na,{relatedTarget:0}),Ac=Pn(Uv),Ov=pt({},Oo,{animationName:0,elapsedTime:0,pseudoElement:0}),$v=Pn(Ov),Dv=pt({},Oo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Fv=Pn(Dv),zv=pt({},Oo,{data:0}),Am=Pn(zv),Bv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Vv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Hv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Wv(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Hv[e])?!!t[e]:!1}function tf(){return Wv}var Gv=pt({},na,{key:function(e){if(e.key){var t=Bv[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Ha(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Vv[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:tf,charCode:function(e){return e.type==="keypress"?Ha(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Ha(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),qv=Pn(Gv),Kv=pt({},Vl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rm=Pn(Kv),Yv=pt({},na,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:tf}),Jv=Pn(Yv),Qv=pt({},Oo,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xv=Pn(Qv),Zv=pt({},Vl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),ew=Pn(Zv),tw=[9,13,27,32],nf=Ar&&"CompositionEvent"in window,xi=null;Ar&&"documentMode"in document&&(xi=document.documentMode);var nw=Ar&&"TextEvent"in window&&!xi,pg=Ar&&(!nf||xi&&8<xi&&11>=xi),Pm=String.fromCharCode(32),Lm=!1;function gg(e,t){switch(e){case"keyup":return tw.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xg(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ao=!1;function rw(e,t){switch(e){case"compositionend":return xg(t);case"keypress":return t.which!==32?null:(Lm=!0,Pm);case"textInput":return e=t.data,e===Pm&&Lm?null:e;default:return null}}function sw(e,t){if(ao)return e==="compositionend"||!nf&&gg(e,t)?(e=hg(),Va=Zu=Jr=null,ao=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return pg&&t.locale!=="ko"?null:t.data;default:return null}}var ow={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Um(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!ow[e.type]:t==="textarea"}function yg(e,t,n,s){Yp(s),t=ml(t,"onChange"),0<t.length&&(n=new ef("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var yi=null,Pi=null;function iw(e){Tg(e,0)}function Hl(e){var t=uo(e);if(Bp(t))return e}function aw(e,t){if(e==="change")return t}var vg=!1;if(Ar){var Rc;if(Ar){var Pc="oninput"in document;if(!Pc){var Om=document.createElement("div");Om.setAttribute("oninput","return;"),Pc=typeof Om.oninput=="function"}Rc=Pc}else Rc=!1;vg=Rc&&(!document.documentMode||9<document.documentMode)}function $m(){yi&&(yi.detachEvent("onpropertychange",wg),Pi=yi=null)}function wg(e){if(e.propertyName==="value"&&Hl(Pi)){var t=[];yg(t,Pi,e,Ku(e)),Zp(iw,t)}}function lw(e,t,n){e==="focusin"?($m(),yi=t,Pi=n,yi.attachEvent("onpropertychange",wg)):e==="focusout"&&$m()}function cw(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Hl(Pi)}function dw(e,t){if(e==="click")return Hl(t)}function uw(e,t){if(e==="input"||e==="change")return Hl(t)}function fw(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var er=typeof Object.is=="function"?Object.is:fw;function Li(e,t){if(er(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var o=n[s];if(!gd.call(t,o)||!er(e[o],t[o]))return!1}return!0}function Dm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Fm(e,t){var n=Dm(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Dm(n)}}function bg(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?bg(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function jg(){for(var e=window,t=il();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=il(e.document)}return t}function rf(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function mw(e){var t=jg(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&bg(n.ownerDocument.documentElement,n)){if(s!==null&&rf(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=n.textContent.length,i=Math.min(s.start,o);s=s.end===void 0?i:Math.min(s.end,o),!e.extend&&i>s&&(o=s,s=i,i=o),o=Fm(n,i);var a=Fm(n,s);o&&a&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>s?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var hw=Ar&&"documentMode"in document&&11>=document.documentMode,lo=null,Ld=null,vi=null,Ud=!1;function zm(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ud||lo==null||lo!==il(s)||(s=lo,"selectionStart"in s&&rf(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),vi&&Li(vi,s)||(vi=s,s=ml(Ld,"onSelect"),0<s.length&&(t=new ef("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=lo)))}function Ea(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var co={animationend:Ea("Animation","AnimationEnd"),animationiteration:Ea("Animation","AnimationIteration"),animationstart:Ea("Animation","AnimationStart"),transitionend:Ea("Transition","TransitionEnd")},Lc={},Ng={};Ar&&(Ng=document.createElement("div").style,"AnimationEvent"in window||(delete co.animationend.animation,delete co.animationiteration.animation,delete co.animationstart.animation),"TransitionEvent"in window||delete co.transitionend.transition);function Wl(e){if(Lc[e])return Lc[e];if(!co[e])return e;var t=co[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Ng)return Lc[e]=t[n];return e}var kg=Wl("animationend"),Sg=Wl("animationiteration"),Cg=Wl("animationstart"),Eg=Wl("transitionend"),Ig=new Map,Bm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ys(e,t){Ig.set(e,t),Ys(t,[e])}for(var Uc=0;Uc<Bm.length;Uc++){var Oc=Bm[Uc],pw=Oc.toLowerCase(),gw=Oc[0].toUpperCase()+Oc.slice(1);ys(pw,"on"+gw)}ys(kg,"onAnimationEnd");ys(Sg,"onAnimationIteration");ys(Cg,"onAnimationStart");ys("dblclick","onDoubleClick");ys("focusin","onFocus");ys("focusout","onBlur");ys(Eg,"onTransitionEnd");Co("onMouseEnter",["mouseout","mouseover"]);Co("onMouseLeave",["mouseout","mouseover"]);Co("onPointerEnter",["pointerout","pointerover"]);Co("onPointerLeave",["pointerout","pointerover"]);Ys("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ys("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ys("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ys("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ys("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ys("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xw=new Set("cancel close invalid load scroll toggle".split(" ").concat(mi));function Vm(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,pv(s,t,void 0,e),e.currentTarget=null}function Tg(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],o=s.event;s=s.listeners;e:{var i=void 0;if(t)for(var a=s.length-1;0<=a;a--){var c=s[a],d=c.instance,f=c.currentTarget;if(c=c.listener,d!==i&&o.isPropagationStopped())break e;Vm(o,c,f),i=d}else for(a=0;a<s.length;a++){if(c=s[a],d=c.instance,f=c.currentTarget,c=c.listener,d!==i&&o.isPropagationStopped())break e;Vm(o,c,f),i=d}}}if(ll)throw e=Md,ll=!1,Md=null,e}function st(e,t){var n=t[zd];n===void 0&&(n=t[zd]=new Set);var s=e+"__bubble";n.has(s)||(_g(t,e,2,!1),n.add(s))}function $c(e,t,n){var s=0;t&&(s|=4),_g(n,e,s,t)}var Ia="_reactListening"+Math.random().toString(36).slice(2);function Ui(e){if(!e[Ia]){e[Ia]=!0,Op.forEach(function(n){n!=="selectionchange"&&(xw.has(n)||$c(n,!1,e),$c(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Ia]||(t[Ia]=!0,$c("selectionchange",!1,t))}}function _g(e,t,n,s){switch(mg(t)){case 1:var o=Mv;break;case 4:o=Av;break;default:o=Xu}n=o.bind(null,t,n,e),o=void 0,!_d||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),s?o!==void 0?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):o!==void 0?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Dc(e,t,n,s,o){var i=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var a=s.tag;if(a===3||a===4){var c=s.stateNode.containerInfo;if(c===o||c.nodeType===8&&c.parentNode===o)break;if(a===4)for(a=s.return;a!==null;){var d=a.tag;if((d===3||d===4)&&(d=a.stateNode.containerInfo,d===o||d.nodeType===8&&d.parentNode===o))return;a=a.return}for(;c!==null;){if(a=As(c),a===null)return;if(d=a.tag,d===5||d===6){s=i=a;continue e}c=c.parentNode}}s=s.return}Zp(function(){var f=i,x=Ku(n),g=[];e:{var b=Ig.get(e);if(b!==void 0){var _=ef,I=e;switch(e){case"keypress":if(Ha(n)===0)break e;case"keydown":case"keyup":_=qv;break;case"focusin":I="focus",_=Ac;break;case"focusout":I="blur",_=Ac;break;case"beforeblur":case"afterblur":_=Ac;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=Mm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=Lv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=Jv;break;case kg:case Sg:case Cg:_=$v;break;case Eg:_=Xv;break;case"scroll":_=Rv;break;case"wheel":_=ew;break;case"copy":case"cut":case"paste":_=Fv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=Rm}var M=(t&4)!==0,v=!M&&e==="scroll",w=M?b!==null?b+"Capture":null:b;M=[];for(var m=f,y;m!==null;){y=m;var R=y.stateNode;if(y.tag===5&&R!==null&&(y=R,w!==null&&(R=_i(m,w),R!=null&&M.push(Oi(m,R,y)))),v)break;m=m.return}0<M.length&&(b=new _(b,I,null,n,x),g.push({event:b,listeners:M}))}}if(!(t&7)){e:{if(b=e==="mouseover"||e==="pointerover",_=e==="mouseout"||e==="pointerout",b&&n!==Id&&(I=n.relatedTarget||n.fromElement)&&(As(I)||I[Rr]))break e;if((_||b)&&(b=x.window===x?x:(b=x.ownerDocument)?b.defaultView||b.parentWindow:window,_?(I=n.relatedTarget||n.toElement,_=f,I=I?As(I):null,I!==null&&(v=Js(I),I!==v||I.tag!==5&&I.tag!==6)&&(I=null)):(_=null,I=f),_!==I)){if(M=Mm,R="onMouseLeave",w="onMouseEnter",m="mouse",(e==="pointerout"||e==="pointerover")&&(M=Rm,R="onPointerLeave",w="onPointerEnter",m="pointer"),v=_==null?b:uo(_),y=I==null?b:uo(I),b=new M(R,m+"leave",_,n,x),b.target=v,b.relatedTarget=y,R=null,As(x)===f&&(M=new M(w,m+"enter",I,n,x),M.target=y,M.relatedTarget=v,R=M),v=R,_&&I)t:{for(M=_,w=I,m=0,y=M;y;y=so(y))m++;for(y=0,R=w;R;R=so(R))y++;for(;0<m-y;)M=so(M),m--;for(;0<y-m;)w=so(w),y--;for(;m--;){if(M===w||w!==null&&M===w.alternate)break t;M=so(M),w=so(w)}M=null}else M=null;_!==null&&Hm(g,b,_,M,!1),I!==null&&v!==null&&Hm(g,v,I,M,!0)}}e:{if(b=f?uo(f):window,_=b.nodeName&&b.nodeName.toLowerCase(),_==="select"||_==="input"&&b.type==="file")var U=aw;else if(Um(b))if(vg)U=uw;else{U=cw;var W=lw}else(_=b.nodeName)&&_.toLowerCase()==="input"&&(b.type==="checkbox"||b.type==="radio")&&(U=dw);if(U&&(U=U(e,f))){yg(g,U,n,x);break e}W&&W(e,b,f),e==="focusout"&&(W=b._wrapperState)&&W.controlled&&b.type==="number"&&Nd(b,"number",b.value)}switch(W=f?uo(f):window,e){case"focusin":(Um(W)||W.contentEditable==="true")&&(lo=W,Ld=f,vi=null);break;case"focusout":vi=Ld=lo=null;break;case"mousedown":Ud=!0;break;case"contextmenu":case"mouseup":case"dragend":Ud=!1,zm(g,n,x);break;case"selectionchange":if(hw)break;case"keydown":case"keyup":zm(g,n,x)}var F;if(nf)e:{switch(e){case"compositionstart":var Z="onCompositionStart";break e;case"compositionend":Z="onCompositionEnd";break e;case"compositionupdate":Z="onCompositionUpdate";break e}Z=void 0}else ao?gg(e,n)&&(Z="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(Z="onCompositionStart");Z&&(pg&&n.locale!=="ko"&&(ao||Z!=="onCompositionStart"?Z==="onCompositionEnd"&&ao&&(F=hg()):(Jr=x,Zu="value"in Jr?Jr.value:Jr.textContent,ao=!0)),W=ml(f,Z),0<W.length&&(Z=new Am(Z,e,null,n,x),g.push({event:Z,listeners:W}),F?Z.data=F:(F=xg(n),F!==null&&(Z.data=F)))),(F=nw?rw(e,n):sw(e,n))&&(f=ml(f,"onBeforeInput"),0<f.length&&(x=new Am("onBeforeInput","beforeinput",null,n,x),g.push({event:x,listeners:f}),x.data=F))}Tg(g,t)})}function Oi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function ml(e,t){for(var n=t+"Capture",s=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=_i(e,n),i!=null&&s.unshift(Oi(e,i,o)),i=_i(e,t),i!=null&&s.push(Oi(e,i,o))),e=e.return}return s}function so(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Hm(e,t,n,s,o){for(var i=t._reactName,a=[];n!==null&&n!==s;){var c=n,d=c.alternate,f=c.stateNode;if(d!==null&&d===s)break;c.tag===5&&f!==null&&(c=f,o?(d=_i(n,i),d!=null&&a.unshift(Oi(n,d,c))):o||(d=_i(n,i),d!=null&&a.push(Oi(n,d,c)))),n=n.return}a.length!==0&&e.push({event:t,listeners:a})}var yw=/\r\n?/g,vw=/\u0000|\uFFFD/g;function Wm(e){return(typeof e=="string"?e:""+e).replace(yw,`
`).replace(vw,"")}function Ta(e,t,n){if(t=Wm(t),Wm(e)!==t&&n)throw Error(ce(425))}function hl(){}var Od=null,$d=null;function Dd(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Fd=typeof setTimeout=="function"?setTimeout:void 0,ww=typeof clearTimeout=="function"?clearTimeout:void 0,Gm=typeof Promise=="function"?Promise:void 0,bw=typeof queueMicrotask=="function"?queueMicrotask:typeof Gm<"u"?function(e){return Gm.resolve(null).then(e).catch(jw)}:Fd;function jw(e){setTimeout(function(){throw e})}function Fc(e,t){var n=t,s=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(s===0){e.removeChild(o),Ri(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=o}while(n);Ri(t)}function ss(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function qm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var $o=Math.random().toString(36).slice(2),dr="__reactFiber$"+$o,$i="__reactProps$"+$o,Rr="__reactContainer$"+$o,zd="__reactEvents$"+$o,Nw="__reactListeners$"+$o,kw="__reactHandles$"+$o;function As(e){var t=e[dr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Rr]||n[dr]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=qm(e);e!==null;){if(n=e[dr])return n;e=qm(e)}return t}e=n,n=e.parentNode}return null}function ra(e){return e=e[dr]||e[Rr],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function uo(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ce(33))}function Gl(e){return e[$i]||null}var Bd=[],fo=-1;function vs(e){return{current:e}}function it(e){0>fo||(e.current=Bd[fo],Bd[fo]=null,fo--)}function rt(e,t){fo++,Bd[fo]=e.current,e.current=t}var gs={},en=vs(gs),yn=vs(!1),Ds=gs;function Eo(e,t){var n=e.type.contextTypes;if(!n)return gs;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in n)o[i]=t[i];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function vn(e){return e=e.childContextTypes,e!=null}function pl(){it(yn),it(en)}function Km(e,t,n){if(en.current!==gs)throw Error(ce(168));rt(en,t),rt(yn,n)}function Mg(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var o in s)if(!(o in t))throw Error(ce(108,lv(e)||"Unknown",o));return pt({},n,s)}function gl(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||gs,Ds=en.current,rt(en,e),rt(yn,yn.current),!0}function Ym(e,t,n){var s=e.stateNode;if(!s)throw Error(ce(169));n?(e=Mg(e,t,Ds),s.__reactInternalMemoizedMergedChildContext=e,it(yn),it(en),rt(en,e)):it(yn),rt(yn,n)}var Sr=null,ql=!1,zc=!1;function Ag(e){Sr===null?Sr=[e]:Sr.push(e)}function Sw(e){ql=!0,Ag(e)}function ws(){if(!zc&&Sr!==null){zc=!0;var e=0,t=et;try{var n=Sr;for(et=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}Sr=null,ql=!1}catch(o){throw Sr!==null&&(Sr=Sr.slice(e+1)),rg(Yu,ws),o}finally{et=t,zc=!1}}return null}var mo=[],ho=0,xl=null,yl=0,$n=[],Dn=0,Fs=null,Er=1,Ir="";function Is(e,t){mo[ho++]=yl,mo[ho++]=xl,xl=e,yl=t}function Rg(e,t,n){$n[Dn++]=Er,$n[Dn++]=Ir,$n[Dn++]=Fs,Fs=e;var s=Er;e=Ir;var o=32-Qn(s)-1;s&=~(1<<o),n+=1;var i=32-Qn(t)+o;if(30<i){var a=o-o%5;i=(s&(1<<a)-1).toString(32),s>>=a,o-=a,Er=1<<32-Qn(t)+o|n<<o|s,Ir=i+e}else Er=1<<i|n<<o|s,Ir=e}function sf(e){e.return!==null&&(Is(e,1),Rg(e,1,0))}function of(e){for(;e===xl;)xl=mo[--ho],mo[ho]=null,yl=mo[--ho],mo[ho]=null;for(;e===Fs;)Fs=$n[--Dn],$n[Dn]=null,Ir=$n[--Dn],$n[Dn]=null,Er=$n[--Dn],$n[Dn]=null}var Mn=null,Tn=null,ut=!1,Jn=null;function Pg(e,t){var n=zn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Jm(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Mn=e,Tn=ss(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Mn=e,Tn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Fs!==null?{id:Er,overflow:Ir}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=zn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Mn=e,Tn=null,!0):!1;default:return!1}}function Vd(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Hd(e){if(ut){var t=Tn;if(t){var n=t;if(!Jm(e,t)){if(Vd(e))throw Error(ce(418));t=ss(n.nextSibling);var s=Mn;t&&Jm(e,t)?Pg(s,n):(e.flags=e.flags&-4097|2,ut=!1,Mn=e)}}else{if(Vd(e))throw Error(ce(418));e.flags=e.flags&-4097|2,ut=!1,Mn=e}}}function Qm(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Mn=e}function _a(e){if(e!==Mn)return!1;if(!ut)return Qm(e),ut=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Dd(e.type,e.memoizedProps)),t&&(t=Tn)){if(Vd(e))throw Lg(),Error(ce(418));for(;t;)Pg(e,t),t=ss(t.nextSibling)}if(Qm(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ce(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Tn=ss(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Tn=null}}else Tn=Mn?ss(e.stateNode.nextSibling):null;return!0}function Lg(){for(var e=Tn;e;)e=ss(e.nextSibling)}function Io(){Tn=Mn=null,ut=!1}function af(e){Jn===null?Jn=[e]:Jn.push(e)}var Cw=$r.ReactCurrentBatchConfig;function oi(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ce(309));var s=n.stateNode}if(!s)throw Error(ce(147,e));var o=s,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(a){var c=o.refs;a===null?delete c[i]:c[i]=a},t._stringRef=i,t)}if(typeof e!="string")throw Error(ce(284));if(!n._owner)throw Error(ce(290,e))}return e}function Ma(e,t){throw e=Object.prototype.toString.call(t),Error(ce(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Xm(e){var t=e._init;return t(e._payload)}function Ug(e){function t(w,m){if(e){var y=w.deletions;y===null?(w.deletions=[m],w.flags|=16):y.push(m)}}function n(w,m){if(!e)return null;for(;m!==null;)t(w,m),m=m.sibling;return null}function s(w,m){for(w=new Map;m!==null;)m.key!==null?w.set(m.key,m):w.set(m.index,m),m=m.sibling;return w}function o(w,m){return w=ls(w,m),w.index=0,w.sibling=null,w}function i(w,m,y){return w.index=y,e?(y=w.alternate,y!==null?(y=y.index,y<m?(w.flags|=2,m):y):(w.flags|=2,m)):(w.flags|=1048576,m)}function a(w){return e&&w.alternate===null&&(w.flags|=2),w}function c(w,m,y,R){return m===null||m.tag!==6?(m=Kc(y,w.mode,R),m.return=w,m):(m=o(m,y),m.return=w,m)}function d(w,m,y,R){var U=y.type;return U===io?x(w,m,y.props.children,R,y.key):m!==null&&(m.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===Wr&&Xm(U)===m.type)?(R=o(m,y.props),R.ref=oi(w,m,y),R.return=w,R):(R=Qa(y.type,y.key,y.props,null,w.mode,R),R.ref=oi(w,m,y),R.return=w,R)}function f(w,m,y,R){return m===null||m.tag!==4||m.stateNode.containerInfo!==y.containerInfo||m.stateNode.implementation!==y.implementation?(m=Yc(y,w.mode,R),m.return=w,m):(m=o(m,y.children||[]),m.return=w,m)}function x(w,m,y,R,U){return m===null||m.tag!==7?(m=$s(y,w.mode,R,U),m.return=w,m):(m=o(m,y),m.return=w,m)}function g(w,m,y){if(typeof m=="string"&&m!==""||typeof m=="number")return m=Kc(""+m,w.mode,y),m.return=w,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case wa:return y=Qa(m.type,m.key,m.props,null,w.mode,y),y.ref=oi(w,null,m),y.return=w,y;case oo:return m=Yc(m,w.mode,y),m.return=w,m;case Wr:var R=m._init;return g(w,R(m._payload),y)}if(ui(m)||ei(m))return m=$s(m,w.mode,y,null),m.return=w,m;Ma(w,m)}return null}function b(w,m,y,R){var U=m!==null?m.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return U!==null?null:c(w,m,""+y,R);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case wa:return y.key===U?d(w,m,y,R):null;case oo:return y.key===U?f(w,m,y,R):null;case Wr:return U=y._init,b(w,m,U(y._payload),R)}if(ui(y)||ei(y))return U!==null?null:x(w,m,y,R,null);Ma(w,y)}return null}function _(w,m,y,R,U){if(typeof R=="string"&&R!==""||typeof R=="number")return w=w.get(y)||null,c(m,w,""+R,U);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case wa:return w=w.get(R.key===null?y:R.key)||null,d(m,w,R,U);case oo:return w=w.get(R.key===null?y:R.key)||null,f(m,w,R,U);case Wr:var W=R._init;return _(w,m,y,W(R._payload),U)}if(ui(R)||ei(R))return w=w.get(y)||null,x(m,w,R,U,null);Ma(m,R)}return null}function I(w,m,y,R){for(var U=null,W=null,F=m,Z=m=0,ae=null;F!==null&&Z<y.length;Z++){F.index>Z?(ae=F,F=null):ae=F.sibling;var se=b(w,F,y[Z],R);if(se===null){F===null&&(F=ae);break}e&&F&&se.alternate===null&&t(w,F),m=i(se,m,Z),W===null?U=se:W.sibling=se,W=se,F=ae}if(Z===y.length)return n(w,F),ut&&Is(w,Z),U;if(F===null){for(;Z<y.length;Z++)F=g(w,y[Z],R),F!==null&&(m=i(F,m,Z),W===null?U=F:W.sibling=F,W=F);return ut&&Is(w,Z),U}for(F=s(w,F);Z<y.length;Z++)ae=_(F,w,Z,y[Z],R),ae!==null&&(e&&ae.alternate!==null&&F.delete(ae.key===null?Z:ae.key),m=i(ae,m,Z),W===null?U=ae:W.sibling=ae,W=ae);return e&&F.forEach(function(te){return t(w,te)}),ut&&Is(w,Z),U}function M(w,m,y,R){var U=ei(y);if(typeof U!="function")throw Error(ce(150));if(y=U.call(y),y==null)throw Error(ce(151));for(var W=U=null,F=m,Z=m=0,ae=null,se=y.next();F!==null&&!se.done;Z++,se=y.next()){F.index>Z?(ae=F,F=null):ae=F.sibling;var te=b(w,F,se.value,R);if(te===null){F===null&&(F=ae);break}e&&F&&te.alternate===null&&t(w,F),m=i(te,m,Z),W===null?U=te:W.sibling=te,W=te,F=ae}if(se.done)return n(w,F),ut&&Is(w,Z),U;if(F===null){for(;!se.done;Z++,se=y.next())se=g(w,se.value,R),se!==null&&(m=i(se,m,Z),W===null?U=se:W.sibling=se,W=se);return ut&&Is(w,Z),U}for(F=s(w,F);!se.done;Z++,se=y.next())se=_(F,w,Z,se.value,R),se!==null&&(e&&se.alternate!==null&&F.delete(se.key===null?Z:se.key),m=i(se,m,Z),W===null?U=se:W.sibling=se,W=se);return e&&F.forEach(function(fe){return t(w,fe)}),ut&&Is(w,Z),U}function v(w,m,y,R){if(typeof y=="object"&&y!==null&&y.type===io&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case wa:e:{for(var U=y.key,W=m;W!==null;){if(W.key===U){if(U=y.type,U===io){if(W.tag===7){n(w,W.sibling),m=o(W,y.props.children),m.return=w,w=m;break e}}else if(W.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===Wr&&Xm(U)===W.type){n(w,W.sibling),m=o(W,y.props),m.ref=oi(w,W,y),m.return=w,w=m;break e}n(w,W);break}else t(w,W);W=W.sibling}y.type===io?(m=$s(y.props.children,w.mode,R,y.key),m.return=w,w=m):(R=Qa(y.type,y.key,y.props,null,w.mode,R),R.ref=oi(w,m,y),R.return=w,w=R)}return a(w);case oo:e:{for(W=y.key;m!==null;){if(m.key===W)if(m.tag===4&&m.stateNode.containerInfo===y.containerInfo&&m.stateNode.implementation===y.implementation){n(w,m.sibling),m=o(m,y.children||[]),m.return=w,w=m;break e}else{n(w,m);break}else t(w,m);m=m.sibling}m=Yc(y,w.mode,R),m.return=w,w=m}return a(w);case Wr:return W=y._init,v(w,m,W(y._payload),R)}if(ui(y))return I(w,m,y,R);if(ei(y))return M(w,m,y,R);Ma(w,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,m!==null&&m.tag===6?(n(w,m.sibling),m=o(m,y),m.return=w,w=m):(n(w,m),m=Kc(y,w.mode,R),m.return=w,w=m),a(w)):n(w,m)}return v}var To=Ug(!0),Og=Ug(!1),vl=vs(null),wl=null,po=null,lf=null;function cf(){lf=po=wl=null}function df(e){var t=vl.current;it(vl),e._currentValue=t}function Wd(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function jo(e,t){wl=e,lf=po=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(xn=!0),e.firstContext=null)}function Vn(e){var t=e._currentValue;if(lf!==e)if(e={context:e,memoizedValue:t,next:null},po===null){if(wl===null)throw Error(ce(308));po=e,wl.dependencies={lanes:0,firstContext:e}}else po=po.next=e;return t}var Rs=null;function uf(e){Rs===null?Rs=[e]:Rs.push(e)}function $g(e,t,n,s){var o=t.interleaved;return o===null?(n.next=n,uf(t)):(n.next=o.next,o.next=n),t.interleaved=n,Pr(e,s)}function Pr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Gr=!1;function ff(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Dg(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function _r(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function os(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,Ke&2){var o=s.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),s.pending=t,Pr(e,n)}return o=s.interleaved,o===null?(t.next=t,uf(s)):(t.next=o.next,o.next=t),s.interleaved=t,Pr(e,n)}function Wa(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,Ju(e,n)}}function Zm(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var o=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?o=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?o=i=t:i=i.next=t}else o=i=t;n={baseState:s.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function bl(e,t,n,s){var o=e.updateQueue;Gr=!1;var i=o.firstBaseUpdate,a=o.lastBaseUpdate,c=o.shared.pending;if(c!==null){o.shared.pending=null;var d=c,f=d.next;d.next=null,a===null?i=f:a.next=f,a=d;var x=e.alternate;x!==null&&(x=x.updateQueue,c=x.lastBaseUpdate,c!==a&&(c===null?x.firstBaseUpdate=f:c.next=f,x.lastBaseUpdate=d))}if(i!==null){var g=o.baseState;a=0,x=f=d=null,c=i;do{var b=c.lane,_=c.eventTime;if((s&b)===b){x!==null&&(x=x.next={eventTime:_,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var I=e,M=c;switch(b=t,_=n,M.tag){case 1:if(I=M.payload,typeof I=="function"){g=I.call(_,g,b);break e}g=I;break e;case 3:I.flags=I.flags&-65537|128;case 0:if(I=M.payload,b=typeof I=="function"?I.call(_,g,b):I,b==null)break e;g=pt({},g,b);break e;case 2:Gr=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,b=o.effects,b===null?o.effects=[c]:b.push(c))}else _={eventTime:_,lane:b,tag:c.tag,payload:c.payload,callback:c.callback,next:null},x===null?(f=x=_,d=g):x=x.next=_,a|=b;if(c=c.next,c===null){if(c=o.shared.pending,c===null)break;b=c,c=b.next,b.next=null,o.lastBaseUpdate=b,o.shared.pending=null}}while(1);if(x===null&&(d=g),o.baseState=d,o.firstBaseUpdate=f,o.lastBaseUpdate=x,t=o.shared.interleaved,t!==null){o=t;do a|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);Bs|=a,e.lanes=a,e.memoizedState=g}}function eh(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],o=s.callback;if(o!==null){if(s.callback=null,s=n,typeof o!="function")throw Error(ce(191,o));o.call(s)}}}var sa={},mr=vs(sa),Di=vs(sa),Fi=vs(sa);function Ps(e){if(e===sa)throw Error(ce(174));return e}function mf(e,t){switch(rt(Fi,t),rt(Di,e),rt(mr,sa),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Sd(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Sd(t,e)}it(mr),rt(mr,t)}function _o(){it(mr),it(Di),it(Fi)}function Fg(e){Ps(Fi.current);var t=Ps(mr.current),n=Sd(t,e.type);t!==n&&(rt(Di,e),rt(mr,n))}function hf(e){Di.current===e&&(it(mr),it(Di))}var mt=vs(0);function jl(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Bc=[];function pf(){for(var e=0;e<Bc.length;e++)Bc[e]._workInProgressVersionPrimary=null;Bc.length=0}var Ga=$r.ReactCurrentDispatcher,Vc=$r.ReactCurrentBatchConfig,zs=0,ht=null,_t=null,Ut=null,Nl=!1,wi=!1,zi=0,Ew=0;function qt(){throw Error(ce(321))}function gf(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!er(e[n],t[n]))return!1;return!0}function xf(e,t,n,s,o,i){if(zs=i,ht=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Ga.current=e===null||e.memoizedState===null?Mw:Aw,e=n(s,o),wi){i=0;do{if(wi=!1,zi=0,25<=i)throw Error(ce(301));i+=1,Ut=_t=null,t.updateQueue=null,Ga.current=Rw,e=n(s,o)}while(wi)}if(Ga.current=kl,t=_t!==null&&_t.next!==null,zs=0,Ut=_t=ht=null,Nl=!1,t)throw Error(ce(300));return e}function yf(){var e=zi!==0;return zi=0,e}function lr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ut===null?ht.memoizedState=Ut=e:Ut=Ut.next=e,Ut}function Hn(){if(_t===null){var e=ht.alternate;e=e!==null?e.memoizedState:null}else e=_t.next;var t=Ut===null?ht.memoizedState:Ut.next;if(t!==null)Ut=t,_t=e;else{if(e===null)throw Error(ce(310));_t=e,e={memoizedState:_t.memoizedState,baseState:_t.baseState,baseQueue:_t.baseQueue,queue:_t.queue,next:null},Ut===null?ht.memoizedState=Ut=e:Ut=Ut.next=e}return Ut}function Bi(e,t){return typeof t=="function"?t(e):t}function Hc(e){var t=Hn(),n=t.queue;if(n===null)throw Error(ce(311));n.lastRenderedReducer=e;var s=_t,o=s.baseQueue,i=n.pending;if(i!==null){if(o!==null){var a=o.next;o.next=i.next,i.next=a}s.baseQueue=o=i,n.pending=null}if(o!==null){i=o.next,s=s.baseState;var c=a=null,d=null,f=i;do{var x=f.lane;if((zs&x)===x)d!==null&&(d=d.next={lane:0,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null}),s=f.hasEagerState?f.eagerState:e(s,f.action);else{var g={lane:x,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null};d===null?(c=d=g,a=s):d=d.next=g,ht.lanes|=x,Bs|=x}f=f.next}while(f!==null&&f!==i);d===null?a=s:d.next=c,er(s,t.memoizedState)||(xn=!0),t.memoizedState=s,t.baseState=a,t.baseQueue=d,n.lastRenderedState=s}if(e=n.interleaved,e!==null){o=e;do i=o.lane,ht.lanes|=i,Bs|=i,o=o.next;while(o!==e)}else o===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Wc(e){var t=Hn(),n=t.queue;if(n===null)throw Error(ce(311));n.lastRenderedReducer=e;var s=n.dispatch,o=n.pending,i=t.memoizedState;if(o!==null){n.pending=null;var a=o=o.next;do i=e(i,a.action),a=a.next;while(a!==o);er(i,t.memoizedState)||(xn=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,s]}function zg(){}function Bg(e,t){var n=ht,s=Hn(),o=t(),i=!er(s.memoizedState,o);if(i&&(s.memoizedState=o,xn=!0),s=s.queue,vf(Wg.bind(null,n,s,e),[e]),s.getSnapshot!==t||i||Ut!==null&&Ut.memoizedState.tag&1){if(n.flags|=2048,Vi(9,Hg.bind(null,n,s,o,t),void 0,null),Ot===null)throw Error(ce(349));zs&30||Vg(n,t,o)}return o}function Vg(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=ht.updateQueue,t===null?(t={lastEffect:null,stores:null},ht.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Hg(e,t,n,s){t.value=n,t.getSnapshot=s,Gg(t)&&qg(e)}function Wg(e,t,n){return n(function(){Gg(t)&&qg(e)})}function Gg(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!er(e,n)}catch{return!0}}function qg(e){var t=Pr(e,1);t!==null&&Xn(t,e,1,-1)}function th(e){var t=lr();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Bi,lastRenderedState:e},t.queue=e,e=e.dispatch=_w.bind(null,ht,e),[t.memoizedState,e]}function Vi(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=ht.updateQueue,t===null?(t={lastEffect:null,stores:null},ht.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function Kg(){return Hn().memoizedState}function qa(e,t,n,s){var o=lr();ht.flags|=e,o.memoizedState=Vi(1|t,n,void 0,s===void 0?null:s)}function Kl(e,t,n,s){var o=Hn();s=s===void 0?null:s;var i=void 0;if(_t!==null){var a=_t.memoizedState;if(i=a.destroy,s!==null&&gf(s,a.deps)){o.memoizedState=Vi(t,n,i,s);return}}ht.flags|=e,o.memoizedState=Vi(1|t,n,i,s)}function nh(e,t){return qa(8390656,8,e,t)}function vf(e,t){return Kl(2048,8,e,t)}function Yg(e,t){return Kl(4,2,e,t)}function Jg(e,t){return Kl(4,4,e,t)}function Qg(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Xg(e,t,n){return n=n!=null?n.concat([e]):null,Kl(4,4,Qg.bind(null,t,e),n)}function wf(){}function Zg(e,t){var n=Hn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&gf(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function e0(e,t){var n=Hn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&gf(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function t0(e,t,n){return zs&21?(er(n,t)||(n=ig(),ht.lanes|=n,Bs|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,xn=!0),e.memoizedState=n)}function Iw(e,t){var n=et;et=n!==0&&4>n?n:4,e(!0);var s=Vc.transition;Vc.transition={};try{e(!1),t()}finally{et=n,Vc.transition=s}}function n0(){return Hn().memoizedState}function Tw(e,t,n){var s=as(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},r0(e))s0(t,n);else if(n=$g(e,t,n,s),n!==null){var o=cn();Xn(n,e,s,o),o0(n,t,s)}}function _w(e,t,n){var s=as(e),o={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(r0(e))s0(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var a=t.lastRenderedState,c=i(a,n);if(o.hasEagerState=!0,o.eagerState=c,er(c,a)){var d=t.interleaved;d===null?(o.next=o,uf(t)):(o.next=d.next,d.next=o),t.interleaved=o;return}}catch{}finally{}n=$g(e,t,o,s),n!==null&&(o=cn(),Xn(n,e,s,o),o0(n,t,s))}}function r0(e){var t=e.alternate;return e===ht||t!==null&&t===ht}function s0(e,t){wi=Nl=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function o0(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,Ju(e,n)}}var kl={readContext:Vn,useCallback:qt,useContext:qt,useEffect:qt,useImperativeHandle:qt,useInsertionEffect:qt,useLayoutEffect:qt,useMemo:qt,useReducer:qt,useRef:qt,useState:qt,useDebugValue:qt,useDeferredValue:qt,useTransition:qt,useMutableSource:qt,useSyncExternalStore:qt,useId:qt,unstable_isNewReconciler:!1},Mw={readContext:Vn,useCallback:function(e,t){return lr().memoizedState=[e,t===void 0?null:t],e},useContext:Vn,useEffect:nh,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,qa(4194308,4,Qg.bind(null,t,e),n)},useLayoutEffect:function(e,t){return qa(4194308,4,e,t)},useInsertionEffect:function(e,t){return qa(4,2,e,t)},useMemo:function(e,t){var n=lr();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=lr();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=Tw.bind(null,ht,e),[s.memoizedState,e]},useRef:function(e){var t=lr();return e={current:e},t.memoizedState=e},useState:th,useDebugValue:wf,useDeferredValue:function(e){return lr().memoizedState=e},useTransition:function(){var e=th(!1),t=e[0];return e=Iw.bind(null,e[1]),lr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=ht,o=lr();if(ut){if(n===void 0)throw Error(ce(407));n=n()}else{if(n=t(),Ot===null)throw Error(ce(349));zs&30||Vg(s,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,nh(Wg.bind(null,s,i,e),[e]),s.flags|=2048,Vi(9,Hg.bind(null,s,i,n,t),void 0,null),n},useId:function(){var e=lr(),t=Ot.identifierPrefix;if(ut){var n=Ir,s=Er;n=(s&~(1<<32-Qn(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=zi++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=Ew++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Aw={readContext:Vn,useCallback:Zg,useContext:Vn,useEffect:vf,useImperativeHandle:Xg,useInsertionEffect:Yg,useLayoutEffect:Jg,useMemo:e0,useReducer:Hc,useRef:Kg,useState:function(){return Hc(Bi)},useDebugValue:wf,useDeferredValue:function(e){var t=Hn();return t0(t,_t.memoizedState,e)},useTransition:function(){var e=Hc(Bi)[0],t=Hn().memoizedState;return[e,t]},useMutableSource:zg,useSyncExternalStore:Bg,useId:n0,unstable_isNewReconciler:!1},Rw={readContext:Vn,useCallback:Zg,useContext:Vn,useEffect:vf,useImperativeHandle:Xg,useInsertionEffect:Yg,useLayoutEffect:Jg,useMemo:e0,useReducer:Wc,useRef:Kg,useState:function(){return Wc(Bi)},useDebugValue:wf,useDeferredValue:function(e){var t=Hn();return _t===null?t.memoizedState=e:t0(t,_t.memoizedState,e)},useTransition:function(){var e=Wc(Bi)[0],t=Hn().memoizedState;return[e,t]},useMutableSource:zg,useSyncExternalStore:Bg,useId:n0,unstable_isNewReconciler:!1};function qn(e,t){if(e&&e.defaultProps){t=pt({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Gd(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:pt({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Yl={isMounted:function(e){return(e=e._reactInternals)?Js(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=cn(),o=as(e),i=_r(s,o);i.payload=t,n!=null&&(i.callback=n),t=os(e,i,o),t!==null&&(Xn(t,e,o,s),Wa(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=cn(),o=as(e),i=_r(s,o);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=os(e,i,o),t!==null&&(Xn(t,e,o,s),Wa(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=cn(),s=as(e),o=_r(n,s);o.tag=2,t!=null&&(o.callback=t),t=os(e,o,s),t!==null&&(Xn(t,e,s,n),Wa(t,e,s))}};function rh(e,t,n,s,o,i,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,i,a):t.prototype&&t.prototype.isPureReactComponent?!Li(n,s)||!Li(o,i):!0}function i0(e,t,n){var s=!1,o=gs,i=t.contextType;return typeof i=="object"&&i!==null?i=Vn(i):(o=vn(t)?Ds:en.current,s=t.contextTypes,i=(s=s!=null)?Eo(e,o):gs),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Yl,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function sh(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&Yl.enqueueReplaceState(t,t.state,null)}function qd(e,t,n,s){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},ff(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=Vn(i):(i=vn(t)?Ds:en.current,o.context=Eo(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Gd(e,t,i,n),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&Yl.enqueueReplaceState(o,o.state,null),bl(e,n,o,s),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function Mo(e,t){try{var n="",s=t;do n+=av(s),s=s.return;while(s);var o=n}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function Gc(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Kd(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var Pw=typeof WeakMap=="function"?WeakMap:Map;function a0(e,t,n){n=_r(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){Cl||(Cl=!0,su=s),Kd(e,t)},n}function l0(e,t,n){n=_r(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var o=t.value;n.payload=function(){return s(o)},n.callback=function(){Kd(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Kd(e,t),typeof s!="function"&&(is===null?is=new Set([this]):is.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),n}function oh(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new Pw;var o=new Set;s.set(t,o)}else o=s.get(t),o===void 0&&(o=new Set,s.set(t,o));o.has(n)||(o.add(n),e=Kw.bind(null,e,t,n),t.then(e,e))}function ih(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function ah(e,t,n,s,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=_r(-1,1),t.tag=2,os(n,t,1))),n.lanes|=1),e)}var Lw=$r.ReactCurrentOwner,xn=!1;function on(e,t,n,s){t.child=e===null?Og(t,null,n,s):To(t,e.child,n,s)}function lh(e,t,n,s,o){n=n.render;var i=t.ref;return jo(t,o),s=xf(e,t,n,s,i,o),n=yf(),e!==null&&!xn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Lr(e,t,o)):(ut&&n&&sf(t),t.flags|=1,on(e,t,s,o),t.child)}function ch(e,t,n,s,o){if(e===null){var i=n.type;return typeof i=="function"&&!If(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,c0(e,t,i,s,o)):(e=Qa(n.type,null,s,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&o)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:Li,n(a,s)&&e.ref===t.ref)return Lr(e,t,o)}return t.flags|=1,e=ls(i,s),e.ref=t.ref,e.return=t,t.child=e}function c0(e,t,n,s,o){if(e!==null){var i=e.memoizedProps;if(Li(i,s)&&e.ref===t.ref)if(xn=!1,t.pendingProps=s=i,(e.lanes&o)!==0)e.flags&131072&&(xn=!0);else return t.lanes=e.lanes,Lr(e,t,o)}return Yd(e,t,n,s,o)}function d0(e,t,n){var s=t.pendingProps,o=s.children,i=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},rt(xo,En),En|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,rt(xo,En),En|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,rt(xo,En),En|=s}else i!==null?(s=i.baseLanes|n,t.memoizedState=null):s=n,rt(xo,En),En|=s;return on(e,t,o,n),t.child}function u0(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Yd(e,t,n,s,o){var i=vn(n)?Ds:en.current;return i=Eo(t,i),jo(t,o),n=xf(e,t,n,s,i,o),s=yf(),e!==null&&!xn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Lr(e,t,o)):(ut&&s&&sf(t),t.flags|=1,on(e,t,n,o),t.child)}function dh(e,t,n,s,o){if(vn(n)){var i=!0;gl(t)}else i=!1;if(jo(t,o),t.stateNode===null)Ka(e,t),i0(t,n,s),qd(t,n,s,o),s=!0;else if(e===null){var a=t.stateNode,c=t.memoizedProps;a.props=c;var d=a.context,f=n.contextType;typeof f=="object"&&f!==null?f=Vn(f):(f=vn(n)?Ds:en.current,f=Eo(t,f));var x=n.getDerivedStateFromProps,g=typeof x=="function"||typeof a.getSnapshotBeforeUpdate=="function";g||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(c!==s||d!==f)&&sh(t,a,s,f),Gr=!1;var b=t.memoizedState;a.state=b,bl(t,s,a,o),d=t.memoizedState,c!==s||b!==d||yn.current||Gr?(typeof x=="function"&&(Gd(t,n,x,s),d=t.memoizedState),(c=Gr||rh(t,n,c,s,b,d,f))?(g||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=d),a.props=s,a.state=d,a.context=f,s=c):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{a=t.stateNode,Dg(e,t),c=t.memoizedProps,f=t.type===t.elementType?c:qn(t.type,c),a.props=f,g=t.pendingProps,b=a.context,d=n.contextType,typeof d=="object"&&d!==null?d=Vn(d):(d=vn(n)?Ds:en.current,d=Eo(t,d));var _=n.getDerivedStateFromProps;(x=typeof _=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(c!==g||b!==d)&&sh(t,a,s,d),Gr=!1,b=t.memoizedState,a.state=b,bl(t,s,a,o);var I=t.memoizedState;c!==g||b!==I||yn.current||Gr?(typeof _=="function"&&(Gd(t,n,_,s),I=t.memoizedState),(f=Gr||rh(t,n,f,s,b,I,d)||!1)?(x||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,I,d),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,I,d)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||c===e.memoizedProps&&b===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&b===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=I),a.props=s,a.state=I,a.context=d,s=f):(typeof a.componentDidUpdate!="function"||c===e.memoizedProps&&b===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&b===e.memoizedState||(t.flags|=1024),s=!1)}return Jd(e,t,n,s,i,o)}function Jd(e,t,n,s,o,i){u0(e,t);var a=(t.flags&128)!==0;if(!s&&!a)return o&&Ym(t,n,!1),Lr(e,t,i);s=t.stateNode,Lw.current=t;var c=a&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&a?(t.child=To(t,e.child,null,i),t.child=To(t,null,c,i)):on(e,t,c,i),t.memoizedState=s.state,o&&Ym(t,n,!0),t.child}function f0(e){var t=e.stateNode;t.pendingContext?Km(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Km(e,t.context,!1),mf(e,t.containerInfo)}function uh(e,t,n,s,o){return Io(),af(o),t.flags|=256,on(e,t,n,s),t.child}var Qd={dehydrated:null,treeContext:null,retryLane:0};function Xd(e){return{baseLanes:e,cachePool:null,transitions:null}}function m0(e,t,n){var s=t.pendingProps,o=mt.current,i=!1,a=(t.flags&128)!==0,c;if((c=a)||(c=e!==null&&e.memoizedState===null?!1:(o&2)!==0),c?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),rt(mt,o&1),e===null)return Hd(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=s.children,e=s.fallback,i?(s=t.mode,i=t.child,a={mode:"hidden",children:a},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Xl(a,s,0,null),e=$s(e,s,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=Xd(n),t.memoizedState=Qd,e):bf(t,a));if(o=e.memoizedState,o!==null&&(c=o.dehydrated,c!==null))return Uw(e,t,a,s,c,o,n);if(i){i=s.fallback,a=t.mode,o=e.child,c=o.sibling;var d={mode:"hidden",children:s.children};return!(a&1)&&t.child!==o?(s=t.child,s.childLanes=0,s.pendingProps=d,t.deletions=null):(s=ls(o,d),s.subtreeFlags=o.subtreeFlags&14680064),c!==null?i=ls(c,i):(i=$s(i,a,n,null),i.flags|=2),i.return=t,s.return=t,s.sibling=i,t.child=s,s=i,i=t.child,a=e.child.memoizedState,a=a===null?Xd(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=e.childLanes&~n,t.memoizedState=Qd,s}return i=e.child,e=i.sibling,s=ls(i,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function bf(e,t){return t=Xl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Aa(e,t,n,s){return s!==null&&af(s),To(t,e.child,null,n),e=bf(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Uw(e,t,n,s,o,i,a){if(n)return t.flags&256?(t.flags&=-257,s=Gc(Error(ce(422))),Aa(e,t,a,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=s.fallback,o=t.mode,s=Xl({mode:"visible",children:s.children},o,0,null),i=$s(i,o,a,null),i.flags|=2,s.return=t,i.return=t,s.sibling=i,t.child=s,t.mode&1&&To(t,e.child,null,a),t.child.memoizedState=Xd(a),t.memoizedState=Qd,i);if(!(t.mode&1))return Aa(e,t,a,null);if(o.data==="$!"){if(s=o.nextSibling&&o.nextSibling.dataset,s)var c=s.dgst;return s=c,i=Error(ce(419)),s=Gc(i,s,void 0),Aa(e,t,a,s)}if(c=(a&e.childLanes)!==0,xn||c){if(s=Ot,s!==null){switch(a&-a){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(s.suspendedLanes|a)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,Pr(e,o),Xn(s,e,o,-1))}return Ef(),s=Gc(Error(ce(421))),Aa(e,t,a,s)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=Yw.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,Tn=ss(o.nextSibling),Mn=t,ut=!0,Jn=null,e!==null&&($n[Dn++]=Er,$n[Dn++]=Ir,$n[Dn++]=Fs,Er=e.id,Ir=e.overflow,Fs=t),t=bf(t,s.children),t.flags|=4096,t)}function fh(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Wd(e.return,t,n)}function qc(e,t,n,s,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=o)}function h0(e,t,n){var s=t.pendingProps,o=s.revealOrder,i=s.tail;if(on(e,t,s.children,n),s=mt.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&fh(e,n,t);else if(e.tag===19)fh(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(rt(mt,s),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;n!==null;)e=n.alternate,e!==null&&jl(e)===null&&(o=n),n=n.sibling;n=o,n===null?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),qc(t,!1,o,n,i);break;case"backwards":for(n=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&jl(e)===null){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}qc(t,!0,n,null,i);break;case"together":qc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ka(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Lr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Bs|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(ce(153));if(t.child!==null){for(e=t.child,n=ls(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=ls(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Ow(e,t,n){switch(t.tag){case 3:f0(t),Io();break;case 5:Fg(t);break;case 1:vn(t.type)&&gl(t);break;case 4:mf(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,o=t.memoizedProps.value;rt(vl,s._currentValue),s._currentValue=o;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(rt(mt,mt.current&1),t.flags|=128,null):n&t.child.childLanes?m0(e,t,n):(rt(mt,mt.current&1),e=Lr(e,t,n),e!==null?e.sibling:null);rt(mt,mt.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return h0(e,t,n);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),rt(mt,mt.current),s)break;return null;case 22:case 23:return t.lanes=0,d0(e,t,n)}return Lr(e,t,n)}var p0,Zd,g0,x0;p0=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Zd=function(){};g0=function(e,t,n,s){var o=e.memoizedProps;if(o!==s){e=t.stateNode,Ps(mr.current);var i=null;switch(n){case"input":o=bd(e,o),s=bd(e,s),i=[];break;case"select":o=pt({},o,{value:void 0}),s=pt({},s,{value:void 0}),i=[];break;case"textarea":o=kd(e,o),s=kd(e,s),i=[];break;default:typeof o.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=hl)}Cd(n,s);var a;n=null;for(f in o)if(!s.hasOwnProperty(f)&&o.hasOwnProperty(f)&&o[f]!=null)if(f==="style"){var c=o[f];for(a in c)c.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else f!=="dangerouslySetInnerHTML"&&f!=="children"&&f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(Ii.hasOwnProperty(f)?i||(i=[]):(i=i||[]).push(f,null));for(f in s){var d=s[f];if(c=o!=null?o[f]:void 0,s.hasOwnProperty(f)&&d!==c&&(d!=null||c!=null))if(f==="style")if(c){for(a in c)!c.hasOwnProperty(a)||d&&d.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in d)d.hasOwnProperty(a)&&c[a]!==d[a]&&(n||(n={}),n[a]=d[a])}else n||(i||(i=[]),i.push(f,n)),n=d;else f==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,c=c?c.__html:void 0,d!=null&&c!==d&&(i=i||[]).push(f,d)):f==="children"?typeof d!="string"&&typeof d!="number"||(i=i||[]).push(f,""+d):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&(Ii.hasOwnProperty(f)?(d!=null&&f==="onScroll"&&st("scroll",e),i||c===d||(i=[])):(i=i||[]).push(f,d))}n&&(i=i||[]).push("style",n);var f=i;(t.updateQueue=f)&&(t.flags|=4)}};x0=function(e,t,n,s){n!==s&&(t.flags|=4)};function ii(e,t){if(!ut)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Kt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var o=e.child;o!==null;)n|=o.lanes|o.childLanes,s|=o.subtreeFlags&14680064,s|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)n|=o.lanes|o.childLanes,s|=o.subtreeFlags,s|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function $w(e,t,n){var s=t.pendingProps;switch(of(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Kt(t),null;case 1:return vn(t.type)&&pl(),Kt(t),null;case 3:return s=t.stateNode,_o(),it(yn),it(en),pf(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(_a(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Jn!==null&&(au(Jn),Jn=null))),Zd(e,t),Kt(t),null;case 5:hf(t);var o=Ps(Fi.current);if(n=t.type,e!==null&&t.stateNode!=null)g0(e,t,n,s,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(ce(166));return Kt(t),null}if(e=Ps(mr.current),_a(t)){s=t.stateNode,n=t.type;var i=t.memoizedProps;switch(s[dr]=t,s[$i]=i,e=(t.mode&1)!==0,n){case"dialog":st("cancel",s),st("close",s);break;case"iframe":case"object":case"embed":st("load",s);break;case"video":case"audio":for(o=0;o<mi.length;o++)st(mi[o],s);break;case"source":st("error",s);break;case"img":case"image":case"link":st("error",s),st("load",s);break;case"details":st("toggle",s);break;case"input":bm(s,i),st("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},st("invalid",s);break;case"textarea":Nm(s,i),st("invalid",s)}Cd(n,i),o=null;for(var a in i)if(i.hasOwnProperty(a)){var c=i[a];a==="children"?typeof c=="string"?s.textContent!==c&&(i.suppressHydrationWarning!==!0&&Ta(s.textContent,c,e),o=["children",c]):typeof c=="number"&&s.textContent!==""+c&&(i.suppressHydrationWarning!==!0&&Ta(s.textContent,c,e),o=["children",""+c]):Ii.hasOwnProperty(a)&&c!=null&&a==="onScroll"&&st("scroll",s)}switch(n){case"input":ba(s),jm(s,i,!0);break;case"textarea":ba(s),km(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=hl)}s=o,t.updateQueue=s,s!==null&&(t.flags|=4)}else{a=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Wp(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=a.createElement(n,{is:s.is}):(e=a.createElement(n),n==="select"&&(a=e,s.multiple?a.multiple=!0:s.size&&(a.size=s.size))):e=a.createElementNS(e,n),e[dr]=t,e[$i]=s,p0(e,t,!1,!1),t.stateNode=e;e:{switch(a=Ed(n,s),n){case"dialog":st("cancel",e),st("close",e),o=s;break;case"iframe":case"object":case"embed":st("load",e),o=s;break;case"video":case"audio":for(o=0;o<mi.length;o++)st(mi[o],e);o=s;break;case"source":st("error",e),o=s;break;case"img":case"image":case"link":st("error",e),st("load",e),o=s;break;case"details":st("toggle",e),o=s;break;case"input":bm(e,s),o=bd(e,s),st("invalid",e);break;case"option":o=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},o=pt({},s,{value:void 0}),st("invalid",e);break;case"textarea":Nm(e,s),o=kd(e,s),st("invalid",e);break;default:o=s}Cd(n,o),c=o;for(i in c)if(c.hasOwnProperty(i)){var d=c[i];i==="style"?Kp(e,d):i==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&Gp(e,d)):i==="children"?typeof d=="string"?(n!=="textarea"||d!=="")&&Ti(e,d):typeof d=="number"&&Ti(e,""+d):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ii.hasOwnProperty(i)?d!=null&&i==="onScroll"&&st("scroll",e):d!=null&&Hu(e,i,d,a))}switch(n){case"input":ba(e),jm(e,s,!1);break;case"textarea":ba(e),km(e);break;case"option":s.value!=null&&e.setAttribute("value",""+ps(s.value));break;case"select":e.multiple=!!s.multiple,i=s.value,i!=null?yo(e,!!s.multiple,i,!1):s.defaultValue!=null&&yo(e,!!s.multiple,s.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=hl)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Kt(t),null;case 6:if(e&&t.stateNode!=null)x0(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(ce(166));if(n=Ps(Fi.current),Ps(mr.current),_a(t)){if(s=t.stateNode,n=t.memoizedProps,s[dr]=t,(i=s.nodeValue!==n)&&(e=Mn,e!==null))switch(e.tag){case 3:Ta(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Ta(s.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[dr]=t,t.stateNode=s}return Kt(t),null;case 13:if(it(mt),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ut&&Tn!==null&&t.mode&1&&!(t.flags&128))Lg(),Io(),t.flags|=98560,i=!1;else if(i=_a(t),s!==null&&s.dehydrated!==null){if(e===null){if(!i)throw Error(ce(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ce(317));i[dr]=t}else Io(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Kt(t),i=!1}else Jn!==null&&(au(Jn),Jn=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||mt.current&1?Mt===0&&(Mt=3):Ef())),t.updateQueue!==null&&(t.flags|=4),Kt(t),null);case 4:return _o(),Zd(e,t),e===null&&Ui(t.stateNode.containerInfo),Kt(t),null;case 10:return df(t.type._context),Kt(t),null;case 17:return vn(t.type)&&pl(),Kt(t),null;case 19:if(it(mt),i=t.memoizedState,i===null)return Kt(t),null;if(s=(t.flags&128)!==0,a=i.rendering,a===null)if(s)ii(i,!1);else{if(Mt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=jl(e),a!==null){for(t.flags|=128,ii(i,!1),s=a.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)i=n,e=s,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,e=a.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return rt(mt,mt.current&1|2),t.child}e=e.sibling}i.tail!==null&&Nt()>Ao&&(t.flags|=128,s=!0,ii(i,!1),t.lanes=4194304)}else{if(!s)if(e=jl(a),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),ii(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!ut)return Kt(t),null}else 2*Nt()-i.renderingStartTime>Ao&&n!==1073741824&&(t.flags|=128,s=!0,ii(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(n=i.last,n!==null?n.sibling=a:t.child=a,i.last=a)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Nt(),t.sibling=null,n=mt.current,rt(mt,s?n&1|2:n&1),t):(Kt(t),null);case 22:case 23:return Cf(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?En&1073741824&&(Kt(t),t.subtreeFlags&6&&(t.flags|=8192)):Kt(t),null;case 24:return null;case 25:return null}throw Error(ce(156,t.tag))}function Dw(e,t){switch(of(t),t.tag){case 1:return vn(t.type)&&pl(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return _o(),it(yn),it(en),pf(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return hf(t),null;case 13:if(it(mt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ce(340));Io()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return it(mt),null;case 4:return _o(),null;case 10:return df(t.type._context),null;case 22:case 23:return Cf(),null;case 24:return null;default:return null}}var Ra=!1,Yt=!1,Fw=typeof WeakSet=="function"?WeakSet:Set,je=null;function go(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){vt(e,t,s)}else n.current=null}function eu(e,t,n){try{n()}catch(s){vt(e,t,s)}}var mh=!1;function zw(e,t){if(Od=ul,e=jg(),rf(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var o=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,c=-1,d=-1,f=0,x=0,g=e,b=null;t:for(;;){for(var _;g!==n||o!==0&&g.nodeType!==3||(c=a+o),g!==i||s!==0&&g.nodeType!==3||(d=a+s),g.nodeType===3&&(a+=g.nodeValue.length),(_=g.firstChild)!==null;)b=g,g=_;for(;;){if(g===e)break t;if(b===n&&++f===o&&(c=a),b===i&&++x===s&&(d=a),(_=g.nextSibling)!==null)break;g=b,b=g.parentNode}g=_}n=c===-1||d===-1?null:{start:c,end:d}}else n=null}n=n||{start:0,end:0}}else n=null;for($d={focusedElem:e,selectionRange:n},ul=!1,je=t;je!==null;)if(t=je,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,je=e;else for(;je!==null;){t=je;try{var I=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(I!==null){var M=I.memoizedProps,v=I.memoizedState,w=t.stateNode,m=w.getSnapshotBeforeUpdate(t.elementType===t.type?M:qn(t.type,M),v);w.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var y=t.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ce(163))}}catch(R){vt(t,t.return,R)}if(e=t.sibling,e!==null){e.return=t.return,je=e;break}je=t.return}return I=mh,mh=!1,I}function bi(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var o=s=s.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&eu(t,n,i)}o=o.next}while(o!==s)}}function Jl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function tu(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function y0(e){var t=e.alternate;t!==null&&(e.alternate=null,y0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[dr],delete t[$i],delete t[zd],delete t[Nw],delete t[kw])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function v0(e){return e.tag===5||e.tag===3||e.tag===4}function hh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||v0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function nu(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=hl));else if(s!==4&&(e=e.child,e!==null))for(nu(e,t,n),e=e.sibling;e!==null;)nu(e,t,n),e=e.sibling}function ru(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(ru(e,t,n),e=e.sibling;e!==null;)ru(e,t,n),e=e.sibling}var Ft=null,Kn=!1;function Hr(e,t,n){for(n=n.child;n!==null;)w0(e,t,n),n=n.sibling}function w0(e,t,n){if(fr&&typeof fr.onCommitFiberUnmount=="function")try{fr.onCommitFiberUnmount(Bl,n)}catch{}switch(n.tag){case 5:Yt||go(n,t);case 6:var s=Ft,o=Kn;Ft=null,Hr(e,t,n),Ft=s,Kn=o,Ft!==null&&(Kn?(e=Ft,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Ft.removeChild(n.stateNode));break;case 18:Ft!==null&&(Kn?(e=Ft,n=n.stateNode,e.nodeType===8?Fc(e.parentNode,n):e.nodeType===1&&Fc(e,n),Ri(e)):Fc(Ft,n.stateNode));break;case 4:s=Ft,o=Kn,Ft=n.stateNode.containerInfo,Kn=!0,Hr(e,t,n),Ft=s,Kn=o;break;case 0:case 11:case 14:case 15:if(!Yt&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){o=s=s.next;do{var i=o,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&eu(n,t,a),o=o.next}while(o!==s)}Hr(e,t,n);break;case 1:if(!Yt&&(go(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(c){vt(n,t,c)}Hr(e,t,n);break;case 21:Hr(e,t,n);break;case 22:n.mode&1?(Yt=(s=Yt)||n.memoizedState!==null,Hr(e,t,n),Yt=s):Hr(e,t,n);break;default:Hr(e,t,n)}}function ph(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new Fw),t.forEach(function(s){var o=Jw.bind(null,e,s);n.has(s)||(n.add(s),s.then(o,o))})}}function Gn(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var o=n[s];try{var i=e,a=t,c=a;e:for(;c!==null;){switch(c.tag){case 5:Ft=c.stateNode,Kn=!1;break e;case 3:Ft=c.stateNode.containerInfo,Kn=!0;break e;case 4:Ft=c.stateNode.containerInfo,Kn=!0;break e}c=c.return}if(Ft===null)throw Error(ce(160));w0(i,a,o),Ft=null,Kn=!1;var d=o.alternate;d!==null&&(d.return=null),o.return=null}catch(f){vt(o,t,f)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)b0(t,e),t=t.sibling}function b0(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Gn(t,e),ir(e),s&4){try{bi(3,e,e.return),Jl(3,e)}catch(M){vt(e,e.return,M)}try{bi(5,e,e.return)}catch(M){vt(e,e.return,M)}}break;case 1:Gn(t,e),ir(e),s&512&&n!==null&&go(n,n.return);break;case 5:if(Gn(t,e),ir(e),s&512&&n!==null&&go(n,n.return),e.flags&32){var o=e.stateNode;try{Ti(o,"")}catch(M){vt(e,e.return,M)}}if(s&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,a=n!==null?n.memoizedProps:i,c=e.type,d=e.updateQueue;if(e.updateQueue=null,d!==null)try{c==="input"&&i.type==="radio"&&i.name!=null&&Vp(o,i),Ed(c,a);var f=Ed(c,i);for(a=0;a<d.length;a+=2){var x=d[a],g=d[a+1];x==="style"?Kp(o,g):x==="dangerouslySetInnerHTML"?Gp(o,g):x==="children"?Ti(o,g):Hu(o,x,g,f)}switch(c){case"input":jd(o,i);break;case"textarea":Hp(o,i);break;case"select":var b=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var _=i.value;_!=null?yo(o,!!i.multiple,_,!1):b!==!!i.multiple&&(i.defaultValue!=null?yo(o,!!i.multiple,i.defaultValue,!0):yo(o,!!i.multiple,i.multiple?[]:"",!1))}o[$i]=i}catch(M){vt(e,e.return,M)}}break;case 6:if(Gn(t,e),ir(e),s&4){if(e.stateNode===null)throw Error(ce(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(M){vt(e,e.return,M)}}break;case 3:if(Gn(t,e),ir(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{Ri(t.containerInfo)}catch(M){vt(e,e.return,M)}break;case 4:Gn(t,e),ir(e);break;case 13:Gn(t,e),ir(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(kf=Nt())),s&4&&ph(e);break;case 22:if(x=n!==null&&n.memoizedState!==null,e.mode&1?(Yt=(f=Yt)||x,Gn(t,e),Yt=f):Gn(t,e),ir(e),s&8192){if(f=e.memoizedState!==null,(e.stateNode.isHidden=f)&&!x&&e.mode&1)for(je=e,x=e.child;x!==null;){for(g=je=x;je!==null;){switch(b=je,_=b.child,b.tag){case 0:case 11:case 14:case 15:bi(4,b,b.return);break;case 1:go(b,b.return);var I=b.stateNode;if(typeof I.componentWillUnmount=="function"){s=b,n=b.return;try{t=s,I.props=t.memoizedProps,I.state=t.memoizedState,I.componentWillUnmount()}catch(M){vt(s,n,M)}}break;case 5:go(b,b.return);break;case 22:if(b.memoizedState!==null){xh(g);continue}}_!==null?(_.return=b,je=_):xh(g)}x=x.sibling}e:for(x=null,g=e;;){if(g.tag===5){if(x===null){x=g;try{o=g.stateNode,f?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(c=g.stateNode,d=g.memoizedProps.style,a=d!=null&&d.hasOwnProperty("display")?d.display:null,c.style.display=qp("display",a))}catch(M){vt(e,e.return,M)}}}else if(g.tag===6){if(x===null)try{g.stateNode.nodeValue=f?"":g.memoizedProps}catch(M){vt(e,e.return,M)}}else if((g.tag!==22&&g.tag!==23||g.memoizedState===null||g===e)&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===e)break e;for(;g.sibling===null;){if(g.return===null||g.return===e)break e;x===g&&(x=null),g=g.return}x===g&&(x=null),g.sibling.return=g.return,g=g.sibling}}break;case 19:Gn(t,e),ir(e),s&4&&ph(e);break;case 21:break;default:Gn(t,e),ir(e)}}function ir(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(v0(n)){var s=n;break e}n=n.return}throw Error(ce(160))}switch(s.tag){case 5:var o=s.stateNode;s.flags&32&&(Ti(o,""),s.flags&=-33);var i=hh(e);ru(e,i,o);break;case 3:case 4:var a=s.stateNode.containerInfo,c=hh(e);nu(e,c,a);break;default:throw Error(ce(161))}}catch(d){vt(e,e.return,d)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Bw(e,t,n){je=e,j0(e)}function j0(e,t,n){for(var s=(e.mode&1)!==0;je!==null;){var o=je,i=o.child;if(o.tag===22&&s){var a=o.memoizedState!==null||Ra;if(!a){var c=o.alternate,d=c!==null&&c.memoizedState!==null||Yt;c=Ra;var f=Yt;if(Ra=a,(Yt=d)&&!f)for(je=o;je!==null;)a=je,d=a.child,a.tag===22&&a.memoizedState!==null?yh(o):d!==null?(d.return=a,je=d):yh(o);for(;i!==null;)je=i,j0(i),i=i.sibling;je=o,Ra=c,Yt=f}gh(e)}else o.subtreeFlags&8772&&i!==null?(i.return=o,je=i):gh(e)}}function gh(e){for(;je!==null;){var t=je;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Yt||Jl(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!Yt)if(n===null)s.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:qn(t.type,n.memoizedProps);s.componentDidUpdate(o,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&eh(t,i,s);break;case 3:var a=t.updateQueue;if(a!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}eh(t,a,n)}break;case 5:var c=t.stateNode;if(n===null&&t.flags&4){n=c;var d=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&n.focus();break;case"img":d.src&&(n.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var f=t.alternate;if(f!==null){var x=f.memoizedState;if(x!==null){var g=x.dehydrated;g!==null&&Ri(g)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ce(163))}Yt||t.flags&512&&tu(t)}catch(b){vt(t,t.return,b)}}if(t===e){je=null;break}if(n=t.sibling,n!==null){n.return=t.return,je=n;break}je=t.return}}function xh(e){for(;je!==null;){var t=je;if(t===e){je=null;break}var n=t.sibling;if(n!==null){n.return=t.return,je=n;break}je=t.return}}function yh(e){for(;je!==null;){var t=je;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Jl(4,t)}catch(d){vt(t,n,d)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var o=t.return;try{s.componentDidMount()}catch(d){vt(t,o,d)}}var i=t.return;try{tu(t)}catch(d){vt(t,i,d)}break;case 5:var a=t.return;try{tu(t)}catch(d){vt(t,a,d)}}}catch(d){vt(t,t.return,d)}if(t===e){je=null;break}var c=t.sibling;if(c!==null){c.return=t.return,je=c;break}je=t.return}}var Vw=Math.ceil,Sl=$r.ReactCurrentDispatcher,jf=$r.ReactCurrentOwner,Bn=$r.ReactCurrentBatchConfig,Ke=0,Ot=null,Et=null,Bt=0,En=0,xo=vs(0),Mt=0,Hi=null,Bs=0,Ql=0,Nf=0,ji=null,gn=null,kf=0,Ao=1/0,Nr=null,Cl=!1,su=null,is=null,Pa=!1,Qr=null,El=0,Ni=0,ou=null,Ya=-1,Ja=0;function cn(){return Ke&6?Nt():Ya!==-1?Ya:Ya=Nt()}function as(e){return e.mode&1?Ke&2&&Bt!==0?Bt&-Bt:Cw.transition!==null?(Ja===0&&(Ja=ig()),Ja):(e=et,e!==0||(e=window.event,e=e===void 0?16:mg(e.type)),e):1}function Xn(e,t,n,s){if(50<Ni)throw Ni=0,ou=null,Error(ce(185));ta(e,n,s),(!(Ke&2)||e!==Ot)&&(e===Ot&&(!(Ke&2)&&(Ql|=n),Mt===4&&Kr(e,Bt)),wn(e,s),n===1&&Ke===0&&!(t.mode&1)&&(Ao=Nt()+500,ql&&ws()))}function wn(e,t){var n=e.callbackNode;Cv(e,t);var s=dl(e,e===Ot?Bt:0);if(s===0)n!==null&&Em(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&Em(n),t===1)e.tag===0?Sw(vh.bind(null,e)):Ag(vh.bind(null,e)),bw(function(){!(Ke&6)&&ws()}),n=null;else{switch(ag(s)){case 1:n=Yu;break;case 4:n=sg;break;case 16:n=cl;break;case 536870912:n=og;break;default:n=cl}n=_0(n,N0.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function N0(e,t){if(Ya=-1,Ja=0,Ke&6)throw Error(ce(327));var n=e.callbackNode;if(No()&&e.callbackNode!==n)return null;var s=dl(e,e===Ot?Bt:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=Il(e,s);else{t=s;var o=Ke;Ke|=2;var i=S0();(Ot!==e||Bt!==t)&&(Nr=null,Ao=Nt()+500,Os(e,t));do try{Gw();break}catch(c){k0(e,c)}while(1);cf(),Sl.current=i,Ke=o,Et!==null?t=0:(Ot=null,Bt=0,t=Mt)}if(t!==0){if(t===2&&(o=Ad(e),o!==0&&(s=o,t=iu(e,o))),t===1)throw n=Hi,Os(e,0),Kr(e,s),wn(e,Nt()),n;if(t===6)Kr(e,s);else{if(o=e.current.alternate,!(s&30)&&!Hw(o)&&(t=Il(e,s),t===2&&(i=Ad(e),i!==0&&(s=i,t=iu(e,i))),t===1))throw n=Hi,Os(e,0),Kr(e,s),wn(e,Nt()),n;switch(e.finishedWork=o,e.finishedLanes=s,t){case 0:case 1:throw Error(ce(345));case 2:Ts(e,gn,Nr);break;case 3:if(Kr(e,s),(s&130023424)===s&&(t=kf+500-Nt(),10<t)){if(dl(e,0)!==0)break;if(o=e.suspendedLanes,(o&s)!==s){cn(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=Fd(Ts.bind(null,e,gn,Nr),t);break}Ts(e,gn,Nr);break;case 4:if(Kr(e,s),(s&4194240)===s)break;for(t=e.eventTimes,o=-1;0<s;){var a=31-Qn(s);i=1<<a,a=t[a],a>o&&(o=a),s&=~i}if(s=o,s=Nt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*Vw(s/1960))-s,10<s){e.timeoutHandle=Fd(Ts.bind(null,e,gn,Nr),s);break}Ts(e,gn,Nr);break;case 5:Ts(e,gn,Nr);break;default:throw Error(ce(329))}}}return wn(e,Nt()),e.callbackNode===n?N0.bind(null,e):null}function iu(e,t){var n=ji;return e.current.memoizedState.isDehydrated&&(Os(e,t).flags|=256),e=Il(e,t),e!==2&&(t=gn,gn=n,t!==null&&au(t)),e}function au(e){gn===null?gn=e:gn.push.apply(gn,e)}function Hw(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var o=n[s],i=o.getSnapshot;o=o.value;try{if(!er(i(),o))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Kr(e,t){for(t&=~Nf,t&=~Ql,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Qn(t),s=1<<n;e[n]=-1,t&=~s}}function vh(e){if(Ke&6)throw Error(ce(327));No();var t=dl(e,0);if(!(t&1))return wn(e,Nt()),null;var n=Il(e,t);if(e.tag!==0&&n===2){var s=Ad(e);s!==0&&(t=s,n=iu(e,s))}if(n===1)throw n=Hi,Os(e,0),Kr(e,t),wn(e,Nt()),n;if(n===6)throw Error(ce(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ts(e,gn,Nr),wn(e,Nt()),null}function Sf(e,t){var n=Ke;Ke|=1;try{return e(t)}finally{Ke=n,Ke===0&&(Ao=Nt()+500,ql&&ws())}}function Vs(e){Qr!==null&&Qr.tag===0&&!(Ke&6)&&No();var t=Ke;Ke|=1;var n=Bn.transition,s=et;try{if(Bn.transition=null,et=1,e)return e()}finally{et=s,Bn.transition=n,Ke=t,!(Ke&6)&&ws()}}function Cf(){En=xo.current,it(xo)}function Os(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,ww(n)),Et!==null)for(n=Et.return;n!==null;){var s=n;switch(of(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&pl();break;case 3:_o(),it(yn),it(en),pf();break;case 5:hf(s);break;case 4:_o();break;case 13:it(mt);break;case 19:it(mt);break;case 10:df(s.type._context);break;case 22:case 23:Cf()}n=n.return}if(Ot=e,Et=e=ls(e.current,null),Bt=En=t,Mt=0,Hi=null,Nf=Ql=Bs=0,gn=ji=null,Rs!==null){for(t=0;t<Rs.length;t++)if(n=Rs[t],s=n.interleaved,s!==null){n.interleaved=null;var o=s.next,i=n.pending;if(i!==null){var a=i.next;i.next=o,s.next=a}n.pending=s}Rs=null}return e}function k0(e,t){do{var n=Et;try{if(cf(),Ga.current=kl,Nl){for(var s=ht.memoizedState;s!==null;){var o=s.queue;o!==null&&(o.pending=null),s=s.next}Nl=!1}if(zs=0,Ut=_t=ht=null,wi=!1,zi=0,jf.current=null,n===null||n.return===null){Mt=1,Hi=t,Et=null;break}e:{var i=e,a=n.return,c=n,d=t;if(t=Bt,c.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var f=d,x=c,g=x.tag;if(!(x.mode&1)&&(g===0||g===11||g===15)){var b=x.alternate;b?(x.updateQueue=b.updateQueue,x.memoizedState=b.memoizedState,x.lanes=b.lanes):(x.updateQueue=null,x.memoizedState=null)}var _=ih(a);if(_!==null){_.flags&=-257,ah(_,a,c,i,t),_.mode&1&&oh(i,f,t),t=_,d=f;var I=t.updateQueue;if(I===null){var M=new Set;M.add(d),t.updateQueue=M}else I.add(d);break e}else{if(!(t&1)){oh(i,f,t),Ef();break e}d=Error(ce(426))}}else if(ut&&c.mode&1){var v=ih(a);if(v!==null){!(v.flags&65536)&&(v.flags|=256),ah(v,a,c,i,t),af(Mo(d,c));break e}}i=d=Mo(d,c),Mt!==4&&(Mt=2),ji===null?ji=[i]:ji.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var w=a0(i,d,t);Zm(i,w);break e;case 1:c=d;var m=i.type,y=i.stateNode;if(!(i.flags&128)&&(typeof m.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(is===null||!is.has(y)))){i.flags|=65536,t&=-t,i.lanes|=t;var R=l0(i,c,t);Zm(i,R);break e}}i=i.return}while(i!==null)}E0(n)}catch(U){t=U,Et===n&&n!==null&&(Et=n=n.return);continue}break}while(1)}function S0(){var e=Sl.current;return Sl.current=kl,e===null?kl:e}function Ef(){(Mt===0||Mt===3||Mt===2)&&(Mt=4),Ot===null||!(Bs&268435455)&&!(Ql&268435455)||Kr(Ot,Bt)}function Il(e,t){var n=Ke;Ke|=2;var s=S0();(Ot!==e||Bt!==t)&&(Nr=null,Os(e,t));do try{Ww();break}catch(o){k0(e,o)}while(1);if(cf(),Ke=n,Sl.current=s,Et!==null)throw Error(ce(261));return Ot=null,Bt=0,Mt}function Ww(){for(;Et!==null;)C0(Et)}function Gw(){for(;Et!==null&&!xv();)C0(Et)}function C0(e){var t=T0(e.alternate,e,En);e.memoizedProps=e.pendingProps,t===null?E0(e):Et=t,jf.current=null}function E0(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=Dw(n,t),n!==null){n.flags&=32767,Et=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Mt=6,Et=null;return}}else if(n=$w(n,t,En),n!==null){Et=n;return}if(t=t.sibling,t!==null){Et=t;return}Et=t=e}while(t!==null);Mt===0&&(Mt=5)}function Ts(e,t,n){var s=et,o=Bn.transition;try{Bn.transition=null,et=1,qw(e,t,n,s)}finally{Bn.transition=o,et=s}return null}function qw(e,t,n,s){do No();while(Qr!==null);if(Ke&6)throw Error(ce(327));n=e.finishedWork;var o=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(ce(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(Ev(e,i),e===Ot&&(Et=Ot=null,Bt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Pa||(Pa=!0,_0(cl,function(){return No(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Bn.transition,Bn.transition=null;var a=et;et=1;var c=Ke;Ke|=4,jf.current=null,zw(e,n),b0(n,e),mw($d),ul=!!Od,$d=Od=null,e.current=n,Bw(n),yv(),Ke=c,et=a,Bn.transition=i}else e.current=n;if(Pa&&(Pa=!1,Qr=e,El=o),i=e.pendingLanes,i===0&&(is=null),bv(n.stateNode),wn(e,Nt()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],s(o.value,{componentStack:o.stack,digest:o.digest});if(Cl)throw Cl=!1,e=su,su=null,e;return El&1&&e.tag!==0&&No(),i=e.pendingLanes,i&1?e===ou?Ni++:(Ni=0,ou=e):Ni=0,ws(),null}function No(){if(Qr!==null){var e=ag(El),t=Bn.transition,n=et;try{if(Bn.transition=null,et=16>e?16:e,Qr===null)var s=!1;else{if(e=Qr,Qr=null,El=0,Ke&6)throw Error(ce(331));var o=Ke;for(Ke|=4,je=e.current;je!==null;){var i=je,a=i.child;if(je.flags&16){var c=i.deletions;if(c!==null){for(var d=0;d<c.length;d++){var f=c[d];for(je=f;je!==null;){var x=je;switch(x.tag){case 0:case 11:case 15:bi(8,x,i)}var g=x.child;if(g!==null)g.return=x,je=g;else for(;je!==null;){x=je;var b=x.sibling,_=x.return;if(y0(x),x===f){je=null;break}if(b!==null){b.return=_,je=b;break}je=_}}}var I=i.alternate;if(I!==null){var M=I.child;if(M!==null){I.child=null;do{var v=M.sibling;M.sibling=null,M=v}while(M!==null)}}je=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,je=a;else e:for(;je!==null;){if(i=je,i.flags&2048)switch(i.tag){case 0:case 11:case 15:bi(9,i,i.return)}var w=i.sibling;if(w!==null){w.return=i.return,je=w;break e}je=i.return}}var m=e.current;for(je=m;je!==null;){a=je;var y=a.child;if(a.subtreeFlags&2064&&y!==null)y.return=a,je=y;else e:for(a=m;je!==null;){if(c=je,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Jl(9,c)}}catch(U){vt(c,c.return,U)}if(c===a){je=null;break e}var R=c.sibling;if(R!==null){R.return=c.return,je=R;break e}je=c.return}}if(Ke=o,ws(),fr&&typeof fr.onPostCommitFiberRoot=="function")try{fr.onPostCommitFiberRoot(Bl,e)}catch{}s=!0}return s}finally{et=n,Bn.transition=t}}return!1}function wh(e,t,n){t=Mo(n,t),t=a0(e,t,1),e=os(e,t,1),t=cn(),e!==null&&(ta(e,1,t),wn(e,t))}function vt(e,t,n){if(e.tag===3)wh(e,e,n);else for(;t!==null;){if(t.tag===3){wh(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(is===null||!is.has(s))){e=Mo(n,e),e=l0(t,e,1),t=os(t,e,1),e=cn(),t!==null&&(ta(t,1,e),wn(t,e));break}}t=t.return}}function Kw(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=cn(),e.pingedLanes|=e.suspendedLanes&n,Ot===e&&(Bt&n)===n&&(Mt===4||Mt===3&&(Bt&130023424)===Bt&&500>Nt()-kf?Os(e,0):Nf|=n),wn(e,t)}function I0(e,t){t===0&&(e.mode&1?(t=ka,ka<<=1,!(ka&130023424)&&(ka=4194304)):t=1);var n=cn();e=Pr(e,t),e!==null&&(ta(e,t,n),wn(e,n))}function Yw(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),I0(e,n)}function Jw(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,o=e.memoizedState;o!==null&&(n=o.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(ce(314))}s!==null&&s.delete(t),I0(e,n)}var T0;T0=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||yn.current)xn=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return xn=!1,Ow(e,t,n);xn=!!(e.flags&131072)}else xn=!1,ut&&t.flags&1048576&&Rg(t,yl,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;Ka(e,t),e=t.pendingProps;var o=Eo(t,en.current);jo(t,n),o=xf(null,t,s,e,o,n);var i=yf();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,vn(s)?(i=!0,gl(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,ff(t),o.updater=Yl,t.stateNode=o,o._reactInternals=t,qd(t,s,e,n),t=Jd(null,t,s,!0,i,n)):(t.tag=0,ut&&i&&sf(t),on(null,t,o,n),t=t.child),t;case 16:s=t.elementType;e:{switch(Ka(e,t),e=t.pendingProps,o=s._init,s=o(s._payload),t.type=s,o=t.tag=Xw(s),e=qn(s,e),o){case 0:t=Yd(null,t,s,e,n);break e;case 1:t=dh(null,t,s,e,n);break e;case 11:t=lh(null,t,s,e,n);break e;case 14:t=ch(null,t,s,qn(s.type,e),n);break e}throw Error(ce(306,s,""))}return t;case 0:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:qn(s,o),Yd(e,t,s,o,n);case 1:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:qn(s,o),dh(e,t,s,o,n);case 3:e:{if(f0(t),e===null)throw Error(ce(387));s=t.pendingProps,i=t.memoizedState,o=i.element,Dg(e,t),bl(t,s,null,n);var a=t.memoizedState;if(s=a.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=Mo(Error(ce(423)),t),t=uh(e,t,s,n,o);break e}else if(s!==o){o=Mo(Error(ce(424)),t),t=uh(e,t,s,n,o);break e}else for(Tn=ss(t.stateNode.containerInfo.firstChild),Mn=t,ut=!0,Jn=null,n=Og(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Io(),s===o){t=Lr(e,t,n);break e}on(e,t,s,n)}t=t.child}return t;case 5:return Fg(t),e===null&&Hd(t),s=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,a=o.children,Dd(s,o)?a=null:i!==null&&Dd(s,i)&&(t.flags|=32),u0(e,t),on(e,t,a,n),t.child;case 6:return e===null&&Hd(t),null;case 13:return m0(e,t,n);case 4:return mf(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=To(t,null,s,n):on(e,t,s,n),t.child;case 11:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:qn(s,o),lh(e,t,s,o,n);case 7:return on(e,t,t.pendingProps,n),t.child;case 8:return on(e,t,t.pendingProps.children,n),t.child;case 12:return on(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,o=t.pendingProps,i=t.memoizedProps,a=o.value,rt(vl,s._currentValue),s._currentValue=a,i!==null)if(er(i.value,a)){if(i.children===o.children&&!yn.current){t=Lr(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var c=i.dependencies;if(c!==null){a=i.child;for(var d=c.firstContext;d!==null;){if(d.context===s){if(i.tag===1){d=_r(-1,n&-n),d.tag=2;var f=i.updateQueue;if(f!==null){f=f.shared;var x=f.pending;x===null?d.next=d:(d.next=x.next,x.next=d),f.pending=d}}i.lanes|=n,d=i.alternate,d!==null&&(d.lanes|=n),Wd(i.return,n,t),c.lanes|=n;break}d=d.next}}else if(i.tag===10)a=i.type===t.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(ce(341));a.lanes|=n,c=a.alternate,c!==null&&(c.lanes|=n),Wd(a,n,t),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}on(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,s=t.pendingProps.children,jo(t,n),o=Vn(o),s=s(o),t.flags|=1,on(e,t,s,n),t.child;case 14:return s=t.type,o=qn(s,t.pendingProps),o=qn(s.type,o),ch(e,t,s,o,n);case 15:return c0(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,o=t.pendingProps,o=t.elementType===s?o:qn(s,o),Ka(e,t),t.tag=1,vn(s)?(e=!0,gl(t)):e=!1,jo(t,n),i0(t,s,o),qd(t,s,o,n),Jd(null,t,s,!0,e,n);case 19:return h0(e,t,n);case 22:return d0(e,t,n)}throw Error(ce(156,t.tag))};function _0(e,t){return rg(e,t)}function Qw(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zn(e,t,n,s){return new Qw(e,t,n,s)}function If(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Xw(e){if(typeof e=="function")return If(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Gu)return 11;if(e===qu)return 14}return 2}function ls(e,t){var n=e.alternate;return n===null?(n=zn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Qa(e,t,n,s,o,i){var a=2;if(s=e,typeof e=="function")If(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case io:return $s(n.children,o,i,t);case Wu:a=8,o|=8;break;case xd:return e=zn(12,n,t,o|2),e.elementType=xd,e.lanes=i,e;case yd:return e=zn(13,n,t,o),e.elementType=yd,e.lanes=i,e;case vd:return e=zn(19,n,t,o),e.elementType=vd,e.lanes=i,e;case Fp:return Xl(n,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case $p:a=10;break e;case Dp:a=9;break e;case Gu:a=11;break e;case qu:a=14;break e;case Wr:a=16,s=null;break e}throw Error(ce(130,e==null?e:typeof e,""))}return t=zn(a,n,t,o),t.elementType=e,t.type=s,t.lanes=i,t}function $s(e,t,n,s){return e=zn(7,e,s,t),e.lanes=n,e}function Xl(e,t,n,s){return e=zn(22,e,s,t),e.elementType=Fp,e.lanes=n,e.stateNode={isHidden:!1},e}function Kc(e,t,n){return e=zn(6,e,null,t),e.lanes=n,e}function Yc(e,t,n){return t=zn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Zw(e,t,n,s,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Tc(0),this.expirationTimes=Tc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Tc(0),this.identifierPrefix=s,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Tf(e,t,n,s,o,i,a,c,d){return e=new Zw(e,t,n,c,d),t===1?(t=1,i===!0&&(t|=8)):t=0,i=zn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},ff(i),e}function eb(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:oo,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function M0(e){if(!e)return gs;e=e._reactInternals;e:{if(Js(e)!==e||e.tag!==1)throw Error(ce(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(vn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ce(171))}if(e.tag===1){var n=e.type;if(vn(n))return Mg(e,n,t)}return t}function A0(e,t,n,s,o,i,a,c,d){return e=Tf(n,s,!0,e,o,i,a,c,d),e.context=M0(null),n=e.current,s=cn(),o=as(n),i=_r(s,o),i.callback=t??null,os(n,i,o),e.current.lanes=o,ta(e,o,s),wn(e,s),e}function Zl(e,t,n,s){var o=t.current,i=cn(),a=as(o);return n=M0(n),t.context===null?t.context=n:t.pendingContext=n,t=_r(i,a),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=os(o,t,a),e!==null&&(Xn(e,o,a,i),Wa(e,o,a)),a}function Tl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function bh(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function _f(e,t){bh(e,t),(e=e.alternate)&&bh(e,t)}function tb(){return null}var R0=typeof reportError=="function"?reportError:function(e){console.error(e)};function Mf(e){this._internalRoot=e}ec.prototype.render=Mf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ce(409));Zl(e,t,null,null)};ec.prototype.unmount=Mf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Vs(function(){Zl(null,e,null,null)}),t[Rr]=null}};function ec(e){this._internalRoot=e}ec.prototype.unstable_scheduleHydration=function(e){if(e){var t=dg();e={blockedOn:null,target:e,priority:t};for(var n=0;n<qr.length&&t!==0&&t<qr[n].priority;n++);qr.splice(n,0,e),n===0&&fg(e)}};function Af(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function tc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function jh(){}function nb(e,t,n,s,o){if(o){if(typeof s=="function"){var i=s;s=function(){var f=Tl(a);i.call(f)}}var a=A0(t,s,e,0,null,!1,!1,"",jh);return e._reactRootContainer=a,e[Rr]=a.current,Ui(e.nodeType===8?e.parentNode:e),Vs(),a}for(;o=e.lastChild;)e.removeChild(o);if(typeof s=="function"){var c=s;s=function(){var f=Tl(d);c.call(f)}}var d=Tf(e,0,!1,null,null,!1,!1,"",jh);return e._reactRootContainer=d,e[Rr]=d.current,Ui(e.nodeType===8?e.parentNode:e),Vs(function(){Zl(t,d,n,s)}),d}function nc(e,t,n,s,o){var i=n._reactRootContainer;if(i){var a=i;if(typeof o=="function"){var c=o;o=function(){var d=Tl(a);c.call(d)}}Zl(t,a,e,o)}else a=nb(n,t,e,o,s);return Tl(a)}lg=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=fi(t.pendingLanes);n!==0&&(Ju(t,n|1),wn(t,Nt()),!(Ke&6)&&(Ao=Nt()+500,ws()))}break;case 13:Vs(function(){var s=Pr(e,1);if(s!==null){var o=cn();Xn(s,e,1,o)}}),_f(e,1)}};Qu=function(e){if(e.tag===13){var t=Pr(e,134217728);if(t!==null){var n=cn();Xn(t,e,134217728,n)}_f(e,134217728)}};cg=function(e){if(e.tag===13){var t=as(e),n=Pr(e,t);if(n!==null){var s=cn();Xn(n,e,t,s)}_f(e,t)}};dg=function(){return et};ug=function(e,t){var n=et;try{return et=e,t()}finally{et=n}};Td=function(e,t,n){switch(t){case"input":if(jd(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var o=Gl(s);if(!o)throw Error(ce(90));Bp(s),jd(s,o)}}}break;case"textarea":Hp(e,n);break;case"select":t=n.value,t!=null&&yo(e,!!n.multiple,t,!1)}};Qp=Sf;Xp=Vs;var rb={usingClientEntryPoint:!1,Events:[ra,uo,Gl,Yp,Jp,Sf]},ai={findFiberByHostInstance:As,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},sb={bundleType:ai.bundleType,version:ai.version,rendererPackageName:ai.rendererPackageName,rendererConfig:ai.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$r.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=tg(e),e===null?null:e.stateNode},findFiberByHostInstance:ai.findFiberByHostInstance||tb,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var La=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!La.isDisabled&&La.supportsFiber)try{Bl=La.inject(sb),fr=La}catch{}}Rn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rb;Rn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Af(t))throw Error(ce(200));return eb(e,t,null,n)};Rn.createRoot=function(e,t){if(!Af(e))throw Error(ce(299));var n=!1,s="",o=R0;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=Tf(e,1,!1,null,null,n,!1,s,o),e[Rr]=t.current,Ui(e.nodeType===8?e.parentNode:e),new Mf(t)};Rn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ce(188)):(e=Object.keys(e).join(","),Error(ce(268,e)));return e=tg(t),e=e===null?null:e.stateNode,e};Rn.flushSync=function(e){return Vs(e)};Rn.hydrate=function(e,t,n){if(!tc(t))throw Error(ce(200));return nc(null,e,t,!0,n)};Rn.hydrateRoot=function(e,t,n){if(!Af(e))throw Error(ce(405));var s=n!=null&&n.hydratedSources||null,o=!1,i="",a=R0;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),t=A0(t,null,e,1,n??null,o,!1,i,a),e[Rr]=t.current,Ui(e),s)for(e=0;e<s.length;e++)n=s[e],o=n._getVersion,o=o(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new ec(t)};Rn.render=function(e,t,n){if(!tc(t))throw Error(ce(200));return nc(null,e,t,!1,n)};Rn.unmountComponentAtNode=function(e){if(!tc(e))throw Error(ce(40));return e._reactRootContainer?(Vs(function(){nc(null,null,e,!1,function(){e._reactRootContainer=null,e[Rr]=null})}),!0):!1};Rn.unstable_batchedUpdates=Sf;Rn.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!tc(n))throw Error(ce(200));if(e==null||e._reactInternals===void 0)throw Error(ce(38));return nc(e,t,n,!1,s)};Rn.version="18.3.1-next-f1338f8080-20240426";function P0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(P0)}catch(e){console.error(e)}}P0(),Pp.exports=Rn;var ob=Pp.exports,Nh=ob;pd.createRoot=Nh.createRoot,pd.hydrateRoot=Nh.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wi(){return Wi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Wi.apply(this,arguments)}var Xr;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Xr||(Xr={}));const kh="popstate";function ib(e){e===void 0&&(e={});function t(s,o){let{pathname:i,search:a,hash:c}=s.location;return lu("",{pathname:i,search:a,hash:c},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(s,o){return typeof o=="string"?o:_l(o)}return lb(t,n,null,e)}function kt(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function L0(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function ab(){return Math.random().toString(36).substr(2,8)}function Sh(e,t){return{usr:e.state,key:e.key,idx:t}}function lu(e,t,n,s){return n===void 0&&(n=null),Wi({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Do(t):t,{state:n,key:t&&t.key||s||ab()})}function _l(e){let{pathname:t="/",search:n="",hash:s=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),s&&s!=="#"&&(t+=s.charAt(0)==="#"?s:"#"+s),t}function Do(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let s=e.indexOf("?");s>=0&&(t.search=e.substr(s),e=e.substr(0,s)),e&&(t.pathname=e)}return t}function lb(e,t,n,s){s===void 0&&(s={});let{window:o=document.defaultView,v5Compat:i=!1}=s,a=o.history,c=Xr.Pop,d=null,f=x();f==null&&(f=0,a.replaceState(Wi({},a.state,{idx:f}),""));function x(){return(a.state||{idx:null}).idx}function g(){c=Xr.Pop;let v=x(),w=v==null?null:v-f;f=v,d&&d({action:c,location:M.location,delta:w})}function b(v,w){c=Xr.Push;let m=lu(M.location,v,w);n&&n(m,v),f=x()+1;let y=Sh(m,f),R=M.createHref(m);try{a.pushState(y,"",R)}catch(U){if(U instanceof DOMException&&U.name==="DataCloneError")throw U;o.location.assign(R)}i&&d&&d({action:c,location:M.location,delta:1})}function _(v,w){c=Xr.Replace;let m=lu(M.location,v,w);n&&n(m,v),f=x();let y=Sh(m,f),R=M.createHref(m);a.replaceState(y,"",R),i&&d&&d({action:c,location:M.location,delta:0})}function I(v){let w=o.location.origin!=="null"?o.location.origin:o.location.href,m=typeof v=="string"?v:_l(v);return m=m.replace(/ $/,"%20"),kt(w,"No window.location.(origin|href) available to create URL for href: "+m),new URL(m,w)}let M={get action(){return c},get location(){return e(o,a)},listen(v){if(d)throw new Error("A history only accepts one active listener");return o.addEventListener(kh,g),d=v,()=>{o.removeEventListener(kh,g),d=null}},createHref(v){return t(o,v)},createURL:I,encodeLocation(v){let w=I(v);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:b,replace:_,go(v){return a.go(v)}};return M}var Ch;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Ch||(Ch={}));function cb(e,t,n){return n===void 0&&(n="/"),db(e,t,n,!1)}function db(e,t,n,s){let o=typeof t=="string"?Do(t):t,i=Rf(o.pathname||"/",n);if(i==null)return null;let a=U0(e);ub(a);let c=null;for(let d=0;c==null&&d<a.length;++d){let f=jb(i);c=wb(a[d],f,s)}return c}function U0(e,t,n,s){t===void 0&&(t=[]),n===void 0&&(n=[]),s===void 0&&(s="");let o=(i,a,c)=>{let d={relativePath:c===void 0?i.path||"":c,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};d.relativePath.startsWith("/")&&(kt(d.relativePath.startsWith(s),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(s.length));let f=cs([s,d.relativePath]),x=n.concat(d);i.children&&i.children.length>0&&(kt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+f+'".')),U0(i.children,t,x,f)),!(i.path==null&&!i.index)&&t.push({path:f,score:yb(f,i.index),routesMeta:x})};return e.forEach((i,a)=>{var c;if(i.path===""||!((c=i.path)!=null&&c.includes("?")))o(i,a);else for(let d of O0(i.path))o(i,a,d)}),t}function O0(e){let t=e.split("/");if(t.length===0)return[];let[n,...s]=t,o=n.endsWith("?"),i=n.replace(/\?$/,"");if(s.length===0)return o?[i,""]:[i];let a=O0(s.join("/")),c=[];return c.push(...a.map(d=>d===""?i:[i,d].join("/"))),o&&c.push(...a),c.map(d=>e.startsWith("/")&&d===""?"/":d)}function ub(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:vb(t.routesMeta.map(s=>s.childrenIndex),n.routesMeta.map(s=>s.childrenIndex)))}const fb=/^:[\w-]+$/,mb=3,hb=2,pb=1,gb=10,xb=-2,Eh=e=>e==="*";function yb(e,t){let n=e.split("/"),s=n.length;return n.some(Eh)&&(s+=xb),t&&(s+=hb),n.filter(o=>!Eh(o)).reduce((o,i)=>o+(fb.test(i)?mb:i===""?pb:gb),s)}function vb(e,t){return e.length===t.length&&e.slice(0,-1).every((s,o)=>s===t[o])?e[e.length-1]-t[t.length-1]:0}function wb(e,t,n){n===void 0&&(n=!1);let{routesMeta:s}=e,o={},i="/",a=[];for(let c=0;c<s.length;++c){let d=s[c],f=c===s.length-1,x=i==="/"?t:t.slice(i.length)||"/",g=Ih({path:d.relativePath,caseSensitive:d.caseSensitive,end:f},x),b=d.route;if(!g&&f&&n&&!s[s.length-1].route.index&&(g=Ih({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},x)),!g)return null;Object.assign(o,g.params),a.push({params:o,pathname:cs([i,g.pathname]),pathnameBase:Cb(cs([i,g.pathnameBase])),route:b}),g.pathnameBase!=="/"&&(i=cs([i,g.pathnameBase]))}return a}function Ih(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,s]=bb(e.path,e.caseSensitive,e.end),o=t.match(n);if(!o)return null;let i=o[0],a=i.replace(/(.)\/+$/,"$1"),c=o.slice(1);return{params:s.reduce((f,x,g)=>{let{paramName:b,isOptional:_}=x;if(b==="*"){let M=c[g]||"";a=i.slice(0,i.length-M.length).replace(/(.)\/+$/,"$1")}const I=c[g];return _&&!I?f[b]=void 0:f[b]=(I||"").replace(/%2F/g,"/"),f},{}),pathname:i,pathnameBase:a,pattern:e}}function bb(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),L0(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let s=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,c,d)=>(s.push({paramName:c,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(s.push({paramName:"*"}),o+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":e!==""&&e!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),s]}function jb(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return L0(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Rf(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,s=e.charAt(n);return s&&s!=="/"?null:e.slice(n)||"/"}function Nb(e,t){t===void 0&&(t="/");let{pathname:n,search:s="",hash:o=""}=typeof e=="string"?Do(e):e;return{pathname:n?n.startsWith("/")?n:kb(n,t):t,search:Eb(s),hash:Ib(o)}}function kb(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(o=>{o===".."?n.length>1&&n.pop():o!=="."&&n.push(o)}),n.length>1?n.join("/"):"/"}function Jc(e,t,n,s){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Sb(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function Pf(e,t){let n=Sb(e);return t?n.map((s,o)=>o===n.length-1?s.pathname:s.pathnameBase):n.map(s=>s.pathnameBase)}function Lf(e,t,n,s){s===void 0&&(s=!1);let o;typeof e=="string"?o=Do(e):(o=Wi({},e),kt(!o.pathname||!o.pathname.includes("?"),Jc("?","pathname","search",o)),kt(!o.pathname||!o.pathname.includes("#"),Jc("#","pathname","hash",o)),kt(!o.search||!o.search.includes("#"),Jc("#","search","hash",o)));let i=e===""||o.pathname==="",a=i?"/":o.pathname,c;if(a==null)c=n;else{let g=t.length-1;if(!s&&a.startsWith("..")){let b=a.split("/");for(;b[0]==="..";)b.shift(),g-=1;o.pathname=b.join("/")}c=g>=0?t[g]:"/"}let d=Nb(o,c),f=a&&a!=="/"&&a.endsWith("/"),x=(i||a===".")&&n.endsWith("/");return!d.pathname.endsWith("/")&&(f||x)&&(d.pathname+="/"),d}const cs=e=>e.join("/").replace(/\/\/+/g,"/"),Cb=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Eb=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Ib=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Tb(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const $0=["post","put","patch","delete"];new Set($0);const _b=["get",...$0];new Set(_b);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Gi(){return Gi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Gi.apply(this,arguments)}const Uf=h.createContext(null),Mb=h.createContext(null),bs=h.createContext(null),rc=h.createContext(null),Dr=h.createContext({outlet:null,matches:[],isDataRoute:!1}),D0=h.createContext(null);function Ab(e,t){let{relative:n}=t===void 0?{}:t;Fo()||kt(!1);let{basename:s,navigator:o}=h.useContext(bs),{hash:i,pathname:a,search:c}=z0(e,{relative:n}),d=a;return s!=="/"&&(d=a==="/"?s:cs([s,a])),o.createHref({pathname:d,search:c,hash:i})}function Fo(){return h.useContext(rc)!=null}function oa(){return Fo()||kt(!1),h.useContext(rc).location}function F0(e){h.useContext(bs).static||h.useLayoutEffect(e)}function gr(){let{isDataRoute:e}=h.useContext(Dr);return e?Gb():Rb()}function Rb(){Fo()||kt(!1);let e=h.useContext(Uf),{basename:t,future:n,navigator:s}=h.useContext(bs),{matches:o}=h.useContext(Dr),{pathname:i}=oa(),a=JSON.stringify(Pf(o,n.v7_relativeSplatPath)),c=h.useRef(!1);return F0(()=>{c.current=!0}),h.useCallback(function(f,x){if(x===void 0&&(x={}),!c.current)return;if(typeof f=="number"){s.go(f);return}let g=Lf(f,JSON.parse(a),i,x.relative==="path");e==null&&t!=="/"&&(g.pathname=g.pathname==="/"?t:cs([t,g.pathname])),(x.replace?s.replace:s.push)(g,x.state,x)},[t,s,a,i,e])}function Pb(){let{matches:e}=h.useContext(Dr),t=e[e.length-1];return t?t.params:{}}function z0(e,t){let{relative:n}=t===void 0?{}:t,{future:s}=h.useContext(bs),{matches:o}=h.useContext(Dr),{pathname:i}=oa(),a=JSON.stringify(Pf(o,s.v7_relativeSplatPath));return h.useMemo(()=>Lf(e,JSON.parse(a),i,n==="path"),[e,a,i,n])}function Lb(e,t){return Ub(e,t)}function Ub(e,t,n,s){Fo()||kt(!1);let{navigator:o}=h.useContext(bs),{matches:i}=h.useContext(Dr),a=i[i.length-1],c=a?a.params:{};a&&a.pathname;let d=a?a.pathnameBase:"/";a&&a.route;let f=oa(),x;if(t){var g;let v=typeof t=="string"?Do(t):t;d==="/"||(g=v.pathname)!=null&&g.startsWith(d)||kt(!1),x=v}else x=f;let b=x.pathname||"/",_=b;if(d!=="/"){let v=d.replace(/^\//,"").split("/");_="/"+b.replace(/^\//,"").split("/").slice(v.length).join("/")}let I=cb(e,{pathname:_}),M=zb(I&&I.map(v=>Object.assign({},v,{params:Object.assign({},c,v.params),pathname:cs([d,o.encodeLocation?o.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?d:cs([d,o.encodeLocation?o.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),i,n,s);return t&&M?h.createElement(rc.Provider,{value:{location:Gi({pathname:"/",search:"",hash:"",state:null,key:"default"},x),navigationType:Xr.Pop}},M):M}function Ob(){let e=Wb(),t=Tb(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return h.createElement(h.Fragment,null,h.createElement("h2",null,"Unexpected Application Error!"),h.createElement("h3",{style:{fontStyle:"italic"}},t),n?h.createElement("pre",{style:o},n):null,i)}const $b=h.createElement(Ob,null);class Db extends h.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?h.createElement(Dr.Provider,{value:this.props.routeContext},h.createElement(D0.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Fb(e){let{routeContext:t,match:n,children:s}=e,o=h.useContext(Uf);return o&&o.static&&o.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=n.route.id),h.createElement(Dr.Provider,{value:t},s)}function zb(e,t,n,s){var o;if(t===void 0&&(t=[]),n===void 0&&(n=null),s===void 0&&(s=null),e==null){var i;if(!n)return null;if(n.errors)e=n.matches;else if((i=s)!=null&&i.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let a=e,c=(o=n)==null?void 0:o.errors;if(c!=null){let x=a.findIndex(g=>g.route.id&&(c==null?void 0:c[g.route.id])!==void 0);x>=0||kt(!1),a=a.slice(0,Math.min(a.length,x+1))}let d=!1,f=-1;if(n&&s&&s.v7_partialHydration)for(let x=0;x<a.length;x++){let g=a[x];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(f=x),g.route.id){let{loaderData:b,errors:_}=n,I=g.route.loader&&b[g.route.id]===void 0&&(!_||_[g.route.id]===void 0);if(g.route.lazy||I){d=!0,f>=0?a=a.slice(0,f+1):a=[a[0]];break}}}return a.reduceRight((x,g,b)=>{let _,I=!1,M=null,v=null;n&&(_=c&&g.route.id?c[g.route.id]:void 0,M=g.route.errorElement||$b,d&&(f<0&&b===0?(qb("route-fallback",!1),I=!0,v=null):f===b&&(I=!0,v=g.route.hydrateFallbackElement||null)));let w=t.concat(a.slice(0,b+1)),m=()=>{let y;return _?y=M:I?y=v:g.route.Component?y=h.createElement(g.route.Component,null):g.route.element?y=g.route.element:y=x,h.createElement(Fb,{match:g,routeContext:{outlet:x,matches:w,isDataRoute:n!=null},children:y})};return n&&(g.route.ErrorBoundary||g.route.errorElement||b===0)?h.createElement(Db,{location:n.location,revalidation:n.revalidation,component:M,error:_,children:m(),routeContext:{outlet:null,matches:w,isDataRoute:!0}}):m()},null)}var B0=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(B0||{}),Ml=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Ml||{});function Bb(e){let t=h.useContext(Uf);return t||kt(!1),t}function Vb(e){let t=h.useContext(Mb);return t||kt(!1),t}function Hb(e){let t=h.useContext(Dr);return t||kt(!1),t}function V0(e){let t=Hb(),n=t.matches[t.matches.length-1];return n.route.id||kt(!1),n.route.id}function Wb(){var e;let t=h.useContext(D0),n=Vb(Ml.UseRouteError),s=V0(Ml.UseRouteError);return t!==void 0?t:(e=n.errors)==null?void 0:e[s]}function Gb(){let{router:e}=Bb(B0.UseNavigateStable),t=V0(Ml.UseNavigateStable),n=h.useRef(!1);return F0(()=>{n.current=!0}),h.useCallback(function(o,i){i===void 0&&(i={}),n.current&&(typeof o=="number"?e.navigate(o):e.navigate(o,Gi({fromRouteId:t},i)))},[e,t])}const Th={};function qb(e,t,n){!t&&!Th[e]&&(Th[e]=!0)}function Kb(e,t){e==null||e.v7_startTransition,(e==null?void 0:e.v7_relativeSplatPath)===void 0&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}function ki(e){let{to:t,replace:n,state:s,relative:o}=e;Fo()||kt(!1);let{future:i,static:a}=h.useContext(bs),{matches:c}=h.useContext(Dr),{pathname:d}=oa(),f=gr(),x=Lf(t,Pf(c,i.v7_relativeSplatPath),d,o==="path"),g=JSON.stringify(x);return h.useEffect(()=>f(JSON.parse(g),{replace:n,state:s,relative:o}),[f,g,o,n,s]),null}function Pt(e){kt(!1)}function Yb(e){let{basename:t="/",children:n=null,location:s,navigationType:o=Xr.Pop,navigator:i,static:a=!1,future:c}=e;Fo()&&kt(!1);let d=t.replace(/^\/*/,"/"),f=h.useMemo(()=>({basename:d,navigator:i,static:a,future:Gi({v7_relativeSplatPath:!1},c)}),[d,c,i,a]);typeof s=="string"&&(s=Do(s));let{pathname:x="/",search:g="",hash:b="",state:_=null,key:I="default"}=s,M=h.useMemo(()=>{let v=Rf(x,d);return v==null?null:{location:{pathname:v,search:g,hash:b,state:_,key:I},navigationType:o}},[d,x,g,b,_,I,o]);return M==null?null:h.createElement(bs.Provider,{value:f},h.createElement(rc.Provider,{children:n,value:M}))}function _h(e){let{children:t,location:n}=e;return Lb(cu(t),n)}new Promise(()=>{});function cu(e,t){t===void 0&&(t=[]);let n=[];return h.Children.forEach(e,(s,o)=>{if(!h.isValidElement(s))return;let i=[...t,o];if(s.type===h.Fragment){n.push.apply(n,cu(s.props.children,i));return}s.type!==Pt&&kt(!1),!s.props.index||!s.props.children||kt(!1);let a={id:s.props.id||i.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(a.children=cu(s.props.children,i)),n.push(a)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function du(){return du=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},du.apply(this,arguments)}function Jb(e,t){if(e==null)return{};var n={},s=Object.keys(e),o,i;for(i=0;i<s.length;i++)o=s[i],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}function Qb(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Xb(e,t){return e.button===0&&(!t||t==="_self")&&!Qb(e)}const Zb=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],e1="6";try{window.__reactRouterVersion=e1}catch{}const t1="startTransition",Mh=Ky[t1];function n1(e){let{basename:t,children:n,future:s,window:o}=e,i=h.useRef();i.current==null&&(i.current=ib({window:o,v5Compat:!0}));let a=i.current,[c,d]=h.useState({action:a.action,location:a.location}),{v7_startTransition:f}=s||{},x=h.useCallback(g=>{f&&Mh?Mh(()=>d(g)):d(g)},[d,f]);return h.useLayoutEffect(()=>a.listen(x),[a,x]),h.useEffect(()=>Kb(s),[s]),h.createElement(Yb,{basename:t,children:n,location:c.location,navigationType:c.action,navigator:a,future:s})}const r1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",s1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Al=h.forwardRef(function(t,n){let{onClick:s,relative:o,reloadDocument:i,replace:a,state:c,target:d,to:f,preventScrollReset:x,viewTransition:g}=t,b=Jb(t,Zb),{basename:_}=h.useContext(bs),I,M=!1;if(typeof f=="string"&&s1.test(f)&&(I=f,r1))try{let y=new URL(window.location.href),R=f.startsWith("//")?new URL(y.protocol+f):new URL(f),U=Rf(R.pathname,_);R.origin===y.origin&&U!=null?f=U+R.search+R.hash:M=!0}catch{}let v=Ab(f,{relative:o}),w=o1(f,{replace:a,state:c,target:d,preventScrollReset:x,relative:o,viewTransition:g});function m(y){s&&s(y),y.defaultPrevented||w(y)}return h.createElement("a",du({},b,{href:I||v,onClick:M||i?s:m,ref:n,target:d}))});var Ah;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Ah||(Ah={}));var Rh;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Rh||(Rh={}));function o1(e,t){let{target:n,replace:s,state:o,preventScrollReset:i,relative:a,viewTransition:c}=t===void 0?{}:t,d=gr(),f=oa(),x=z0(e,{relative:a});return h.useCallback(g=>{if(Xb(g,n)){g.preventDefault();let b=s!==void 0?s:_l(f)===_l(x);d(e,{replace:b,state:o,preventScrollReset:i,relative:a,viewTransition:c})}},[f,d,x,s,o,n,e,i,a,c])}let i1={data:""},a1=e=>typeof window=="object"?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||i1,l1=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,c1=/\/\*[^]*?\*\/|  +/g,Ph=/\n+/g,Yr=(e,t)=>{let n="",s="",o="";for(let i in e){let a=e[i];i[0]=="@"?i[1]=="i"?n=i+" "+a+";":s+=i[1]=="f"?Yr(a,i):i+"{"+Yr(a,i[1]=="k"?"":t)+"}":typeof a=="object"?s+=Yr(a,t?t.replace(/([^,])+/g,c=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,d=>/&/.test(d)?d.replace(/&/g,c):c?c+" "+d:d)):i):a!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),o+=Yr.p?Yr.p(i,a):i+":"+a+";")}return n+(t&&o?t+"{"+o+"}":o)+s},jr={},H0=e=>{if(typeof e=="object"){let t="";for(let n in e)t+=n+H0(e[n]);return t}return e},d1=(e,t,n,s,o)=>{let i=H0(e),a=jr[i]||(jr[i]=(d=>{let f=0,x=11;for(;f<d.length;)x=101*x+d.charCodeAt(f++)>>>0;return"go"+x})(i));if(!jr[a]){let d=i!==e?e:(f=>{let x,g,b=[{}];for(;x=l1.exec(f.replace(c1,""));)x[4]?b.shift():x[3]?(g=x[3].replace(Ph," ").trim(),b.unshift(b[0][g]=b[0][g]||{})):b[0][x[1]]=x[2].replace(Ph," ").trim();return b[0]})(e);jr[a]=Yr(o?{["@keyframes "+a]:d}:d,n?"":"."+a)}let c=n&&jr.g?jr.g:null;return n&&(jr.g=jr[a]),((d,f,x,g)=>{g?f.data=f.data.replace(g,d):f.data.indexOf(d)===-1&&(f.data=x?d+f.data:f.data+d)})(jr[a],t,s,c),a},u1=(e,t,n)=>e.reduce((s,o,i)=>{let a=t[i];if(a&&a.call){let c=a(n),d=c&&c.props&&c.props.className||/^go/.test(c)&&c;a=d?"."+d:c&&typeof c=="object"?c.props?"":Yr(c,""):c===!1?"":c}return s+o+(a??"")},"");function sc(e){let t=this||{},n=e.call?e(t.p):e;return d1(n.unshift?n.raw?u1(n,[].slice.call(arguments,1),t.p):n.reduce((s,o)=>Object.assign(s,o&&o.call?o(t.p):o),{}):n,a1(t.target),t.g,t.o,t.k)}let W0,uu,fu;sc.bind({g:1});let Ur=sc.bind({k:1});function f1(e,t,n,s){Yr.p=t,W0=e,uu=n,fu=s}function js(e,t){let n=this||{};return function(){let s=arguments;function o(i,a){let c=Object.assign({},i),d=c.className||o.className;n.p=Object.assign({theme:uu&&uu()},c),n.o=/ *go\d+/.test(d),c.className=sc.apply(n,s)+(d?" "+d:""),t&&(c.ref=a);let f=e;return e[0]&&(f=c.as||e,delete c.as),fu&&f[0]&&fu(c),W0(f,c)}return t?t(o):o}}var m1=e=>typeof e=="function",Rl=(e,t)=>m1(e)?e(t):e,h1=(()=>{let e=0;return()=>(++e).toString()})(),G0=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),p1=20,Of="default",q0=(e,t)=>{let{toastLimit:n}=e.settings;switch(t.type){case 0:return{...e,toasts:[t.toast,...e.toasts].slice(0,n)};case 1:return{...e,toasts:e.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case 2:let{toast:s}=t;return q0(e,{type:e.toasts.find(a=>a.id===s.id)?1:0,toast:s});case 3:let{toastId:o}=t;return{...e,toasts:e.toasts.map(a=>a.id===o||o===void 0?{...a,dismissed:!0,visible:!1}:a)};case 4:return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(a=>a.id!==t.toastId)};case 5:return{...e,pausedAt:t.time};case 6:let i=t.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map(a=>({...a,pauseDuration:a.pauseDuration+i}))}}},Xa=[],K0={toasts:[],pausedAt:void 0,settings:{toastLimit:p1}},ur={},Y0=(e,t=Of)=>{ur[t]=q0(ur[t]||K0,e),Xa.forEach(([n,s])=>{n===t&&s(ur[t])})},J0=e=>Object.keys(ur).forEach(t=>Y0(e,t)),g1=e=>Object.keys(ur).find(t=>ur[t].toasts.some(n=>n.id===e)),oc=(e=Of)=>t=>{Y0(t,e)},x1={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},y1=(e={},t=Of)=>{let[n,s]=h.useState(ur[t]||K0),o=h.useRef(ur[t]);h.useEffect(()=>(o.current!==ur[t]&&s(ur[t]),Xa.push([t,s]),()=>{let a=Xa.findIndex(([c])=>c===t);a>-1&&Xa.splice(a,1)}),[t]);let i=n.toasts.map(a=>{var c,d,f;return{...e,...e[a.type],...a,removeDelay:a.removeDelay||((c=e[a.type])==null?void 0:c.removeDelay)||(e==null?void 0:e.removeDelay),duration:a.duration||((d=e[a.type])==null?void 0:d.duration)||(e==null?void 0:e.duration)||x1[a.type],style:{...e.style,...(f=e[a.type])==null?void 0:f.style,...a.style}}});return{...n,toasts:i}},v1=(e,t="blank",n)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...n,id:(n==null?void 0:n.id)||h1()}),ia=e=>(t,n)=>{let s=v1(t,e,n);return oc(s.toasterId||g1(s.id))({type:2,toast:s}),s.id},D=(e,t)=>ia("blank")(e,t);D.error=ia("error");D.success=ia("success");D.loading=ia("loading");D.custom=ia("custom");D.dismiss=(e,t)=>{let n={type:3,toastId:e};t?oc(t)(n):J0(n)};D.dismissAll=e=>D.dismiss(void 0,e);D.remove=(e,t)=>{let n={type:4,toastId:e};t?oc(t)(n):J0(n)};D.removeAll=e=>D.remove(void 0,e);D.promise=(e,t,n)=>{let s=D.loading(t.loading,{...n,...n==null?void 0:n.loading});return typeof e=="function"&&(e=e()),e.then(o=>{let i=t.success?Rl(t.success,o):void 0;return i?D.success(i,{id:s,...n,...n==null?void 0:n.success}):D.dismiss(s),o}).catch(o=>{let i=t.error?Rl(t.error,o):void 0;i?D.error(i,{id:s,...n,...n==null?void 0:n.error}):D.dismiss(s)}),e};var w1=1e3,b1=(e,t="default")=>{let{toasts:n,pausedAt:s}=y1(e,t),o=h.useRef(new Map).current,i=h.useCallback((g,b=w1)=>{if(o.has(g))return;let _=setTimeout(()=>{o.delete(g),a({type:4,toastId:g})},b);o.set(g,_)},[]);h.useEffect(()=>{if(s)return;let g=Date.now(),b=n.map(_=>{if(_.duration===1/0)return;let I=(_.duration||0)+_.pauseDuration-(g-_.createdAt);if(I<0){_.visible&&D.dismiss(_.id);return}return setTimeout(()=>D.dismiss(_.id,t),I)});return()=>{b.forEach(_=>_&&clearTimeout(_))}},[n,s,t]);let a=h.useCallback(oc(t),[t]),c=h.useCallback(()=>{a({type:5,time:Date.now()})},[a]),d=h.useCallback((g,b)=>{a({type:1,toast:{id:g,height:b}})},[a]),f=h.useCallback(()=>{s&&a({type:6,time:Date.now()})},[s,a]),x=h.useCallback((g,b)=>{let{reverseOrder:_=!1,gutter:I=8,defaultPosition:M}=b||{},v=n.filter(y=>(y.position||M)===(g.position||M)&&y.height),w=v.findIndex(y=>y.id===g.id),m=v.filter((y,R)=>R<w&&y.visible).length;return v.filter(y=>y.visible).slice(..._?[m+1]:[0,m]).reduce((y,R)=>y+(R.height||0)+I,0)},[n]);return h.useEffect(()=>{n.forEach(g=>{if(g.dismissed)i(g.id,g.removeDelay);else{let b=o.get(g.id);b&&(clearTimeout(b),o.delete(g.id))}})},[n,i]),{toasts:n,handlers:{updateHeight:d,startPause:c,endPause:f,calculateOffset:x}}},j1=Ur`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,N1=Ur`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,k1=Ur`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,S1=js("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${j1} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${N1} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${e=>e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${k1} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,C1=Ur`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,E1=js("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${e=>e.secondary||"#e0e0e0"};
  border-right-color: ${e=>e.primary||"#616161"};
  animation: ${C1} 1s linear infinite;
`,I1=Ur`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,T1=Ur`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,_1=js("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${I1} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${T1} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${e=>e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,M1=js("div")`
  position: absolute;
`,A1=js("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,R1=Ur`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,P1=js("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${R1} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,L1=({toast:e})=>{let{icon:t,type:n,iconTheme:s}=e;return t!==void 0?typeof t=="string"?h.createElement(P1,null,t):t:n==="blank"?null:h.createElement(A1,null,h.createElement(E1,{...s}),n!=="loading"&&h.createElement(M1,null,n==="error"?h.createElement(S1,{...s}):h.createElement(_1,{...s})))},U1=e=>`
0% {transform: translate3d(0,${e*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,O1=e=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${e*-150}%,-1px) scale(.6); opacity:0;}
`,$1="0%{opacity:0;} 100%{opacity:1;}",D1="0%{opacity:1;} 100%{opacity:0;}",F1=js("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,z1=js("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,B1=(e,t)=>{let n=e.includes("top")?1:-1,[s,o]=G0()?[$1,D1]:[U1(n),O1(n)];return{animation:t?`${Ur(s)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Ur(o)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},V1=h.memo(({toast:e,position:t,style:n,children:s})=>{let o=e.height?B1(e.position||t||"top-center",e.visible):{opacity:0},i=h.createElement(L1,{toast:e}),a=h.createElement(z1,{...e.ariaProps},Rl(e.message,e));return h.createElement(F1,{className:e.className,style:{...o,...n,...e.style}},typeof s=="function"?s({icon:i,message:a}):h.createElement(h.Fragment,null,i,a))});f1(h.createElement);var H1=({id:e,className:t,style:n,onHeightUpdate:s,children:o})=>{let i=h.useCallback(a=>{if(a){let c=()=>{let d=a.getBoundingClientRect().height;s(e,d)};c(),new MutationObserver(c).observe(a,{subtree:!0,childList:!0,characterData:!0})}},[e,s]);return h.createElement("div",{ref:i,className:t,style:n},o)},W1=(e,t)=>{let n=e.includes("top"),s=n?{top:0}:{bottom:0},o=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:G0()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(n?1:-1)}px)`,...s,...o}},G1=sc`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Ua=16,q1=({reverseOrder:e,position:t="top-center",toastOptions:n,gutter:s,children:o,toasterId:i,containerStyle:a,containerClassName:c})=>{let{toasts:d,handlers:f}=b1(n,i);return h.createElement("div",{"data-rht-toaster":i||"",style:{position:"fixed",zIndex:9999,top:Ua,left:Ua,right:Ua,bottom:Ua,pointerEvents:"none",...a},className:c,onMouseEnter:f.startPause,onMouseLeave:f.endPause},d.map(x=>{let g=x.position||t,b=f.calculateOffset(x,{reverseOrder:e,gutter:s,defaultPosition:t}),_=W1(g,b);return h.createElement(H1,{id:x.id,key:x.id,onHeightUpdate:f.updateHeight,className:x.visible?G1:"",style:_},x.type==="custom"?Rl(x.message,x):o?o(x):h.createElement(V1,{toast:x,position:g}))}))};function Q0(e,t){return function(){return e.apply(t,arguments)}}const{toString:K1}=Object.prototype,{getPrototypeOf:$f}=Object,{iterator:ic,toStringTag:X0}=Symbol,ac=(e=>t=>{const n=K1.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),tr=e=>(e=e.toLowerCase(),t=>ac(t)===e),lc=e=>t=>typeof t===e,{isArray:zo}=Array,Ro=lc("undefined");function aa(e){return e!==null&&!Ro(e)&&e.constructor!==null&&!Ro(e.constructor)&&bn(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Z0=tr("ArrayBuffer");function Y1(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&Z0(e.buffer),t}const J1=lc("string"),bn=lc("function"),ex=lc("number"),la=e=>e!==null&&typeof e=="object",Q1=e=>e===!0||e===!1,Za=e=>{if(ac(e)!=="object")return!1;const t=$f(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(X0 in e)&&!(ic in e)},X1=e=>{if(!la(e)||aa(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},Z1=tr("Date"),ej=tr("File"),tj=tr("Blob"),nj=tr("FileList"),rj=e=>la(e)&&bn(e.pipe),sj=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||bn(e.append)&&((t=ac(e))==="formdata"||t==="object"&&bn(e.toString)&&e.toString()==="[object FormData]"))},oj=tr("URLSearchParams"),[ij,aj,lj,cj]=["ReadableStream","Request","Response","Headers"].map(tr),dj=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ca(e,t,{allOwnKeys:n=!1}={}){if(e===null||typeof e>"u")return;let s,o;if(typeof e!="object"&&(e=[e]),zo(e))for(s=0,o=e.length;s<o;s++)t.call(null,e[s],s,e);else{if(aa(e))return;const i=n?Object.getOwnPropertyNames(e):Object.keys(e),a=i.length;let c;for(s=0;s<a;s++)c=i[s],t.call(null,e[c],c,e)}}function tx(e,t){if(aa(e))return null;t=t.toLowerCase();const n=Object.keys(e);let s=n.length,o;for(;s-- >0;)if(o=n[s],t===o.toLowerCase())return o;return null}const Ls=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),nx=e=>!Ro(e)&&e!==Ls;function mu(){const{caseless:e,skipUndefined:t}=nx(this)&&this||{},n={},s=(o,i)=>{const a=e&&tx(n,i)||i;Za(n[a])&&Za(o)?n[a]=mu(n[a],o):Za(o)?n[a]=mu({},o):zo(o)?n[a]=o.slice():(!t||!Ro(o))&&(n[a]=o)};for(let o=0,i=arguments.length;o<i;o++)arguments[o]&&ca(arguments[o],s);return n}const uj=(e,t,n,{allOwnKeys:s}={})=>(ca(t,(o,i)=>{n&&bn(o)?e[i]=Q0(o,n):e[i]=o},{allOwnKeys:s}),e),fj=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),mj=(e,t,n,s)=>{e.prototype=Object.create(t.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},hj=(e,t,n,s)=>{let o,i,a;const c={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),i=o.length;i-- >0;)a=o[i],(!s||s(a,e,t))&&!c[a]&&(t[a]=e[a],c[a]=!0);e=n!==!1&&$f(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},pj=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const s=e.indexOf(t,n);return s!==-1&&s===n},gj=e=>{if(!e)return null;if(zo(e))return e;let t=e.length;if(!ex(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},xj=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&$f(Uint8Array)),yj=(e,t)=>{const s=(e&&e[ic]).call(e);let o;for(;(o=s.next())&&!o.done;){const i=o.value;t.call(e,i[0],i[1])}},vj=(e,t)=>{let n;const s=[];for(;(n=e.exec(t))!==null;)s.push(n);return s},wj=tr("HTMLFormElement"),bj=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,s,o){return s.toUpperCase()+o}),Lh=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),jj=tr("RegExp"),rx=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),s={};ca(n,(o,i)=>{let a;(a=t(o,i,e))!==!1&&(s[i]=a||o)}),Object.defineProperties(e,s)},Nj=e=>{rx(e,(t,n)=>{if(bn(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=e[n];if(bn(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},kj=(e,t)=>{const n={},s=o=>{o.forEach(i=>{n[i]=!0})};return zo(e)?s(e):s(String(e).split(t)),n},Sj=()=>{},Cj=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function Ej(e){return!!(e&&bn(e.append)&&e[X0]==="FormData"&&e[ic])}const Ij=e=>{const t=new Array(10),n=(s,o)=>{if(la(s)){if(t.indexOf(s)>=0)return;if(aa(s))return s;if(!("toJSON"in s)){t[o]=s;const i=zo(s)?[]:{};return ca(s,(a,c)=>{const d=n(a,o+1);!Ro(d)&&(i[c]=d)}),t[o]=void 0,i}}return s};return n(e,0)},Tj=tr("AsyncFunction"),_j=e=>e&&(la(e)||bn(e))&&bn(e.then)&&bn(e.catch),sx=((e,t)=>e?setImmediate:t?((n,s)=>(Ls.addEventListener("message",({source:o,data:i})=>{o===Ls&&i===n&&s.length&&s.shift()()},!1),o=>{s.push(o),Ls.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",bn(Ls.postMessage)),Mj=typeof queueMicrotask<"u"?queueMicrotask.bind(Ls):typeof process<"u"&&process.nextTick||sx,Aj=e=>e!=null&&bn(e[ic]),K={isArray:zo,isArrayBuffer:Z0,isBuffer:aa,isFormData:sj,isArrayBufferView:Y1,isString:J1,isNumber:ex,isBoolean:Q1,isObject:la,isPlainObject:Za,isEmptyObject:X1,isReadableStream:ij,isRequest:aj,isResponse:lj,isHeaders:cj,isUndefined:Ro,isDate:Z1,isFile:ej,isBlob:tj,isRegExp:jj,isFunction:bn,isStream:rj,isURLSearchParams:oj,isTypedArray:xj,isFileList:nj,forEach:ca,merge:mu,extend:uj,trim:dj,stripBOM:fj,inherits:mj,toFlatObject:hj,kindOf:ac,kindOfTest:tr,endsWith:pj,toArray:gj,forEachEntry:yj,matchAll:vj,isHTMLForm:wj,hasOwnProperty:Lh,hasOwnProp:Lh,reduceDescriptors:rx,freezeMethods:Nj,toObjectSet:kj,toCamelCase:bj,noop:Sj,toFiniteNumber:Cj,findKey:tx,global:Ls,isContextDefined:nx,isSpecCompliantForm:Ej,toJSONObject:Ij,isAsyncFn:Tj,isThenable:_j,setImmediate:sx,asap:Mj,isIterable:Aj};function Ue(e,t,n,s,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),s&&(this.request=s),o&&(this.response=o,this.status=o.status?o.status:null)}K.inherits(Ue,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:K.toJSONObject(this.config),code:this.code,status:this.status}}});const ox=Ue.prototype,ix={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{ix[e]={value:e}});Object.defineProperties(Ue,ix);Object.defineProperty(ox,"isAxiosError",{value:!0});Ue.from=(e,t,n,s,o,i)=>{const a=Object.create(ox);K.toFlatObject(e,a,function(x){return x!==Error.prototype},f=>f!=="isAxiosError");const c=e&&e.message?e.message:"Error",d=t==null&&e?e.code:t;return Ue.call(a,c,d,n,s,o),e&&a.cause==null&&Object.defineProperty(a,"cause",{value:e,configurable:!0}),a.name=e&&e.name||"Error",i&&Object.assign(a,i),a};const Rj=null;function hu(e){return K.isPlainObject(e)||K.isArray(e)}function ax(e){return K.endsWith(e,"[]")?e.slice(0,-2):e}function Uh(e,t,n){return e?e.concat(t).map(function(o,i){return o=ax(o),!n&&i?"["+o+"]":o}).join(n?".":""):t}function Pj(e){return K.isArray(e)&&!e.some(hu)}const Lj=K.toFlatObject(K,{},null,function(t){return/^is[A-Z]/.test(t)});function cc(e,t,n){if(!K.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=K.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(M,v){return!K.isUndefined(v[M])});const s=n.metaTokens,o=n.visitor||x,i=n.dots,a=n.indexes,d=(n.Blob||typeof Blob<"u"&&Blob)&&K.isSpecCompliantForm(t);if(!K.isFunction(o))throw new TypeError("visitor must be a function");function f(I){if(I===null)return"";if(K.isDate(I))return I.toISOString();if(K.isBoolean(I))return I.toString();if(!d&&K.isBlob(I))throw new Ue("Blob is not supported. Use a Buffer instead.");return K.isArrayBuffer(I)||K.isTypedArray(I)?d&&typeof Blob=="function"?new Blob([I]):Buffer.from(I):I}function x(I,M,v){let w=I;if(I&&!v&&typeof I=="object"){if(K.endsWith(M,"{}"))M=s?M:M.slice(0,-2),I=JSON.stringify(I);else if(K.isArray(I)&&Pj(I)||(K.isFileList(I)||K.endsWith(M,"[]"))&&(w=K.toArray(I)))return M=ax(M),w.forEach(function(y,R){!(K.isUndefined(y)||y===null)&&t.append(a===!0?Uh([M],R,i):a===null?M:M+"[]",f(y))}),!1}return hu(I)?!0:(t.append(Uh(v,M,i),f(I)),!1)}const g=[],b=Object.assign(Lj,{defaultVisitor:x,convertValue:f,isVisitable:hu});function _(I,M){if(!K.isUndefined(I)){if(g.indexOf(I)!==-1)throw Error("Circular reference detected in "+M.join("."));g.push(I),K.forEach(I,function(w,m){(!(K.isUndefined(w)||w===null)&&o.call(t,w,K.isString(m)?m.trim():m,M,b))===!0&&_(w,M?M.concat(m):[m])}),g.pop()}}if(!K.isObject(e))throw new TypeError("data must be an object");return _(e),t}function Oh(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function Df(e,t){this._pairs=[],e&&cc(e,this,t)}const lx=Df.prototype;lx.append=function(t,n){this._pairs.push([t,n])};lx.toString=function(t){const n=t?function(s){return t.call(this,s,Oh)}:Oh;return this._pairs.map(function(o){return n(o[0])+"="+n(o[1])},"").join("&")};function Uj(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function cx(e,t,n){if(!t)return e;const s=n&&n.encode||Uj;K.isFunction(n)&&(n={serialize:n});const o=n&&n.serialize;let i;if(o?i=o(t,n):i=K.isURLSearchParams(t)?t.toString():new Df(t,n).toString(s),i){const a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e}class Oj{constructor(){this.handlers=[]}use(t,n,s){return this.handlers.push({fulfilled:t,rejected:n,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){K.forEach(this.handlers,function(s){s!==null&&t(s)})}}const $h=Oj,dx={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$j=typeof URLSearchParams<"u"?URLSearchParams:Df,Dj=typeof FormData<"u"?FormData:null,Fj=typeof Blob<"u"?Blob:null,zj={isBrowser:!0,classes:{URLSearchParams:$j,FormData:Dj,Blob:Fj},protocols:["http","https","file","blob","url","data"]},Ff=typeof window<"u"&&typeof document<"u",pu=typeof navigator=="object"&&navigator||void 0,Bj=Ff&&(!pu||["ReactNative","NativeScript","NS"].indexOf(pu.product)<0),Vj=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Hj=Ff&&window.location.href||"http://localhost",Wj=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ff,hasStandardBrowserEnv:Bj,hasStandardBrowserWebWorkerEnv:Vj,navigator:pu,origin:Hj},Symbol.toStringTag,{value:"Module"})),Qt={...Wj,...zj};function Gj(e,t){return cc(e,new Qt.classes.URLSearchParams,{visitor:function(n,s,o,i){return Qt.isNode&&K.isBuffer(n)?(this.append(s,n.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...t})}function qj(e){return K.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Kj(e){const t={},n=Object.keys(e);let s;const o=n.length;let i;for(s=0;s<o;s++)i=n[s],t[i]=e[i];return t}function ux(e){function t(n,s,o,i){let a=n[i++];if(a==="__proto__")return!0;const c=Number.isFinite(+a),d=i>=n.length;return a=!a&&K.isArray(o)?o.length:a,d?(K.hasOwnProp(o,a)?o[a]=[o[a],s]:o[a]=s,!c):((!o[a]||!K.isObject(o[a]))&&(o[a]=[]),t(n,s,o[a],i)&&K.isArray(o[a])&&(o[a]=Kj(o[a])),!c)}if(K.isFormData(e)&&K.isFunction(e.entries)){const n={};return K.forEachEntry(e,(s,o)=>{t(qj(s),o,n,0)}),n}return null}function Yj(e,t,n){if(K.isString(e))try{return(t||JSON.parse)(e),K.trim(e)}catch(s){if(s.name!=="SyntaxError")throw s}return(n||JSON.stringify)(e)}const zf={transitional:dx,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const s=n.getContentType()||"",o=s.indexOf("application/json")>-1,i=K.isObject(t);if(i&&K.isHTMLForm(t)&&(t=new FormData(t)),K.isFormData(t))return o?JSON.stringify(ux(t)):t;if(K.isArrayBuffer(t)||K.isBuffer(t)||K.isStream(t)||K.isFile(t)||K.isBlob(t)||K.isReadableStream(t))return t;if(K.isArrayBufferView(t))return t.buffer;if(K.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let c;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Gj(t,this.formSerializer).toString();if((c=K.isFileList(t))||s.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return cc(c?{"files[]":t}:t,d&&new d,this.formSerializer)}}return i||o?(n.setContentType("application/json",!1),Yj(t)):t}],transformResponse:[function(t){const n=this.transitional||zf.transitional,s=n&&n.forcedJSONParsing,o=this.responseType==="json";if(K.isResponse(t)||K.isReadableStream(t))return t;if(t&&K.isString(t)&&(s&&!this.responseType||o)){const a=!(n&&n.silentJSONParsing)&&o;try{return JSON.parse(t,this.parseReviver)}catch(c){if(a)throw c.name==="SyntaxError"?Ue.from(c,Ue.ERR_BAD_RESPONSE,this,null,this.response):c}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qt.classes.FormData,Blob:Qt.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};K.forEach(["delete","get","head","post","put","patch"],e=>{zf.headers[e]={}});const Bf=zf,Jj=K.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Qj=e=>{const t={};let n,s,o;return e&&e.split(`
`).forEach(function(a){o=a.indexOf(":"),n=a.substring(0,o).trim().toLowerCase(),s=a.substring(o+1).trim(),!(!n||t[n]&&Jj[n])&&(n==="set-cookie"?t[n]?t[n].push(s):t[n]=[s]:t[n]=t[n]?t[n]+", "+s:s)}),t},Dh=Symbol("internals");function li(e){return e&&String(e).trim().toLowerCase()}function el(e){return e===!1||e==null?e:K.isArray(e)?e.map(el):String(e)}function Xj(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(e);)t[s[1]]=s[2];return t}const Zj=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Qc(e,t,n,s,o){if(K.isFunction(s))return s.call(this,t,n);if(o&&(t=n),!!K.isString(t)){if(K.isString(s))return t.indexOf(s)!==-1;if(K.isRegExp(s))return s.test(t)}}function eN(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,s)=>n.toUpperCase()+s)}function tN(e,t){const n=K.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(e,s+n,{value:function(o,i,a){return this[s].call(this,t,o,i,a)},configurable:!0})})}class dc{constructor(t){t&&this.set(t)}set(t,n,s){const o=this;function i(c,d,f){const x=li(d);if(!x)throw new Error("header name must be a non-empty string");const g=K.findKey(o,x);(!g||o[g]===void 0||f===!0||f===void 0&&o[g]!==!1)&&(o[g||d]=el(c))}const a=(c,d)=>K.forEach(c,(f,x)=>i(f,x,d));if(K.isPlainObject(t)||t instanceof this.constructor)a(t,n);else if(K.isString(t)&&(t=t.trim())&&!Zj(t))a(Qj(t),n);else if(K.isObject(t)&&K.isIterable(t)){let c={},d,f;for(const x of t){if(!K.isArray(x))throw TypeError("Object iterator must return a key-value pair");c[f=x[0]]=(d=c[f])?K.isArray(d)?[...d,x[1]]:[d,x[1]]:x[1]}a(c,n)}else t!=null&&i(n,t,s);return this}get(t,n){if(t=li(t),t){const s=K.findKey(this,t);if(s){const o=this[s];if(!n)return o;if(n===!0)return Xj(o);if(K.isFunction(n))return n.call(this,o,s);if(K.isRegExp(n))return n.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=li(t),t){const s=K.findKey(this,t);return!!(s&&this[s]!==void 0&&(!n||Qc(this,this[s],s,n)))}return!1}delete(t,n){const s=this;let o=!1;function i(a){if(a=li(a),a){const c=K.findKey(s,a);c&&(!n||Qc(s,s[c],c,n))&&(delete s[c],o=!0)}}return K.isArray(t)?t.forEach(i):i(t),o}clear(t){const n=Object.keys(this);let s=n.length,o=!1;for(;s--;){const i=n[s];(!t||Qc(this,this[i],i,t,!0))&&(delete this[i],o=!0)}return o}normalize(t){const n=this,s={};return K.forEach(this,(o,i)=>{const a=K.findKey(s,i);if(a){n[a]=el(o),delete n[i];return}const c=t?eN(i):String(i).trim();c!==i&&delete n[i],n[c]=el(o),s[c]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return K.forEach(this,(s,o)=>{s!=null&&s!==!1&&(n[o]=t&&K.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const s=new this(t);return n.forEach(o=>s.set(o)),s}static accessor(t){const s=(this[Dh]=this[Dh]={accessors:{}}).accessors,o=this.prototype;function i(a){const c=li(a);s[c]||(tN(o,a),s[c]=!0)}return K.isArray(t)?t.forEach(i):i(t),this}}dc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);K.reduceDescriptors(dc.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(s){this[n]=s}}});K.freezeMethods(dc);const Zn=dc;function Xc(e,t){const n=this||Bf,s=t||n,o=Zn.from(s.headers);let i=s.data;return K.forEach(e,function(c){i=c.call(n,i,o.normalize(),t?t.status:void 0)}),o.normalize(),i}function fx(e){return!!(e&&e.__CANCEL__)}function Bo(e,t,n){Ue.call(this,e??"canceled",Ue.ERR_CANCELED,t,n),this.name="CanceledError"}K.inherits(Bo,Ue,{__CANCEL__:!0});function mx(e,t,n){const s=n.config.validateStatus;!n.status||!s||s(n.status)?e(n):t(new Ue("Request failed with status code "+n.status,[Ue.ERR_BAD_REQUEST,Ue.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function nN(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function rN(e,t){e=e||10;const n=new Array(e),s=new Array(e);let o=0,i=0,a;return t=t!==void 0?t:1e3,function(d){const f=Date.now(),x=s[i];a||(a=f),n[o]=d,s[o]=f;let g=i,b=0;for(;g!==o;)b+=n[g++],g=g%e;if(o=(o+1)%e,o===i&&(i=(i+1)%e),f-a<t)return;const _=x&&f-x;return _?Math.round(b*1e3/_):void 0}}function sN(e,t){let n=0,s=1e3/t,o,i;const a=(f,x=Date.now())=>{n=x,o=null,i&&(clearTimeout(i),i=null),e(...f)};return[(...f)=>{const x=Date.now(),g=x-n;g>=s?a(f,x):(o=f,i||(i=setTimeout(()=>{i=null,a(o)},s-g)))},()=>o&&a(o)]}const Pl=(e,t,n=3)=>{let s=0;const o=rN(50,250);return sN(i=>{const a=i.loaded,c=i.lengthComputable?i.total:void 0,d=a-s,f=o(d),x=a<=c;s=a;const g={loaded:a,total:c,progress:c?a/c:void 0,bytes:d,rate:f||void 0,estimated:f&&c&&x?(c-a)/f:void 0,event:i,lengthComputable:c!=null,[t?"download":"upload"]:!0};e(g)},n)},Fh=(e,t)=>{const n=e!=null;return[s=>t[0]({lengthComputable:n,total:e,loaded:s}),t[1]]},zh=e=>(...t)=>K.asap(()=>e(...t)),oN=Qt.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,Qt.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(Qt.origin),Qt.navigator&&/(msie|trident)/i.test(Qt.navigator.userAgent)):()=>!0,iN=Qt.hasStandardBrowserEnv?{write(e,t,n,s,o,i){const a=[e+"="+encodeURIComponent(t)];K.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),K.isString(s)&&a.push("path="+s),K.isString(o)&&a.push("domain="+o),i===!0&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function aN(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function lN(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function hx(e,t,n){let s=!aN(t);return e&&(s||n==!1)?lN(e,t):t}const Bh=e=>e instanceof Zn?{...e}:e;function Hs(e,t){t=t||{};const n={};function s(f,x,g,b){return K.isPlainObject(f)&&K.isPlainObject(x)?K.merge.call({caseless:b},f,x):K.isPlainObject(x)?K.merge({},x):K.isArray(x)?x.slice():x}function o(f,x,g,b){if(K.isUndefined(x)){if(!K.isUndefined(f))return s(void 0,f,g,b)}else return s(f,x,g,b)}function i(f,x){if(!K.isUndefined(x))return s(void 0,x)}function a(f,x){if(K.isUndefined(x)){if(!K.isUndefined(f))return s(void 0,f)}else return s(void 0,x)}function c(f,x,g){if(g in t)return s(f,x);if(g in e)return s(void 0,f)}const d={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c,headers:(f,x,g)=>o(Bh(f),Bh(x),g,!0)};return K.forEach(Object.keys({...e,...t}),function(x){const g=d[x]||o,b=g(e[x],t[x],x);K.isUndefined(b)&&g!==c||(n[x]=b)}),n}const px=e=>{const t=Hs({},e);let{data:n,withXSRFToken:s,xsrfHeaderName:o,xsrfCookieName:i,headers:a,auth:c}=t;if(t.headers=a=Zn.from(a),t.url=cx(hx(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&a.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),K.isFormData(n)){if(Qt.hasStandardBrowserEnv||Qt.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(K.isFunction(n.getHeaders)){const d=n.getHeaders(),f=["content-type","content-length"];Object.entries(d).forEach(([x,g])=>{f.includes(x.toLowerCase())&&a.set(x,g)})}}if(Qt.hasStandardBrowserEnv&&(s&&K.isFunction(s)&&(s=s(t)),s||s!==!1&&oN(t.url))){const d=o&&i&&iN.read(i);d&&a.set(o,d)}return t},cN=typeof XMLHttpRequest<"u",dN=cN&&function(e){return new Promise(function(n,s){const o=px(e);let i=o.data;const a=Zn.from(o.headers).normalize();let{responseType:c,onUploadProgress:d,onDownloadProgress:f}=o,x,g,b,_,I;function M(){_&&_(),I&&I(),o.cancelToken&&o.cancelToken.unsubscribe(x),o.signal&&o.signal.removeEventListener("abort",x)}let v=new XMLHttpRequest;v.open(o.method.toUpperCase(),o.url,!0),v.timeout=o.timeout;function w(){if(!v)return;const y=Zn.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders()),U={data:!c||c==="text"||c==="json"?v.responseText:v.response,status:v.status,statusText:v.statusText,headers:y,config:e,request:v};mx(function(F){n(F),M()},function(F){s(F),M()},U),v=null}"onloadend"in v?v.onloadend=w:v.onreadystatechange=function(){!v||v.readyState!==4||v.status===0&&!(v.responseURL&&v.responseURL.indexOf("file:")===0)||setTimeout(w)},v.onabort=function(){v&&(s(new Ue("Request aborted",Ue.ECONNABORTED,e,v)),v=null)},v.onerror=function(R){const U=R&&R.message?R.message:"Network Error",W=new Ue(U,Ue.ERR_NETWORK,e,v);W.event=R||null,s(W),v=null},v.ontimeout=function(){let R=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const U=o.transitional||dx;o.timeoutErrorMessage&&(R=o.timeoutErrorMessage),s(new Ue(R,U.clarifyTimeoutError?Ue.ETIMEDOUT:Ue.ECONNABORTED,e,v)),v=null},i===void 0&&a.setContentType(null),"setRequestHeader"in v&&K.forEach(a.toJSON(),function(R,U){v.setRequestHeader(U,R)}),K.isUndefined(o.withCredentials)||(v.withCredentials=!!o.withCredentials),c&&c!=="json"&&(v.responseType=o.responseType),f&&([b,I]=Pl(f,!0),v.addEventListener("progress",b)),d&&v.upload&&([g,_]=Pl(d),v.upload.addEventListener("progress",g),v.upload.addEventListener("loadend",_)),(o.cancelToken||o.signal)&&(x=y=>{v&&(s(!y||y.type?new Bo(null,e,v):y),v.abort(),v=null)},o.cancelToken&&o.cancelToken.subscribe(x),o.signal&&(o.signal.aborted?x():o.signal.addEventListener("abort",x)));const m=nN(o.url);if(m&&Qt.protocols.indexOf(m)===-1){s(new Ue("Unsupported protocol "+m+":",Ue.ERR_BAD_REQUEST,e));return}v.send(i||null)})},uN=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let s=new AbortController,o;const i=function(f){if(!o){o=!0,c();const x=f instanceof Error?f:this.reason;s.abort(x instanceof Ue?x:new Bo(x instanceof Error?x.message:x))}};let a=t&&setTimeout(()=>{a=null,i(new Ue(`timeout ${t} of ms exceeded`,Ue.ETIMEDOUT))},t);const c=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach(f=>{f.unsubscribe?f.unsubscribe(i):f.removeEventListener("abort",i)}),e=null)};e.forEach(f=>f.addEventListener("abort",i));const{signal:d}=s;return d.unsubscribe=()=>K.asap(c),d}},fN=uN,mN=function*(e,t){let n=e.byteLength;if(!t||n<t){yield e;return}let s=0,o;for(;s<n;)o=s+t,yield e.slice(s,o),s=o},hN=async function*(e,t){for await(const n of pN(e))yield*mN(n,t)},pN=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:n,value:s}=await t.read();if(n)break;yield s}}finally{await t.cancel()}},Vh=(e,t,n,s)=>{const o=hN(e,t);let i=0,a,c=d=>{a||(a=!0,s&&s(d))};return new ReadableStream({async pull(d){try{const{done:f,value:x}=await o.next();if(f){c(),d.close();return}let g=x.byteLength;if(n){let b=i+=g;n(b)}d.enqueue(new Uint8Array(x))}catch(f){throw c(f),f}},cancel(d){return c(d),o.return()}},{highWaterMark:2})},Hh=64*1024,{isFunction:Oa}=K,gN=(({Request:e,Response:t})=>({Request:e,Response:t}))(K.global),{ReadableStream:Wh,TextEncoder:Gh}=K.global,qh=(e,...t)=>{try{return!!e(...t)}catch{return!1}},xN=e=>{e=K.merge.call({skipUndefined:!0},gN,e);const{fetch:t,Request:n,Response:s}=e,o=t?Oa(t):typeof fetch=="function",i=Oa(n),a=Oa(s);if(!o)return!1;const c=o&&Oa(Wh),d=o&&(typeof Gh=="function"?(I=>M=>I.encode(M))(new Gh):async I=>new Uint8Array(await new n(I).arrayBuffer())),f=i&&c&&qh(()=>{let I=!1;const M=new n(Qt.origin,{body:new Wh,method:"POST",get duplex(){return I=!0,"half"}}).headers.has("Content-Type");return I&&!M}),x=a&&c&&qh(()=>K.isReadableStream(new s("").body)),g={stream:x&&(I=>I.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(I=>{!g[I]&&(g[I]=(M,v)=>{let w=M&&M[I];if(w)return w.call(M);throw new Ue(`Response type '${I}' is not supported`,Ue.ERR_NOT_SUPPORT,v)})});const b=async I=>{if(I==null)return 0;if(K.isBlob(I))return I.size;if(K.isSpecCompliantForm(I))return(await new n(Qt.origin,{method:"POST",body:I}).arrayBuffer()).byteLength;if(K.isArrayBufferView(I)||K.isArrayBuffer(I))return I.byteLength;if(K.isURLSearchParams(I)&&(I=I+""),K.isString(I))return(await d(I)).byteLength},_=async(I,M)=>{const v=K.toFiniteNumber(I.getContentLength());return v??b(M)};return async I=>{let{url:M,method:v,data:w,signal:m,cancelToken:y,timeout:R,onDownloadProgress:U,onUploadProgress:W,responseType:F,headers:Z,withCredentials:ae="same-origin",fetchOptions:se}=px(I),te=t||fetch;F=F?(F+"").toLowerCase():"text";let fe=fN([m,y&&y.toAbortSignal()],R),L=null;const oe=fe&&fe.unsubscribe&&(()=>{fe.unsubscribe()});let P;try{if(W&&f&&v!=="get"&&v!=="head"&&(P=await _(Z,w))!==0){let X=new n(M,{method:"POST",body:w,duplex:"half"}),z;if(K.isFormData(w)&&(z=X.headers.get("content-type"))&&Z.setContentType(z),X.body){const[G,V]=Fh(P,Pl(zh(W)));w=Vh(X.body,Hh,G,V)}}K.isString(ae)||(ae=ae?"include":"omit");const q=i&&"credentials"in n.prototype,Q={...se,signal:fe,method:v.toUpperCase(),headers:Z.normalize().toJSON(),body:w,duplex:"half",credentials:q?ae:void 0};L=i&&new n(M,Q);let O=await(i?te(L,se):te(M,Q));const S=x&&(F==="stream"||F==="response");if(x&&(U||S&&oe)){const X={};["status","statusText","headers"].forEach($=>{X[$]=O[$]});const z=K.toFiniteNumber(O.headers.get("content-length")),[G,V]=U&&Fh(z,Pl(zh(U),!0))||[];O=new s(Vh(O.body,Hh,G,()=>{V&&V(),oe&&oe()}),X)}F=F||"text";let E=await g[K.findKey(g,F)||"text"](O,I);return!S&&oe&&oe(),await new Promise((X,z)=>{mx(X,z,{data:E,headers:Zn.from(O.headers),status:O.status,statusText:O.statusText,config:I,request:L})})}catch(q){throw oe&&oe(),q&&q.name==="TypeError"&&/Load failed|fetch/i.test(q.message)?Object.assign(new Ue("Network Error",Ue.ERR_NETWORK,I,L),{cause:q.cause||q}):Ue.from(q,q&&q.code,I,L)}}},yN=new Map,gx=e=>{let t=e?e.env:{};const{fetch:n,Request:s,Response:o}=t,i=[s,o,n];let a=i.length,c=a,d,f,x=yN;for(;c--;)d=i[c],f=x.get(d),f===void 0&&x.set(d,f=c?new Map:xN(t)),x=f;return f};gx();const gu={http:Rj,xhr:dN,fetch:{get:gx}};K.forEach(gu,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const Kh=e=>`- ${e}`,vN=e=>K.isFunction(e)||e===null||e===!1,xx={getAdapter:(e,t)=>{e=K.isArray(e)?e:[e];const{length:n}=e;let s,o;const i={};for(let a=0;a<n;a++){s=e[a];let c;if(o=s,!vN(s)&&(o=gu[(c=String(s)).toLowerCase()],o===void 0))throw new Ue(`Unknown adapter '${c}'`);if(o&&(K.isFunction(o)||(o=o.get(t))))break;i[c||"#"+a]=o}if(!o){const a=Object.entries(i).map(([d,f])=>`adapter ${d} `+(f===!1?"is not supported by the environment":"is not available in the build"));let c=n?a.length>1?`since :
`+a.map(Kh).join(`
`):" "+Kh(a[0]):"as no adapter specified";throw new Ue("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return o},adapters:gu};function Zc(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Bo(null,e)}function Yh(e){return Zc(e),e.headers=Zn.from(e.headers),e.data=Xc.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),xx.getAdapter(e.adapter||Bf.adapter,e)(e).then(function(s){return Zc(e),s.data=Xc.call(e,e.transformResponse,s),s.headers=Zn.from(s.headers),s},function(s){return fx(s)||(Zc(e),s&&s.response&&(s.response.data=Xc.call(e,e.transformResponse,s.response),s.response.headers=Zn.from(s.response.headers))),Promise.reject(s)})}const yx="1.12.2",uc={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{uc[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const Jh={};uc.transitional=function(t,n,s){function o(i,a){return"[Axios v"+yx+"] Transitional option '"+i+"'"+a+(s?". "+s:"")}return(i,a,c)=>{if(t===!1)throw new Ue(o(a," has been removed"+(n?" in "+n:"")),Ue.ERR_DEPRECATED);return n&&!Jh[a]&&(Jh[a]=!0,console.warn(o(a," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(i,a,c):!0}};uc.spelling=function(t){return(n,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function wN(e,t,n){if(typeof e!="object")throw new Ue("options must be an object",Ue.ERR_BAD_OPTION_VALUE);const s=Object.keys(e);let o=s.length;for(;o-- >0;){const i=s[o],a=t[i];if(a){const c=e[i],d=c===void 0||a(c,i,e);if(d!==!0)throw new Ue("option "+i+" must be "+d,Ue.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Ue("Unknown option "+i,Ue.ERR_BAD_OPTION)}}const tl={assertOptions:wN,validators:uc},ar=tl.validators;class Ll{constructor(t){this.defaults=t||{},this.interceptors={request:new $h,response:new $h}}async request(t,n){try{return await this._request(t,n)}catch(s){if(s instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const i=o.stack?o.stack.replace(/^.+\n/,""):"";try{s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}catch{}}throw s}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=Hs(this.defaults,n);const{transitional:s,paramsSerializer:o,headers:i}=n;s!==void 0&&tl.assertOptions(s,{silentJSONParsing:ar.transitional(ar.boolean),forcedJSONParsing:ar.transitional(ar.boolean),clarifyTimeoutError:ar.transitional(ar.boolean)},!1),o!=null&&(K.isFunction(o)?n.paramsSerializer={serialize:o}:tl.assertOptions(o,{encode:ar.function,serialize:ar.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),tl.assertOptions(n,{baseUrl:ar.spelling("baseURL"),withXsrfToken:ar.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let a=i&&K.merge(i.common,i[n.method]);i&&K.forEach(["delete","get","head","post","put","patch","common"],I=>{delete i[I]}),n.headers=Zn.concat(a,i);const c=[];let d=!0;this.interceptors.request.forEach(function(M){typeof M.runWhen=="function"&&M.runWhen(n)===!1||(d=d&&M.synchronous,c.unshift(M.fulfilled,M.rejected))});const f=[];this.interceptors.response.forEach(function(M){f.push(M.fulfilled,M.rejected)});let x,g=0,b;if(!d){const I=[Yh.bind(this),void 0];for(I.unshift(...c),I.push(...f),b=I.length,x=Promise.resolve(n);g<b;)x=x.then(I[g++],I[g++]);return x}b=c.length;let _=n;for(;g<b;){const I=c[g++],M=c[g++];try{_=I(_)}catch(v){M.call(this,v);break}}try{x=Yh.call(this,_)}catch(I){return Promise.reject(I)}for(g=0,b=f.length;g<b;)x=x.then(f[g++],f[g++]);return x}getUri(t){t=Hs(this.defaults,t);const n=hx(t.baseURL,t.url,t.allowAbsoluteUrls);return cx(n,t.params,t.paramsSerializer)}}K.forEach(["delete","get","head","options"],function(t){Ll.prototype[t]=function(n,s){return this.request(Hs(s||{},{method:t,url:n,data:(s||{}).data}))}});K.forEach(["post","put","patch"],function(t){function n(s){return function(i,a,c){return this.request(Hs(c||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}Ll.prototype[t]=n(),Ll.prototype[t+"Form"]=n(!0)});const nl=Ll;class Vf{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(i){n=i});const s=this;this.promise.then(o=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](o);s._listeners=null}),this.promise.then=o=>{let i;const a=new Promise(c=>{s.subscribe(c),i=c}).then(o);return a.cancel=function(){s.unsubscribe(i)},a},t(function(i,a,c){s.reason||(s.reason=new Bo(i,a,c),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=s=>{t.abort(s)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new Vf(function(o){t=o}),cancel:t}}}const bN=Vf;function jN(e){return function(n){return e.apply(null,n)}}function NN(e){return K.isObject(e)&&e.isAxiosError===!0}const xu={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(xu).forEach(([e,t])=>{xu[t]=e});const kN=xu;function vx(e){const t=new nl(e),n=Q0(nl.prototype.request,t);return K.extend(n,nl.prototype,t,{allOwnKeys:!0}),K.extend(n,t,null,{allOwnKeys:!0}),n.create=function(o){return vx(Hs(e,o))},n}const Tt=vx(Bf);Tt.Axios=nl;Tt.CanceledError=Bo;Tt.CancelToken=bN;Tt.isCancel=fx;Tt.VERSION=yx;Tt.toFormData=cc;Tt.AxiosError=Ue;Tt.Cancel=Tt.CanceledError;Tt.all=function(t){return Promise.all(t)};Tt.spread=jN;Tt.isAxiosError=NN;Tt.mergeConfig=Hs;Tt.AxiosHeaders=Zn;Tt.formToJSON=e=>ux(K.isHTMLForm(e)?new FormData(e):e);Tt.getAdapter=xx.getAdapter;Tt.HttpStatusCode=kN;Tt.default=Tt;const nt=Tt,wx="https://internalchat.pizeonfly.com/api",Se=wx.replace(/\/?api\/?$/,""),be=nt.create({baseURL:wx,headers:{"Content-Type":"application/json"},timeout:5*60*1e3});be.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e));be.interceptors.response.use(e=>e,e=>{var t;return((t=e.response)==null?void 0:t.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)});const Si={login:(e,t)=>be.post("/auth/login",{email:e,password:t}),registerSuperAdmin:(e,t,n)=>be.post("/auth/register-superadmin",{name:e,email:t,password:n}),getCurrentUser:()=>be.get("/auth/me"),checkSuperAdmin:()=>be.get("/auth/check-superadmin")},an={getUsers:()=>be.get("/users"),getActiveUsers:()=>be.get("/users/active"),createUser:e=>be.post("/users",e),updateUser:(e,t)=>be.put(`/users/${e}`,t),deleteUser:e=>be.delete(`/users/${e}`),toggleUserStatus:e=>be.put(`/users/${e}/toggle-status`),updateProfile:e=>{const t=e instanceof FormData?e:(()=>{const n=new FormData;return Object.entries(e||{}).forEach(([s,o])=>{o!=null&&n.append(s,o)}),n})();return be.put("/users/profile",t,{headers:{"Content-Type":"multipart/form-data"}})}},zt={getGroups:()=>be.get("/groups"),getMyGroups:()=>be.get("/groups/my-groups"),createGroup:e=>be.post("/groups",e),addMembers:(e,t)=>be.post(`/groups/${e}/members`,{members:t}),removeMember:(e,t)=>be.delete(`/groups/${e}/members/${t}`),updateGroup:(e,t)=>be.put(`/groups/${e}`,t),deleteGroup:e=>be.delete(`/groups/${e}`),uploadGroupAvatar:(e,t)=>be.post(`/groups/${e}/avatar`,t,{headers:{"Content-Type":"multipart/form-data"}}),pinMessage:(e,t)=>be.post(`/groups/${e}/pin-message`,{messageId:t}),unpinMessage:(e,t)=>be.post(`/groups/${e}/unpin-message`,{messageId:t}),getPinnedMessages:e=>be.get(`/groups/${e}/pinned-messages`)},yt={getPersonalMessages:(e,t={})=>be.get(`/messages/personal/${e}`,{params:t}),getGroupMessages:(e,t={})=>be.get(`/messages/group/${e}`,{params:t}),sendPersonalMessage:(e,t)=>e instanceof FormData?be.post("/messages/personal",e,{headers:{"Content-Type":"multipart/form-data"},timeout:10*60*1e3,maxContentLength:100*1024*1024,maxBodyLength:100*1024*1024,onUploadProgress:t}):be.post("/messages/personal",e),sendGroupMessage:(e,t)=>e instanceof FormData?be.post("/messages/group",e,{headers:{"Content-Type":"multipart/form-data"},timeout:10*60*1e3,maxContentLength:100*1024*1024,maxBodyLength:100*1024*1024,onUploadProgress:t}):be.post("/messages/group",e),markAsRead:e=>be.put(`/messages/${e}/read`),getUnreadCount:()=>be.get("/messages/unread/count"),getChatState:()=>be.get("/messages/chat-state"),updateChatState:e=>be.post("/messages/chat-state",e),forwardMessage:e=>be.post("/messages/forward",e),editMessage:(e,t)=>be.put(`/messages/${e}`,{message:t})},qi={getHistory:(e={})=>be.get("/calls/history",{params:e}),initiate:(e,t="voice",n=null)=>be.post("/calls/initiate",{receiverId:e,callType:t,offer:n}),answer:(e,t)=>be.put(`/calls/${e}/answer`,{answer:t}),decline:e=>be.put(`/calls/${e}/decline`),end:e=>be.put(`/calls/${e}/end`),addIceCandidate:(e,t,n,s)=>be.post(`/calls/${e}/ice-candidate`,{candidate:t,sdpMLineIndex:n,sdpMid:s}),getDetails:e=>be.get(`/calls/${e}`),updateNotes:(e,t)=>be.put(`/calls/${e}/notes`,{notes:t}),delete:e=>be.delete(`/calls/${e}`)},Tr={test:()=>be.get("/group-calls/test"),initiate:(e,t="voice")=>be.post("/group-calls/initiate",{groupId:e,callType:t}),join:e=>be.post(`/group-calls/${e}/join`),leave:e=>be.post(`/group-calls/${e}/leave`),end:e=>be.post(`/group-calls/${e}/end`),updateMuteStatus:(e,t)=>be.put(`/group-calls/${e}/mute`,{isMuted:t}),updateVideoStatus:(e,t)=>be.put(`/group-calls/${e}/video`,{isVideoEnabled:t}),removeParticipant:(e,t)=>be.delete(`/group-calls/${e}/participant/${t}`),getDetails:e=>be.get(`/group-calls/${e}`),getActiveCalls:e=>be.get(`/group-calls/group/${e}/active`),getHistory:(e,t={})=>be.get(`/group-calls/group/${e}/history`,{params:t}),endAllActive:()=>be.post("/group-calls/debug/end-all-active")},bx={getSettings:()=>be.get("/time-settings"),updateSettings:e=>be.put("/time-settings",e),getCurrentTime:()=>be.get("/time-settings/current-time")},_s={getSchedules:()=>be.get("/scheduled-disable"),getSchedule:e=>be.get(`/scheduled-disable/${e}`),createSchedule:e=>be.post("/scheduled-disable",e),updateSchedule:(e,t)=>be.put(`/scheduled-disable/${e}`,t),deleteSchedule:e=>be.delete(`/scheduled-disable/${e}`),toggleSchedule:e=>be.put(`/scheduled-disable/${e}/toggle`),resetTrigger:e=>be.put(`/scheduled-disable/${e}/reset-trigger`)},SN=Object.freeze(Object.defineProperty({__proto__:null,API_ORIGIN:Se,authAPI:Si,callsAPI:qi,default:be,groupCallsAPI:Tr,groupsAPI:zt,messagesAPI:yt,scheduledDisableAPI:_s,timeSettingsAPI:bx,usersAPI:an},Symbol.toStringTag,{value:"Module"})),Hf=window.electron&&window.electron.isElectron,CN=()=>Hf?"http://localhost:5001/api":"https://internalchat.pizeonfly.com/api",EN=()=>Hf?"http://localhost:5001":"https://internalchat.pizeonfly.com",jx={API_URL:CN(),SOCKET_URL:EN(),TURN_URL:"turn:internalchat.pizeonfly.com:3478",TURN_USERNAME:"webrtcuser",TURN_PASSWORD:{}.VITE_TURN_PASSWORD||"o4Ps!xl4",IS_ELECTRON:Hf},IN={apiKey:"AIzaSyAntZL8-YIMYI5Fs19kGrccYOR2nIpIWPM",authDomain:"extractor-9843e.firebaseapp.com",projectId:"extractor-9843e",storageBucket:"extractor-9843e.firebasestorage.app",messagingSenderId:"1029960130572",appId:"1:1029960130572:web:692b0189efa3b22a9d4e29"},TN="BBniT8kgqBbeYvWgHMUMcHAcfB2lBfvSrVIkzxKC7Ppi3D9WfboQHzpMf333gP6IlbU1IMQ_X58xeHI2-2w9YfY",Nx=jx.API_URL.replace(/\/?api\/?$/,"");function _N(e){const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),s=atob(n);return Uint8Array.from([...s].map(o=>o.charCodeAt(0)))}const MN=()=>"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window,AN=async()=>{try{return(await nt.get(`${Nx}/api/push-notifications/vapid-public-key`)).data}catch(e){throw console.error("Failed to get VAPID key:",e),e}},RN=async()=>{if(!("Notification"in window))return console.log("This browser does not support notifications"),"denied";if(Notification.permission==="granted")return console.log(" Notification permission already granted"),"granted";if(Notification.permission==="denied")return console.warn(" Notification permission is denied. Please enable it in browser settings."),"denied";console.log(" Requesting notification permission...");const e=await Notification.requestPermission();return e==="granted"?console.log(" Notification permission granted!"):console.warn(" Notification permission denied by user"),e},PN=async()=>{if(!("serviceWorker"in navigator))throw new Error("Service Workers not supported");try{const e=await navigator.serviceWorker.register("/push-sw.js",{scope:"/"});return console.log(" Service Worker registered:",e),e}catch(e){throw console.error(" Service Worker registration failed:",e),e}},LN=async e=>{try{if(!MN())throw new Error("Push notifications are not supported");if(await RN()!=="granted")throw new Error("Notification permission denied");const{publicKey:n,configured:s}=await AN();if(!s||!n)throw new Error("Push notifications not configured on server");const o=await PN();await navigator.serviceWorker.ready;const i=await o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:_N(n)});console.log(" Push subscription created:",i);const a=localStorage.getItem("token");return await nt.post(`${Nx}/api/push-notifications/subscribe`,{...i.toJSON(),userId:e},{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}),console.log(" Push subscription saved to server"),localStorage.setItem("pushSubscriptionEndpoint",i.endpoint),{success:!0,subscription:i}}catch(t){return console.error(" Push subscription failed:",t),{success:!1,error:t.message}}},UN=async()=>{try{if(!("serviceWorker"in navigator))return{subscribed:!1};const e=await navigator.serviceWorker.getRegistration();if(!e)return{subscribed:!1};const t=await e.pushManager.getSubscription();return{subscribed:!!t,subscription:t}}catch(e){return console.error(" Check subscription failed:",e),{subscribed:!1}}},yu=async e=>{try{console.log(" Initializing push notifications...");const{subscribed:t}=await UN();return t?(console.log(" Already subscribed to push notifications"),{success:!0,alreadySubscribed:!0}):await LN(e)}catch(t){return console.error(" Push initialization failed:",t),{success:!1,error:t.message}}},ON=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kx=function(e){const t=[];let n=0;for(let s=0;s<e.length;s++){let o=e.charCodeAt(s);o<128?t[n++]=o:o<2048?(t[n++]=o>>6|192,t[n++]=o&63|128):(o&64512)===55296&&s+1<e.length&&(e.charCodeAt(s+1)&64512)===56320?(o=65536+((o&1023)<<10)+(e.charCodeAt(++s)&1023),t[n++]=o>>18|240,t[n++]=o>>12&63|128,t[n++]=o>>6&63|128,t[n++]=o&63|128):(t[n++]=o>>12|224,t[n++]=o>>6&63|128,t[n++]=o&63|128)}return t},$N=function(e){const t=[];let n=0,s=0;for(;n<e.length;){const o=e[n++];if(o<128)t[s++]=String.fromCharCode(o);else if(o>191&&o<224){const i=e[n++];t[s++]=String.fromCharCode((o&31)<<6|i&63)}else if(o>239&&o<365){const i=e[n++],a=e[n++],c=e[n++],d=((o&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;t[s++]=String.fromCharCode(55296+(d>>10)),t[s++]=String.fromCharCode(56320+(d&1023))}else{const i=e[n++],a=e[n++];t[s++]=String.fromCharCode((o&15)<<12|(i&63)<<6|a&63)}}return t.join("")},Sx={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let o=0;o<e.length;o+=3){const i=e[o],a=o+1<e.length,c=a?e[o+1]:0,d=o+2<e.length,f=d?e[o+2]:0,x=i>>2,g=(i&3)<<4|c>>4;let b=(c&15)<<2|f>>6,_=f&63;d||(_=64,a||(b=64)),s.push(n[x],n[g],n[b],n[_])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(kx(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):$N(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let o=0;o<e.length;){const i=n[e.charAt(o++)],c=o<e.length?n[e.charAt(o)]:0;++o;const f=o<e.length?n[e.charAt(o)]:64;++o;const g=o<e.length?n[e.charAt(o)]:64;if(++o,i==null||c==null||f==null||g==null)throw new DN;const b=i<<2|c>>4;if(s.push(b),f!==64){const _=c<<4&240|f>>2;if(s.push(_),g!==64){const I=f<<6&192|g;s.push(I)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class DN extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const FN=function(e){const t=kx(e);return Sx.encodeByteArray(t,!0)},Cx=function(e){return FN(e).replace(/\./g,"")},zN=function(e){try{return Sx.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BN(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VN=()=>BN().__FIREBASE_DEFAULTS__,HN=()=>{if(typeof process>"u"||typeof process.env>"u")return;const e={}.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},WN=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&zN(e[1]);return t&&JSON.parse(t)},GN=()=>{try{return ON()||VN()||HN()||WN()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},Ex=()=>{var e;return(e=GN())==null?void 0:e.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qN{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,n)=>{this.resolve=t,this.reject=n})}wrapCallback(t){return(n,s)=>{n?this.reject(n):this.resolve(s),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(n):t(n,s))}}}function Ix(){try{return typeof indexedDB=="object"}catch{return!1}}function Tx(){return new Promise((e,t)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",o=self.indexedDB.open(s);o.onsuccess=()=>{o.result.close(),n||self.indexedDB.deleteDatabase(s),e(!0)},o.onupgradeneeded=()=>{n=!1},o.onerror=()=>{var i;t(((i=o.error)==null?void 0:i.message)||"")}}catch(n){t(n)}})}function KN(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YN="FirebaseError";class Vo extends Error{constructor(t,n,s){super(n),this.code=t,this.customData=s,this.name=YN,Object.setPrototypeOf(this,Vo.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,fc.prototype.create)}}class fc{constructor(t,n,s){this.service=t,this.serviceName=n,this.errors=s}create(t,...n){const s=n[0]||{},o=`${this.service}/${t}`,i=this.errors[t],a=i?JN(i,s):"Error",c=`${this.serviceName}: ${a} (${o}).`;return new Vo(o,c,s)}}function JN(e,t){return e.replace(QN,(n,s)=>{const o=t[s];return o!=null?String(o):`<${s}?>`})}const QN=/\{\$([^}]+)}/g;function vu(e,t){if(e===t)return!0;const n=Object.keys(e),s=Object.keys(t);for(const o of n){if(!s.includes(o))return!1;const i=e[o],a=t[o];if(Qh(i)&&Qh(a)){if(!vu(i,a))return!1}else if(i!==a)return!1}for(const o of s)if(!n.includes(o))return!1;return!0}function Qh(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wf(e){return e&&e._delegate?e._delegate:e}class xs{constructor(t,n,s){this.name=t,this.instanceFactory=n,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ms="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XN{constructor(t,n){this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const n=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(n)){const s=new qN;if(this.instancesDeferred.set(n,s),this.isInitialized(n)||this.shouldAutoInitialize())try{const o=this.getOrInitializeService({instanceIdentifier:n});o&&s.resolve(o)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(t){const n=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),s=(t==null?void 0:t.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(o){if(s)return null;throw o}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(e2(t))try{this.getOrInitializeService({instanceIdentifier:Ms})}catch{}for(const[n,s]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:o});s.resolve(i)}catch{}}}}clearInstance(t=Ms){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...t.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Ms){return this.instances.has(t)}getOptions(t=Ms){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:n={}}=t,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const o=this.getOrInitializeService({instanceIdentifier:s,options:n});for(const[i,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);s===c&&a.resolve(o)}return o}onInit(t,n){const s=this.normalizeInstanceIdentifier(n),o=this.onInitCallbacks.get(s)??new Set;o.add(t),this.onInitCallbacks.set(s,o);const i=this.instances.get(s);return i&&t(i,s),()=>{o.delete(t)}}invokeOnInitCallbacks(t,n){const s=this.onInitCallbacks.get(n);if(s)for(const o of s)try{o(t,n)}catch{}}getOrInitializeService({instanceIdentifier:t,options:n={}}){let s=this.instances.get(t);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:ZN(t),options:n}),this.instances.set(t,s),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(s,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,s)}catch{}return s||null}normalizeInstanceIdentifier(t=Ms){return this.component?this.component.multipleInstances?t:Ms:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ZN(e){return e===Ms?void 0:e}function e2(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t2{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const n=this.getProvider(t.name);if(n.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);n.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const n=new XN(t,this);return this.providers.set(t,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ot;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(ot||(ot={}));const n2={debug:ot.DEBUG,verbose:ot.VERBOSE,info:ot.INFO,warn:ot.WARN,error:ot.ERROR,silent:ot.SILENT},r2=ot.INFO,s2={[ot.DEBUG]:"log",[ot.VERBOSE]:"log",[ot.INFO]:"info",[ot.WARN]:"warn",[ot.ERROR]:"error"},o2=(e,t,...n)=>{if(t<e.logLevel)return;const s=new Date().toISOString(),o=s2[t];if(o)console[o](`[${s}]  ${e.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class i2{constructor(t){this.name=t,this._logLevel=r2,this._logHandler=o2,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in ot))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?n2[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,ot.DEBUG,...t),this._logHandler(this,ot.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,ot.VERBOSE,...t),this._logHandler(this,ot.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,ot.INFO,...t),this._logHandler(this,ot.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,ot.WARN,...t),this._logHandler(this,ot.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,ot.ERROR,...t),this._logHandler(this,ot.ERROR,...t)}}const a2=(e,t)=>t.some(n=>e instanceof n);let Xh,Zh;function l2(){return Xh||(Xh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function c2(){return Zh||(Zh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const _x=new WeakMap,wu=new WeakMap,Mx=new WeakMap,ed=new WeakMap,Gf=new WeakMap;function d2(e){const t=new Promise((n,s)=>{const o=()=>{e.removeEventListener("success",i),e.removeEventListener("error",a)},i=()=>{n(Mr(e.result)),o()},a=()=>{s(e.error),o()};e.addEventListener("success",i),e.addEventListener("error",a)});return t.then(n=>{n instanceof IDBCursor&&_x.set(n,e)}).catch(()=>{}),Gf.set(t,e),t}function u2(e){if(wu.has(e))return;const t=new Promise((n,s)=>{const o=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=()=>{n(),o()},a=()=>{s(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)});wu.set(e,t)}let bu={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return wu.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Mx.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Mr(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function f2(e){bu=e(bu)}function m2(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const s=e.call(td(this),t,...n);return Mx.set(s,t.sort?t.sort():[t]),Mr(s)}:c2().includes(e)?function(...t){return e.apply(td(this),t),Mr(_x.get(this))}:function(...t){return Mr(e.apply(td(this),t))}}function h2(e){return typeof e=="function"?m2(e):(e instanceof IDBTransaction&&u2(e),a2(e,l2())?new Proxy(e,bu):e)}function Mr(e){if(e instanceof IDBRequest)return d2(e);if(ed.has(e))return ed.get(e);const t=h2(e);return t!==e&&(ed.set(e,t),Gf.set(t,e)),t}const td=e=>Gf.get(e);function mc(e,t,{blocked:n,upgrade:s,blocking:o,terminated:i}={}){const a=indexedDB.open(e,t),c=Mr(a);return s&&a.addEventListener("upgradeneeded",d=>{s(Mr(a.result),d.oldVersion,d.newVersion,Mr(a.transaction),d)}),n&&a.addEventListener("blocked",d=>n(d.oldVersion,d.newVersion,d)),c.then(d=>{i&&d.addEventListener("close",()=>i()),o&&d.addEventListener("versionchange",f=>o(f.oldVersion,f.newVersion,f))}).catch(()=>{}),c}function nd(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",s=>t(s.oldVersion,s)),Mr(n).then(()=>{})}const p2=["get","getKey","getAll","getAllKeys","count"],g2=["put","add","delete","clear"],rd=new Map;function ep(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(rd.get(t))return rd.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,o=g2.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(o||p2.includes(n)))return;const i=async function(a,...c){const d=this.transaction(a,o?"readwrite":"readonly");let f=d.store;return s&&(f=f.index(c.shift())),(await Promise.all([f[n](...c),o&&d.done]))[0]};return rd.set(t,i),i}f2(e=>({...e,get:(t,n,s)=>ep(t,n)||e.get(t,n,s),has:(t,n)=>!!ep(t,n)||e.has(t,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x2{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(y2(n)){const s=n.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(n=>n).join(" ")}}function y2(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const ju="@firebase/app",tp="0.14.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Or=new i2("@firebase/app"),v2="@firebase/app-compat",w2="@firebase/analytics-compat",b2="@firebase/analytics",j2="@firebase/app-check-compat",N2="@firebase/app-check",k2="@firebase/auth",S2="@firebase/auth-compat",C2="@firebase/database",E2="@firebase/data-connect",I2="@firebase/database-compat",T2="@firebase/functions",_2="@firebase/functions-compat",M2="@firebase/installations",A2="@firebase/installations-compat",R2="@firebase/messaging",P2="@firebase/messaging-compat",L2="@firebase/performance",U2="@firebase/performance-compat",O2="@firebase/remote-config",$2="@firebase/remote-config-compat",D2="@firebase/storage",F2="@firebase/storage-compat",z2="@firebase/firestore",B2="@firebase/ai",V2="@firebase/firestore-compat",H2="firebase";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nu="[DEFAULT]",W2={[ju]:"fire-core",[v2]:"fire-core-compat",[b2]:"fire-analytics",[w2]:"fire-analytics-compat",[N2]:"fire-app-check",[j2]:"fire-app-check-compat",[k2]:"fire-auth",[S2]:"fire-auth-compat",[C2]:"fire-rtdb",[E2]:"fire-data-connect",[I2]:"fire-rtdb-compat",[T2]:"fire-fn",[_2]:"fire-fn-compat",[M2]:"fire-iid",[A2]:"fire-iid-compat",[R2]:"fire-fcm",[P2]:"fire-fcm-compat",[L2]:"fire-perf",[U2]:"fire-perf-compat",[O2]:"fire-rc",[$2]:"fire-rc-compat",[D2]:"fire-gcs",[F2]:"fire-gcs-compat",[z2]:"fire-fst",[V2]:"fire-fst-compat",[B2]:"fire-vertex","fire-js":"fire-js",[H2]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ul=new Map,G2=new Map,ku=new Map;function np(e,t){try{e.container.addComponent(t)}catch(n){Or.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Ws(e){const t=e.name;if(ku.has(t))return Or.debug(`There were multiple attempts to register component ${t}.`),!1;ku.set(t,e);for(const n of Ul.values())np(n,e);for(const n of G2.values())np(n,e);return!0}function qf(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q2={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ds=new fc("app","Firebase",q2);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K2{constructor(t,n,s){this._isDeleted=!1,this._options={...t},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new xs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ds.create("app-deleted",{appName:this._name})}}function Ax(e,t={}){let n=e;typeof t!="object"&&(t={name:t});const s={name:Nu,automaticDataCollectionEnabled:!0,...t},o=s.name;if(typeof o!="string"||!o)throw ds.create("bad-app-name",{appName:String(o)});if(n||(n=Ex()),!n)throw ds.create("no-options");const i=Ul.get(o);if(i){if(vu(n,i.options)&&vu(s,i.config))return i;throw ds.create("duplicate-app",{appName:o})}const a=new t2(o);for(const d of ku.values())a.addComponent(d);const c=new K2(n,s,a);return Ul.set(o,c),c}function Y2(e=Nu){const t=Ul.get(e);if(!t&&e===Nu&&Ex())return Ax();if(!t)throw ds.create("no-app",{appName:e});return t}function us(e,t,n){let s=W2[e]??e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),i=t.match(/\s|\//);if(o||i){const a=[`Unable to register library "${s}" with version "${t}":`];o&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&i&&a.push("and"),i&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Or.warn(a.join(" "));return}Ws(new xs(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J2="firebase-heartbeat-database",Q2=1,Ki="firebase-heartbeat-store";let sd=null;function Rx(){return sd||(sd=mc(J2,Q2,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(Ki)}catch(n){console.warn(n)}}}}).catch(e=>{throw ds.create("idb-open",{originalErrorMessage:e.message})})),sd}async function X2(e){try{const n=(await Rx()).transaction(Ki),s=await n.objectStore(Ki).get(Px(e));return await n.done,s}catch(t){if(t instanceof Vo)Or.warn(t.message);else{const n=ds.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Or.warn(n.message)}}}async function rp(e,t){try{const s=(await Rx()).transaction(Ki,"readwrite");await s.objectStore(Ki).put(t,Px(e)),await s.done}catch(n){if(n instanceof Vo)Or.warn(n.message);else{const s=ds.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Or.warn(s.message)}}}function Px(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z2=1024,ek=30;class tk{constructor(t){this.container=t,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new rk(n),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var t,n;try{const o=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=sp();if(((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:o}),this._heartbeatsCache.heartbeats.length>ek){const a=sk(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){Or.warn(s)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=sp(),{heartbeatsToSend:s,unsentEntries:o}=nk(this._heartbeatsCache.heartbeats),i=Cx(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=n,o.length>0?(this._heartbeatsCache.heartbeats=o,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Or.warn(n),""}}}function sp(){return new Date().toISOString().substring(0,10)}function nk(e,t=Z2){const n=[];let s=e.slice();for(const o of e){const i=n.find(a=>a.agent===o.agent);if(i){if(i.dates.push(o.date),op(n)>t){i.dates.pop();break}}else if(n.push({agent:o.agent,dates:[o.date]}),op(n)>t){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}class rk{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ix()?Tx().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await X2(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const s=await this.read();return rp(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const s=await this.read();return rp(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}else return}}function op(e){return Cx(JSON.stringify({version:2,heartbeats:e})).length}function sk(e){if(e.length===0)return-1;let t=0,n=e[0].date;for(let s=1;s<e.length;s++)e[s].date<n&&(n=e[s].date,t=s);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ok(e){Ws(new xs("platform-logger",t=>new x2(t),"PRIVATE")),Ws(new xs("heartbeat",t=>new tk(t),"PRIVATE")),us(ju,tp,e),us(ju,tp,"esm2020"),us("fire-js","")}ok("");var ik="firebase",ak="12.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */us(ik,ak,"app");const Lx="@firebase/installations",Kf="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ux=1e4,Ox=`w:${Kf}`,$x="FIS_v2",lk="https://firebaseinstallations.googleapis.com/v1",ck=60*60*1e3,dk="installations",uk="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fk={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Gs=new fc(dk,uk,fk);function Dx(e){return e instanceof Vo&&e.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fx({projectId:e}){return`${lk}/projects/${e}/installations`}function zx(e){return{token:e.token,requestStatus:2,expiresIn:hk(e.expiresIn),creationTime:Date.now()}}async function Bx(e,t){const s=(await t.json()).error;return Gs.create("request-failed",{requestName:e,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function Vx({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function mk(e,{refreshToken:t}){const n=Vx(e);return n.append("Authorization",pk(t)),n}async function Hx(e){const t=await e();return t.status>=500&&t.status<600?e():t}function hk(e){return Number(e.replace("s","000"))}function pk(e){return`${$x} ${e}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gk({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const s=Fx(e),o=Vx(e),i=t.getImmediate({optional:!0});if(i){const f=await i.getHeartbeatsHeader();f&&o.append("x-firebase-client",f)}const a={fid:n,authVersion:$x,appId:e.appId,sdkVersion:Ox},c={method:"POST",headers:o,body:JSON.stringify(a)},d=await Hx(()=>fetch(s,c));if(d.ok){const f=await d.json();return{fid:f.fid||n,registrationStatus:2,refreshToken:f.refreshToken,authToken:zx(f.authToken)}}else throw await Bx("Create Installation",d)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wx(e){return new Promise(t=>{setTimeout(t,e)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xk(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yk=/^[cdef][\w-]{21}$/,Su="";function vk(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const n=wk(e);return yk.test(n)?n:Su}catch{return Su}}function wk(e){return xk(e).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hc(e){return`${e.appName}!${e.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gx=new Map;function qx(e,t){const n=hc(e);Kx(n,t),bk(n,t)}function Kx(e,t){const n=Gx.get(e);if(n)for(const s of n)s(t)}function bk(e,t){const n=jk();n&&n.postMessage({key:e,fid:t}),Nk()}let Us=null;function jk(){return!Us&&"BroadcastChannel"in self&&(Us=new BroadcastChannel("[Firebase] FID Change"),Us.onmessage=e=>{Kx(e.data.key,e.data.fid)}),Us}function Nk(){Gx.size===0&&Us&&(Us.close(),Us=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kk="firebase-installations-database",Sk=1,qs="firebase-installations-store";let od=null;function Yf(){return od||(od=mc(kk,Sk,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(qs)}}})),od}async function Ol(e,t){const n=hc(e),o=(await Yf()).transaction(qs,"readwrite"),i=o.objectStore(qs),a=await i.get(n);return await i.put(t,n),await o.done,(!a||a.fid!==t.fid)&&qx(e,t.fid),t}async function Yx(e){const t=hc(e),s=(await Yf()).transaction(qs,"readwrite");await s.objectStore(qs).delete(t),await s.done}async function pc(e,t){const n=hc(e),o=(await Yf()).transaction(qs,"readwrite"),i=o.objectStore(qs),a=await i.get(n),c=t(a);return c===void 0?await i.delete(n):await i.put(c,n),await o.done,c&&(!a||a.fid!==c.fid)&&qx(e,c.fid),c}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jf(e){let t;const n=await pc(e.appConfig,s=>{const o=Ck(s),i=Ek(e,o);return t=i.registrationPromise,i.installationEntry});return n.fid===Su?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}function Ck(e){const t=e||{fid:vk(),registrationStatus:0};return Jx(t)}function Ek(e,t){if(t.registrationStatus===0){if(!navigator.onLine){const o=Promise.reject(Gs.create("app-offline"));return{installationEntry:t,registrationPromise:o}}const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},s=Ik(e,n);return{installationEntry:n,registrationPromise:s}}else return t.registrationStatus===1?{installationEntry:t,registrationPromise:Tk(e)}:{installationEntry:t}}async function Ik(e,t){try{const n=await gk(e,t);return Ol(e.appConfig,n)}catch(n){throw Dx(n)&&n.customData.serverCode===409?await Yx(e.appConfig):await Ol(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}async function Tk(e){let t=await ip(e.appConfig);for(;t.registrationStatus===1;)await Wx(100),t=await ip(e.appConfig);if(t.registrationStatus===0){const{installationEntry:n,registrationPromise:s}=await Jf(e);return s||n}return t}function ip(e){return pc(e,t=>{if(!t)throw Gs.create("installation-not-found");return Jx(t)})}function Jx(e){return _k(e)?{fid:e.fid,registrationStatus:0}:e}function _k(e){return e.registrationStatus===1&&e.registrationTime+Ux<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mk({appConfig:e,heartbeatServiceProvider:t},n){const s=Ak(e,n),o=mk(e,n),i=t.getImmediate({optional:!0});if(i){const f=await i.getHeartbeatsHeader();f&&o.append("x-firebase-client",f)}const a={installation:{sdkVersion:Ox,appId:e.appId}},c={method:"POST",headers:o,body:JSON.stringify(a)},d=await Hx(()=>fetch(s,c));if(d.ok){const f=await d.json();return zx(f)}else throw await Bx("Generate Auth Token",d)}function Ak(e,{fid:t}){return`${Fx(e)}/${t}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qf(e,t=!1){let n;const s=await pc(e.appConfig,i=>{if(!Qx(i))throw Gs.create("not-registered");const a=i.authToken;if(!t&&Lk(a))return i;if(a.requestStatus===1)return n=Rk(e,t),i;{if(!navigator.onLine)throw Gs.create("app-offline");const c=Ok(i);return n=Pk(e,c),c}});return n?await n:s.authToken}async function Rk(e,t){let n=await ap(e.appConfig);for(;n.authToken.requestStatus===1;)await Wx(100),n=await ap(e.appConfig);const s=n.authToken;return s.requestStatus===0?Qf(e,t):s}function ap(e){return pc(e,t=>{if(!Qx(t))throw Gs.create("not-registered");const n=t.authToken;return $k(n)?{...t,authToken:{requestStatus:0}}:t})}async function Pk(e,t){try{const n=await Mk(e,t),s={...t,authToken:n};return await Ol(e.appConfig,s),n}catch(n){if(Dx(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await Yx(e.appConfig);else{const s={...t,authToken:{requestStatus:0}};await Ol(e.appConfig,s)}throw n}}function Qx(e){return e!==void 0&&e.registrationStatus===2}function Lk(e){return e.requestStatus===2&&!Uk(e)}function Uk(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+ck}function Ok(e){const t={requestStatus:1,requestTime:Date.now()};return{...e,authToken:t}}function $k(e){return e.requestStatus===1&&e.requestTime+Ux<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dk(e){const t=e,{installationEntry:n,registrationPromise:s}=await Jf(t);return s?s.catch(console.error):Qf(t).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fk(e,t=!1){const n=e;return await zk(n),(await Qf(n,t)).token}async function zk(e){const{registrationPromise:t}=await Jf(e);t&&await t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bk(e){if(!e||!e.options)throw id("App Configuration");if(!e.name)throw id("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw id(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}function id(e){return Gs.create("missing-app-config-values",{valueName:e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xx="installations",Vk="installations-internal",Hk=e=>{const t=e.getProvider("app").getImmediate(),n=Bk(t),s=qf(t,"heartbeat");return{app:t,appConfig:n,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},Wk=e=>{const t=e.getProvider("app").getImmediate(),n=qf(t,Xx).getImmediate();return{getId:()=>Dk(n),getToken:o=>Fk(n,o)}};function Gk(){Ws(new xs(Xx,Hk,"PUBLIC")),Ws(new xs(Vk,Wk,"PRIVATE"))}Gk();us(Lx,Kf);us(Lx,Kf,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qk="/firebase-messaging-sw.js",Kk="/firebase-cloud-messaging-push-scope",Zx="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Yk="https://fcmregistrations.googleapis.com/v1",ey="google.c.a.c_id",Jk="google.c.a.c_l",Qk="google.c.a.ts",Xk="google.c.a.e",lp=1e4;var cp;(function(e){e[e.DATA_MESSAGE=1]="DATA_MESSAGE",e[e.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(cp||(cp={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var Yi;(function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"})(Yi||(Yi={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kr(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Zk(e){const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),s=atob(n),o=new Uint8Array(s.length);for(let i=0;i<s.length;++i)o[i]=s.charCodeAt(i);return o}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ad="fcm_token_details_db",eS=5,dp="fcm_token_object_Store";async function tS(e){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(ad))return null;let t=null;return(await mc(ad,eS,{upgrade:async(s,o,i,a)=>{if(o<2||!s.objectStoreNames.contains(dp))return;const c=a.objectStore(dp),d=await c.index("fcmSenderId").get(e);if(await c.clear(),!!d){if(o===2){const f=d;if(!f.auth||!f.p256dh||!f.endpoint)return;t={token:f.fcmToken,createTime:f.createTime??Date.now(),subscriptionOptions:{auth:f.auth,p256dh:f.p256dh,endpoint:f.endpoint,swScope:f.swScope,vapidKey:typeof f.vapidKey=="string"?f.vapidKey:kr(f.vapidKey)}}}else if(o===3){const f=d;t={token:f.fcmToken,createTime:f.createTime,subscriptionOptions:{auth:kr(f.auth),p256dh:kr(f.p256dh),endpoint:f.endpoint,swScope:f.swScope,vapidKey:kr(f.vapidKey)}}}else if(o===4){const f=d;t={token:f.fcmToken,createTime:f.createTime,subscriptionOptions:{auth:kr(f.auth),p256dh:kr(f.p256dh),endpoint:f.endpoint,swScope:f.swScope,vapidKey:kr(f.vapidKey)}}}}}})).close(),await nd(ad),await nd("fcm_vapid_details_db"),await nd("undefined"),nS(t)?t:null}function nS(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return typeof e.createTime=="number"&&e.createTime>0&&typeof e.token=="string"&&e.token.length>0&&typeof t.auth=="string"&&t.auth.length>0&&typeof t.p256dh=="string"&&t.p256dh.length>0&&typeof t.endpoint=="string"&&t.endpoint.length>0&&typeof t.swScope=="string"&&t.swScope.length>0&&typeof t.vapidKey=="string"&&t.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rS="firebase-messaging-database",sS=1,Ji="firebase-messaging-store";let ld=null;function ty(){return ld||(ld=mc(rS,sS,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(Ji)}}})),ld}async function oS(e){const t=ny(e),s=await(await ty()).transaction(Ji).objectStore(Ji).get(t);if(s)return s;{const o=await tS(e.appConfig.senderId);if(o)return await Xf(e,o),o}}async function Xf(e,t){const n=ny(e),o=(await ty()).transaction(Ji,"readwrite");return await o.objectStore(Ji).put(t,n),await o.done,t}function ny({appConfig:e}){return e.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iS={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},Zt=new fc("messaging","Messaging",iS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aS(e,t){const n=await em(e),s=ry(t),o={method:"POST",headers:n,body:JSON.stringify(s)};let i;try{i=await(await fetch(Zf(e.appConfig),o)).json()}catch(a){throw Zt.create("token-subscribe-failed",{errorInfo:a==null?void 0:a.toString()})}if(i.error){const a=i.error.message;throw Zt.create("token-subscribe-failed",{errorInfo:a})}if(!i.token)throw Zt.create("token-subscribe-no-token");return i.token}async function lS(e,t){const n=await em(e),s=ry(t.subscriptionOptions),o={method:"PATCH",headers:n,body:JSON.stringify(s)};let i;try{i=await(await fetch(`${Zf(e.appConfig)}/${t.token}`,o)).json()}catch(a){throw Zt.create("token-update-failed",{errorInfo:a==null?void 0:a.toString()})}if(i.error){const a=i.error.message;throw Zt.create("token-update-failed",{errorInfo:a})}if(!i.token)throw Zt.create("token-update-no-token");return i.token}async function cS(e,t){const s={method:"DELETE",headers:await em(e)};try{const i=await(await fetch(`${Zf(e.appConfig)}/${t}`,s)).json();if(i.error){const a=i.error.message;throw Zt.create("token-unsubscribe-failed",{errorInfo:a})}}catch(o){throw Zt.create("token-unsubscribe-failed",{errorInfo:o==null?void 0:o.toString()})}}function Zf({projectId:e}){return`${Yk}/projects/${e}/registrations`}async function em({appConfig:e,installations:t}){const n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function ry({p256dh:e,auth:t,endpoint:n,vapidKey:s}){const o={web:{endpoint:n,auth:t,p256dh:e}};return s!==Zx&&(o.web.applicationPubKey=s),o}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dS=7*24*60*60*1e3;async function uS(e){const t=await mS(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:kr(t.getKey("auth")),p256dh:kr(t.getKey("p256dh"))},s=await oS(e.firebaseDependencies);if(s){if(hS(s.subscriptionOptions,n))return Date.now()>=s.createTime+dS?fS(e,{token:s.token,createTime:Date.now(),subscriptionOptions:n}):s.token;try{await cS(e.firebaseDependencies,s.token)}catch(o){console.warn(o)}return up(e.firebaseDependencies,n)}else return up(e.firebaseDependencies,n)}async function fS(e,t){try{const n=await lS(e.firebaseDependencies,t),s={...t,token:n,createTime:Date.now()};return await Xf(e.firebaseDependencies,s),n}catch(n){throw n}}async function up(e,t){const s={token:await aS(e,t),createTime:Date.now(),subscriptionOptions:t};return await Xf(e,s),s.token}async function mS(e,t){const n=await e.pushManager.getSubscription();return n||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Zk(t)})}function hS(e,t){const n=t.vapidKey===e.vapidKey,s=t.endpoint===e.endpoint,o=t.auth===e.auth,i=t.p256dh===e.p256dh;return n&&s&&o&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fp(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return pS(t,e),gS(t,e),xS(t,e),t}function pS(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const s=t.notification.body;s&&(e.notification.body=s);const o=t.notification.image;o&&(e.notification.image=o);const i=t.notification.icon;i&&(e.notification.icon=i)}function gS(e,t){t.data&&(e.data=t.data)}function xS(e,t){var o,i,a,c;if(!t.fcmOptions&&!((o=t.notification)!=null&&o.click_action))return;e.fcmOptions={};const n=((i=t.fcmOptions)==null?void 0:i.link)??((a=t.notification)==null?void 0:a.click_action);n&&(e.fcmOptions.link=n);const s=(c=t.fcmOptions)==null?void 0:c.analytics_label;s&&(e.fcmOptions.analyticsLabel=s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yS(e){return typeof e=="object"&&!!e&&ey in e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */vS("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function vS(e,t){const n=[];for(let s=0;s<e.length;s++)n.push(e.charAt(s)),s<t.length&&n.push(t.charAt(s));return n.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wS(e){if(!e||!e.options)throw cd("App Configuration Object");if(!e.name)throw cd("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const s of t)if(!n[s])throw cd(s);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}function cd(e){return Zt.create("missing-app-config-values",{valueName:e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bS{constructor(t,n,s){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const o=wS(t);this.firebaseDependencies={app:t,appConfig:o,installations:n,analyticsProvider:s}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jS(e){try{e.swRegistration=await navigator.serviceWorker.register(qk,{scope:Kk}),e.swRegistration.update().catch(()=>{}),await NS(e.swRegistration)}catch(t){throw Zt.create("failed-service-worker-registration",{browserErrorMessage:t==null?void 0:t.message})}}async function NS(e){return new Promise((t,n)=>{const s=setTimeout(()=>n(new Error(`Service worker not registered after ${lp} ms`)),lp),o=e.installing||e.waiting;e.active?(clearTimeout(s),t()):o?o.onstatechange=i=>{var a;((a=i.target)==null?void 0:a.state)==="activated"&&(o.onstatechange=null,clearTimeout(s),t())}:(clearTimeout(s),n(new Error("No incoming service worker found.")))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kS(e,t){if(!t&&!e.swRegistration&&await jS(e),!(!t&&e.swRegistration)){if(!(t instanceof ServiceWorkerRegistration))throw Zt.create("invalid-sw-registration");e.swRegistration=t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SS(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=Zx)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sy(e,t){if(!navigator)throw Zt.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw Zt.create("permission-blocked");return await SS(e,t==null?void 0:t.vapidKey),await kS(e,t==null?void 0:t.serviceWorkerRegistration),uS(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CS(e,t,n){const s=ES(t);(await e.firebaseDependencies.analyticsProvider.get()).logEvent(s,{message_id:n[ey],message_name:n[Jk],message_time:n[Qk],message_device_time:Math.floor(Date.now()/1e3)})}function ES(e){switch(e){case Yi.NOTIFICATION_CLICKED:return"notification_open";case Yi.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IS(e,t){const n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===Yi.PUSH_RECEIVED&&(typeof e.onMessageHandler=="function"?e.onMessageHandler(fp(n)):e.onMessageHandler.next(fp(n)));const s=n.data;yS(s)&&s[Xk]==="1"&&await CS(e,n.messageType,s)}const mp="@firebase/messaging",hp="0.12.23";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TS=e=>{const t=new bS(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",n=>IS(t,n)),t},_S=e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:s=>sy(t,s)}};function MS(){Ws(new xs("messaging",TS,"PUBLIC")),Ws(new xs("messaging-internal",_S,"PRIVATE")),us(mp,hp),us(mp,hp,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AS(){try{await Tx()}catch{return!1}return typeof window<"u"&&Ix()&&KN()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RS(e,t){if(!navigator)throw Zt.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PS(e=Y2()){return AS().then(t=>{if(!t)throw Zt.create("unsupported-browser")},t=>{throw Zt.create("indexed-db-unsupported")}),qf(Wf(e),"messaging").getImmediate()}async function LS(e,t){return e=Wf(e),sy(e,t)}function US(e,t){return e=Wf(e),RS(e,t)}MS();let dd=null,$l=null;function OS(){try{return dd||(dd=Ax(IN),$l=PS(dd),console.log(" Firebase initialized")),!0}catch(e){return console.error(" Firebase initialization failed:",e),!1}}async function $S(e){try{if(!OS())return{success:!1,error:"Firebase init failed"};if(await Notification.requestPermission()!=="granted")return{success:!1,error:"Permission denied"};const n=await LS($l,{vapidKey:TN});if(n){console.log(" FCM Token:",n.substring(0,20)+"...");const s=jx.API_URL.replace(/\/?api\/?$/,""),o=localStorage.getItem("token");return await nt.post(`${s}/api/fcm-notifications/register`,{userId:e,token:n},{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}}),console.log(" FCM token registered with backend"),localStorage.setItem("fcmToken",n),{success:!0,token:n}}return{success:!1,error:"No token available"}}catch(t){return console.error(" FCM registration failed:",t),{success:!1,error:t.message}}}async function Cu(e){try{console.log(" Initializing FCM...");const t=await $S(e);return t.success&&$l&&US($l,n=>{console.log(" FCM message received:",n);const{title:s,body:o,icon:i}=n.notification||{};Notification.permission==="granted"&&new Notification(s||"New Message",{body:o||"You have a new message",icon:i||"/icon.png"})}),t}catch(t){return console.error(" FCM init failed:",t),{success:!1,error:t.message}}}const oy=h.createContext(),fn=()=>{const e=h.useContext(oy);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},DS=({children:e})=>{const[t,n]=h.useState(null),[s,o]=h.useState(!0);h.useEffect(()=>{localStorage.getItem("token")?Si.getCurrentUser().then(x=>{var g;n(x.data.user),(g=x.data.user)!=null&&g._id&&Cu(x.data.user._id).then(b=>{if(b.success)console.log(" FCM initialized");else return console.log(" FCM failed, trying Web Push..."),yu(x.data.user._id)}).then(b=>{b&&b.success&&console.log(" Web Push initialized")}).catch(b=>{console.log(" Notifications failed:",b)})}).catch(x=>{console.error("Auth check failed:",x),localStorage.removeItem("token")}).finally(()=>{o(!1)}):o(!1)},[]);const d={user:t,setUser:n,login:async(f,x)=>{var g,b,_,I;try{const M=await Si.login(f,x),{token:v,user:w}=M.data;return localStorage.setItem("token",v),n(w),w!=null&&w._id&&Cu(w._id).then(m=>{if(m.success)console.log(" FCM enabled");else return console.log(" FCM failed, trying Web Push..."),yu(w._id)}).then(m=>{m&&m.success&&console.log(" Web Push enabled")}).catch(m=>{console.log(" Notifications failed:",m)}),{success:!0,data:M.data}}catch(M){return(b=(g=M.response)==null?void 0:g.data)!=null&&b.disabled?{success:!1,error:"Your account has been disabled by administrator",disabled:!0}:{success:!1,error:((I=(_=M.response)==null?void 0:_.data)==null?void 0:I.message)||"Login failed"}}},registerSuperAdmin:async(f,x,g)=>{var b,_;try{const I=await Si.registerSuperAdmin(f,x,g),{token:M,user:v}=I.data;return localStorage.setItem("token",M),n(v),{success:!0,data:I.data}}catch(I){return{success:!1,error:((_=(b=I.response)==null?void 0:b.data)==null?void 0:_.message)||"Registration failed"}}},logout:()=>{localStorage.removeItem("token"),n(null)},loading:s};return r.jsx(oy.Provider,{value:d,children:e})},FS="modulepreload",zS=function(e,t){return new URL(e,t).href},pp={},BS=function(t,n,s){if(!n||n.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=zS(i,s),i in pp)return;pp[i]=!0;const a=i.endsWith(".css"),c=a?'[rel="stylesheet"]':"";if(!!s)for(let x=o.length-1;x>=0;x--){const g=o[x];if(g.href===i&&(!a||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${c}`))return;const f=document.createElement("link");if(f.rel=a?"stylesheet":FS,a||(f.as="script",f.crossOrigin=""),f.href=i,document.head.appendChild(f),a)return new Promise((x,g)=>{f.addEventListener("load",x),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t()).catch(i=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i})},pr=Object.create(null);pr.open="0";pr.close="1";pr.ping="2";pr.pong="3";pr.message="4";pr.upgrade="5";pr.noop="6";const rl=Object.create(null);Object.keys(pr).forEach(e=>{rl[pr[e]]=e});const Eu={type:"error",data:"parser error"},iy=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",ay=typeof ArrayBuffer=="function",ly=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,tm=({type:e,data:t},n,s)=>iy&&t instanceof Blob?n?s(t):gp(t,s):ay&&(t instanceof ArrayBuffer||ly(t))?n?s(t):gp(new Blob([t]),s):s(pr[e]+(t||"")),gp=(e,t)=>{const n=new FileReader;return n.onload=function(){const s=n.result.split(",")[1];t("b"+(s||""))},n.readAsDataURL(e)};function xp(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let ud;function VS(e,t){if(iy&&e.data instanceof Blob)return e.data.arrayBuffer().then(xp).then(t);if(ay&&(e.data instanceof ArrayBuffer||ly(e.data)))return t(xp(e.data));tm(e,!1,n=>{ud||(ud=new TextEncoder),t(ud.encode(n))})}const yp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",hi=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<yp.length;e++)hi[yp.charCodeAt(e)]=e;const HS=e=>{let t=e.length*.75,n=e.length,s,o=0,i,a,c,d;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const f=new ArrayBuffer(t),x=new Uint8Array(f);for(s=0;s<n;s+=4)i=hi[e.charCodeAt(s)],a=hi[e.charCodeAt(s+1)],c=hi[e.charCodeAt(s+2)],d=hi[e.charCodeAt(s+3)],x[o++]=i<<2|a>>4,x[o++]=(a&15)<<4|c>>2,x[o++]=(c&3)<<6|d&63;return f},WS=typeof ArrayBuffer=="function",nm=(e,t)=>{if(typeof e!="string")return{type:"message",data:cy(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:GS(e.substring(1),t)}:rl[n]?e.length>1?{type:rl[n],data:e.substring(1)}:{type:rl[n]}:Eu},GS=(e,t)=>{if(WS){const n=HS(e);return cy(n,t)}else return{base64:!0,data:e}},cy=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},dy=String.fromCharCode(30),qS=(e,t)=>{const n=e.length,s=new Array(n);let o=0;e.forEach((i,a)=>{tm(i,!1,c=>{s[a]=c,++o===n&&t(s.join(dy))})})},KS=(e,t)=>{const n=e.split(dy),s=[];for(let o=0;o<n.length;o++){const i=nm(n[o],t);if(s.push(i),i.type==="error")break}return s};function YS(){return new TransformStream({transform(e,t){VS(e,n=>{const s=n.length;let o;if(s<126)o=new Uint8Array(1),new DataView(o.buffer).setUint8(0,s);else if(s<65536){o=new Uint8Array(3);const i=new DataView(o.buffer);i.setUint8(0,126),i.setUint16(1,s)}else{o=new Uint8Array(9);const i=new DataView(o.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(s))}e.data&&typeof e.data!="string"&&(o[0]|=128),t.enqueue(o),t.enqueue(n)})}})}let fd;function $a(e){return e.reduce((t,n)=>t+n.length,0)}function Da(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let s=0;for(let o=0;o<t;o++)n[o]=e[0][s++],s===e[0].length&&(e.shift(),s=0);return e.length&&s<e[0].length&&(e[0]=e[0].slice(s)),n}function JS(e,t){fd||(fd=new TextDecoder);const n=[];let s=0,o=-1,i=!1;return new TransformStream({transform(a,c){for(n.push(a);;){if(s===0){if($a(n)<1)break;const d=Da(n,1);i=(d[0]&128)===128,o=d[0]&127,o<126?s=3:o===126?s=1:s=2}else if(s===1){if($a(n)<2)break;const d=Da(n,2);o=new DataView(d.buffer,d.byteOffset,d.length).getUint16(0),s=3}else if(s===2){if($a(n)<8)break;const d=Da(n,8),f=new DataView(d.buffer,d.byteOffset,d.length),x=f.getUint32(0);if(x>Math.pow(2,53-32)-1){c.enqueue(Eu);break}o=x*Math.pow(2,32)+f.getUint32(4),s=3}else{if($a(n)<o)break;const d=Da(n,o);c.enqueue(nm(i?d:fd.decode(d),t)),s=0}if(o===0||o>e){c.enqueue(Eu);break}}}})}const uy=4;function It(e){if(e)return QS(e)}function QS(e){for(var t in It.prototype)e[t]=It.prototype[t];return e}It.prototype.on=It.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};It.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};It.prototype.off=It.prototype.removeListener=It.prototype.removeAllListeners=It.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var s,o=0;o<n.length;o++)if(s=n[o],s===t||s.fn===t){n.splice(o,1);break}return n.length===0&&delete this._callbacks["$"+e],this};It.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(n){n=n.slice(0);for(var s=0,o=n.length;s<o;++s)n[s].apply(this,t)}return this};It.prototype.emitReserved=It.prototype.emit;It.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};It.prototype.hasListeners=function(e){return!!this.listeners(e).length};const gc=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0))(),Fn=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),XS="arraybuffer";function fy(e,...t){return t.reduce((n,s)=>(e.hasOwnProperty(s)&&(n[s]=e[s]),n),{})}const ZS=Fn.setTimeout,eC=Fn.clearTimeout;function xc(e,t){t.useNativeTimers?(e.setTimeoutFn=ZS.bind(Fn),e.clearTimeoutFn=eC.bind(Fn)):(e.setTimeoutFn=Fn.setTimeout.bind(Fn),e.clearTimeoutFn=Fn.clearTimeout.bind(Fn))}const tC=1.33;function nC(e){return typeof e=="string"?rC(e):Math.ceil((e.byteLength||e.size)*tC)}function rC(e){let t=0,n=0;for(let s=0,o=e.length;s<o;s++)t=e.charCodeAt(s),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(s++,n+=4);return n}function my(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function sC(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function oC(e){let t={},n=e.split("&");for(let s=0,o=n.length;s<o;s++){let i=n[s].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}class iC extends Error{constructor(t,n,s){super(t),this.description=n,this.context=s,this.type="TransportError"}}class rm extends It{constructor(t){super(),this.writable=!1,xc(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,n,s){return super.emitReserved("error",new iC(t,n,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=nm(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=sC(t);return n.length?"?"+n:""}}class aC extends rm{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||n()})),this.writable||(s++,this.once("drain",function(){--s||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};KS(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,qS(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=my()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}}let hy=!1;try{hy=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const lC=hy;function cC(){}class dC extends aC{constructor(t){if(super(t),typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||s!==t.port}}doWrite(t,n){const s=this.request({method:"POST",data:t});s.on("success",n),s.on("error",(o,i)=>{this.onError("xhr post error",o,i)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,s)=>{this.onError("xhr poll error",n,s)}),this.pollXhr=t}}class hr extends It{constructor(t,n,s){super(),this.createRequest=t,xc(this,s),this._opts=s,this._method=s.method||"GET",this._uri=n,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var t;const n=fy(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(n);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let o in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(o)&&s.setRequestHeader(o,this._opts.extraHeaders[o])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var o;s.readyState===3&&((o=this._opts.cookieJar)===null||o===void 0||o.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(o){this.setTimeoutFn(()=>{this._onError(o)},0);return}typeof document<"u"&&(this._index=hr.requestsCount++,hr.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=cC,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete hr.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}hr.requestsCount=0;hr.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",vp);else if(typeof addEventListener=="function"){const e="onpagehide"in Fn?"pagehide":"unload";addEventListener(e,vp,!1)}}function vp(){for(let e in hr.requests)hr.requests.hasOwnProperty(e)&&hr.requests[e].abort()}const uC=function(){const e=py({xdomain:!1});return e&&e.responseType!==null}();class fC extends dC{constructor(t){super(t);const n=t&&t.forceBase64;this.supportsBinary=uC&&!n}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new hr(py,this.uri(),t)}}function py(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||lC))return new XMLHttpRequest}catch{}if(!t)try{return new Fn[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const gy=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class mC extends rm{get name(){return"websocket"}doOpen(){const t=this.uri(),n=this.opts.protocols,s=gy?{}:fy(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,n,s)}catch(o){return this.emitReserved("error",o)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],o=n===t.length-1;tm(s,this.supportsBinary,i=>{try{this.doWrite(s,i)}catch{}o&&gc(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=my()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}}const md=Fn.WebSocket||Fn.MozWebSocket;class hC extends mC{createSocket(t,n,s){return gy?new md(t,n,s):n?new md(t,n):new md(t)}doWrite(t,n){this.ws.send(n)}}class pC extends rm{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const n=JS(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=t.readable.pipeThrough(n).getReader(),o=YS();o.readable.pipeTo(t.writable),this._writer=o.writable.getWriter();const i=()=>{s.read().then(({done:c,value:d})=>{c||(this.onPacket(d),i())}).catch(c=>{})};i();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],o=n===t.length-1;this._writer.write(s).then(()=>{o&&gc(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const gC={websocket:hC,webtransport:pC,polling:fC},xC=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,yC=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Iu(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),s=e.indexOf("]");n!=-1&&s!=-1&&(e=e.substring(0,n)+e.substring(n,s).replace(/:/g,";")+e.substring(s,e.length));let o=xC.exec(e||""),i={},a=14;for(;a--;)i[yC[a]]=o[a]||"";return n!=-1&&s!=-1&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=vC(i,i.path),i.queryKey=wC(i,i.query),i}function vC(e,t){const n=/\/{2,9}/g,s=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&s.splice(0,1),t.slice(-1)=="/"&&s.splice(s.length-1,1),s}function wC(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,o,i){o&&(n[o]=i)}),n}const Tu=typeof addEventListener=="function"&&typeof removeEventListener=="function",sl=[];Tu&&addEventListener("offline",()=>{sl.forEach(e=>e())},!1);class fs extends It{constructor(t,n){if(super(),this.binaryType=XS,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(n=t,t=null),t){const s=Iu(t);n.hostname=s.host,n.secure=s.protocol==="https"||s.protocol==="wss",n.port=s.port,s.query&&(n.query=s.query)}else n.host&&(n.hostname=Iu(n.host).host);xc(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(s=>{const o=s.prototype.name;this.transports.push(o),this._transportsByName[o]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=oC(this.opts.query)),Tu&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},sl.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=uy,n.transport=t,this.id&&(n.sid=this.id);const s=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&fs.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",fs.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=t.data,this._onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let s=0;s<this.writeBuffer.length;s++){const o=this.writeBuffer[s].data;if(o&&(n+=nC(o)),s>0&&n>this._maxPayload)return this.writeBuffer.slice(0,s);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,gc(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,n,s){return this._sendPacket("message",t,n,s),this}send(t,n,s){return this._sendPacket("message",t,n,s),this}_sendPacket(t,n,s,o){if(typeof n=="function"&&(o=n,n=void 0),typeof s=="function"&&(o=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const i={type:t,data:n,options:s};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),o&&this.once("flush",o),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},s=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}_onError(t){if(fs.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Tu&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=sl.indexOf(this._offlineEventListener);s!==-1&&sl.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this._prevBufferLen=0}}}fs.protocol=uy;class bC extends fs{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let n=this.createTransport(t),s=!1;fs.priorWebsocketSuccess=!1;const o=()=>{s||(n.send([{type:"ping",data:"probe"}]),n.once("packet",g=>{if(!s)if(g.type==="pong"&&g.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;fs.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(x(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const b=new Error("probe error");b.transport=n.name,this.emitReserved("upgradeError",b)}}))};function i(){s||(s=!0,x(),n.close(),n=null)}const a=g=>{const b=new Error("probe error: "+g);b.transport=n.name,i(),this.emitReserved("upgradeError",b)};function c(){a("transport closed")}function d(){a("socket closed")}function f(g){n&&g.name!==n.name&&i()}const x=()=>{n.removeListener("open",o),n.removeListener("error",a),n.removeListener("close",c),this.off("close",d),this.off("upgrading",f)};n.once("open",o),n.once("error",a),n.once("close",c),this.once("close",d),this.once("upgrading",f),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{s||n.open()},200):n.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const n=[];for(let s=0;s<t.length;s++)~this.transports.indexOf(t[s])&&n.push(t[s]);return n}}let jC=class extends bC{constructor(t,n={}){const s=typeof t=="object"?t:n;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(o=>gC[o]).filter(o=>!!o)),super(t,s)}};function NC(e,t="",n){let s=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),s=Iu(e)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const i=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+i+":"+s.port+t,s.href=s.protocol+"://"+i+(n&&n.port===s.port?"":":"+s.port),s}const kC=typeof ArrayBuffer=="function",SC=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,xy=Object.prototype.toString,CC=typeof Blob=="function"||typeof Blob<"u"&&xy.call(Blob)==="[object BlobConstructor]",EC=typeof File=="function"||typeof File<"u"&&xy.call(File)==="[object FileConstructor]";function sm(e){return kC&&(e instanceof ArrayBuffer||SC(e))||CC&&e instanceof Blob||EC&&e instanceof File}function ol(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,s=e.length;n<s;n++)if(ol(e[n]))return!0;return!1}if(sm(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return ol(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&ol(e[n]))return!0;return!1}function IC(e){const t=[],n=e.data,s=e;return s.data=_u(n,t),s.attachments=t.length,{packet:s,buffers:t}}function _u(e,t){if(!e)return e;if(sm(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=_u(e[s],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=_u(e[s],t));return n}return e}function TC(e,t){return e.data=Mu(e.data,t),delete e.attachments,e}function Mu(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Mu(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Mu(e[n],t));return e}const _C=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],MC=5;var We;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(We||(We={}));class AC{constructor(t){this.replacer=t}encode(t){return(t.type===We.EVENT||t.type===We.ACK)&&ol(t)?this.encodeAsBinary({type:t.type===We.EVENT?We.BINARY_EVENT:We.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===We.BINARY_EVENT||t.type===We.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=IC(t),s=this.encodeAsString(n.packet),o=n.buffers;return o.unshift(s),o}}function wp(e){return Object.prototype.toString.call(e)==="[object Object]"}class om extends It{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const s=n.type===We.BINARY_EVENT;s||n.type===We.BINARY_ACK?(n.type=s?We.EVENT:We.ACK,this.reconstructor=new RC(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(sm(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const s={type:Number(t.charAt(0))};if(We[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===We.BINARY_EVENT||s.type===We.BINARY_ACK){const i=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const a=t.substring(i,n);if(a!=Number(a)||t.charAt(n)!=="-")throw new Error("Illegal attachments");s.attachments=Number(a)}if(t.charAt(n+1)==="/"){const i=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););s.nsp=t.substring(i,n)}else s.nsp="/";const o=t.charAt(n+1);if(o!==""&&Number(o)==o){const i=n+1;for(;++n;){const a=t.charAt(n);if(a==null||Number(a)!=a){--n;break}if(n===t.length)break}s.id=Number(t.substring(i,n+1))}if(t.charAt(++n)){const i=this.tryParse(t.substr(n));if(om.isPayloadValid(s.type,i))s.data=i;else throw new Error("invalid payload")}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case We.CONNECT:return wp(n);case We.DISCONNECT:return n===void 0;case We.CONNECT_ERROR:return typeof n=="string"||wp(n);case We.EVENT:case We.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&_C.indexOf(n[0])===-1);case We.ACK:case We.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class RC{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=TC(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const PC=Object.freeze(Object.defineProperty({__proto__:null,Decoder:om,Encoder:AC,get PacketType(){return We},protocol:MC},Symbol.toStringTag,{value:"Module"}));function Yn(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const LC=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class yy extends It{constructor(t,n,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Yn(t,"open",this.onopen.bind(this)),Yn(t,"packet",this.onpacket.bind(this)),Yn(t,"error",this.onerror.bind(this)),Yn(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){var s,o,i;if(LC.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const a={type:We.EVENT,data:n};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const x=this.ids++,g=n.pop();this._registerAckCallback(x,g),a.id=x}const c=(o=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||o===void 0?void 0:o.writable,d=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!c||(d?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(t,n){var s;const o=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(o===void 0){this.acks[t]=n;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let c=0;c<this.sendBuffer.length;c++)this.sendBuffer[c].id===t&&this.sendBuffer.splice(c,1);n.call(this,new Error("operation has timed out"))},o),a=(...c)=>{this.io.clearTimeoutFn(i),n.apply(this,c)};a.withError=!0,this.acks[t]=a}emitWithAck(t,...n){return new Promise((s,o)=>{const i=(a,c)=>a?o(a):s(c);i.withError=!0,n.push(i),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((o,...i)=>s!==this._queue[0]?void 0:(o!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(o)):(this._queue.shift(),n&&n(null,...i)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:We.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(s=>String(s.id)===t)){const s=this.acks[t];delete this.acks[t],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case We.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case We.EVENT:case We.BINARY_EVENT:this.onevent(t);break;case We.ACK:case We.BINARY_ACK:this.onack(t);break;case We.DISCONNECT:this.ondisconnect();break;case We.CONNECT_ERROR:this.destroy();const s=new Error(t.data.message);s.data=t.data.data,this.emitReserved("connect_error",s);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const s of n)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let s=!1;return function(...o){s||(s=!0,n.packet({type:We.ACK,id:t,data:o}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(delete this.acks[t.id],n.withError&&t.data.unshift(null),n.apply(this,t.data))}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:We.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const s of n)s.apply(this,t.data)}}}function Ho(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Ho.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0};Ho.prototype.reset=function(){this.attempts=0};Ho.prototype.setMin=function(e){this.ms=e};Ho.prototype.setMax=function(e){this.max=e};Ho.prototype.setJitter=function(e){this.jitter=e};class Au extends It{constructor(t,n){var s;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,xc(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((s=n.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Ho({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const o=n.parser||PC;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new jC(this.uri,this.opts);const n=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const o=Yn(n,"open",function(){s.onopen(),t&&t()}),i=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),t?t(c):this.maybeReconnectOnOpen()},a=Yn(n,"error",i);if(this._timeout!==!1){const c=this._timeout,d=this.setTimeoutFn(()=>{o(),i(new Error("timeout")),n.close()},c);this.opts.autoUnref&&d.unref(),this.subs.push(()=>{this.clearTimeoutFn(d)})}return this.subs.push(o),this.subs.push(a),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(Yn(t,"ping",this.onping.bind(this)),Yn(t,"data",this.ondata.bind(this)),Yn(t,"error",this.onerror.bind(this)),Yn(t,"close",this.onclose.bind(this)),Yn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){gc(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new yy(this,t,n),this.nsps[t]=s),s}_destroy(t){const n=Object.keys(this.nsps);for(const s of n)if(this.nsps[s].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let s=0;s<n.length;s++)this.engine.write(n[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,n){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(o=>{o?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",o)):t.onreconnect()}))},n);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const ci={};function Ci(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=NC(e,t.path||"/socket.io"),s=n.source,o=n.id,i=n.path,a=ci[o]&&i in ci[o].nsps,c=t.forceNew||t["force new connection"]||t.multiplex===!1||a;let d;return c?d=new Au(s,t):(ci[o]||(ci[o]=new Au(s,t)),d=ci[o]),n.query&&!t.query&&(t.query=n.queryKey),d.socket(n.path,t)}Object.assign(Ci,{Manager:Au,Socket:yy,io:Ci,connect:Ci});const vy=h.createContext(),Wo=()=>{const e=h.useContext(vy);if(!e)throw new Error("useSocket must be used within a SocketProvider");return e},UC=({children:e,user:t})=>{const[n,s]=h.useState(null),[o,i]=h.useState(!1),[a,c]=h.useState([]),[d,f]=h.useState(0),[x,g]=h.useState(Date.now()),[b,_]=h.useState([]),I=async G=>{try{if(console.log(" Starting push notification initialization..."),typeof Notification<"u"&&Notification.permission==="denied"){console.warn(" Notification permission is denied. Skipping push notification setup."),D("Enable notifications in browser settings to receive alerts when offline",{icon:"",duration:5e3});return}if(console.log(" Attempting FCM registration..."),(await Cu(G)).success){console.log(" Push notifications initialized (FCM)");return}console.log(" FCM failed, trying Web Push...");const $=await yu(G);$.success?console.log(" Push notifications initialized (Web Push)"):(console.warn(" Push notifications not initialized:",$.error),$.error.includes("permission"))}catch(V){console.error(" Push notification initialization error:",V)}},M=G=>{if(t&&(t.role==="admin"||t.role==="superadmin")){const $=` DISABLED USER LOGIN ATTEMPT

${G.userName} (${G.userEmail}) is trying to access the system`;D.error($,{duration:8e3,position:"top-center",style:{background:"#fef2f2",color:"#dc2626",border:"2px solid #ef4444",fontSize:"14px",fontWeight:"bold",padding:"16px",borderRadius:"8px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",whiteSpace:"pre-line"},icon:"",className:"toast-admin-alert"});const J=Date.now()+Math.random();_(B=>[...B,{...G,id:J}])}},v=async G=>{try{const{usersAPI:V}=await BS(()=>Promise.resolve().then(()=>SN),void 0,import.meta.url);await V.toggleUserStatus(G);const $=b.find(J=>J.userId===G);_(J=>J.filter(B=>B.userId!==G)),$&&D.success(` User ${$.userName} has been activated successfully!`,{duration:4e3,position:"top-right"})}catch(V){console.error("Error activating user:",V),D.error("Failed to activate user. Please try again.")}},w=G=>{_(V=>V.filter($=>$.id!==G))},m={autoConnect:!0,transports:["websocket","polling"],upgrade:!0,rememberUpgrade:!0,timeout:2e4,forceNew:!0,reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:1e4,maxReconnectionAttempts:1/0};h.useEffect(()=>{if(t&&t.id){console.log(" Initializing socket connection for user:",t.name),console.log(" Socket URL:","https://internalchat.pizeonfly.com"),n&&(console.log(" Closing existing socket connection"),n.close(),s(null));const G=localStorage.getItem("token"),V=Ci("https://internalchat.pizeonfly.com",{...m,auth:{token:G}});V.on("connect",()=>{f(0),g(Date.now()),i(!0),console.log(" Socket connected - ID:",V.id),console.log(" Connected as user:",t.name),console.log(" Connection URL:",V.io.uri),V.emit("join",t.id),console.log(` User ${t.id} joined personal room`),I(t.id),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",B=>{if(console.log(" Service worker message received:",B.data),B.data.type==="send-reply"){const{replyText:ue,receiver:me,sender:ye}=B.data.data;console.log(" Sending reply from notification:",ue),V.emit("send-message",{receiver:me,message:ue,messageType:"text",sender:ye,timestamp:new Date().toISOString()}),D.success(" Reply sent!",{duration:2e3,position:"top-right"})}}),W(V),Z(V)}),V.on("disconnect",B=>{i(!1),console.log(" Socket disconnected - Reason:",B),console.log(" Disconnected user:",t.name),F(),ae(),y(V)}),V.on("connect_error",B=>{console.error(" Socket connection error:",B),i(!1),B.message&&B.message.includes("WebSocket")&&(console.log(" WebSocket connection failed, trying polling transport"),V.io.opts.transports=["polling"],setTimeout(()=>V.connect(),1e3)),y(V)}),V.on("reconnect",B=>{f(0),console.log(" Socket reconnected after",B,"attempts"),console.log(" New Socket ID:",V.id),i(!0),V.emit("join",t.id)}),V.on("reconnect_error",B=>{console.error(" Socket reconnection error:",B)}),V.on("reconnect_failed",()=>{console.error(" Socket reconnection failed"),i(!1)}),V.on("ping",B=>{g(Date.now()),console.log(" Ping received - Connection alive, timestamp:",new Date(Date.now()).toLocaleTimeString())}),V.on("pong",B=>{g(Date.now()),console.log(" Pong received - Connection confirmed, timestamp:",new Date(Date.now()).toLocaleTimeString())}),V.on("connect_timeout",()=>{console.log(" Socket connection timed out")}),V.on("reconnect_error",B=>{console.error(" Reconnection error:",B.message)}),V.on("reconnect_failed",()=>{console.error(" Reconnection failed permanently - forcing reconnect"),f(1/0)}),V.on("force-logout",B=>{console.log(" Force logout received:",B),localStorage.removeItem("token"),window.location.href="/login"}),V.on("admin_notification",B=>{M(B)}),V.on("task_notification",B=>{console.log(" Task notification received:",B);const ue=()=>{switch(B.type){case"task_assigned":return` New Task: ${B.taskTitle}
${B.assignedBy} assigned you a ${B.taskPriority} priority task`;case"task_comment":return` ${B.commentedBy} commented on: ${B.taskTitle}`;case"task_status_update":return` Task "${B.taskTitle}" status updated to: ${B.newStatus}`;default:return B.message||"New task notification"}},me=()=>{switch(B.type){case"task_assigned":return B.taskPriority==="high"?"":B.taskPriority==="low"?"":"";case"task_comment":return"";case"task_status_update":return"";default:return""}};D(ue(),{icon:me(),duration:5e3,position:"top-right",style:{background:"#f3f4f6",color:"#1f2937",border:"1px solid #e5e7eb",fontSize:"14px",padding:"12px 16px",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",whiteSpace:"pre-line",maxWidth:"400px"}});try{const ye=new Audio("/notification.mp3");ye.volume=.5,ye.play().catch(Ie=>console.log("Audio play failed:",Ie))}catch(ye){console.log("Notification sound failed:",ye)}}),V.on("user-online",B=>{var ue;console.log(" User came online:",(ue=B.user)==null?void 0:ue.name),c(me=>me.find(Ie=>Ie.userId===B.userId)?me.map(Ie=>Ie.userId===B.userId?{...Ie,isOnline:!0,lastSeen:new Date}:Ie):[...me,{...B,isOnline:!0,lastSeen:new Date}])}),V.on("user-offline",B=>{var ue;console.log(" User went offline:",(ue=B.user)==null?void 0:ue.name),c(me=>me.find(Ie=>Ie.userId===B.userId)?me.map(Ie=>Ie.userId===B.userId?{...Ie,isOnline:!1,lastSeen:new Date}:Ie):me)}),V.on("online-users",B=>{console.log(" Initial online users:",B.map(ue=>{var me;return((me=ue.user)==null?void 0:me.name)||ue.name})),c(B.map(ue=>({...ue,isOnline:!0,lastSeen:new Date})))}),s(V);const $=()=>{document.hidden?(console.log(" User left tab - marking as away"),V&&V.connected&&V.emit("user-away",{userId:t.id})):(console.log(" User returned to tab - marking as active"),V&&V.connected&&V.emit("user-active",{userId:t.id}))},J=()=>{console.log(" User closing tab/window - disconnecting immediately"),V&&V.connected&&(V.emit("force-disconnect",{userId:t.id}),V.disconnect())};return document.addEventListener("visibilitychange",$),window.addEventListener("beforeunload",J),()=>{console.log(" Cleaning up socket connection"),document.removeEventListener("visibilitychange",$),window.removeEventListener("beforeunload",J),F(),ae(),V&&V.connected&&V.emit("force-disconnect",{userId:t.id}),V.close(),s(null),i(!1),c([])}}else n&&(console.log(" Disconnecting socket - no user"),n.close(),s(null),i(!1),c([]))},[t==null?void 0:t.id]);const y=G=>{if(console.log(" Starting reconnection logic"),d<5){const V=1e3*Math.pow(2,d);console.log(` Reconnecting in ${V}ms...`),setTimeout(()=>{f($=>$+1),G.connect()},V)}else console.log(" Max reconnections reached, manual reconnection forced"),G.connect()};let R,U;const W=G=>{R&&clearInterval(R),R=setInterval(()=>{const V=Date.now()-x;console.log(`Time since last ping: ${V}ms`),G&&o&&V>45e3&&(console.log(" Proactive ping sent to prevent timeout"),G.emit("ping",{timestamp:Date.now()}),g(Date.now())),V>18e4?(console.log(" Extended timeout reached - checking connection"),G&&G.connected&&o?(console.log(" Connection verified, resetting last ping"),g(Date.now())):(console.log(" Disconnection confirmed, reconnecting..."),G.connect())):console.log(` Socket maintained: ${V}ms since last ping`)},25e3)},F=()=>{R&&(clearInterval(R),R=null)},Z=G=>{U&&clearInterval(U),U=setInterval(()=>{G&&G.connected&&G.emit("client-heartbeat",{t:Date.now()})},2e3)},ae=()=>{U&&(clearInterval(U),U=null)},z={socket:n,isConnected:o,onlineUsers:a,notifications:b,sendMessage:(G,V,$="text",J=!1,B=null)=>{if(console.log(" sendMessage called with:",{receiverId:G,content:V,messageType:$,isGroupChat:J,attachment:B,socketStatus:{socket:!!n,isConnected:o,socketId:n==null?void 0:n.id}}),n&&o){console.log(" Emitting send-message event...");let ue;return J?(ue={sender:t.id,groupId:G,message:V,messageType:$,timestamp:new Date().toISOString()},n.emit("send-group-message",ue)):(ue={sender:t.id,receiver:G,message:V,messageType:$,timestamp:new Date().toISOString()},n.emit("send-message",ue)),console.log(" Message sent successfully:",ue),!0}else throw console.error(" Cannot send message: Socket not connected"),new Error("Socket not connected. Please check your connection.")},markMessageRead:(G,V)=>{n&&o&&(n.emit("mark-message-read",{messageId:G,senderId:V}),console.log(" Message read marked for:",{messageId:G,senderId:V}))},startTyping:G=>{n&&o&&n.emit("typing",{sender:t.id,receiver:G,isTyping:!0})},stopTyping:G=>{n&&o&&n.emit("typing",{sender:t.id,receiver:G,isTyping:!1})},isUserOnline:G=>{const V=a.find($=>$.userId===G);return V?V.isOnline:!1},getUserStatus:G=>{const V=a.find($=>$.userId===G);return V?{isOnline:V.isOnline,lastSeen:V.lastSeen}:{isOnline:!1,lastSeen:null}},joinGroup:G=>{n&&o&&(n.emit("join-group",G),console.log(" Joined group room:",G))},leaveGroup:G=>{n&&o&&(n.emit("leave-group",G),console.log(" Left group room:",G))},onReceiveMessage:G=>{n&&(n.off("receive-message"),n.on("receive-message",V=>{console.log(" Received message:",V),G(V)}))},onReceiveGroupMessage:G=>{n&&(n.off("receive-group-message"),n.on("receive-group-message",V=>{console.log(" Received group message:",V),G(V)}))},onMessageSent:G=>{n&&(n.off("message-sent"),n.on("message-sent",V=>{console.log(" Message sent confirmation:",V),G(V)}))},onProfileUpdated:G=>{n&&(n.off("avatar-updated"),n.on("avatar-updated",V=>{console.log(" Profile updated:",V),G(V)}))},handleActivateUser:v,handleCloseNotification:w,getConnectionStatus:()=>({isConnected:o,reconnectAttempts:d,lastPing:new Date(x).toLocaleString(),socketId:n==null?void 0:n.id})};return r.jsx(vy.Provider,{value:z,children:e})};var OC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const $C=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ce=(e,t)=>{const n=h.forwardRef(({color:s="currentColor",size:o=24,strokeWidth:i=2,absoluteStrokeWidth:a,children:c,...d},f)=>h.createElement("svg",{ref:f,...OC,width:o,height:o,stroke:s,strokeWidth:a?Number(i)*24/Number(o):i,className:`lucide lucide-${$C(e)}`,...d},[...t.map(([x,g])=>h.createElement(x,g)),...(Array.isArray(c)?c:[c])||[]]));return n.displayName=`${e}`,n},xr=Ce("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),hd=Ce("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),DC=Ce("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),_n=Ce("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),FC=Ce("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Ei=Ce("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Ru=Ce("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),ko=Ce("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Po=Ce("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Lo=Ce("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Pu=Ce("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),ms=Ce("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Zr=Ce("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Dl=Ce("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),Jt=Ce("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Lu=Ce("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Uu=Ce("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Xt=Ce("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]),es=Ce("Forward",[["polyline",{points:"15 17 20 12 15 7",key:"1w3sku"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]),im=Ce("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),In=Ce("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),zC=Ce("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),BC=Ce("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),yc=Ce("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),wy=Ce("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),by=Ce("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),VC=Ce("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),Cr=Ce("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),hs=Ce("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),HC=Ce("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),Ou=Ce("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),WC=Ce("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]),jy=Ce("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),jn=Ce("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),bp=Ce("PhoneCall",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]]),GC=Ce("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]),Qi=Ce("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),cr=Ce("PinOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M9 9v1.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V17h12",key:"13x2n8"}],["path",{d:"M15 9.34V6h1a2 2 0 0 0 0-4H7.89",key:"reo3ki"}]]),On=Ce("Pin",[["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z",key:"13yl11"}]]),Xi=Ce("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),qC=Ce("Power",[["path",{d:"M18.36 6.64a9 9 0 1 1-12.73 0",key:"phirl6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"12",key:"aemgbe"}]]),am=Ce("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Ny=Ce("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Go=Ce("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),vc=Ce("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),lm=Ce("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Zi=Ce("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),ky=Ce("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]),Sy=Ce("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),Ks=Ce("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Cy=Ce("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),So=Ce("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),cm=Ce("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Nn=Ce("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),At=Ce("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),$t=Ce("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),KC=Ce("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),ln=Ce("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ey=Ce("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Iy=Ce("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),YC=()=>{const[e,t]=h.useState({name:"",email:"",password:"",confirmPassword:""}),[n,s]=h.useState("user"),[o,i]=h.useState(!1),[a,c]=h.useState(!1),[d,f]=h.useState(!1),[x,g]=h.useState(!0),[b,_]=h.useState(!1),[I,M]=h.useState(!1),{login:v,registerSuperAdmin:w}=fn();h.useEffect(()=>{(async()=>{try{const F=await Si.checkSuperAdmin();f(F.data.exists)}catch(F){console.error("Error checking super admin:",F)}finally{g(!1)}})()},[]);const m=[{value:"user",label:"User",icon:Nn,description:"Chat with other users"},{value:"admin",label:"Admin",icon:Zi,description:"Manage users and groups"},{value:"superadmin",label:"Super Admin",icon:Dl,description:"Full system access"}],y=W=>{t({...e,[W.target.name]:W.target.value})},R=async W=>{W.preventDefault(),c(!0);try{if(o&&n==="superadmin"){if(e.password!==e.confirmPassword){D.error("Passwords do not match");return}const F=await w(e.name,e.email,e.password);F.success?D.success("Super Admin registered successfully!"):D.error(F.error)}else{const F=await v(e.email,e.password);F.success?D.success("Login successful!"):F.disabled?D.error("Your account has been disabled by administrator"):D.error(F.error)}}catch{D.error("An error occurred. Please try again.")}finally{c(!1)}},U=()=>{if(!o&&d){D.error("Super admin already exists. Please login instead.");return}i(!o),t({name:"",email:"",password:"",confirmPassword:""})};return x?r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-primary-100 flex items-center justify-center p-4",children:r.jsx("div",{className:"max-w-md w-full space-y-8",children:r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"mt-6 text-3xl font-bold text-gray-900",children:"Internal Chat App"}),r.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Checking system status..."}),r.jsx("div",{className:"flex justify-center mt-4",children:r.jsx("div",{className:"w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"})})]})})}):r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-primary-100 flex items-center justify-center p-4",children:r.jsxs("div",{className:"max-w-md w-full space-y-8",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"mt-6 text-3xl font-bold text-gray-900",children:"Internal Chat App"}),r.jsx("p",{className:"mt-2 text-sm text-gray-600",children:o?"Register as Super Admin":"Sign in to your account"})]}),r.jsxs("div",{className:"card p-8",children:[!o&&r.jsxs("div",{className:"mb-6",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Role"}),r.jsx("div",{className:"grid grid-cols-1 gap-3",children:m.map(W=>{const F=W.icon;return r.jsx("button",{type:"button",onClick:()=>s(W.value),className:`p-3 rounded-lg border-2 transition-all ${n===W.value?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"}`,children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(F,{className:"w-5 h-5 text-gray-600"}),r.jsxs("div",{className:"text-left",children:[r.jsx("div",{className:"font-medium text-gray-900",children:W.label}),r.jsx("div",{className:"text-sm text-gray-500",children:W.description})]})]})},W.value)})})]}),r.jsxs("form",{onSubmit:R,className:"space-y-6",children:[o&&r.jsxs("div",{children:[r.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Full Name"}),r.jsx("input",{id:"name",name:"name",type:"text",required:!0,value:e.name,onChange:y,className:"input-field mt-1",placeholder:"Enter your full name"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),r.jsx("input",{id:"email",name:"email",type:"email",required:!0,value:e.email,onChange:y,className:"input-field mt-1",placeholder:"Enter your email"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),r.jsxs("div",{className:"relative mt-1",children:[r.jsx("input",{id:"password",name:"password",type:b?"text":"password",required:!0,value:e.password,onChange:y,className:"input-field pr-10",placeholder:"Enter your password"}),r.jsx("button",{type:"button","aria-label":b?"Hide password":"Show password",onClick:()=>_(!b),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600",children:b?r.jsx(Lu,{className:"w-5 h-5"}):r.jsx(Uu,{className:"w-5 h-5"})})]})]}),o&&r.jsxs("div",{children:[r.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),r.jsxs("div",{className:"relative mt-1",children:[r.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:I?"text":"password",required:!0,value:e.confirmPassword,onChange:y,className:"input-field pr-10",placeholder:"Confirm your password"}),r.jsx("button",{type:"button","aria-label":I?"Hide password":"Show password",onClick:()=>M(!I),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600",children:I?r.jsx(Lu,{className:"w-5 h-5"}):r.jsx(Uu,{className:"w-5 h-5"})})]})]}),r.jsx("div",{children:r.jsx("button",{type:"submit",disabled:a,className:"w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:a?r.jsxs("div",{className:"flex items-center justify-center",children:[r.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),o?"Registering...":"Signing in..."]}):o?"Register Super Admin":"Sign In"})}),r.jsx("div",{className:"text-center",children:r.jsx("button",{type:"button",onClick:U,disabled:x,className:"text-sm text-primary-600 hover:text-primary-500 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Checking system status...":o?"Already have an account? Sign in":d?"Super admin already exists. Please login instead.":"Need to register Super Admin? Click here"})})]})]})]})})},dm=({user:e,callData:t,isIncoming:n=!1,onCallEnd:s,onCallAnswer:o,onCallDecline:i})=>{var G,V,$,J,B,ue,me,ye,Ie,wt,Ze,Rt,Ht,Be,bt;const{socket:a}=Wo(),[c,d]=h.useState(n?"incoming":"outgoing"),[f,x]=h.useState(!1),[g,b]=h.useState(0),[_,I]=h.useState(null),[M,v]=h.useState({x:window.innerWidth-350,y:20}),[w,m]=h.useState(!1),[y,R]=h.useState({x:0,y:0}),U=h.useRef(null),W=h.useRef(null),F=h.useRef(null),Z=h.useRef(null),ae=h.useRef(null),te=(()=>{var gt,at,He,$e,lt,Ye;const pe=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}],Ae=(at=(gt=import.meta)==null?void 0:gt.env)==null?void 0:at.VITE_TURN_URL,Oe=($e=(He=import.meta)==null?void 0:He.env)==null?void 0:$e.VITE_TURN_USERNAME,Qe=(Ye=(lt=import.meta)==null?void 0:lt.env)==null?void 0:Ye.VITE_TURN_CREDENTIAL;return Ae&&Oe&&Qe&&pe.push({urls:Ae,username:Oe,credential:Qe}),{iceServers:pe}})(),fe=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return console.error("WebRTC not supported in this browser or requires HTTPS"),I("Audio calls require HTTPS connection or are not supported in this browser. Please use HTTPS or try a different browser."),!1;if(typeof RTCPeerConnection>"u")return console.error("RTCPeerConnection not supported"),I("WebRTC is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari."),!1;F.current=new RTCPeerConnection(te),F.current.onicecandidate=Ae=>{if(Ae.candidate&&a)try{a.emit("ice-candidate",{callId:t.callId,candidate:Ae.candidate.candidate,sdpMLineIndex:Ae.candidate.sdpMLineIndex,sdpMid:Ae.candidate.sdpMid})}catch(Oe){console.error("Error sending ICE candidate:",Oe)}},F.current.ontrack=Ae=>{if(console.log(" Remote audio track received:",Ae),console.log(" Track details:",{kind:Ae.track.kind,label:Ae.track.label,enabled:Ae.track.enabled,readyState:Ae.track.readyState,streamsCount:Ae.streams.length}),Ae.streams&&Ae.streams[0]){const Oe=Ae.streams[0];console.log(" Setting remote audio stream:",Oe),console.log(" Stream tracks:",Oe.getTracks()),W.current&&(W.current.srcObject=Oe,Oe.getAudioTracks().forEach(Qe=>{Qe.enabled=c==="connected",console.log(" Remote audio track enabled:",Qe.enabled,"callStatus:",c)}),W.current.volume!==void 0&&(W.current.volume=1),c==="connected"?(W.current.muted=!1,W.current.play().catch(Qe=>{Qe.name!=="AbortError"&&console.error(" Error playing remote audio:",Qe)}),console.log(" Remote audio playing after call connected")):(W.current.muted=!0,console.log(" Remote audio muted until call is accepted")))}},F.current.onconnectionstatechange=()=>{const Ae=F.current.connectionState;Ae==="connected"?(d("connected"),L()):(Ae==="disconnected"||Ae==="failed")&&X()};const pe=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});return Z.current=pe,U.current&&(U.current.srcObject=pe),pe.getAudioTracks().forEach(Ae=>{F.current.addTrack(Ae,pe)}),!0}catch(pe){return console.error("Error initializing WebRTC:",pe),pe.name==="NotAllowedError"||pe.name==="PermissionDeniedError"?I("Microphone access denied. Please allow microphone permissions in your browser settings."):pe.name==="NotFoundError"||pe.name==="DevicesNotFoundError"?I("No microphone found. Please connect a microphone and try again."):pe.name==="NotReadableError"||pe.name==="TrackStartError"?I("Microphone is being used by another application. Please close other apps and try again."):pe.name==="OverconstrainedError"?I("Could not access microphone with the required settings."):pe.name==="SecurityError"?I("Audio calls require HTTPS connection. Please access the site via HTTPS."):I(`Failed to access microphone: ${pe.message||"Unknown error"}`),!1}},L=()=>{ae.current=setInterval(()=>{b(pe=>pe+1)},1e3)},oe=()=>{ae.current&&(clearInterval(ae.current),ae.current=null)},P=pe=>{const Ae=Math.floor(pe/60),Oe=pe%60;return`${Ae.toString().padStart(2,"0")}:${Oe.toString().padStart(2,"0")}`},q=pe=>{m(!0);const Ae=pe.currentTarget.getBoundingClientRect();R({x:pe.clientX-Ae.left,y:pe.clientY-Ae.top})},Q=pe=>{if(!w)return;const Ae=pe.clientX-y.x,Oe=pe.clientY-y.y,Qe=window.innerWidth-320,gt=window.innerHeight-200;v({x:Math.max(0,Math.min(Ae,Qe)),y:Math.max(0,Math.min(Oe,gt))})},O=()=>{m(!1)};h.useEffect(()=>{if(w)return document.addEventListener("mousemove",Q),document.addEventListener("mouseup",O),()=>{document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",O)}},[w,y]);const S=async()=>{await fe()&&(d("connecting"),o&&o(),a&&a.emit("call-answer",{callId:t.callId}))},E=()=>{d("declined"),i&&i(),a&&a.emit("call-decline",{callId:t.callId})},X=()=>{oe(),F.current&&(F.current.close(),F.current=null),Z.current&&(Z.current.getTracks().forEach(pe=>pe.stop()),Z.current=null),d("ended"),s&&s(),a&&a.emit("call-end",{callId:t.callId})},z=()=>{if(Z.current){const pe=Z.current.getAudioTracks()[0];pe&&(pe.enabled=!pe.enabled,x(!pe.enabled))}};return h.useEffect(()=>{if(!a)return;const pe=async He=>{if(He.callId===t.callId){d("connecting");try{const $e=await F.current.createOffer();await F.current.setLocalDescription($e),a.emit("call-offer",{callId:t.callId,offer:$e})}catch{I("Failed to establish connection")}}},Ae=async He=>{if(He.callId===t.callId)try{const $e=F.current.signalingState;if(console.log(" Processing offer, current state:",$e),$e==="stable"){await F.current.setRemoteDescription(He.offer);const lt=await F.current.createAnswer();await F.current.setLocalDescription(lt),a.emit("call-answer-webrtc",{callId:t.callId,answer:lt})}else console.warn(" Cannot process offer in state:",$e),I("Call connection not ready")}catch($e){console.error(" Failed to handle call offer:",$e),I("Failed to establish connection")}},Oe=async He=>{if(He.callId===t.callId)try{const $e=F.current.signalingState;console.log(" Processing answer, current state:",$e),$e==="have-local-offer"||$e==="have-local-pranswer"?(await F.current.setRemoteDescription(He.answer),console.log(" Answer processed successfully")):$e==="stable"?console.log(" Connection already established, skipping answer"):(console.warn(" Cannot process answer in state:",$e),I("Call connection not ready"))}catch($e){console.error(" Failed to handle call answer:",$e),I("Failed to establish connection")}},Qe=async He=>{if(He.callId===t.callId&&F.current)try{const $e=new RTCIceCandidate({candidate:He.candidate,sdpMLineIndex:He.sdpMLineIndex,sdpMid:He.sdpMid});await F.current.addIceCandidate($e)}catch{}},gt=He=>{He.callId===t.callId&&(d("declined"),X())},at=He=>{He.callId===t.callId&&X()};return a.on("call-answered",pe),a.on("call-offer",Ae),a.on("call-answer-webrtc",Oe),a.on("ice-candidate",Qe),a.on("call-declined",gt),a.on("call-ended",at),()=>{a.off("call-answered",pe),a.off("call-offer",Ae),a.off("call-answer-webrtc",Oe),a.off("ice-candidate",Qe),a.off("call-declined",gt),a.off("call-ended",at)}},[a,t.callId]),h.useEffect(()=>{!n&&c==="outgoing"&&fe()},[n,c]),h.useEffect(()=>{c==="connected"&&W.current&&(W.current.muted=!1,W.current.volume=1,W.current.play().catch(pe=>{pe.name!=="AbortError"&&console.error(" Error playing remote audio after call connected:",pe)}),console.log(" Remote audio unmuted after call connected"))},[c]),h.useEffect(()=>()=>{oe(),F.current&&F.current.close(),Z.current&&Z.current.getTracks().forEach(pe=>pe.stop())},[]),n&&c==="incoming"?r.jsx("div",{className:"fixed z-50",style:{left:M.x,top:M.y},children:r.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl p-6 w-80 text-center shadow-2xl border border-gray-700 relative",children:[r.jsx("div",{className:"absolute top-2 right-2",children:r.jsx("button",{onMouseDown:q,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:r.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})})}),r.jsx("div",{className:"mb-4",children:(G=t==null?void 0:t.caller)!=null&&G.avatar?r.jsx("img",{src:t.caller.avatar,alt:t.caller.name,className:"w-16 h-16 rounded-full mx-auto object-cover border-2 border-white"}):r.jsx("div",{className:"w-16 h-16 rounded-full mx-auto bg-green-500 text-white flex items-center justify-center text-lg font-bold border-2 border-white",children:(($=(V=t==null?void 0:t.caller)==null?void 0:V.name)==null?void 0:$.charAt(0))||"U"})}),r.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:((J=t==null?void 0:t.caller)==null?void 0:J.name)||"Unknown"}),r.jsx("p",{className:"text-gray-300 mb-6 text-sm",children:" Incoming voice call..."}),r.jsxs("div",{className:"flex justify-center gap-4",children:[r.jsx("button",{onClick:E,className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",children:r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsx("button",{onClick:S,className:"w-12 h-12 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",children:r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})})]})]})}):_?r.jsx("div",{className:"fixed z-50",style:{left:M.x,top:M.y},children:r.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl p-6 w-80 text-center shadow-2xl border border-gray-700 relative",children:[r.jsx("div",{className:"absolute top-2 right-2",children:r.jsx("button",{onMouseDown:q,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:r.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})})}),r.jsx("div",{className:"text-4xl mb-3",children:""}),r.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Call Error"}),r.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:_}),r.jsx("button",{onClick:X,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:"Close"})]})}):r.jsx("div",{className:"fixed z-50",style:{left:M.x,top:M.y},children:r.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 p-6 w-80 text-center text-white relative",children:[r.jsx("div",{className:"absolute top-2 right-2",children:r.jsx("button",{onMouseDown:q,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:r.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})})}),r.jsx("audio",{ref:U,muted:!0,autoPlay:!0}),r.jsx("audio",{ref:W,autoPlay:!0}),r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("h2",{className:"text-sm text-gray-300 mb-2",children:c==="connecting"?"Connecting...":c==="connected"?"Voice Call":c==="outgoing"?"Calling...":"Call"}),r.jsx("h1",{className:"text-lg font-semibold",children:((B=t==null?void 0:t.otherUser)==null?void 0:B.name)||((ue=t==null?void 0:t.caller)==null?void 0:ue.name)||"Unknown"}),c==="connected"&&r.jsx("p",{className:"text-gray-300 mt-1 text-sm",children:P(g)})]}),r.jsx("div",{className:"mb-6",children:(me=t==null?void 0:t.otherUser)!=null&&me.avatar||(ye=t==null?void 0:t.caller)!=null&&ye.avatar?r.jsx("img",{src:((Ie=t==null?void 0:t.otherUser)==null?void 0:Ie.avatar)||((wt=t==null?void 0:t.caller)==null?void 0:wt.avatar),alt:((Ze=t==null?void 0:t.otherUser)==null?void 0:Ze.name)||((Rt=t==null?void 0:t.caller)==null?void 0:Rt.name),className:"w-20 h-20 rounded-full object-cover shadow-2xl border-2 border-white mx-auto"}):r.jsx("div",{className:"w-20 h-20 rounded-full bg-green-500 flex items-center justify-center text-2xl font-bold shadow-2xl border-2 border-white mx-auto",children:((bt=((Ht=t==null?void 0:t.otherUser)==null?void 0:Ht.name)||((Be=t==null?void 0:t.caller)==null?void 0:Be.name))==null?void 0:bt.charAt(0))||"U"})}),r.jsxs("div",{className:"mb-4 text-center",children:[c==="outgoing"&&r.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),r.jsx("span",{className:"text-gray-300 text-sm",children:"Calling..."})]}),c==="connecting"&&r.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce"}),r.jsx("span",{className:"text-gray-300 text-sm",children:"Connecting..."})]}),c==="connected"&&r.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),r.jsx("span",{className:"text-gray-300 text-sm",children:"Connected"})]})]}),r.jsxs("div",{className:"flex gap-4 justify-center",children:[c==="connected"&&r.jsx("button",{onClick:z,className:`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${f?"bg-red-500 hover:bg-red-600":"bg-white bg-opacity-20 hover:bg-opacity-30"}`,title:f?"Unmute":"Mute",children:f?r.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),r.jsx("button",{onClick:X,className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",title:"End Call",children:r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c==="connected"&&r.jsxs("div",{className:"mt-4 text-center",children:[r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("div",{className:"w-1 h-2 bg-green-400 rounded"}),r.jsx("div",{className:"w-1 h-3 bg-green-400 rounded"}),r.jsx("div",{className:"w-1 h-4 bg-green-400 rounded"}),r.jsx("div",{className:"w-1 h-3 bg-green-400 rounded"}),r.jsx("div",{className:"w-1 h-2 bg-green-400 rounded"})]}),r.jsx("span",{className:"text-xs text-gray-300 mt-1 block",children:"Good quality"})]})]})})},um=({user:e,callData:t,isIncoming:n=!1,onCallEnd:s,onCallAnswer:o,onCallDecline:i})=>{var B,ue,me,ye,Ie,wt,Ze,Rt,Ht,Be,bt,pe,Ae,Oe,Qe,gt,at,He,$e,lt,Ye,tn;const{socket:a,isConnected:c}=Wo(),[d,f]=h.useState(n?"incoming":"outgoing"),[x,g]=h.useState(!1),[b,_]=h.useState((t==null?void 0:t.callType)==="video"),[I,M]=h.useState(0),[v,w]=h.useState(null),m=h.useRef(null),y=h.useRef(null),R=h.useRef(null),U=h.useRef(null),W=h.useRef(null),F=h.useRef(null),Z=h.useRef(!1),ae=h.useRef(null),se=h.useRef(!1),te=h.useRef(!1),fe=h.useRef([]),L=h.useRef(!1),P=(()=>{var le,De,Me,tt,Xe,St;const he=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}],T=(De=(le=import.meta)==null?void 0:le.env)==null?void 0:De.VITE_TURN_URL,de=(tt=(Me=import.meta)==null?void 0:Me.env)==null?void 0:tt.VITE_TURN_USERNAME,ke=(St=(Xe=import.meta)==null?void 0:Xe.env)==null?void 0:St.VITE_TURN_CREDENTIAL;return T&&de&&ke&&he.push({urls:T,username:de,credential:ke}),{iceServers:he}})();h.useEffect(()=>(console.log("WebRTCCall useEffect - callData:",t,"isIncoming:",n),t&&t.callId&&c&&!L.current&&q(),()=>{$()}),[t==null?void 0:t.callId,c]),h.useEffect(()=>(d==="connected"&&W.current?F.current=setInterval(()=>{const he=Math.floor((Date.now()-W.current)/1e3);M(he)},1e3):F.current&&(clearInterval(F.current),F.current=null),()=>{F.current&&clearInterval(F.current)}),[d]),h.useEffect(()=>{window.remoteStream&&y.current&&b&&(console.log(" Restoring remote video stream after remount"),y.current.srcObject=window.remoteStream,y.current.play().catch(he=>{he.name!=="AbortError"&&console.error(" Error playing restored remote video:",he)}))},[b,y.current]),h.useEffect(()=>{window.remoteStream&&y.current&&!y.current.srcObject&&(console.log(" Video ref available, attaching stored remote stream"),y.current.srcObject=window.remoteStream,y.current.play().catch(he=>{he.name!=="AbortError"&&console.error(" Error playing stored remote video:",he)}))},[y.current]);const q=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){console.error("WebRTC not supported in this browser or requires HTTPS"),w("Video calls require HTTPS connection or are not supported in this browser. Please use HTTPS or try a different browser.");return}if(typeof RTCPeerConnection>"u"){console.error("RTCPeerConnection not supported"),w("WebRTC is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");return}Z.current=!1,ae.current=null,se.current=!1,te.current=!1,fe.current=[],L.current=!1;const he={audio:!0,video:b?{width:640,height:480}:!1};try{R.current=await navigator.mediaDevices.getUserMedia(he)}catch(le){le.name==="NotAllowedError"||le.name==="PermissionDeniedError"?w("Camera/microphone access denied. Please allow access and try again."):le.name==="NotFoundError"||le.name==="DevicesNotFoundError"?w("Camera/microphone not found. Please check your devices."):le.name==="NotReadableError"||le.name==="TrackStartError"?w("Camera/microphone is being used by another application."):le.name==="SecurityError"?w("Video calls require HTTPS connection. Please access the site via HTTPS."):w(`Media access failed: ${le.message}`);return}R.current.getAudioTracks().forEach(le=>{le.enabled=!0}),R.current.getVideoTracks().forEach(le=>{le.enabled=!0}),m.current&&(m.current.srcObject=R.current,m.current.play().catch(()=>{}));try{U.current=new RTCPeerConnection(P)}catch(le){w(`Failed to create peer connection: ${le.message}`);return}try{R.current.getTracks().forEach(le=>{U.current.addTrack(le,R.current)})}catch(le){w(`Failed to add tracks to peer connection: ${le.message}`);return}U.current.ontrack=le=>{if(console.log(" Remote track received:",le),console.log(" Event streams:",le.streams),console.log(" Remote video ref:",y.current),console.log(" isVideoEnabled:",b),le.streams&&le.streams[0]){const De=le.streams[0];if(console.log(" Setting remote video stream:",De),console.log(" Stream tracks:",De.getTracks()),window.remoteStream||(window.remoteStream=De),y.current)ke(De);else{console.log(" Remote video ref not available, waiting...");const Me=()=>{y.current?(console.log(" Remote video ref now available, setting stream"),ke(De)):setTimeout(Me,100)};Me()}}else console.error(" No remote video ref or stream available")};const ke=le=>{if(!y.current){console.error(" Cannot attach stream: remote video ref not available");return}console.log(" Attaching remote stream to video element"),(async()=>{try{y.current&&(y.current.srcObject=le,console.log(" Set srcObject on remote video element"),y.current.readyState>=2?(await y.current.play(),console.log(" Remote video playing successfully")):y.current.addEventListener("loadeddata",async()=>{try{y.current&&(await y.current.play(),console.log(" Remote video playing after load"))}catch(Me){Me.name!=="AbortError"&&console.error(" Error playing remote video after load:",Me)}},{once:!0}))}catch(Me){Me.name!=="AbortError"&&console.error(" Error playing remote video:",Me)}})(),le.getAudioTracks().forEach(Me=>{Me.enabled=!0,console.log(" Remote audio track enabled:",Me)}),le.getVideoTracks().forEach(Me=>{Me.enabled=!0,console.log(" Remote video track enabled:",Me)}),y.current&&y.current.volume!==void 0&&(y.current.volume=1),_(!0)};U.current.onicecandidate=le=>{le.candidate&&a&&a.emit("ice-candidate",{callId:t.callId,candidate:le.candidate.candidate,sdpMLineIndex:le.candidate.sdpMLineIndex,sdpMid:le.candidate.sdpMid})},U.current.onconnectionstatechange=()=>{const le=U.current.connectionState;console.log(" Connection state changed:",le),le==="connected"?(console.log(" WebRTC connection established"),f("connected"),W.current=Date.now()):(le==="disconnected"||le==="failed")&&(console.log(" WebRTC connection failed:",le),z())},Q(),L.current=!0,n?(console.log(" Incoming call - requesting offer from caller"),a.emit("call-request-offer",{callId:t.callId,receiverId:e._id})):await S()}catch{L.current=!1,w("Failed to access camera/microphone. Please check permissions.")}},Q=()=>{if(a){if(console.log("Setting up socket listeners for call:",t.callId,"isIncoming:",n),L.current){console.log("Socket listeners already set up, skipping...");return}a.off("call-answered"),a.off("call-declined"),a.off("call-ended"),a.off("call-error"),a.off("call-offer"),a.off("call-resend-offer"),a.off("ice-candidate"),a.on("call-answered",async he=>{if(console.log(" Call answered received:",he),he.callId===t.callId){if(ae.current===he.callId)return;try{if(he.answer&&U.current){const T=typeof he.answer=="string"?JSON.parse(he.answer):he.answer,de=U.current.signalingState;console.log(" Processing answer, current state:",de),de==="have-local-offer"&&!Z.current&&(await U.current.setRemoteDescription(T),console.log(" Set remote description, new state:",U.current.signalingState),Z.current=!0,ae.current=he.callId,setTimeout(()=>{O()},100))}f("connected"),W.current=Date.now()}catch(T){console.error(" Failed to handle call answer:",T),w("Failed to handle call answer")}}}),a.on("call-declined",he=>{he.callId===t.callId&&(f("declined"),setTimeout(()=>{s&&s()},2e3))}),a.on("call-ended",he=>{he.callId===t.callId&&z()}),a.on("ice-candidate",async he=>{if(console.log(" ICE candidate received:",he),he.callId===t.callId&&U.current)try{const T=U.current.signalingState,de=U.current.remoteDescription;console.log(" Current signaling state:",T),console.log(" Remote description:",de?"set":"null"),de&&(T==="stable"||T==="have-local-offer"||T==="have-remote-offer")?(await U.current.addIceCandidate({candidate:he.candidate,sdpMLineIndex:he.sdpMLineIndex,sdpMid:he.sdpMid}),console.log(" ICE candidate added successfully")):(console.log(" Queuing ICE candidate for later (remote description not set)"),fe.current.push({candidate:he.candidate,sdpMLineIndex:he.sdpMLineIndex,sdpMid:he.sdpMid}))}catch(T){console.error(" Failed to add ICE candidate:",T),console.log(" Queuing failed ICE candidate for later"),fe.current.push({candidate:he.candidate,sdpMLineIndex:he.sdpMLineIndex,sdpMid:he.sdpMid})}}),a.on("call-error",he=>{w(he.error)}),a.on("call-resend-offer",async he=>{if(console.log(" Received request to resend offer:",he),he.callId===t.callId&&!n&&U.current)try{console.log(" Resending offer to receiver...");const T=U.current.localDescription;T?(a.emit("call-offer",{callId:t.callId,offer:T}),console.log(" Offer resent successfully")):(console.log(" No local description found, creating new offer..."),await S())}catch(T){console.error(" Error resending offer:",T)}}),a.on("call-offer",async he=>{if(console.log("Received call-offer event:",he),he.callId===t.callId&&n)try{const T=typeof he.offer=="string"?JSON.parse(he.offer):he.offer;if(console.log("Parsed offer:",T),!U.current&&!L.current&&(console.log("Peer connection not ready, initializing WebRTC..."),await q()),U.current){const de=U.current.signalingState;console.log("Received offer, current state:",de),de==="stable"?(await U.current.setRemoteDescription(T),console.log("Set remote description, new state:",U.current.signalingState),setTimeout(()=>{O()},100)):console.log("Cannot set remote description in state:",de)}else console.error("Peer connection not available when handling offer")}catch(T){console.error("Failed to handle call offer:",T),w("Failed to handle call offer")}})}},O=async()=>{if(fe.current.length>0&&U.current)if(console.log(" Processing queued ICE candidates:",fe.current.length),U.current.remoteDescription){for(const T of fe.current)try{await U.current.addIceCandidate(T),console.log(" Queued ICE candidate added successfully")}catch(de){console.error(" Failed to add queued ICE candidate:",de)}fe.current=[],console.log(" All queued ICE candidates processed")}else console.log(" Cannot process queued ICE candidates: remote description not set")},S=async()=>{try{if(!L.current){w("WebRTC not initialized yet");return}if(!U.current){w("Peer connection not available");return}if(!a||!a.connected){w("Socket connection not available");return}if(!t||!t.callId){w("Call data not available");return}if(te.current)return;const he=U.current.signalingState;if(he!=="stable"){w(`Cannot create offer in state: ${he}`);return}const T=await U.current.createOffer();await U.current.setLocalDescription(T),te.current=!0,console.log("Sending call-offer with offer:",T),a.emit("call-offer",{callId:t.callId,offer:T}),console.log("Call-offer sent for call:",t.callId),f("ringing")}catch(he){w(`Failed to create call offer: ${he.message}`)}},E=async()=>{try{if(U.current){const he=U.current.signalingState;if(console.log("Answering call, current state:",he),he==="have-remote-offer"){const T=await U.current.createAnswer();await U.current.setLocalDescription(T),a.emit("call-answer",{callId:t.callId,answer:T}),f("connected"),W.current=Date.now(),o&&o()}else he==="stable"?(console.log("Offer not set yet, this indicates a timing issue"),w("Call offer not processed yet. Please wait a moment and try again.")):(console.error("Cannot answer call in state:",he),w(`Cannot answer call in current state: ${he}`))}else w("Call connection not ready")}catch(he){console.error("Failed to answer call:",he),w("Failed to answer call")}},X=()=>{a&&a.emit("call-decline",{callId:t.callId}),f("declined"),i&&i(),setTimeout(()=>{s&&s()},1e3)},z=()=>{se.current||(se.current=!0,a&&a.emit("call-end",{callId:t.callId}),f("ended"),s&&s())},G=()=>{R.current&&(R.current.getAudioTracks().forEach(T=>{T.enabled=x}),g(!x))},V=()=>{if(R.current){const he=R.current.getVideoTracks(),T=!b;if(he.forEach(de=>{de.enabled=T}),_(T),T&&y.current){console.log("Video enabled, ensuring remote video is visible");const de=window.remoteStream||y.current.srcObject;de&&(y.current.srcObject=null,setTimeout(()=>{y.current&&(y.current.srcObject=de,y.current.play().catch(ke=>{ke.name!=="AbortError"&&console.error("Error playing remote video after toggle:",ke)}))},100))}}},$=()=>{window.remoteStream&&(window.remoteStream=null),R.current&&R.current.getTracks().forEach(he=>he.stop()),U.current&&U.current.close(),F.current&&clearInterval(F.current)},J=he=>{const T=Math.floor(he/60),de=he%60;return`${T}:${de.toString().padStart(2,"0")}`};return v?r.jsx("div",{className:"call-error-container",children:r.jsxs("div",{className:"call-error",children:[r.jsx("div",{className:"error-icon",children:""}),r.jsx("h3",{children:"Call Error"}),r.jsx("p",{children:v}),r.jsx("button",{className:"btn btn-primary",onClick:s,children:"Close"})]})}):r.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",children:r.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 overflow-hidden w-96",children:[r.jsx("div",{className:"bg-black bg-opacity-20 px-6 py-4 flex items-center justify-between",children:r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-200",children:(B=t==null?void 0:t.otherUser)!=null&&B.avatar||(ue=t==null?void 0:t.receiver)!=null&&ue.avatar||(me=t==null?void 0:t.caller)!=null&&me.avatar?r.jsx("img",{src:((ye=t.otherUser)==null?void 0:ye.avatar)||((Ie=t.receiver)==null?void 0:Ie.avatar)||((wt=t.caller)==null?void 0:wt.avatar),alt:((Ze=t.otherUser)==null?void 0:Ze.name)||((Rt=t.receiver)==null?void 0:Rt.name)||((Ht=t.caller)==null?void 0:Ht.name),className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold text-lg",children:((Oe=(Ae=((Be=t==null?void 0:t.otherUser)==null?void 0:Be.name)||((bt=t==null?void 0:t.receiver)==null?void 0:bt.name)||((pe=t==null?void 0:t.caller)==null?void 0:pe.name))==null?void 0:Ae.charAt(0))==null?void 0:Oe.toUpperCase())||"U"})})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-white text-lg",children:((Qe=t==null?void 0:t.otherUser)==null?void 0:Qe.name)||((gt=t==null?void 0:t.receiver)==null?void 0:gt.name)||((at=t==null?void 0:t.caller)==null?void 0:at.name)||"Unknown"}),r.jsxs("p",{className:"text-sm text-gray-300",children:[d==="incoming"&&"Incoming call...",d==="outgoing"&&"Calling...",d==="ringing"&&"Ringing...",d==="connected"&&`Connected - ${J(I)}`,d==="declined"&&"Call declined",d==="ended"&&"Call ended"]})]})]})}),r.jsx("div",{className:"relative h-80 bg-black",children:b?r.jsxs(r.Fragment,{children:[r.jsx("video",{ref:y,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),r.jsx("div",{className:"absolute bottom-3 right-3 w-24 h-20 bg-gray-800 rounded-lg overflow-hidden border-2 border-white",children:r.jsx("video",{ref:m,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"})})]}):r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-32 h-32 rounded-full bg-gray-700 flex items-center justify-center mb-4",children:r.jsx("span",{className:"text-3xl text-white",children:((tn=(Ye=((He=t==null?void 0:t.otherUser)==null?void 0:He.name)||(($e=t==null?void 0:t.receiver)==null?void 0:$e.name)||((lt=t==null?void 0:t.caller)==null?void 0:lt.name))==null?void 0:Ye.charAt(0))==null?void 0:tn.toUpperCase())||"U"})}),r.jsx("p",{className:"text-white text-sm",children:"Audio Only Call"})]})})}),r.jsx("div",{className:"bg-black bg-opacity-20 p-6",children:r.jsxs("div",{className:"flex justify-center space-x-4",children:[d==="incoming"&&r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:X,title:"Decline",children:r.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsx("button",{className:"w-16 h-16 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:E,title:"Answer",children:r.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})})]}),d==="connected"&&r.jsxs(r.Fragment,{children:[r.jsx("button",{className:`w-14 h-14 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${x?"bg-red-500 hover:bg-red-600 text-white":"bg-white bg-opacity-20 hover:bg-opacity-30 text-white"}`,onClick:G,title:x?"Unmute":"Mute",children:x?r.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),(t==null?void 0:t.callType)==="video"&&r.jsx("button",{className:`w-14 h-14 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${b?"bg-white bg-opacity-20 hover:bg-opacity-30 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,onClick:V,title:b?"Disable Video":"Enable Video",children:b?r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}):r.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]})}),r.jsx("button",{className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:z,title:"End Call",children:r.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(d==="outgoing"||d==="ringing")&&r.jsx("button",{className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:z,title:"Cancel Call",children:r.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]})})},fm=({user:e,callData:t,isIncoming:n=!1,onCallEnd:s,onCallAnswer:o,onCallDecline:i})=>{var Dt,Ln,xt,kn,Wn,Qs;const{socket:a,isConnected:c}=Wo(),[d,f]=h.useState(n?"incoming":"outgoing"),[x,g]=h.useState(!1),[b,_]=h.useState((t==null?void 0:t.callType)==="video"),[I,M]=h.useState(0),[v,w]=h.useState(null),[m,y]=h.useState([]),[R,U]=h.useState(!1),[W,F]=h.useState({x:window.innerWidth-400,y:20}),[Z,ae]=h.useState(!1),[se,te]=h.useState({x:0,y:0}),[fe,L]=h.useState(!1),[oe,P]=h.useState(!1),q=h.useRef(null),Q=h.useRef(null),O=h.useRef(null),S=h.useRef(null),E=h.useRef(new Map),X=h.useRef(null),z=h.useRef(null),G=h.useRef(!1),V=h.useRef(null),$=h.useRef(!1),J=h.useRef(null),B=h.useRef(!1),ue=h.useRef(!1),me=h.useRef([]),ye=h.useRef(new Map),Ie=h.useRef(new Set),Ze=(()=>{var ge,Te,Re,ve,we,_e;const A=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}],ne=(Te=(ge=import.meta)==null?void 0:ge.env)==null?void 0:Te.VITE_TURN_URL,ee=(ve=(Re=import.meta)==null?void 0:Re.env)==null?void 0:ve.VITE_TURN_USERNAME,Y=(_e=(we=import.meta)==null?void 0:we.env)==null?void 0:_e.VITE_TURN_CREDENTIAL;return ne&&ee&&Y&&A.push({urls:ne,username:ee,credential:Y}),{iceServers:A,iceCandidatePoolSize:10,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}})();h.useEffect(()=>(t&&t.callId&&t.groupId&&c?(console.log(" Initializing WebRTC for group call:",{callId:t.callId,groupId:t.groupId,callType:t.callType,isIncoming:n}),Rt()):console.log(" Waiting for call data to initialize WebRTC:",{hasCallData:!!t,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId),isConnected:c}),()=>{ke()}),[t,c]),h.useEffect(()=>{if(!(t!=null&&t.callId)||!c)return;const A=setInterval(()=>{at()},3e3);return()=>clearInterval(A)},[m,c,t==null?void 0:t.callId]),h.useEffect(()=>(d==="connected"&&X.current?z.current=setInterval(()=>{const A=Math.floor((Date.now()-X.current)/1e3);M(A)},1e3):z.current&&(clearInterval(z.current),z.current=null),()=>{z.current&&clearInterval(z.current)}),[d]);const Rt=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){console.error("WebRTC not supported in this browser or requires HTTPS"),w("Video calls require HTTPS connection or are not supported in this browser. Please use HTTPS or try a different browser.");return}if(typeof RTCPeerConnection>"u"){console.error("RTCPeerConnection not supported"),w("WebRTC is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");return}$.current=!1,J.current=null,B.current=!1,ue.current=!1,me.current=[],Ie.current.clear(),G.current=!1;const A={audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:1,latency:.01},video:b?{width:{ideal:640,max:1280},height:{ideal:480,max:720},frameRate:{ideal:30,max:60}}:!1};try{S.current=await navigator.mediaDevices.getUserMedia(A),console.log(" Media stream obtained successfully")}catch(Y){console.error(" Media access error:",Y),Y.name==="NotAllowedError"||Y.name==="PermissionDeniedError"?w("Camera/microphone access denied. Please allow access and try again."):Y.name==="NotFoundError"||Y.name==="DevicesNotFoundError"?w("Camera/microphone not found. Please check your devices."):Y.name==="NotReadableError"||Y.name==="TrackStartError"?w("Camera/microphone is being used by another application."):Y.name==="SecurityError"?w("Video calls require HTTPS connection. Please access the site via HTTPS."):w(`Media access failed: ${Y.message}`);return}if(S.current.getAudioTracks().forEach(Y=>{Y.enabled=!0}),S.current.getVideoTracks().forEach(Y=>{Y.enabled=b}),Q.current&&(Q.current.srcObject=S.current,Q.current.play().catch(()=>{})),O.current&&(O.current.srcObject=S.current,O.current.muted=!0,O.current.play().catch(()=>{})),Ht(),G.current=!0,console.log(" Setting call as established to allow ICE candidates"),P(!0),!n)await Qe();else{console.log(" Incoming call - joining via API to get participants");try{await Tr.join(t.callId)}catch(Y){console.error("Error joining incoming call:",Y)}}}catch{G.current=!1,w("Failed to access camera/microphone. Please check permissions.")}},Ht=()=>{a&&(a.off("group-call-initiated"),a.off("group-call-joined"),a.off("group-call-left"),a.off("group-call-ended"),a.off("group-call-error"),a.off("group-call-participant-joined"),a.off("group-call-participant-left"),a.off("group-call-offer"),a.off("group-call-answer"),a.off("group-call-ice-candidate"),a.on("group-call-initiated",A=>{A.callId===t.callId&&(console.log("Group call initiated:",A),f("ringing"))}),a.on("group-call-joined",async A=>{var ne,ee;if(A.callId===t.callId){console.log("Group call joined:",A),f("connected"),P(!0),X.current=Date.now();try{const Y=await fetch(`/api/group-calls/${t.callId}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(Y.ok){const ge=await Y.json(),Re=(((ee=(ne=ge==null?void 0:ge.data)==null?void 0:ne.call)==null?void 0:ee.participants)||[]).filter(we=>we&&we.isActive).map(we=>{const _e=typeof we.user=="object"&&we.user?we.user:typeof we.user=="string"&&we.user?{_id:we.user}:typeof we.userId=="string"&&we.userId?{_id:we.userId}:typeof we.userId=="object"&&we.userId?we.userId:typeof we._id=="string"&&we._id?{_id:we._id}:typeof we.id=="string"&&we.id?{_id:we.id}:{},Ge=_e._id||_e.id;return{..._e,id:Ge,name:_e.name||we.name}}).filter(we=>we.id&&we.id!==e.id),ve=He(Re);ve.length>0?(console.log(" Found existing participants:",Re),y(ve),await gt(ve)):console.log(" No existing participants found"),q.current=setInterval(lt,5e3)}}catch(Y){console.error("Error fetching call details:",Y)}}}),a.on("group-call-left",A=>{A.callId===t.callId&&!fe&&(console.log("Group call left:",A),f("ended"),s&&s())}),a.on("group-call-ended",A=>{var ne;A.callId===t.callId&&!fe&&(console.log("Group call ended:",A),A.reason==="Initiator left the call"?D.success(`Call ended - ${((ne=A.endedBy)==null?void 0:ne.name)||"Host"} left the call`):D.success("Call ended"),f("ended"),s&&s())}),a.on("group-call-error",A=>{console.error("Group call error:",A),w(A.error)}),a.on("group-call-participant-joined",A=>{var ne,ee;if(A.callId===t.callId){console.log(" Participant joined socket event:",{data:A,newParticipant:A.newParticipant,hasNewParticipant:!!A.newParticipant,newParticipantId:(ne=A.newParticipant)==null?void 0:ne.id,newParticipantName:(ee=A.newParticipant)==null?void 0:ee.name}),console.log(" Current participants before adding:",m),y(ge=>{const Te={...A.newParticipant,id:A.newParticipant.id||A.newParticipant._id};if(ge.some(we=>we.id===Te.id))return console.log(" Participant already exists, skipping duplicate"),ge;const ve=[...ge,Te];return console.log(" Updated participants after adding:",ve),ve});const Y={...A.newParticipant,id:A.newParticipant.id||A.newParticipant._id};$e(Y)}}),a.on("group-call-participant-left",A=>{A.callId===t.callId&&(console.log(" Participant left:",A),y(ne=>{const ee=ne.filter(Y=>Y.id!==A.leftParticipant.id);return console.log(" Updated participants after removal:",ee),ee}),bt(A.leftParticipant.id))}),a.on("group-call-offer",async A=>{A.callId===t.callId&&(console.log("Group call offer received:",A),await pe(A))}),a.on("group-call-answer",async A=>{A.callId===t.callId&&(console.log("Group call answer received:",A),await Ae(A))}),a.on("group-call-ice-candidate",async A=>{A.callId===t.callId&&(console.log("Group call ICE candidate received:",A),await Oe(A))}))},Be=async A=>{try{console.log(" Creating peer connection for target user:",A);const ne=new RTCPeerConnection(Ze);if(S.current){const ee=S.current.getAudioTracks(),Y=S.current.getVideoTracks();ee.forEach(ge=>{ge.enabled=!x;const Te=ne.addTrack(ge,S.current);if(console.log(" Added audio track to peer connection:",ge.label,"enabled:",ge.enabled),Te&&Te.getParameters){const Re=Te.getParameters();Re.encodings&&Re.encodings[0]&&(Re.encodings[0].maxBitrate=64e3,Re.encodings[0].priority="high",Te.setParameters(Re))}}),Y.forEach(ge=>{ge.enabled=b;const Te=ne.addTrack(ge,S.current);if(console.log(" Added video track to peer connection:",ge.label,"enabled:",ge.enabled),Te&&Te.getParameters){const Re=Te.getParameters();Re.encodings&&Re.encodings[0]&&(Re.encodings[0].maxBitrate=1e6,Re.encodings[0].maxFramerate=30,Te.setParameters(Re))}})}return ne.ontrack=ee=>{console.log(" Remote track received from:",A),console.log(" Track details:",{kind:ee.track.kind,label:ee.track.label,enabled:ee.track.enabled,readyState:ee.track.readyState,streamsCount:ee.streams.length});const Y=ee.streams[0];Y&&(console.log(" Remote stream received:",{id:Y.id,active:Y.active,audioTracks:Y.getAudioTracks().length,videoTracks:Y.getVideoTracks().length}),Y.getAudioTracks().forEach(Te=>{console.log(" Processing remote audio track:",Te.label,"enabled:",Te.enabled),Te.enabled=!0}),y(Te=>{const Re=Te.map(ve=>ve.id===A?{...ve,stream:Y}:ve);return console.log(" Updated participants with stream:",Re),Re}))},ne.onicecandidate=ee=>{if(ee.candidate)if(console.log(" ICE candidate generated for:",A),A&&a&&(t!=null&&t.callId)&&(t!=null&&t.groupId)){const Y={callId:t.callId,groupId:t.groupId,targetUserId:A,candidate:ee.candidate.candidate,sdpMLineIndex:ee.candidate.sdpMLineIndex,sdpMid:ee.candidate.sdpMid};console.log(" Sending ICE candidate immediately"),a.emit("group-call-ice-candidate",Y)}else{console.warn(" ICE candidate queued - missing data:",{hasTargetUserId:!!A,hasSocket:!!a,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId)});const Y=String(A||"unknown");ye.current.has(Y)||ye.current.set(Y,[]),ye.current.get(Y).push({candidate:ee.candidate.candidate,sdpMLineIndex:ee.candidate.sdpMLineIndex,sdpMid:ee.candidate.sdpMid})}else console.log(" ICE gathering completed for:",A)},ne.onconnectionstatechange=()=>{const ee=ne.connectionState;console.log(` Connection state with ${A}:`,ee),ee==="connected"?(console.log(` Connected to ${A}`),y(Y=>Y.map(ge=>ge.id===A?{...ge,isConnected:!0}:ge))):ee==="failed"||ee==="closed"?(console.error(` Connection ${ee} with ${A}`),y(Y=>Y.map(ge=>ge.id===A?{...ge,isConnected:!1}:ge)),ee==="failed"&&E.current.has(A)&&(console.log(` Will attempt to reconnect to ${A} in 3 seconds`),setTimeout(()=>{if(E.current.has(A)){console.log(` Recreating connection to ${A}`),bt(A);const Y=Be(A);Y&&Y.createOffer().then(ge=>{Y.setLocalDescription(ge),a&&(t!=null&&t.callId)&&(t!=null&&t.groupId)&&a.emit("group-call-offer",{callId:t.callId,groupId:t.groupId,targetUserId:A,offer:ge})}).catch(ge=>console.error("Error recreating offer:",ge))}},3e3))):ee==="disconnected"&&(console.warn(` Temporarily disconnected from ${A}`),y(Y=>Y.map(ge=>ge.id===A?{...ge,isConnected:!1}:ge)))},ne.oniceconnectionstatechange=()=>{var Y;const ee=ne.iceConnectionState;console.log(` ICE state with ${A}:`,ee),ee==="connected"||ee==="completed"?console.log(` ICE connected with ${A}`):ee==="failed"?(console.error(` ICE failed with ${A}`),D.error(`Connection issue with ${((Y=m.find(ge=>ge.id===A))==null?void 0:Y.name)||"participant"}`)):ee==="disconnected"&&console.warn(` ICE disconnected with ${A}`)},E.current.set(A,ne),setTimeout(()=>{Me(A)},100),ne}catch(ne){console.error("Error creating peer connection:",ne)}},bt=A=>{const ne=E.current.get(String(A));ne&&(ne.close(),E.current.delete(A))},pe=async A=>{var ne,ee,Y,ge;try{console.log(" Group call offer data received:",{data:A,from:A.from,hasFrom:!!A.from,fromId:(ne=A.from)==null?void 0:ne.id,fromName:(ee=A.from)==null?void 0:ee.name,hasOffer:!!A.offer});const Te=A.from.id||A.from._id;if(!Te){console.error(" Cannot handle offer: missing from user ID",{from:A.from,hasId:!!((Y=A.from)!=null&&Y.id),hasUnderscoreId:!!((ge=A.from)!=null&&ge._id)});return}const Re=await Be(Te);if(Re)try{await Re.setRemoteDescription(A.offer);const ve=await Re.createAnswer();console.log(" Created answer for participant:",Te,{hasAnswer:!!ve,answerType:ve==null?void 0:ve.type,answerSdp:ve!=null&&ve.sdp?ve.sdp.substring(0,100)+"...":"No SDP"}),await Re.setLocalDescription(ve),t&&t.callId&&t.groupId&&ve?(a.emit("group-call-answer",{callId:t.callId,groupId:t.groupId,targetUserId:Te,answer:ve}),De(Te),setTimeout(()=>{Me(Te)},100)):console.warn("Skipping answer: call data not ready yet",{hasCallData:!!t,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId),hasAnswer:!!ve})}catch(ve){console.error("Error creating answer for participant:",Te,ve)}}catch(Te){console.error("Error handling group call offer:",Te)}},Ae=async A=>{var ne,ee,Y,ge,Te,Re,ve;try{console.log(" Group call answer data received:",{data:A,from:A.from,hasFrom:!!A.from,fromId:(ne=A.from)==null?void 0:ne.id,fromUnderscoreId:(ee=A.from)==null?void 0:ee._id,fromName:(Y=A.from)==null?void 0:Y.name,hasAnswer:!!A.answer});const we=A.from.id||A.from._id;if(!we){console.error(" Cannot handle answer: missing from user ID",{from:A.from,hasId:!!((ge=A.from)!=null&&ge.id),hasUnderscoreId:!!((Te=A.from)!=null&&Te._id)});return}const _e=`${we}-${((ve=(Re=A.answer)==null?void 0:Re.sdp)==null?void 0:ve.substring(0,50))||"unknown"}`;if(Ie.current.has(_e)){console.log(" Answer already processed, skipping duplicate:",_e);return}const Ge=E.current.get(we);if(Ge)if(console.log(" Peer connection state for",we,":",{connectionState:Ge.connectionState,iceConnectionState:Ge.iceConnectionState,signalingState:Ge.signalingState,currentRemoteDescription:!!Ge.currentRemoteDescription}),Ge.signalingState==="have-local-offer"||Ge.signalingState==="have-local-pranswer")try{await Ge.setRemoteDescription(A.answer),Ie.current.add(_e),console.log(" Answer processed for participant:",we),setTimeout(()=>{Me(we)},100)}catch(yr){console.error(" Failed to set remote description for",we,":",yr)}else console.warn(" Cannot set remote description - wrong signaling state:",{participant:we,signalingState:Ge.signalingState,expectedStates:["have-local-offer","have-local-pranswer"]});else console.warn(" No peer connection found for participant:",we)}catch(we){console.error("Error handling group call answer:",we)}},Oe=async A=>{var ne,ee,Y,ge;try{console.log(" Received ICE candidate from:",((ne=A.from)==null?void 0:ne.name)||((ee=A.from)==null?void 0:ee.id));const Te=((Y=A.from)==null?void 0:Y.id)||((ge=A.from)==null?void 0:ge._id);if(!Te){console.error(" Cannot handle ICE candidate: missing from user ID");return}const Re=E.current.get(Te);if(Re&&Re.remoteDescription)try{await Re.addIceCandidate({candidate:A.candidate,sdpMLineIndex:A.sdpMLineIndex,sdpMid:A.sdpMid}),console.log(" ICE candidate added for:",Te)}catch(ve){console.error(" Failed to add ICE candidate:",ve.message)}else{console.log(" Queuing ICE candidate for:",Te);const ve=String(Te);ye.current.has(ve)||ye.current.set(ve,[]),ye.current.get(ve).push({candidate:A.candidate,sdpMLineIndex:A.sdpMLineIndex,sdpMid:A.sdpMid})}}catch(Te){console.error("Error handling group call ICE candidate:",Te)}},Qe=async()=>{try{await Tr.join(t.callId),a&&a.emit("group-call-join",{callId:t.callId,groupId:t.groupId})}catch(A){console.error("Error joining group call:",A),w("Failed to join group call")}},gt=async A=>{try{for(const ne of A)if(ne.id!==e.id&&ne.isActive){console.log(`Creating mesh connection with ${ne.name}`);const ee=await Be(ne.id);if(ee)try{const Y=await ee.createOffer();console.log(" Created offer for participant:",ne.id,{hasOffer:!!Y,offerType:Y==null?void 0:Y.type,offerSdp:Y!=null&&Y.sdp?Y.sdp.substring(0,100)+"...":"No SDP"}),await ee.setLocalDescription(Y),t&&t.callId&&t.groupId&&Y?(a.emit("group-call-offer",{callId:t.callId,groupId:t.groupId,targetUserId:ne.id,offer:Y}),De(ne.id),setTimeout(()=>{Me(ne.id)},100)):console.warn("Skipping offer: call data not ready yet",{hasCallData:!!t,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId),hasOffer:!!Y})}catch(Y){console.error("Error creating offer for participant:",ne.id,Y)}}}catch(ne){console.error("Error establishing mesh connections:",ne)}},at=async()=>{try{const A=m||[];for(const ne of A){const ee=ne&&(ne.id||ne._id);if(!(!ee||ee===e.id)&&!E.current.get(ee)){const Y=await Be(ee);if(Y)try{const ge=await Y.createOffer();await Y.setLocalDescription(ge),t&&t.callId&&t.groupId&&ge&&(a.emit("group-call-offer",{callId:t.callId,groupId:t.groupId,targetUserId:ee,offer:ge}),De(ee),setTimeout(()=>{Me(ee)},100))}catch(ge){console.error("Error reconciling offer for participant:",ee,ge)}}}}catch(A){console.error("Error reconciling peer connections:",A)}},He=A=>{const ne=new Set,ee=[];for(const Y of A||[]){const ge=Y&&(Y.id||Y._id);ge&&(ne.has(ge)||(ne.add(ge),ee.push(Y)))}return ee},$e=async A=>{try{console.log(" New participant data received:",{newParticipant:A,hasId:!!(A!=null&&A.id),id:A==null?void 0:A.id,hasName:!!(A!=null&&A.name),name:A==null?void 0:A.name,currentUserId:e==null?void 0:e.id});const ne=A.id||A._id;if(ne&&ne!==e.id){console.log(`New participant joined: ${A.name} (ID: ${ne})`);const ee=await Be(ne);if(ee)try{const Y=await ee.createOffer();console.log(" Created offer for new participant:",ne,{hasOffer:!!Y,offerType:Y==null?void 0:Y.type,offerSdp:Y!=null&&Y.sdp?Y.sdp.substring(0,100)+"...":"No SDP"}),await ee.setLocalDescription(Y),t&&t.callId&&t.groupId&&Y?(a.emit("group-call-offer",{callId:t.callId,groupId:t.groupId,targetUserId:ne,offer:Y}),De(ne),setTimeout(()=>{Me(ne)},100)):console.warn("Skipping offer: call data not ready yet",{hasCallData:!!t,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId),hasOffer:!!Y})}catch(Y){console.error("Error creating offer for new participant:",ne,Y)}}}catch(ne){console.error("Error handling participant joined:",ne)}},lt=async()=>{var A,ne;if(t!=null&&t.callId)try{const ee=await fetch(`/api/group-calls/${t.callId}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(ee.ok){const Y=await ee.json(),Te=(((ne=(A=Y==null?void 0:Y.data)==null?void 0:A.call)==null?void 0:ne.participants)||[]).filter(ve=>ve&&ve.isActive).map(ve=>{const we=typeof ve.user=="object"&&ve.user?ve.user:typeof ve.user=="string"&&ve.user?{_id:ve.user}:typeof ve.userId=="string"&&ve.userId?{_id:ve.userId}:typeof ve.userId=="object"&&ve.userId?ve.userId:typeof ve._id=="string"&&ve._id?{_id:ve._id}:typeof ve.id=="string"&&ve.id?{_id:ve.id}:{},_e=we._id||we.id;return{...we,id:_e,name:we.name||ve.name}}).filter(ve=>ve.id&&ve.id!==e.id),Re=He(Te);Re.length>0&&y(Re)}}catch(ee){console.error("Error refreshing participants:",ee)}},Ye=async()=>{try{await Qe(),await lt(),q.current=setInterval(lt,5e3),o&&o()}catch(A){console.error("Error answering group call:",A),w("Failed to answer group call")}},tn=()=>{a&&a.emit("group-call-leave",{callId:t.callId,groupId:t.groupId}),f("declined"),i&&i(),setTimeout(()=>{s&&s()},1e3)},he=()=>{fe||(L(!0),P(!1),ke(),q.current&&(clearInterval(q.current),q.current=null),a&&a.emit("group-call-leave",{callId:t.callId,groupId:t.groupId}),f("ended"),s&&s())},T=()=>{if(S.current){const A=S.current.getAudioTracks(),ne=!x;A.forEach(ee=>{ee.enabled=!ne}),g(ne),Tr.updateMuteStatus(t.callId,ne).then(()=>console.log(" Mute status updated on server")).catch(ee=>console.error("Error updating mute status:",ee))}},de=()=>{if(S.current){const A=S.current.getVideoTracks(),ne=!b;A.forEach(ee=>{ee.enabled=ne}),_(ne),Tr.updateVideoStatus(t.callId,ne).then(()=>console.log(" Video status updated on server")).catch(ee=>console.error("Error updating video status:",ee))}},ke=()=>{window.remoteStreams&&(window.remoteStreams=new Map),S.current&&S.current.getTracks().forEach(A=>A.stop()),E.current&&(E.current.forEach(A=>{A.close()}),E.current.clear()),Ie.current.clear(),z.current&&clearInterval(z.current)},le=A=>{const ne=Math.floor(A/60),ee=A%60;return`${ne}:${ee.toString().padStart(2,"0")}`},De=A=>{const ne=ye.current.get(String(A))||ye.current.get("unknown");ne&&ne.length>0&&a&&t&&(console.log(` Sending ${ne.length} queued ICE candidates for ${A}`),ne.forEach(Y=>{const ge={callId:t.callId,groupId:t.groupId,targetUserId:A,candidate:Y.candidate,sdpMLineIndex:Y.sdpMLineIndex,sdpMid:Y.sdpMid};a.emit("group-call-ice-candidate",ge)}),ye.current.delete(A));const ee=ye.current.get("unknown");ee&&ee.length>0&&a&&t&&(console.log(` Sending ${ee.length} 'unknown' queued ICE candidates to ${A}`),ee.forEach(Y=>{const ge={callId:t.callId,groupId:t.groupId,targetUserId:A,candidate:Y.candidate,sdpMLineIndex:Y.sdpMLineIndex,sdpMid:Y.sdpMid};a.emit("group-call-ice-candidate",ge)}))},Me=async A=>{const ne=E.current.get(A);if(!ne){console.warn(" No peer connection found to process queued candidates for:",A);return}const ee=ye.current.get(A);if(!ee||ee.length===0){console.log(" No queued ICE candidates to process for:",A);return}console.log(` Processing ${ee.length} queued ICE candidates for ${A}`);for(const Y of ee)try{await ne.addIceCandidate({candidate:Y.candidate,sdpMLineIndex:Y.sdpMLineIndex,sdpMid:Y.sdpMid}),console.log(" Queued ICE candidate added for:",A)}catch(ge){console.error(" Failed to add queued ICE candidate for:",A,ge)}ye.current.delete(String(A)),ye.current.delete("unknown"),console.log(` Finished processing queued ICE candidates for ${A}`)},tt=A=>{if(A.target.closest(".call-controls"))return;ae(!0);const ne=V.current.getBoundingClientRect();te({x:A.clientX-ne.left,y:A.clientY-ne.top})},Xe=A=>{if(!Z)return;const ne=A.clientX-se.x,ee=A.clientY-se.y,Y=window.innerWidth-400,ge=window.innerHeight-300;F({x:Math.max(0,Math.min(ne,Y)),y:Math.max(0,Math.min(ee,ge))})},St=()=>{ae(!1)};return h.useEffect(()=>{if(Z)return document.addEventListener("mousemove",Xe),document.addEventListener("mouseup",St),()=>{document.removeEventListener("mousemove",Xe),document.removeEventListener("mouseup",St)}},[Z,se]),h.useEffect(()=>{S.current&&O.current&&(O.current.srcObject=S.current,O.current.muted=!0,O.current.play().catch(()=>{}))},[S.current,O.current]),v?r.jsx("div",{className:"fixed bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 p-6 z-50 transition-all duration-300",style:{left:W.x,top:W.y,width:"400px",height:"300px"},children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-4xl mb-3",children:""}),r.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Group Call Error"}),r.jsx("p",{className:"text-sm text-gray-300 mb-4",children:v}),r.jsx("button",{onClick:s,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:"Close"})]})}):R?r.jsx("div",{ref:V,className:"fixed bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 z-50 transition-all duration-300 hover:shadow-3xl",style:{left:W.x,top:W.y,width:"320px",height:"80px"},children:r.jsxs("div",{className:"flex items-center justify-between p-3",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:(Dt=t==null?void 0:t.group)!=null&&Dt.avatar?r.jsx("img",{src:t.group.avatar,alt:t.group.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-blue-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold text-sm",children:"G"})})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-white text-sm",children:((Ln=t==null?void 0:t.group)==null?void 0:Ln.name)||"Group Call"}),r.jsx("p",{className:"text-xs text-gray-300",children:d==="connected"?`${m.length+1} participants`:"Group call..."})]})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onMouseDown:tt,className:"p-1.5 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:r.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})}),r.jsx("button",{onClick:A=>{A.stopPropagation(),U(!1)},className:"p-1.5 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:"Expand",children:r.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),r.jsx("button",{onClick:A=>{A.stopPropagation(),he()},className:"p-1.5 bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors",title:"End Call",children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})}):r.jsxs("div",{ref:V,className:"fixed bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 overflow-hidden z-50 transition-all duration-300",style:{left:W.x,top:W.y,width:"500px",height:"600px"},children:[r.jsxs("div",{className:"bg-black bg-opacity-20 px-4 py-3 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:(xt=t==null?void 0:t.group)!=null&&xt.avatar?r.jsx("img",{src:t.group.avatar,alt:t.group.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-blue-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold",children:"G"})})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-white text-sm",children:((kn=t==null?void 0:t.group)==null?void 0:kn.name)||"Group Call"}),r.jsxs("p",{className:"text-xs text-gray-300",children:[d==="incoming"&&"Incoming group call...",d==="outgoing"&&"Joining group call...",d==="ringing"&&"Ringing...",d==="connected"&&`Connected - ${le(I)}`,d==="declined"&&"Call declined",d==="ended"&&"Call ended"]})]})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onMouseDown:tt,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:r.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})}),r.jsx("button",{onClick:A=>{A.stopPropagation(),U(!0)},className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:"Minimize",children:r.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),r.jsx("button",{onClick:A=>{A.stopPropagation(),s()},className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:"Close",children:r.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),r.jsx("audio",{ref:O,muted:!0,autoPlay:!0,style:{display:"none"}}),m.map((A,ne)=>A.stream&&r.jsx("audio",{autoPlay:!0,playsInline:!0,ref:ee=>{ee&&A.stream&&(ee.srcObject=A.stream,ee.volume=1,ee.muted=!1,ee.play().catch(Y=>console.log("Audio play error:",Y)))},style:{display:"none"}},`audio-${A.id}-${ne}`)),r.jsx("div",{className:"relative h-80 bg-black",children:b?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"absolute bottom-3 right-3 w-24 h-20 bg-gray-800 rounded-lg overflow-hidden border-2 border-white",children:r.jsx("video",{ref:Q,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"})}),r.jsx("div",{className:"grid grid-cols-2 gap-2 p-2 h-full",children:m.map((A,ne)=>{var ee,Y,ge,Te;return r.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:A.stream?r.jsx(r.Fragment,{children:t.callType==="video"?r.jsx("video",{autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover",ref:Re=>{Re&&A.stream&&(Re.srcObject=A.stream)}}):r.jsx("div",{className:"w-full h-full flex items-center justify-center relative",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center mb-2",children:r.jsx("span",{className:"text-white text-xl font-semibold",children:((Y=(ee=A.name)==null?void 0:ee.charAt(0))==null?void 0:Y.toUpperCase())||"U"})}),r.jsx("p",{className:"text-white text-sm font-medium",children:A.name}),r.jsxs("div",{className:"flex items-center justify-center mt-2",children:[r.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),r.jsx("span",{className:"text-green-400 text-xs ml-1",children:"Speaking"})]})]})})}):r.jsx("div",{className:"w-full h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-600 flex items-center justify-center mb-2",children:r.jsx("span",{className:"text-white text-lg",children:((Te=(ge=A.name)==null?void 0:ge.charAt(0))==null?void 0:Te.toUpperCase())||"U"})}),r.jsx("p",{className:"text-white text-xs",children:A.name})]})})},`${A.id}-${ne}`)})})]}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("div",{className:"flex items-center justify-center py-4 border-b border-gray-700",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center mb-2 mx-auto",children:r.jsx("span",{className:"text-2xl text-white",children:"G"})}),r.jsx("p",{className:"text-white text-sm font-medium",children:"Group Audio Call"}),r.jsxs("p",{className:"text-gray-300 text-xs mt-1",children:[m.length+1," participant",m.length+1!==1?"s":""]})]})}),r.jsx("div",{className:"flex-1 p-4 overflow-y-auto",children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-800 rounded-lg",children:[r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${x?"bg-red-600":"bg-green-600"}`,children:r.jsx("span",{className:"text-white text-sm font-semibold",children:((Qs=(Wn=e.name)==null?void 0:Wn.charAt(0))==null?void 0:Qs.toUpperCase())||"U"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("p",{className:"text-white text-sm font-medium",children:[e.name," (You)"]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:`w-2 h-2 rounded-full ${x?"bg-red-500":"bg-green-500 animate-pulse"}`}),r.jsx("span",{className:`text-xs ml-1 ${x?"text-red-400":"text-green-400"}`,children:x?"Muted":"Speaking"})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-gray-300 text-xs",children:"Host"}),x&&r.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mt-1"})]})]}),m.map((A,ne)=>{var ee,Y;return r.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-800 rounded-lg",children:[r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${A.stream?"bg-blue-600":"bg-gray-600"}`,children:r.jsx("span",{className:"text-white text-sm font-semibold",children:((Y=(ee=A.name)==null?void 0:ee.charAt(0))==null?void 0:Y.toUpperCase())||"U"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-white text-sm font-medium",children:A.name}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:`w-2 h-2 rounded-full ${A.stream?"bg-green-500 animate-pulse":"bg-yellow-500"}`}),r.jsx("span",{className:`text-xs ml-1 ${A.stream?"text-green-400":"text-yellow-400"}`,children:A.stream?"Speaking":"Connecting..."})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-gray-300 text-xs",children:"Participant"}),A.stream&&r.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-1 animate-pulse"})]})]},`${A.id}-${ne}`)}),m.length===0&&r.jsx("div",{className:"text-center py-8",children:r.jsx("p",{className:"text-gray-400 text-sm",children:"Waiting for other participants..."})})]})})]})}),r.jsxs("div",{className:"bg-black bg-opacity-20 p-4",children:[r.jsxs("div",{className:"call-controls flex justify-center space-x-3",onMouseDown:A=>A.stopPropagation(),children:[d==="incoming"&&r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:tn,title:"Decline",children:r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsx("button",{className:"w-12 h-12 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:Ye,title:"Answer",children:r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})})]}),d==="connected"&&r.jsxs(r.Fragment,{children:[r.jsx("button",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${x?"bg-red-500 hover:bg-red-600 text-white":"bg-white bg-opacity-20 hover:bg-opacity-30 text-white"}`,onClick:T,title:x?"Unmute":"Mute",children:x?r.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),(t==null?void 0:t.callType)==="video"&&r.jsx("button",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${b?"bg-white bg-opacity-20 hover:bg-opacity-30 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,onClick:de,title:b?"Disable Video":"Enable Video",children:b?r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}):r.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]})}),r.jsx("button",{className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:he,title:"End Call",children:r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(d==="outgoing"||d==="ringing")&&r.jsx("button",{className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:he,title:"Cancel Call",children:r.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),d==="connected"&&!b&&r.jsxs("div",{className:"mt-4 text-center",children:[r.jsxs("div",{className:"flex items-center justify-center gap-1 mb-2",children:[r.jsx("div",{className:"w-1 h-2 bg-green-400 rounded"}),r.jsx("div",{className:"w-1 h-3 bg-green-400 rounded"}),r.jsx("div",{className:"w-1 h-4 bg-green-400 rounded"}),r.jsx("div",{className:"w-1 h-3 bg-green-400 rounded"}),r.jsx("div",{className:"w-1 h-2 bg-green-400 rounded"})]}),r.jsx("span",{className:"text-xs text-gray-300",children:"Good audio quality"})]})]})]})},mm=({user:e,callData:t,onCallEnd:n})=>{var oe,P;const[s,o]=h.useState(1),[i,a]=h.useState(""),[c,d]=h.useState(!1),[f,x]=h.useState(!1),[g,b]=h.useState(!1),[_,I]=h.useState(!1),[M,v]=h.useState({x:100,y:100}),[w,m]=h.useState({width:800,height:600}),y=h.useRef(null),R=h.useRef({x:0,y:0}),U=h.useRef({x:0,y:0,width:0,height:0});h.useEffect(()=>{var z;const q=(t==null?void 0:t.roomName)||`group-${t==null?void 0:t.groupId}-${Date.now()}`,Q=`vpaas-magic-cookie-06fa758e7c18435681a16b81d4c43676/${q}`,O=encodeURIComponent((e==null?void 0:e.name)||"User"),S=encodeURIComponent((e==null?void 0:e.email)||""),E=`https://8x8.vc/${Q}?displayName=${O}&email=${S}&config.startWithAudioMuted=false&config.startWithVideoMuted=${(t==null?void 0:t.callType)==="voice"}&config.prejoinPageEnabled=true`;console.log(" ========================================"),console.log(" JITSI VIDEO CALL"),console.log(" Room:",q),console.log(" Full Room:",Q),console.log(" User:",e==null?void 0:e.name),console.log(" URL:",E),console.log(" ========================================"),a(E),D.success(`Joining ${((z=t==null?void 0:t.group)==null?void 0:z.name)||"group call"}`,{icon:"",duration:2e3});const X=setTimeout(()=>{o(G=>G+1),console.log(" Participant count updated (simulated)")},3e4);return()=>clearTimeout(X)},[t,e]);const W=q=>{f||(b(!0),R.current={x:q.clientX-M.x,y:q.clientY-M.y})},F=q=>{if(g&&!f&&v({x:q.clientX-R.current.x,y:q.clientY-R.current.y}),_&&!f){const Q=Math.max(400,U.current.width+(q.clientX-U.current.x)),O=Math.max(300,U.current.height+(q.clientY-U.current.y));m({width:Q,height:O})}},Z=()=>{b(!1),I(!1)},ae=q=>{f||(q.stopPropagation(),I(!0),U.current={x:q.clientX,y:q.clientY,width:w.width,height:w.height})};h.useEffect(()=>{if(g||_)return window.addEventListener("mousemove",F),window.addEventListener("mouseup",Z),()=>{window.removeEventListener("mousemove",F),window.removeEventListener("mouseup",Z)}},[g,_,M,w]);const se=()=>{console.log(" Ending call"),n&&n()},te=()=>{d(!c)},fe=()=>{x(!f)};if(!i)return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-gray-900 rounded-xl p-8 text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-500 border-t-transparent mx-auto mb-4"}),r.jsx("p",{className:"text-white text-lg",children:"Preparing call..."})]})});if(c)return r.jsx("div",{className:"fixed bottom-4 right-4 z-50 bg-gradient-to-r from-gray-900 to-gray-800 rounded-xl shadow-2xl cursor-pointer hover:shadow-3xl transition-all",onClick:te,children:r.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[r.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center animate-pulse",children:r.jsx($t,{size:24,className:"text-white"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-bold text-white text-sm",children:((oe=t==null?void 0:t.group)==null?void 0:oe.name)||"Video Call"}),r.jsxs("p",{className:"text-xs text-gray-300 flex items-center gap-2",children:[r.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Call in progress"]})]})]})});const L=f?{position:"fixed",inset:0,width:"100%",height:"100%"}:{position:"fixed",left:M.x,top:M.y,width:w.width,height:w.height};return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 z-40"}),r.jsxs("div",{ref:y,className:`z-50 bg-gray-900 rounded-xl shadow-2xl overflow-hidden flex flex-col ${g?"cursor-grabbing":""} ${f?"":"border-2 border-gray-700"}`,style:L,children:[r.jsxs("div",{className:`bg-gradient-to-r from-gray-900 to-gray-800 px-4 py-3 flex items-center justify-between border-b border-gray-700 shadow-lg ${f?"":"cursor-grab active:cursor-grabbing"}`,onMouseDown:W,children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow-lg",children:r.jsx(At,{size:20,className:"text-white"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-bold text-white text-sm",children:((P=t==null?void 0:t.group)==null?void 0:P.name)||"Video Call"}),r.jsxs("p",{className:"text-xs text-gray-300 flex items-center gap-2",children:[r.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Group ",(t==null?void 0:t.callType)==="voice"?"Voice":"Video"," Call"]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:te,className:"p-2 hover:bg-gray-700 rounded-lg transition-all text-gray-400 hover:text-white",title:"Minimize",children:r.jsx(HC,{size:18})}),r.jsx("button",{onClick:fe,className:"p-2 hover:bg-gray-700 rounded-lg transition-all text-gray-400 hover:text-white",title:f?"Exit Fullscreen":"Fullscreen",children:r.jsx(VC,{size:18})}),r.jsxs("button",{onClick:se,className:"px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg transition-all text-white font-semibold shadow-lg hover:shadow-xl flex items-center gap-2",title:"End Call",children:[r.jsx(ln,{size:16}),"End"]})]})]}),r.jsx("div",{className:"flex-1 relative bg-black",children:r.jsx("iframe",{src:i,allow:"camera; microphone; fullscreen; display-capture; autoplay",className:"w-full h-full border-0",title:"Jitsi Meet",onLoad:()=>{console.log(" Jitsi iframe loaded successfully"),D.success("Call connected",{icon:"",duration:2e3})},onError:()=>{console.error(" Jitsi iframe load error"),D.error("Failed to load call")}})}),!f&&r.jsx("div",{className:"absolute bottom-0 right-0 w-8 h-8 cursor-nwse-resize hover:bg-blue-500 hover:bg-opacity-30 transition-all",onMouseDown:ae,title:"Drag to resize",children:r.jsxs("div",{className:"absolute bottom-1 right-1 flex flex-col gap-0.5",children:[r.jsxs("div",{className:"flex gap-0.5 justify-end",children:[r.jsx("div",{className:"w-1 h-1 bg-gray-500 rounded-full"}),r.jsx("div",{className:"w-1 h-1 bg-gray-500 rounded-full"})]}),r.jsx("div",{className:"flex gap-0.5 justify-end",children:r.jsx("div",{className:"w-1 h-1 bg-gray-500 rounded-full"})})]})}),!f&&r.jsx("div",{className:"absolute top-3 right-1/2 transform translate-x-1/2 flex gap-1 pointer-events-none",children:r.jsx(WC,{size:16,className:"text-gray-500"})})]})]})},hm=({callData:e,onAccept:t,onDecline:n})=>{var a,c;const s=((a=e==null?void 0:e.group)==null?void 0:a.name)||(e==null?void 0:e.groupName)||"Group Call",o=((c=e==null?void 0:e.initiator)==null?void 0:c.name)||"Someone",i=(e==null?void 0:e.callType)||"video";return r.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 animate-fadeIn",children:[r.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-800 rounded-2xl shadow-2xl p-8 w-96 text-center text-white animate-slideUp",children:[r.jsxs("div",{className:"relative mb-6",children:[r.jsx("div",{className:"w-24 h-24 rounded-full bg-white bg-opacity-20 flex items-center justify-center mx-auto animate-pulse",children:r.jsx($t,{size:48,className:"text-white"})}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx("div",{className:"w-32 h-32 rounded-full border-4 border-white border-opacity-30 animate-ping"})})]}),r.jsx("h2",{className:"text-2xl font-bold mb-2",children:s}),r.jsxs("p",{className:"text-blue-100 mb-1",children:[o," is starting a ",i," call"]}),r.jsx("p",{className:"text-sm text-blue-200 mb-8",children:i==="video"?"Video call with screen sharing":"Voice call"}),r.jsxs("div",{className:"inline-flex items-center gap-2 bg-white bg-opacity-20 px-4 py-2 rounded-full mb-8",children:[r.jsx($t,{size:16}),r.jsx("span",{className:"text-sm font-medium",children:i==="video"?"Video Call":"Voice Call"})]}),r.jsxs("div",{className:"flex gap-4 justify-center",children:[r.jsx("button",{onClick:n,className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-110 active:scale-95",title:"Decline",children:r.jsx(GC,{size:24})}),r.jsx("button",{onClick:t,className:"w-16 h-16 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-110 active:scale-95 animate-bounce",title:"Accept",children:r.jsx(Qi,{size:24})})]}),r.jsxs("div",{className:"mt-6 flex items-center justify-center gap-2",children:[r.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),r.jsx("span",{className:"text-sm text-blue-100",children:"Incoming call..."})]})]}),r.jsx("style",{dangerouslySetInnerHTML:{__html:`
        @keyframes fadeIn {
          from {
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }

        @keyframes slideUp {
          from {
            transform: translateY(100px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }

        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }

        .animate-slideUp {
          animation: slideUp 0.4s ease-out;
        }
      `}})]})},JC=()=>{const{user:e,logout:t}=fn(),{socket:n,notifications:s,handleActivateUser:o,handleCloseNotification:i}=Wo(),[a,c]=h.useState({totalUsers:0,totalGroups:0,activeUsers:0,disabledUsers:0}),[d,f]=h.useState(!0),[x,g]=h.useState(!1),[b,_]=h.useState(!1),[I,M]=h.useState(!1),[v,w]=h.useState(null),[m,y]=h.useState(!1),[R,U]=h.useState(!1),[W,F]=h.useState(null),[Z,ae]=h.useState(!1);h.useEffect(()=>{se()},[]),h.useEffect(()=>{if(n)return console.log(" Setting up Admin Dashboard call listeners..."),n.off("incoming-call"),n.on("incoming-call",L=>{var oe;console.log(" Admin Dashboard - Incoming call received:",L),D.success(`Incoming ${L.callType} call from ${((oe=L.caller)==null?void 0:oe.name)||"Unknown"}`,{duration:5e3,icon:""}),y(!0),w({callId:L.callId,callType:L.callType,caller:L.caller}),M(!0)}),n.off("call-initiated"),n.on("call-initiated",L=>{console.log(" Admin Dashboard - Call initiated:",L),y(!1),w({callId:L.callId,callType:L.callType,otherUser:L.receiver}),M(!0)}),n.off("call-error"),n.on("call-error",L=>{console.error(" Admin Dashboard - Call error:",L),D.error(L.error||"Call failed",{duration:4e3})}),n.off("incoming-group-call"),n.on("incoming-group-call",L=>{var oe;console.log(" Admin Dashboard - Incoming group call received:",L),D.success(`Incoming group ${L.callType} call from ${((oe=L.initiator)==null?void 0:oe.name)||"Unknown"}`,{duration:5e3,icon:""}),ae(!0),F({callId:L.callId,callType:L.callType,groupId:L.groupId,roomName:L.roomName,group:L.group||{name:L.groupName},initiator:L.initiator}),U(!0)}),n.off("group-call-initiated"),n.on("group-call-initiated",L=>{console.log(" Admin Dashboard - Group call initiated:",L),ae(!1),F({callId:L.callId,callType:L.callType,groupId:L.groupId,roomName:L.roomName,group:L.group}),U(!0)}),n.off("group-call-error"),n.on("group-call-error",L=>{console.error(" Admin Dashboard - Group call error:",L),D.error(L.error||"Group call failed",{duration:4e3})}),()=>{n.off("incoming-call"),n.off("call-initiated"),n.off("call-error"),n.off("incoming-group-call"),n.off("group-call-initiated"),n.off("group-call-error")}},[n]),h.useEffect(()=>{const L=q=>{console.log(" Dashboard - Received Service Worker Message:",q.data);const Q=q.data;if(!Q||!Q.type){console.warn("Dashboard - Invalid message received from service worker");return}if(Q.type==="notification-clicked"||Q.type==="answer-call"){console.log(" Dashboard - Processing notification click/answer:",Q.type);const O=Q.data;if(!O){console.warn("Dashboard - No notification data found");return}if(O.type==="incoming-call"){console.log(" Dashboard - Showing incoming call UI from notification click"),console.log("Dashboard - Call data:",O);const S={callId:O.callId,callType:O.callType||"voice",caller:{_id:O.senderId,name:O.senderName,profileImage:O.senderImage}};console.log("Dashboard - Setting call UI with data:",S),y(!0),w(S),M(!0),D.success(`Incoming ${S.callType} call from ${S.caller.name}`,{duration:5e3,icon:""})}else if(O.type==="incoming-group-call"){console.log(" Dashboard - Showing incoming group call UI from notification click"),console.log("Dashboard - Group call data:",O);const S={callId:O.callId,callType:O.callType||"voice",groupId:O.groupId,roomName:O.roomName,group:{_id:O.groupId,name:O.groupName},initiator:{_id:O.senderId,name:O.senderName,profileImage:O.senderImage}};console.log("Dashboard - Setting group call UI with data:",S),ae(!0),F(S),U(!0),D.success(`Incoming group ${S.callType} call from ${S.initiator.name}`,{duration:5e3,icon:""})}}else Q.type==="decline-call"&&(console.log(" Declining call from notification"),M(!1),U(!1),w(null),F(null))};console.log(" Dashboard - Setting up service worker message listener"),navigator.serviceWorker?(navigator.serviceWorker.addEventListener("message",L),console.log(" Dashboard - Service worker message listener attached")):console.warn(" Dashboard - Service worker not available");const P=new URLSearchParams(window.location.search).get("notificationData");if(P){console.log(" Dashboard - Found notification data in URL");try{const q=atob(P),Q=JSON.parse(q);console.log(" Dashboard - Notification data from URL:",Q),L({data:Q}),window.history.replaceState({},document.title,window.location.pathname)}catch(q){console.error("Dashboard - Error parsing notification data from URL:",q)}}return()=>{console.log(" Dashboard - Removing service worker message listener"),navigator.serviceWorker&&navigator.serviceWorker.removeEventListener("message",L)}},[]),h.useEffect(()=>{const L=oe=>{if(x){const P=document.querySelector(".notification-panel");P&&!P.contains(oe.target)&&g(!1)}};return x&&document.addEventListener("mousedown",L),()=>{document.removeEventListener("mousedown",L)}},[x]),h.useEffect(()=>{const L=oe=>{if(b){const P=document.querySelector(".account-menu-container");P&&!P.contains(oe.target)&&_(!1)}};return b&&document.addEventListener("mousedown",L),()=>{document.removeEventListener("mousedown",L)}},[b]);const se=async()=>{try{f(!0);const[L,oe]=await Promise.all([e.role==="user"?an.getActiveUsers():an.getUsers(),zt.getMyGroups()]),P=Array.isArray(L.data)?L.data:[],q=P.filter(O=>(O.isActive??!0)===!0).length,Q=P.filter(O=>(O.isActive??!0)===!1).length;c({totalUsers:P.length,totalGroups:oe.data.length,activeUsers:q,disabledUsers:Q})}catch{D.error("Failed to load dashboard data")}finally{f(!1)}},te=L=>{switch(L){case"superadmin":return r.jsx(Dl,{className:"w-5 h-5 text-yellow-600"});case"admin":return r.jsx(Zi,{className:"w-5 h-5 text-blue-600"});default:return r.jsx(Nn,{className:"w-5 h-5 text-gray-600"})}},fe=L=>{switch(L){case"superadmin":return"bg-yellow-100 text-yellow-800";case"admin":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return d?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("div",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"flex justify-between items-center py-6",children:[r.jsx("div",{className:"flex items-center space-x-4",children:r.jsxs(Al,{to:"/profile",className:"flex items-center space-x-3 hover:opacity-80 transition-opacity",children:[e.profileImage?r.jsx("img",{src:`${Se}${e.profileImage}`,alt:"Profile",className:"w-12 h-12 rounded-full object-cover"}):r.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-primary-600 font-medium text-lg",children:e.name.charAt(0).toUpperCase()})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),r.jsxs("p",{className:"text-gray-600",children:["Welcome back, ",e.name,"!"]})]})]})}),r.jsxs("div",{className:"flex items-center space-x-4",children:[(e.role==="admin"||e.role==="superadmin")&&r.jsx("div",{className:"relative",children:r.jsxs("button",{onClick:()=>g(!x),className:"relative p-2 text-gray-600 hover:text-primary-600 hover:bg-gray-100 rounded-full transition-colors",children:[r.jsx(hd,{className:"w-6 h-6"}),s.length>0&&r.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:s.length})]})}),r.jsxs("div",{className:"relative account-menu-container",children:[r.jsx("button",{onClick:()=>_(L=>!L),className:`px-3 py-1 rounded-full text-sm font-medium hover:opacity-90 transition ${fe(e.role)}`,children:r.jsxs("div",{className:"flex items-center space-x-1",children:[te(e.role),r.jsx("span",{className:"capitalize",children:e.role})]})}),b&&r.jsx("div",{className:"absolute right-0 mt-2 w-44 bg-white border border-gray-200 rounded-md shadow-lg z-20",children:r.jsxs("button",{onClick:()=>{_(!1),t(),D.success("Logged out successfully")},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[r.jsx(wy,{className:"w-4 h-4"}),r.jsx("span",{children:"Logout"})]})})]})]})]})})}),x&&(e.role==="admin"||e.role==="superadmin")&&r.jsx("div",{className:"notification-panel bg-white border-b shadow-sm",children:r.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(hd,{className:"w-5 h-5 text-primary-600"}),r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Notifications"}),s.length>0&&r.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:s.length})]}),r.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:r.jsx(ln,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"space-y-3",children:s.length===0?r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(hd,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),r.jsx("p",{children:"No notifications yet"})]}):s.map(L=>r.jsx("div",{className:"border border-orange-200 bg-orange-50 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:r.jsx(Nn,{className:"w-4 h-4 text-orange-600"})})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"text-sm font-bold text-orange-700 flex items-center gap-2",children:[r.jsx("span",{children:""}),"Disabled User Login Attempt"]}),r.jsxs("div",{className:"mt-1 text-sm",children:[r.jsx("div",{className:"font-semibold text-gray-900",children:L.userName}),r.jsx("div",{className:"text-gray-600",children:L.userEmail}),r.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Time: ",new Date(L.timestamp).toLocaleTimeString()]})]})]}),r.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[r.jsxs("button",{onClick:()=>o(L.userId),className:"flex items-center space-x-1 bg-green-600 text-white px-3 py-1.5 rounded-md text-xs font-medium hover:bg-green-700 transition-colors",children:[r.jsx(Ru,{className:"w-3 h-3"}),r.jsx("span",{children:"Activate"})]}),r.jsxs("button",{onClick:()=>i(L.id),className:"flex items-center space-x-1 bg-gray-100 text-gray-700 px-3 py-1.5 rounded-md text-xs font-medium hover:bg-gray-200 transition-colors",children:[r.jsx(ln,{className:"w-3 h-3"}),r.jsx("span",{children:"Close"})]})]})]})},L.id))})]})}),r.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[r.jsx("div",{className:"card p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:r.jsx(At,{className:"w-6 h-6 text-blue-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.totalUsers})]})]})}),r.jsx("div",{className:"card p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 rounded-full bg-green-100",children:r.jsx(hs,{className:"w-6 h-6 text-green-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"My Groups"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.totalGroups})]})]})}),r.jsx("div",{className:"card p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 rounded-full bg-green-100",children:r.jsx(At,{className:"w-6 h-6 text-green-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Users"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.activeUsers})]})]})}),r.jsx("div",{className:"card p-6",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 rounded-full bg-red-100",children:r.jsx(At,{className:"w-6 h-6 text-red-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Disabled Users"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.disabledUsers})]})]})})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[r.jsxs("div",{className:"card p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quick Chat"}),r.jsx(hs,{className:"w-5 h-5 text-gray-400"})]}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Start chatting with other users or join group conversations."}),r.jsxs("a",{href:"/chat",className:"btn-primary inline-flex items-center",children:[r.jsx(hs,{className:"w-4 h-4 mr-2"}),"Open Chat"]})]}),e.role!=="user"&&r.jsxs("div",{className:"card p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Management"}),r.jsx(lm,{className:"w-5 h-5 text-gray-400"})]}),r.jsx("p",{className:"text-gray-600 mb-4",children:e.role==="superadmin"?"Manage admins and view all users in the system.":"Manage users and create groups for team communication."}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("a",{href:"/users",className:"btn-secondary w-full inline-flex items-center justify-center",children:[r.jsx(cm,{className:"w-4 h-4 mr-2"}),e.role==="superadmin"?"Manage Admins":"Manage Users"]}),e.role==="admin"&&r.jsxs("a",{href:"/groups",className:"btn-primary w-full inline-flex items-center justify-center",children:[r.jsx(Xi,{className:"w-4 h-4 mr-2"}),"Manage Groups"]}),r.jsxs("a",{href:"/manage-daily-updates",className:"btn-secondary w-full inline-flex items-center justify-center",children:[r.jsx(Cr,{className:"w-4 h-4 mr-2"}),"Manage Daily Updates"]}),r.jsxs("a",{href:"/manage-tasks",className:"btn-primary w-full inline-flex items-center justify-center",children:[r.jsx(Zi,{className:"w-4 h-4 mr-2"}),"Manage Tasks"]})]})]}),r.jsxs("div",{className:"card p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Account Info"}),r.jsx(Nn,{className:"w-5 h-5 text-gray-400"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Name:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:e.name})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Email:"}),r.jsx("span",{className:"ml-2 text-gray-900",children:e.email})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Role:"}),r.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${fe(e.role)}`,children:e.role})]})]})]}),e.role==="superadmin"&&r.jsxs("div",{className:"card p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"System Overview"}),r.jsx(Dl,{className:"w-5 h-5 text-yellow-600"})]}),r.jsx("p",{className:"text-gray-600 mb-4",children:"You have full access to manage the entire system including admins and all users."}),r.jsxs("div",{className:"text-sm text-gray-500",children:[r.jsx("p",{children:" Create and manage admin accounts"}),r.jsx("p",{children:" View all system users"}),r.jsx("p",{children:" Monitor system activity"})]})]})]})]}),I&&v&&r.jsx(r.Fragment,{children:v.callType==="voice"?r.jsx(dm,{user:e,callData:v,isIncoming:m,onCallEnd:()=>{M(!1),w(null),y(!1)},onCallAnswer:()=>{y(!1)},onCallDecline:()=>{M(!1),w(null),y(!1)}}):r.jsx(um,{user:e,callData:v,isIncoming:m,onCallEnd:()=>{M(!1),w(null),y(!1)},onCallAnswer:()=>{y(!1)},onCallDecline:()=>{M(!1),w(null),y(!1)}})}),R&&W&&Z&&W.callType==="video"&&r.jsx(hm,{callData:W,onAccept:()=>{console.log(" Admin Dashboard - Accepting incoming video call"),ae(!1),n&&(W!=null&&W.callId)&&n.emit("group-call-join",{callId:W.callId,groupId:W.groupId})},onDecline:()=>{U(!1),F(null),ae(!1),n&&(W!=null&&W.callId)&&n.emit("group-call-decline",{callId:W.callId,groupId:W.groupId})}}),R&&W&&!Z&&(W.callType==="video"?r.jsx(mm,{user:e,callData:W,onCallEnd:()=>{U(!1),F(null),ae(!1)}}):r.jsx(fm,{user:e,callData:W,isIncoming:Z,onCallEnd:()=>{U(!1),F(null),ae(!1)},onCallAnswer:()=>{ae(!1)},onCallDecline:()=>{U(!1),F(null),ae(!1)}}))]})};class QC{constructor(){this.socket=null,this.isConnected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.reconnectDelay=1e3,this.pingInterval=null,this.lastPingTime=Date.now(),this.currentUserId=null,this.listeners=new Map,this.isConnecting=!1}connect(){if(this.isConnecting)return this.socket;if(this.socket&&this.socket.connected)return this.socket;console.log(" Creating new socket connection..."),this.isConnecting=!0,this.socket&&(this.socket.disconnect(),this.socket=null);const t=localStorage.getItem("token");return this.socket=Ci("https://internalchat.pizeonfly.com",{autoConnect:!0,reconnection:!0,reconnectionDelay:this.reconnectDelay,reconnectionAttempts:this.maxReconnectAttempts,maxReconnectionAttempts:this.maxReconnectAttempts,timeout:2e4,forceNew:!0,multiplex:!1,transports:["websocket","polling"],auth:{token:t}}),this.setupEventHandlers(),this.isConnecting=!1,this.socket}setupEventHandlers(){this.socket.on("connect",()=>{this.isConnected=!0,this.reconnectAttempts=0,this.lastPingTime=Date.now(),console.log(" ===== SOCKET CONNECTED ===== "),console.log(" Socket ID:",this.socket.id),console.log(" Connection URL:",this.socket.io.uri),console.log(" Transport:",this.socket.io.engine.transport.name),console.log(" Current User ID:",this.currentUserId),console.log(" Active listeners:",this.listeners.size),console.log("========================================"),this.currentUserId&&this.joinUserRoom(this.currentUserId),this.startPingMonitoring(),this.setupMessageListeners(),this.socket.emit("ping",{timestamp:Date.now()}),console.log(" Enhanced connection alive detection initiated")}),this.socket.on("disconnect",t=>{this.isConnected=!1,console.log(" ===== SOCKET DISCONNECTED ===== "),console.log(" Reason:",t),console.log(" Attempting reconnection..."),console.log("========================================"),this.stopPingMonitoring(),this.attemptReconnection()}),this.socket.on("connect_error",t=>{console.error(" ===== CONNECTION ERROR ===== "),console.error(" Error:",t.message),console.error(" URL:",t.type),console.error(" Status:",t.description),console.error("========================================="),this.attemptReconnection()}),this.socket.on("reconnect",t=>{console.log(" ===== RECONNECTION SUCCESSFUL ===== "),console.log(" Attempts tried:",t),console.log(" New Socket ID:",this.socket.id),console.log("==============================================")}),this.socket.on("ping",t=>{this.lastPingTime=Date.now(),console.log(" Ping received - Connection alive, timestamp:",new Date(this.lastPingTime).toLocaleTimeString())}),this.socket.on("pong",t=>{this.lastPingTime=Date.now(),console.log(" Pong received - Connection confirmed, timestamp:",new Date(this.lastPingTime).toLocaleTimeString())}),this.socket.on("connect_timeout",()=>{console.log(" ===== CONNECTION TIMEOUT ===== "),console.log(" Socket connection timed out"),console.log("======================================")}),this.socket.on("reconnect_error",t=>{console.error(" ===== RECONNECTION ERROR ===== "),console.error("Error:",t.message),console.error("========================================")}),this.socket.on("reconnect_failed",()=>{console.error(" ===== FAILED RECONNECTION ===== "),console.error(" Socket reconnection permanently failed"),console.error(" Attempting force reconnect..."),console.error("===========================================")})}setupMessageListeners(){console.log(" ===== SETTING UP MESSAGE LISTENERS ===== "),console.log(" Total listeners to register:",this.listeners.size);for(const[t,n]of this.listeners)this.socket&&(this.socket.removeAllListeners(t),this.socket.on(t,n),console.log(` Re-registered listener: ${t}`));console.log(" ===== ALL LISTENERS ACTIVE ===== "),console.log(" Socket ready for real-time messaging"),console.log("========================================")}maintainConnection(){console.log(" ===== MAINTAINING PERSISTENT CONNECTION ===== "),!this.isConnected||!this.socket?(console.log(" Socket disconnected, reconnecting..."),this.connect()):(console.log(" Socket is connected, maintaining listeners"),this.setupMessageListeners(),this.socket&&this.isConnected&&(this.socket.emit("ping",{timestamp:Date.now()}),this.lastPingTime=Date.now(),console.log("Keep-alive ping sent - Connection maintained"),setTimeout(()=>{this.socket&&this.isConnected&&this.socket.emit("pong",{timestamp:Date.now()})},100))),console.log("==============================================")}forceChatroomReception(){console.log(" FORCING CHATROOM MESSAGE RECEPTION"),this.socket&&this.isConnected?(this.setupMessageListeners(),console.log(" Chatroom reception listeners reinforced")):(console.log(" Socket not available for chatroom reinforcement"),this.connect()),console.log("=====")}startPingMonitoring(){this.pingInterval&&clearInterval(this.pingInterval),this.pingInterval=setInterval(()=>{const t=Date.now()-this.lastPingTime;if(console.log(` Health check: Time since last ping: ${t}ms`),this.socket&&this.isConnected&&t>45e3&&(console.log(" Proactive ping sent to prevent timeout"),this.socket.emit("ping",{timestamp:Date.now()}),this.lastPingTime=Date.now()),t>18e4){if(console.log(" Extended timeout reached - checking real disconnection"),this.socket&&this.socket.connected&&this.isConnected){console.log(" Socket connection verified alive, resetting timer"),this.lastPingTime=Date.now();return}console.log(" Real disconnection confirmed, force reconnecting..."),this.forceReconnect()}else console.log(` Socket health maintained: ${t}ms response time`)},25e3)}stopPingMonitoring(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null)}attemptReconnection(){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log(" ===== ATTEMPTING RECONNECTION ===== "),console.log(` Attempt: ${this.reconnectAttempts}/${this.maxReconnectAttempts}`),console.log(` Delay: ${this.reconnectDelay*this.reconnectAttempts}ms`),console.log("===================="),setTimeout(()=>{console.log(" Executing reconnection..."),this.connect()},this.reconnectDelay*this.reconnectAttempts)):(console.log(" ===== MAX ATTEMPTS REACHED ===== "),console.log(" Forcing socket reset..."),setTimeout(()=>{this.forceReconnect()},this.reconnectDelay*5),console.log("====================================="))}forceReconnect(){console.log(" Force reconnecting socket..."),this.stopPingMonitoring(),this.reconnectAttempts=0,this.socket&&(this.socket.disconnect(),this.socket=null),setTimeout(()=>{this.connect()},2e3)}disconnect(){this.stopPingMonitoring(),this.listeners.clear(),this.socket&&(this.socket.disconnect(),this.socket=null),this.isConnected=!1,this.currentUserId=null}joinUserRoom(t){this.currentUserId=t,this.socket&&this.isConnected?(this.socket.emit("join",t),console.log(" Joined user room:",t)):console.log(" Waiting to join user room after connection...")}joinGroupRoom(t){this.socket&&this.socket.emit("join-group",t)}leaveGroupRoom(t){this.socket&&this.socket.emit("leave-group",t)}sendPersonalMessage(t){var n;if(console.log(" ===== SENDING PERSONAL MESSAGE ===== "),console.log(" Data:",t),console.log(" Socket available:",!!this.socket),console.log(" Socket connected:",this.isConnected),console.log(" Socket ID:",(n=this.socket)==null?void 0:n.id),!this.socket||!this.isConnected){console.log(" Socket not connected, connecting first..."),this.connect(),setTimeout(()=>{this.socket&&this.isConnected?(console.log(" Retrying message send after connection"),this.socket.emit("send-message",t),console.log(" Personal message retry sent successfully")):console.error(" Still not connected after retry")},2e3);return}this.ensureConnected(),this.socket&&this.isConnected?(this.socket.emit("send-message",t),console.log(" Personal message sent successfully"),setTimeout(()=>{this.socket&&this.isConnected&&this.socket.emit("ping",{timestamp:Date.now()})},100)):console.error(" Socket lost connection before sending message"),console.log("=============================================")}sendGroupMessage(t){var n;if(console.log(" ===== SENDING GROUP MESSAGE ===== "),console.log(" Data:",t),console.log(" Socket available:",!!this.socket),console.log(" Socket connected:",this.isConnected),console.log(" Socket ID:",(n=this.socket)==null?void 0:n.id),!this.socket||!this.isConnected){console.log(" Socket not connected, connecting first..."),this.connect(),setTimeout(()=>{this.socket&&this.isConnected?(console.log(" Retrying group message send after connection"),this.socket.emit("send-group-message",t),console.log(" Group message retry sent successfully")):console.error(" Still not connected after retry")},2e3);return}this.socket.emit("send-group-message",t),console.log(" Group message sent successfully"),console.log("============================================")}onReceiveMessage(t){console.log(" Registering onReceiveMessage listener"),this.registerListener("receive-message",n=>{console.log(" Received message:",n);const s={...n,_isExternalMessage:!0,_timestamp:new Date().toISOString()};t(s)}),setTimeout(()=>{this.socket&&this.isConnected&&(this.socket.off("receive-message"),this.socket.on("receive-message",n=>{console.log(" Maintained receive-message listener:",n);const s={...n,_isExternalMessage:!0,_timestamp:new Date().toISOString()};t(s)}),console.log(" Listener re-registered for chatroom persistence"))},1e3)}onReceiveGroupMessage(t){console.log(" Registering onReceiveGroupMessage listener"),this.registerListener("receive-group-message",n=>{console.log(" Received group message:",n);const s={...n,_isExternalMessage:!0,_timestamp:new Date().toISOString()};t(s)})}onMessageSent(t){console.log(" Registering onMessageSent listener"),this.registerListener("message-sent",n=>{console.log(" Message sent confirmation:",n);const s={...n,_isOurMessage:!0,_isConfirmation:!0,_timestamp:new Date().toISOString()};t(s)})}registerListener(t,n){this.listeners.set(t,n),console.log(` Stored listener for event: ${t}`),this.socket&&this.isConnected?(this.socket.off(t),this.socket.on(t,n),console.log(` Listener immediately registered for event: ${t}`)):console.log(` Listener queued for event: ${t} (waiting for connection)`)}onGroupMessageSent(t){this.registerListener("group-message-sent",t)}onTyping(t){this.registerListener("user-typing",t)}sendTyping(t){this.socket&&this.isConnected&&this.socket.emit("typing",t)}onError(t){this.registerListener("error",t)}onAvatarUpdate(t){this.registerListener("avatar-updated",t)}onUserProfileUpdate(t){this.registerListener("user-profile-updated",t)}removeAllListeners(){this.listeners.clear(),this.socket&&(this.socket.removeAllListeners(),this.socket.on("connect",()=>{this.isConnected=!0,this.reconnectAttempts=0,this.lastPingTime=Date.now(),this.currentUserId&&this.joinUserRoom(this.currentUserId),this.startPingMonitoring(),this.setupMessageListeners()}))}ensureConnected(){return!this.socket||!this.isConnected?(console.log(" Ensuring socket connection..."),this.connect()):!0}getConnectionStatus(){var t;return{isConnected:this.isConnected,socketId:(t=this.socket)==null?void 0:t.id,lastPing:new Date(this.lastPingTime).toLocaleString(),listenersCount:this.listeners.size}}logConnectionStatus(){var t,n,s,o,i,a,c;console.log(" ===== SOCKET STATUS REPORT ===== "),console.log(" Is Connected:",this.isConnected?" YES":" NO"),console.log(" Socket ID:",((t=this.socket)==null?void 0:t.id)||"N/A"),console.log(" Connection URL:",((s=(n=this.socket)==null?void 0:n.io)==null?void 0:s.uri)||"N/A"),console.log(" Transport:",((c=(a=(i=(o=this.socket)==null?void 0:o.io)==null?void 0:i.engine)==null?void 0:a.transport)==null?void 0:c.name)||"N/A"),console.log(" Current User ID:",this.currentUserId||"Not set"),console.log(" Active Listeners:",this.listeners.size),console.log(" Reconnect Attempts:",this.reconnectAttempts),console.log(" Last Ping:",new Date(this.lastPingTime).toLocaleTimeString()),console.log(" Listeners registered:",Array.from(this.listeners.keys()).join(", ")||"None"),console.log("========================================")}testConnection(){console.log(" ===== TESTING SOCKET CONNECTION ===== "),this.logConnectionStatus(),this.socket&&(console.log(" Emitting test ping..."),this.socket.emit("ping")),console.log("============================================")}forceConnectionTest(){console.log(" ===== MANUAL CONNECTION FORCE TEST ===== "),this.connect(),setTimeout(()=>{this.testConnection()},3e3),console.log("=============================================")}reset(){console.log(" Resetting socket service..."),this.disconnect(),this.currentUserId=null,this.listeners.clear(),this.reconnectAttempts=0,this.isConnecting=!1,clearTimeout(this.reconnectTimeout)}}const Lt=new QC,jp=()=>{const{user:e,logout:t}=fn(),n=gr(),{socket:s,isConnected:o,sendMessage:i,joinGroup:a,leaveGroup:c,onReceiveMessage:d,onReceiveGroupMessage:f,onMessageSent:x,getConnectionStatus:g,isUserOnline:b,getUserStatus:_}=Wo(),[I,M]=h.useState([]),[v,w]=h.useState([]),[m,y]=h.useState(null),[R,U]=h.useState([]),[W,F]=h.useState(""),[Z,ae]=h.useState(""),[se,te]=h.useState(!0),[fe,L]=h.useState({}),[oe,P]=h.useState({}),[q,Q]=h.useState("all"),[O,S]=h.useState(()=>{try{const l=localStorage.getItem("pinnedChats");return l?JSON.parse(l):[]}catch{return[]}}),[E,X]=h.useState(!1),[z,G]=h.useState(!1),V=50,[$,J]=h.useState(null),[B,ue]=h.useState(null),[me,ye]=h.useState(!1),[Ie,wt]=h.useState({}),[Ze,Rt]=h.useState(()=>{try{const l=sessionStorage.getItem("downloadedMessages");return l?JSON.parse(l):{}}catch{return{}}}),[Ht,Be]=h.useState(!1),[bt,pe]=h.useState(null),[Ae,Oe]=h.useState(!1),[Qe,gt]=h.useState(null),[at,He]=h.useState(null),[$e,lt]=h.useState(null),[Ye,tn]=h.useState(null),[he,T]=h.useState(1),[de,ke]=h.useState({x:0,y:0}),[le,De]=h.useState(!1),[Me,tt]=h.useState(!1),[Xe,St]=h.useState(null),[Dt,Ln]=h.useState(null),[xt,kn]=h.useState([]),[Wn,Qs]=h.useState(!1),A=()=>{T(l=>Math.min(l*1.25,4))},ne=()=>{T(l=>Math.max(l/1.25,.5))},ee=()=>{T(1),ke({x:0,y:0})},Y=l=>{l.preventDefault(),De(!0),ke({x:l.clientX-de.x,y:l.clientY-de.y})},ge=l=>{le&&(l.preventDefault(),ke({x:l.clientX-de.x,y:l.clientY-de.y}))},Te=()=>{De(!1)},Re=l=>{He(l),T(1),ke({x:0,y:0})},[ve,we]=h.useState(!1),[_e,Ge]=h.useState(null),[yr,ft]=h.useState(!1),nn=l=>l&&(/^https?:\/\//i.test(l)?l:`${Se}${l}`),da=l=>{if(!l)return"";const p=new Date(l),j=new Date,C=new Date(j.getFullYear(),j.getMonth(),j.getDate()),k=new Date(C);k.setDate(k.getDate()-1);const N=new Date(p.getFullYear(),p.getMonth(),p.getDate());return N.getTime()===C.getTime()?p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):N.getTime()===k.getTime()?"Yesterday":Math.floor((C-N)/(1e3*60*60*24))<7?p.toLocaleDateString([],{weekday:"short"}):p.toLocaleDateString([],{day:"numeric",month:"numeric",year:p.getFullYear()!==j.getFullYear()?"numeric":void 0})},wc=l=>{if(!l)return"";const p=new Date(l),j=new Date,C=new Date(j.getFullYear(),j.getMonth(),j.getDate()),k=new Date(C);k.setDate(k.getDate()-1);const N=new Date(p.getFullYear(),p.getMonth(),p.getDate());return N.getTime()===C.getTime()?"Today":N.getTime()===k.getTime()?"Yesterday":Math.floor((C-N)/(1e3*60*60*24))<7?p.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric"}):p.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric",year:p.getFullYear()!==j.getFullYear()?"numeric":void 0})},bc=l=>{if(!l)return"Last seen recently";const p=new Date,j=new Date(l),C=p-j,k=Math.floor(C/(1e3*60)),N=Math.floor(C/(1e3*60*60)),H=Math.floor(C/(1e3*60*60*24));return k<1?"Last seen just now":k<60?`Last seen ${k} minute${k===1?"":"s"} ago`:N<24?`Last seen ${N} hour${N===1?"":"s"} ago`:H===1?"Last seen yesterday":H<7?`Last seen ${H} day${H===1?"":"s"} ago`:`Last seen ${j.toLocaleDateString([],{month:"short",day:"numeric"})}`},[Xs,Ns]=h.useState(null),[ua,fa]=h.useState(!1),[qo,Zs]=h.useState(null),[nr,rr]=h.useState(null),[Fr,vr]=h.useState(""),[mn,Wt]=h.useState(null),Ct=l=>((l==null?void 0:l.id)||(l==null?void 0:l._id)||(l==null?void 0:l.messageId)||"").toString(),ct=l=>{Xs&&clearTimeout(Xs);const p=setTimeout(()=>{Zs(l),fa(!0)},700);Ns(p)},jt=()=>{Xs&&(clearTimeout(Xs),Ns(null))},Gt=(l,p)=>{p.stopPropagation(),Wt(mn===l?null:l)},rn=(l,p)=>{switch(Zs(p),Wt(null),l){case"copy":Sn(p);break;case"edit":Ko(p);break;case"forward":jc(p);break}},Sn=async l=>{try{const p=(l==null?void 0:l.messageType)==="text"?(l==null?void 0:l.message)||"":nn(l==null?void 0:l.fileUrl)||(l==null?void 0:l.fileName)||"";p&&(await navigator.clipboard.writeText(p),D.success("Copied to clipboard"))}catch(p){console.error("Copy failed:",p),D.error("Failed to copy")}},jc=l=>{try{sessionStorage.setItem("forwardMessage",JSON.stringify({id:l.id||l._id,message:l.message,messageType:l.messageType,fileUrl:l.fileUrl,fileName:l.fileName,fileSize:l.fileSize,fileType:l.fileType})),D.success("Message ready to forward"),window.location.href="/forward"}catch(p){console.error("Forward setup failed:",p),D.error("Failed to prepare message for forwarding")}},Ko=l=>{var p,j,C,k;if(l&&l.messageType==="text"){const N=((p=l.sender)==null?void 0:p.id)||((j=l.sender)==null?void 0:j._id)||l.sender;N===e.id||N===e._id||N===((C=e.id)==null?void 0:C.toString())||N===((k=e._id)==null?void 0:k.toString())?(rr(l),vr(l.message||"")):D.error("You can only edit your own messages")}},ma=async()=>{if(!(!nr||!Fr.trim()))try{U(l=>l.map(p=>Ct(p)===Ct(nr)?{...p,message:Fr.trim(),isEdited:!0,editedAt:new Date().toISOString()}:p)),await yt.editMessage(nr.id||nr._id,Fr.trim()),rr(null),vr("")}catch(l){console.error("Failed to edit message:",l),D.error("Failed to edit message")}},ha=()=>{rr(null),vr("")},pa=h.useRef(null),Yo=h.useRef(!0),hn=h.useRef(null),ks=h.useRef(0),zr=h.useRef(null),Br=h.useRef(!1);h.useEffect(()=>((async()=>{try{console.log(" Loading chat state from database for UserDashboard...");const p=await yt.getChatState(),{personalChats:j,groupChats:C}=p.data,k={},N={};j.forEach(H=>{var xe,Ne,Ee;H.unreadCount>0&&(k[H.chatId]=H.unreadCount),H.lastMessage&&H.lastMessage.message&&(N[H.chatId]={id:H.lastMessage._id||H.lastMessage.id,message:H.lastMessage.message,senderName:H.lastMessage.senderName||((xe=H.lastMessage.sender)==null?void 0:xe.name)||"User",senderId:H.lastMessage.senderId||((Ne=H.lastMessage.sender)==null?void 0:Ne._id)||((Ee=H.lastMessage.sender)==null?void 0:Ee.id),timestamp:H.lastMessage.createdAt||H.lastMessage.timestamp})}),C.forEach(H=>{var xe,Ne,Ee;H.unreadCount>0&&(k[H.chatId]=H.unreadCount),H.lastMessage&&H.lastMessage.message&&(N[H.chatId]={id:H.lastMessage._id||H.lastMessage.id,message:H.lastMessage.message,senderName:H.lastMessage.senderName||((xe=H.lastMessage.sender)==null?void 0:xe.name)||"User",senderId:H.lastMessage.senderId||((Ne=H.lastMessage.sender)==null?void 0:Ne._id)||((Ee=H.lastMessage.sender)==null?void 0:Ee.id),timestamp:H.lastMessage.createdAt||H.lastMessage.timestamp})}),L(k),P(N),console.log(" UserDashboard chat state loaded from database:",{unreadCounts:k,lastMessages:Object.keys(N).length})}catch(p){console.error("Error loading chat state from database:",p)}})(),Ss(),Jo(),()=>{}),[]),h.useEffect(()=>{if(s)return console.log(" Setting up PERSISTENT call listeners for UserDashboard..."),s.off("incoming-call"),s.on("incoming-call",l=>{var p;console.log(" UserDashboard - Incoming call received:",l),D.success(`Incoming ${l.callType} call from ${((p=l.caller)==null?void 0:p.name)||"Unknown"}`,{duration:5e3,icon:""}),Oe(!0),pe({callId:l.callId,callType:l.callType,caller:l.caller}),Be(!0)}),s.off("call-initiated"),s.on("call-initiated",l=>{console.log(" UserDashboard - Call initiated:",l),Oe(!1),pe({callId:l.callId,callType:l.callType,otherUser:l.receiver}),Be(!0)}),s.off("call-error"),s.on("call-error",l=>{console.error(" UserDashboard - Call error:",l),D.error(l.error||"Call failed",{duration:4e3})}),s.off("incoming-group-call"),s.on("incoming-group-call",l=>{var p,j;console.log(" ========================================"),console.log(" UserDashboard - INCOMING GROUP CALL RECEIVED!"),console.log(" Call ID:",l.callId),console.log(" Call Type:",l.callType),console.log(" Room Name:",l.roomName),console.log(" Group:",l.groupName),console.log(" Initiator:",(p=l.initiator)==null?void 0:p.name),console.log(" ========================================"),D.success(`Incoming group ${l.callType} call from ${((j=l.initiator)==null?void 0:j.name)||"Unknown"}`,{duration:5e3,icon:""}),ft(!0),Ge({callId:l.callId,callType:l.callType,groupId:l.groupId,roomName:l.roomName,group:l.group||{name:l.groupName},initiator:l.initiator}),we(!0)}),s.off("group-call-initiated"),s.on("group-call-initiated",l=>{console.log(" ========================================"),console.log(" UserDashboard - GROUP CALL INITIATED!"),console.log(" Call ID:",l.callId),console.log(" Room Name:",l.roomName),console.log(" Call Type:",l.callType),console.log(" ========================================"),ft(!1),Ge({callId:l.callId,callType:l.callType,groupId:l.groupId,roomName:l.roomName,group:l.group}),we(!0)}),s.off("group-call-error"),s.on("group-call-error",l=>{console.error(" UserDashboard - Group call error:",l),D.error(l.error||"Group call failed",{duration:4e3})}),()=>{console.log(" Cleaning up PERSISTENT call listeners..."),s.off("incoming-call"),s.off("call-initiated"),s.off("call-error"),s.off("incoming-group-call"),s.off("group-call-initiated"),s.off("group-call-error")}},[s]),h.useEffect(()=>{const l=C=>{console.log(" UserDashboard - Received Service Worker Message:",C.data);const k=C.data;if(!k||!k.type){console.warn("UserDashboard - Invalid message received from service worker");return}if(k.type==="notification-clicked"||k.type==="answer-call"){console.log(" UserDashboard - Processing notification click/answer:",k.type);const N=k.data;if(!N){console.warn("UserDashboard - No notification data found");return}if(N.type==="incoming-call"){console.log(" UserDashboard - Showing incoming call UI from notification click"),console.log("UserDashboard - Call data:",N);const H={callId:N.callId,callType:N.callType||"voice",caller:{_id:N.senderId,name:N.senderName,profileImage:N.senderImage}};console.log("UserDashboard - Setting call UI with data:",H),Oe(!0),pe(H),Be(!0),D.success(`Incoming ${H.callType} call from ${H.caller.name}`,{duration:5e3,icon:""})}else if(N.type==="incoming-group-call"){console.log(" UserDashboard - Showing incoming group call UI from notification click"),console.log("UserDashboard - Group call data:",N);const H={callId:N.callId,callType:N.callType||"voice",groupId:N.groupId,roomName:N.roomName,group:{_id:N.groupId,name:N.groupName},initiator:{_id:N.senderId,name:N.senderName,profileImage:N.senderImage}};console.log("UserDashboard - Setting group call UI with data:",H),ft(!0),Ge(H),we(!0),D.success(`Incoming group ${H.callType} call from ${H.initiator.name}`,{duration:5e3,icon:""})}}else k.type==="decline-call"&&(console.log(" Declining call from notification"),Be(!1),we(!1),pe(null),Ge(null))};console.log(" UserDashboard - Setting up service worker message listener"),navigator.serviceWorker?(navigator.serviceWorker.addEventListener("message",l),console.log(" UserDashboard - Service worker message listener attached")):console.warn(" UserDashboard - Service worker not available");const j=new URLSearchParams(window.location.search).get("notificationData");if(j){console.log(" UserDashboard - Found notification data in URL");try{const C=atob(j),k=JSON.parse(C);console.log(" UserDashboard - Notification data from URL:",k),l({data:k}),window.history.replaceState({},document.title,window.location.pathname)}catch(C){console.error("UserDashboard - Error parsing notification data from URL:",C)}}return()=>{console.log(" UserDashboard - Removing service worker message listener"),navigator.serviceWorker&&navigator.serviceWorker.removeEventListener("message",l)}},[]),h.useEffect(()=>{R.length>0&&setTimeout(()=>{Cs()},100)},[R,m]),h.useEffect(()=>(m&&(U([]),X(!1),G(!1),Yo.current=!0,Qo(),Jo(),m.type==="group"?(a(m.id),Xo(m.id),console.log(" UserDashboard joined group room for:",m.name)):kn([])),()=>{Lt.removeAllListeners(),m&&m.type==="group"&&(c(m.id),console.log(" UserDashboard left group room for:",m.name)),Lt.healthCheckInterval&&(clearInterval(Lt.healthCheckInterval),delete Lt.healthCheckInterval)}),[m]),h.useEffect(()=>{if(R.length>0){if(Yo.current)setTimeout(()=>{Cs(!0),Yo.current=!1},100);else if(Br.current)setTimeout(()=>{Cs(!1),Br.current=!1},100);else if(hn.current){const l=hn.current,p=l.scrollHeight,j=l.scrollTop,C=l.clientHeight;p-j-C<200&&Cs(!1)}}},[R]);const pn=()=>{!hn.current||z||!E||!m||(zr.current&&clearTimeout(zr.current),zr.current=setTimeout(()=>{var j,C;if(!hn.current||z||!E)return;const l=hn.current;if(l.scrollTop<50&&R.length>0){ks.current=l.scrollHeight;const k=((j=R[0])==null?void 0:j._id)||((C=R[0])==null?void 0:C.id);k&&Qo(k)}},150))};h.useEffect(()=>{const l=hn.current;if(!(!l||!m))return l.addEventListener("scroll",pn),()=>{l.removeEventListener("scroll",pn),zr.current&&clearTimeout(zr.current)}},[R,z,E,m]);const wr=async()=>{try{console.log(" Refreshing UserDashboard chat state from database...");const l=await yt.getChatState(),{personalChats:p,groupChats:j}=l.data,C={},k={};p.forEach(N=>{var H,xe,Ne;N.unreadCount>0&&(C[N.chatId]=N.unreadCount),N.lastMessage&&N.lastMessage.message&&(k[N.chatId]={id:N.lastMessage._id||N.lastMessage.id,message:N.lastMessage.message,senderName:N.lastMessage.senderName||((H=N.lastMessage.sender)==null?void 0:H.name)||"User",senderId:N.lastMessage.senderId||((xe=N.lastMessage.sender)==null?void 0:xe._id)||((Ne=N.lastMessage.sender)==null?void 0:Ne.id),timestamp:N.lastMessage.createdAt||N.lastMessage.timestamp})}),j.forEach(N=>{var H,xe,Ne;N.unreadCount>0&&(C[N.chatId]=N.unreadCount),N.lastMessage&&N.lastMessage.message&&(k[N.chatId]={id:N.lastMessage._id||N.lastMessage.id,message:N.lastMessage.message,senderName:N.lastMessage.senderName||((H=N.lastMessage.sender)==null?void 0:H.name)||"User",senderId:N.lastMessage.senderId||((xe=N.lastMessage.sender)==null?void 0:xe._id)||((Ne=N.lastMessage.sender)==null?void 0:Ne.id),timestamp:N.lastMessage.createdAt||N.lastMessage.timestamp})}),L(C),P(k),console.log(" UserDashboard chat state refreshed from database")}catch(l){console.error("Error refreshing UserDashboard chat state:",l)}};h.useEffect(()=>{const l=()=>St(null),p=j=>{j.key==="Escape"&&St(null)};if(Xe)return window.addEventListener("scroll",l,!0),window.addEventListener("keydown",p),()=>{window.removeEventListener("scroll",l,!0),window.removeEventListener("keydown",p)}},[Xe]),h.useEffect(()=>{const l=()=>Ln(null),p=j=>{j.key==="Escape"&&Ln(null)};if(Dt)return window.addEventListener("scroll",l,!0),window.addEventListener("keydown",p),()=>{window.removeEventListener("scroll",l,!0),window.removeEventListener("keydown",p)}},[Dt]),h.useEffect(()=>{window.testSocketDashboard=()=>{Lt.testConnection()},window.checkSocketDashboard=()=>{Lt.logConnectionStatus()},window.forceSocketConnectDashboard=()=>{Lt.forceConnectionTest()},console.log(" UserDashboard Socket debugging methods available:"),console.log(" - testSocketDashboard() - Test socket connection status"),console.log(" - checkSocketDashboard() - Show current socket status"),console.log(" - forceSocketConnectDashboard() - Force reconnection")},[]);const Ss=async()=>{try{te(!0);const[l,p]=await Promise.all([an.getActiveUsers(),zt.getMyGroups()]);console.log(" UserDashboard Data Loaded:"),console.log(" Users:",l.data.length),console.log(" Groups:",p.data.length),console.log(" Group Details:",p.data.map(j=>{var C;return{id:j.id,name:j.name,members:((C=j.members)==null?void 0:C.length)||0,avatar:j.avatar?"Has Avatar":"No Avatar"}})),M(l.data.filter(j=>j.id!==e.id)),w(p.data)}catch(l){console.error("Error fetching dashboard data:",l),D.error("Failed to load dashboard data")}finally{te(!1)}},Jo=()=>{console.log(" Setting up enhanced UserDashboard socket listeners with Context API...");const l=g();console.log(" Current socket status:",l),d(p=>{var Ne,Ee;console.log(" USERDASHBOARD CONTEXT - received message:",p);const j=typeof p.sender=="object"?p.sender.id||p.sender._id:p.sender,C=typeof p.receiver=="object"?p.receiver.id||p.receiver._id:p.receiver,k=p.id||p._id||p.messageId,N=p.message||p.content,H=j===e.id||j===e._id||j===((Ne=e.id)==null?void 0:Ne.toString())||j===((Ee=e._id)==null?void 0:Ee.toString());if(p._isConfirmation||p.isConfirmMessage||p.isMessageSentConfirmation){console.log(" Skipping confirmation message");return}const xe=eo(p,m,e);if(console.log(" ENHANCED USERDASHBOARD MESSAGE FILTERING:",{senderId:j,receiverId:C,messageId:k,messageText:N,selectedChatId:m==null?void 0:m.id,selectedChatType:m==null?void 0:m.type,currentUserId:e.id,isCurrentUserSender:H,isForCurrentChat:xe,messageData:p}),xe&&m)console.log(" Processing message for current active dashboard chat"),H?console.log(" Message from current user - handled by optimistic updates"):(console.log(" Adding external message to current dashboard chat immediately"),U(Fe=>{if(Fe.some(ie=>{var sn,Un;const Pe=ie.id||ie._id||ie.messageId,Le=ie.message||ie.content,Je=((sn=ie.sender)==null?void 0:sn.id)||((Un=ie.sender)==null?void 0:Un._id)||ie.sender,qe=ie.createdAt||ie.timestamp,dt=p.createdAt||p.timestamp;return!!(Pe===k&&k||Le===N&&String(Je)===String(j)&&dt&&qe&&Math.abs(new Date(dt)-new Date(qe))<5e3||ie.isOptimistic&&Le===N&&String(Je)===String(j)&&dt&&qe&&Math.abs(new Date(dt)-new Date(qe))<1e4)}))return console.log(" UserDashboard enhanced detection: Message already exists - confirmed duplicate",{messageId:k,messageText:N==null?void 0:N.substring(0,20),senderId:j,isDuplicate:!0}),Fe;console.log(" REAL-TIME USERDASHBOARD: NEW message confirmed - Adding to active chat",{messageId:k,messageText:N==null?void 0:N.substring(0,20),senderId:j,isDuplicate:!1});const re=ga(p,j);return sr(m.id,p,j),setTimeout(()=>{wr()},100),[...Fe,re]}));else if(N&&!H){const Fe=j||p.sender;Fe&&Fe!==e.id&&(console.log(" Incrementing unread count for dashboard chat:",Fe),L(ze=>({...ze,[Fe]:(ze[Fe]||0)+1})),sr(Fe,p,j),setTimeout(()=>{wr()},100))}}),x(p=>{console.log(" Dashboard message sent confirmation received:",p),p&&p.id&&U(j=>{const C=j.filter(N=>!N.isOptimistic),k={id:p.id,message:p.message,messageType:p.messageType||"text",fileUrl:p.fileUrl,fileName:p.fileName,fileSize:p.fileSize,fileType:p.fileType,sender:p.sender,createdAt:p.createdAt||p.timestamp,timestamp:p.timestamp,isOptimistic:!1};return[...C,k]})}),f(p=>{var Ne,Ee,Fe,ze;console.log(" USERDASHBOARD GROUP MESSAGE CONTEXT - received message:",p);const j=typeof p.sender=="object"?p.sender.id||p.sender._id:p.sender,C=p.groupId||((Ne=p.group)==null?void 0:Ne.id)||((Ee=p.group)==null?void 0:Ee._id),k=p.id||p._id||p.messageId,N=p.message||p.content,H=j===e.id||j===e._id||j===((Fe=e.id)==null?void 0:Fe.toString())||j===((ze=e._id)==null?void 0:ze.toString());if(p._isConfirmation||p.isConfirmMessage||p.isMessageSentConfirmation){console.log(" Skipping confirmation message");return}const xe=m&&m.type==="group"&&(C===m.id||String(C)===String(m.id));if(console.log(" USERDASHBOARD GROUP MESSAGE FILTERING:",{senderId:j,groupId:C,messageId:k,messageText:N,selectedChatId:m==null?void 0:m.id,selectedChatType:m==null?void 0:m.type,currentUserId:e.id,isCurrentUserSender:H,isForCurrentGroup:xe,messageData:p}),xe&&m)console.log(" Processing group message for current UserDashboard group"),H?console.log(" Group message from current user - handled by optimistic updates"):(console.log(" Adding external group message to current dashboard chat immediately"),U(re=>{if(re.some(Le=>{var Es,ya;const Je=Le.id||Le._id||Le.messageId,qe=Le.message||Le.content,dt=((Es=Le.sender)==null?void 0:Es.id)||((ya=Le.sender)==null?void 0:ya._id)||Le.sender,sn=Le.createdAt||Le.timestamp,Un=p.createdAt||p.timestamp;return!!(Je===k&&k||qe===N&&String(dt)===String(j)&&Un&&sn&&Math.abs(new Date(Un)-new Date(sn))<5e3||Le.isOptimistic&&qe===N&&String(dt)===String(j)&&Un&&sn&&Math.abs(new Date(Un)-new Date(sn))<1e4)}))return console.log(" USERDASHBOARD GROUP duplicate detection: Message already exists",{messageId:k,messageText:N==null?void 0:N.substring(0,20),senderId:j==null?void 0:j.toString(),isDuplicate:!0}),re;console.log(" USERDASHBOARD GROUP REAL-TIME: NEW message confirmed - Adding to active group",{messageId:k,messageText:N==null?void 0:N.substring(0,20),senderId:j,groupId:C});const Pe=ga(p,j);return sr(m.id,p,j),setTimeout(()=>{wr()},100),[...re,Pe]}));else if(N&&!H){const re=C||p.groupId;re&&(!m||m.type!=="group"||String(re)!==String(m.id))&&(console.log(" UserDashboard incrementing unread count for group:",re),L(Pe=>({...Pe,[re]:(Pe[re]||0)+1})),sr(re,p,j),setTimeout(()=>{wr()},100))}}),s&&(s.off("avatar-updated"),s.on("avatar-updated",p=>{var C,k;console.log(" Profile updated received:",p);const j=((C=p.userId)==null?void 0:C.toString())||p.userId;M(N=>N.map(H=>{var xe;return((xe=H.id||H._id)==null?void 0:xe.toString())===j?{...H,profileImage:p.profileImage,name:p.name}:H})),m&&m.type==="personal"&&((k=m.id||m._id)==null?void 0:k.toString())===j&&y(N=>({...N,profileImage:p.profileImage,name:p.name})),U(N=>N.map(H=>{var Ne,Ee,Fe;return((Fe=((Ne=H.sender)==null?void 0:Ne.id)||((Ee=H.sender)==null?void 0:Ee._id)||H.sender)==null?void 0:Fe.toString())===j?{...H,sender:{...typeof H.sender=="object"?H.sender:{id:H.sender},profileImage:p.profileImage,name:p.name}}:H}))}),s.off("messages-seen"),s.on("messages-seen",p=>{console.log(" Messages seen by user:",p.readBy),m&&m.type==="personal"&&p.chatId===m.id&&U(j=>j.map(C=>{var N,H;return(((N=C.sender)==null?void 0:N.id)||((H=C.sender)==null?void 0:H._id)||C.sender)===e.id?{...C,isRead:!0,readBy:[{user:p.readBy,readAt:p.timestamp}]}:C}))}))},eo=(l,p,j)=>{var H,xe,Ne,Ee;if(!p)return!1;const C=((H=l.sender)==null?void 0:H.id)||((xe=l.sender)==null?void 0:xe._id)||l.sender,k=((Ne=l.receiver)==null?void 0:Ne.id)||((Ee=l.receiver)==null?void 0:Ee._id)||l.receiver,N=l.chatId||l.chatRoom;return p.type==="personal"&&p.id&&(C===p.id&&k===j.id||C===j.id&&k===p.id||String(C)===String(p.id)||String(k)===String(p.id))?!0:p.type==="group"?N===p.id||l.groupId===p.id:!1},ga=(l,p)=>{var j,C;return{id:l.id||l._id||l.messageId,message:l.message||l.content,messageType:l.messageType||"text",fileUrl:l.fileUrl,fileName:l.fileName,fileSize:l.fileSize,fileType:l.fileType,sender:typeof l.sender=="object"?l.sender:{id:p,name:l.senderName||((j=l.sender)==null?void 0:j.name)||"User",profileImage:l.senderProfileImage||((C=l.sender)==null?void 0:C.profileImage)},createdAt:l.createdAt||l.timestamp||new Date().toISOString(),timestamp:l.timestamp||l.createdAt,isFromOtherUser:!(p===e.id||p===e._id)}},sr=(l,p,j)=>{const C=j===e.id||j===e._id;P(k=>{var N;return{...k,[l]:{id:p.id||p._id||p.messageId,message:p.message||p.content,senderName:C?"You":p.senderName||((N=p.sender)==null?void 0:N.name)||"User",senderId:j,timestamp:p.createdAt||p.timestamp||new Date().toISOString()}}})},Qo=async(l=null)=>{var p;try{l&&G(!0);let j;const C={limit:V};if(l&&(C.before=l),m.type==="personal"){if(!m.id){console.error("User ID is undefined for personal chat");return}j=await yt.getPersonalMessages(m.id,C)}else{if(!m.id){console.error("Group ID is undefined for group chat");return}j=await yt.getGroupMessages(m.id,C)}let k,N;if(j.data&&typeof j.data=="object"?Array.isArray(j.data.messages)?(k=j.data.messages,N=j.data.hasMore||!1):Array.isArray(j.data)?(k=j.data,N=j.data.length>=V):(k=[],N=!1):(k=[],N=!1),l)U(H=>{const xe=new Set(H.map(Ee=>Ee._id||Ee.id));return[...k.filter(Ee=>{const Fe=Ee._id||Ee.id;return!xe.has(Fe)}),...H]}),X(N),G(!1),setTimeout(()=>{if(hn.current&&ks.current>0){const xe=hn.current.scrollHeight-ks.current;hn.current.scrollTop=xe+100}},0);else if(U(k||[]),X(N),k&&k.length>0){const H=k[k.length-1];sr(m.id,H,((p=H.sender)==null?void 0:p.id)||H.sender)}}catch(j){console.error("Error fetching messages:",j),D.error("Failed to load messages"),U([]),l&&G(!1)}},to=l=>{const p=document.createElement("input");p.type="file",p.style.display="none",l==="image"?p.accept="image/*":l==="video"?p.accept="video/*":l==="document"&&(p.accept=".pdf,.doc,.docx,.txt,.csv,.xls,.xlsx,.ppt,.pptx,.xlsm,.xlsx,.zip,.rar,.7z,.tar,.gz,.bz2,.xz,.iso,.dmg,.img,.bin,.exe,.msi,.dmg,.iso,.tar,.gz,.bz2,.xz,.img,.bin,.exe,.msi"),p.onchange=j=>{const C=j.target.files[0];if(C){if(J(C),C.type.startsWith("image/")){const k=new FileReader;k.onload=N=>ue(N.target.result),k.readAsDataURL(C)}else ue(null);ye(!1)}},document.body.appendChild(p),p.click(),document.body.removeChild(p)},br=()=>{J(null),ue(null)},Vr=async(l,p,j)=>{try{wt(re=>({...re,[j]:{progress:0,downloading:!0}}));const C=await fetch(nn(l)),k=C.headers.get("content-length"),N=parseInt(k,10);if(!C.ok)throw new Error("Download failed");const H=C.body.getReader(),xe=[];let Ne=0;for(;;){const{done:re,value:ie}=await H.read();if(re)break;xe.push(ie),Ne+=ie.length;const Pe=N?Math.round(Ne/N*100):0;wt(Le=>({...Le,[j]:{progress:Pe,downloading:!0}}))}const Ee=new Blob(xe),Fe=window.URL.createObjectURL(Ee),ze=document.createElement("a");ze.href=Fe,ze.download=p,document.body.appendChild(ze),ze.click(),document.body.removeChild(ze),window.URL.revokeObjectURL(Fe),wt(re=>({...re,[j]:{progress:100,downloading:!1}})),Rt(re=>{const ie={...re,[j]:!0};try{sessionStorage.setItem("downloadedMessages",JSON.stringify(ie))}catch{}return ie}),setTimeout(()=>{wt(re=>{const ie={...re};return delete ie[j],ie})},2e3)}catch(C){console.error("Download failed:",C),wt(k=>({...k,[j]:{progress:0,downloading:!1,error:!0}}))}};h.useEffect(()=>{const l=p=>{me&&!p.target.closest(".file-options-container")&&ye(!1),mn&&!p.target.closest(".message-dropdown-container")&&Wt(null)};return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[me,mn]);const no=async l=>{if(l.preventDefault(),!W.trim()&&!$||!m)return;if(m.type==="personal"&&m.isActive===!1){D.error("Cannot send messages to disabled users");return}const p=W.trim();F("");try{let j={sender:e.id,message:p,messageType:"text"};if(m.type==="personal"?j.receiver=m.id:j.group=m.id,$){const C=new FormData;m.type==="personal"?C.append("receiver",m.id):C.append("group",m.id),C.append("message",p),C.append("file",$);let k="file";$.type.startsWith("image/")?k="image":$.type.startsWith("video/")&&(k="video");const N={id:Date.now(),message:p||$.name,messageType:k,fileUrl:URL.createObjectURL($),fileName:$.name,fileSize:$.size,fileType:$.type,sender:{id:e.id,name:e.name,profileImage:e.profileImage},createdAt:new Date().toISOString(),timestamp:new Date().toISOString(),isOptimistic:!0};U(H=>[...H,N]),Br.current=!0,sr(m.id,{id:N.id,message:N.message,createdAt:N.createdAt},e.id),m.type==="personal"?await yt.sendPersonalMessage(C):await yt.sendGroupMessage(C),br()}else{const C={id:Date.now(),message:p,messageType:"text",sender:{id:e.id,name:e.name,profileImage:e.profileImage},createdAt:new Date().toISOString(),timestamp:new Date().toISOString(),isOptimistic:!0};if(U(k=>[...k,C]),Br.current=!0,sr(m.id,{id:C.id,message:C.message,createdAt:C.createdAt},e.id),m.type==="personal")try{await i(m.id,p,"text",!1),console.log(" Dashboard message sent via context socket")}catch(k){console.warn("Context socket failed, trying API:",k),await yt.sendPersonalMessage(j)}else try{await i(m.id,p,"text",!0),console.log(" Dashboard group message sent via context socket")}catch(k){console.warn("Context socket failed, trying API:",k),await yt.sendGroupMessage({sender:e.id,group:m.id,message:p,timestamp:new Date().toISOString()})}}console.log(" Dashboard message sent successfully")}catch(j){console.error(" Failed to send dashboard message:",j),D.error("Failed to send message"),U(C=>C.filter(k=>!k.isOptimistic))}},Cs=(l=!1)=>{var p;(p=pa.current)==null||p.scrollIntoView({behavior:l?"instant":"smooth"})},ro=()=>{t(),D.success("Logged out successfully")},xa=(l,p,j)=>{j.stopPropagation();const C=`${l}-${p}`;S(k=>{let N;return k.includes(C)?(N=k.filter(H=>H!==C),D.success("Chat unpinned")):(N=[...k,C],D.success("Chat pinned")),localStorage.setItem("pinnedChats",JSON.stringify(N)),N})},Xo=async l=>{try{const p=await zt.getPinnedMessages(l);kn(p.data.pinnedMessages||[])}catch(p){console.error("Error fetching pinned messages:",p)}},or=async(l,p)=>{var j,C;if(p&&p.stopPropagation(),!m||m.type!=="group"){D.error("You can only pin messages in groups");return}try{xt.some(N=>N._id===l._id||N.id===l._id)?(await zt.unpinMessage(m.id,l._id||l.id),kn(N=>N.filter(H=>(H._id||H.id)!==(l._id||l.id))),D.success("Message unpinned")):(await zt.pinMessage(m.id,l._id||l.id),kn(N=>[...N,l]),D.success("Message pinned"))}catch(k){console.error("Error toggling pin message:",k),D.error(((C=(j=k.response)==null?void 0:j.data)==null?void 0:C.message)||"Failed to pin/unpin message")}},Zo=[...I.map(l=>({id:l.id,name:l.name,email:l.email,type:"personal",avatar:l.name.charAt(0).toUpperCase(),profileImage:l.profileImage,lastMessage:oe[l.id]||null,isActive:l.isActive})),...v.map(l=>{var p;return{id:l.id,name:l.name,email:`${((p=l.members)==null?void 0:p.length)||0} members`,type:"group",avatar:l.avatar?`${Se}${l.avatar}`:"G",profileImage:l.avatar,lastMessage:oe[l.id]||null}})].sort((l,p)=>{var Ne,Ee;const j=`${l.type}-${l.id}`,C=`${p.type}-${p.id}`,k=O.includes(j),N=O.includes(C);if(k&&!N)return-1;if(!k&&N)return 1;const H=(Ne=l.lastMessage)!=null&&Ne.timestamp?new Date(l.lastMessage.timestamp).getTime():0;return((Ee=p.lastMessage)!=null&&Ee.timestamp?new Date(p.lastMessage.timestamp).getTime():0)-H}),u=(()=>{let l=Zo;switch(q){case"unread":l=Zo.filter(p=>fe[p.id]>0);break;case"groups":l=Zo.filter(p=>p.type==="group");break;case"all":default:l=Zo;break}return l.filter(p=>p.name.toLowerCase().includes(Z.toLowerCase())||p.email.toLowerCase().includes(Z.toLowerCase()))})();return se?r.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"})}):r.jsxs("div",{className:"h-screen bg-gray-50 flex",children:[r.jsxs("div",{className:"w-full h-screen flex bg-white shadow-lg",children:[r.jsxs("div",{className:"w-1/3 min-w-[300px] max-w-[400px] bg-white border-r border-gray-200 flex flex-col",children:[r.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"User Dashboard"}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsxs("div",{className:"relative",children:[r.jsx("button",{onClick:()=>tt(!Me),className:"text-gray-500 hover:text-gray-700",title:"Settings",children:r.jsx(lm,{className:"w-5 h-5"})}),Me&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>tt(!1)}),r.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-20",children:[r.jsxs("button",{onClick:()=>{n("/daily-update"),tt(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-2",children:[r.jsx(_n,{className:"w-4 h-4"}),"Daily Update"]}),r.jsxs("button",{onClick:()=>{n("/tasks"),tt(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-2",children:[r.jsx(hs,{className:"w-4 h-4"}),"Task"]}),r.jsx("div",{className:"border-t border-gray-200 my-1"}),r.jsxs(Al,{to:"/profile",onClick:()=>tt(!1),className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-2",children:[r.jsx(Nn,{className:"w-4 h-4"}),"Profile"]})]})]})]}),r.jsx("button",{onClick:ro,className:"p-1 text-gray-500 hover:text-gray-700",title:"Logout",children:r.jsx(wy,{className:"w-5 h-5"})})]})]}),r.jsx("div",{className:"flex items-center space-x-3 mb-3",children:r.jsxs(Al,{to:"/profile",className:"flex items-center space-x-3 hover:opacity-80 transition-opacity",children:[e.profileImage?r.jsx("img",{src:`${Se}${e.profileImage}`,alt:"Profile",className:"w-10 h-10 rounded-full object-cover"}):r.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-white font-medium",children:e.name.charAt(0).toUpperCase()})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:e.name}),r.jsx("p",{className:"text-xs text-green-600",children:"Online"})]})]})}),r.jsxs("div",{className:"relative mb-3",children:[r.jsx(Go,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"text",placeholder:"Search or start new chat",value:Z,onChange:l=>ae(l.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-green-400"})]}),r.jsxs("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:[r.jsx("button",{onClick:()=>Q("all"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${q==="all"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"All"}),r.jsxs("button",{onClick:()=>Q("unread"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${q==="unread"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:["Unread",Object.values(fe).reduce((l,p)=>l+p,0)>0&&r.jsx("span",{className:"ml-1 bg-green-500 text-white text-xs rounded-full px-1.5 py-0.5",children:Object.values(fe).reduce((l,p)=>l+p,0)})]}),r.jsx("button",{onClick:()=>Q("groups"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${q==="groups"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Groups"})]})]}),r.jsxs("div",{className:"flex-1 overflow-y-auto",children:[u.map(l=>{var p;return r.jsx("div",{onClick:()=>{console.log("Selecting chat:",l),y({type:l.type,id:l.id,name:l.name,profileImage:l.profileImage,isActive:l.isActive!==!1}),fe[l.id]&&(L(j=>{const C={...j};return delete C[l.id],C}),yt.updateChatState({chatId:l.id,chatType:l.type,action:"clear_unread"}).catch(j=>{console.error("Error clearing unread count:",j)}))},onContextMenu:j=>{j.preventDefault(),St({x:j.clientX,y:j.clientY,chat:l})},className:`p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 ${(m==null?void 0:m.id)===l.id&&(m==null?void 0:m.type)===l.type?"bg-green-50":""} ${l.type==="personal"&&l.isActive===!1?"opacity-60 bg-red-50 border-l-4 border-red-300":""}`,title:l.type==="personal"&&l.isActive===!1?"Disabled User":"",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:`w-12 h-12 rounded-full overflow-hidden cursor-pointer hover:ring-2 hover:ring-green-400 transition-all ${l.type==="personal"&&l.isActive===!1?"bg-gray-300":"bg-gray-200"}`,onClick:j=>{j.stopPropagation(),l.profileImage&&gt({image:l.type==="personal"?`${Se}${l.profileImage}`:l.avatar,name:l.name})},children:l.type==="personal"?l.profileImage?r.jsx("img",{src:`${Se}${l.profileImage}`,alt:l.name,className:`w-full h-full object-cover ${l.isActive===!1?"grayscale opacity-70":""}`}):r.jsx("div",{className:`w-full h-full ${l.isActive===!1?"bg-gray-400":"bg-green-500"} flex items-center justify-center`,children:r.jsx("span",{className:"text-white font-semibold text-lg",children:l.avatar})}):l.profileImage?r.jsx("img",{src:l.avatar,alt:l.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:r.jsx(At,{className:"w-6 h-6 text-white"})})}),l.type==="personal"&&l.isActive===!1&&r.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-red-500 rounded-full border-2 border-white flex items-center justify-center",children:r.jsx("span",{className:"text-white text-xs font-bold",children:""})})]}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsxs("h3",{className:`truncate ${l.type==="personal"&&l.isActive===!1?"font-medium text-red-700 line-through":"font-medium text-gray-900"}`,children:[l.name,l.type==="personal"&&l.isActive===!1&&r.jsx("span",{className:"ml-2 text-xs text-red-500",children:"(Disabled)"})]}),l.type==="group"&&r.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Group"})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[O.includes(`${l.type}-${l.id}`)&&r.jsx(On,{className:"w-3 h-3 text-gray-400 fill-gray-400"}),r.jsx("span",{className:"text-xs text-gray-500",children:(p=l.lastMessage)!=null&&p.timestamp?da(l.lastMessage.timestamp):""}),fe[l.id]&&fe[l.id]>0&&r.jsx("div",{className:"bg-green-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center",children:fe[l.id]>99?"99+":fe[l.id]})]})]}),r.jsx("p",{className:`text-sm truncate ${l.type==="personal"&&l.isActive===!1?"text-red-400":"text-gray-500"}`,children:l.type==="personal"&&l.isActive===!1?"User is disabled - cannot send new messages":l.lastMessage&&l.lastMessage.message?`${l.lastMessage.senderName||"You"}: ${l.lastMessage.message}`:"No messages yet"})]})]})},`${l.type}-${l.id}`)}),u.length===0&&r.jsxs("div",{className:"text-center py-8",children:[r.jsx(hs,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-500 text-sm",children:Z?"No chats found.":"No chats available."})]})]})]}),Qe&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:()=>gt(null),children:r.jsxs("div",{className:"relative max-w-2xl max-h-[90vh] p-4",children:[r.jsx("button",{onClick:()=>gt(null),className:"absolute top-6 right-6 z-10 bg-white/10 hover:bg-white/20 text-white rounded-full p-2 transition-colors",title:"Close",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsxs("div",{className:"bg-white rounded-lg overflow-hidden shadow-2xl",children:[r.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-4",children:r.jsx("h3",{className:"text-white text-xl font-semibold text-center",children:Qe.name})}),r.jsx("img",{src:Qe.image,alt:Qe.name,className:"w-full h-auto max-h-[70vh] object-contain",onClick:l=>l.stopPropagation()})]})]})}),Xe&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>St(null)}),r.jsx("div",{className:"fixed z-50 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[180px]",style:{top:`${Xe.y}px`,left:`${Xe.x}px`},children:r.jsx("button",{onClick:l=>{xa(Xe.chat.type,Xe.chat.id,l),St(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-3",children:O.includes(`${Xe.chat.type}-${Xe.chat.id}`)?r.jsxs(r.Fragment,{children:[r.jsx(cr,{className:"w-4 h-4"}),"Unpin Chat"]}):r.jsxs(r.Fragment,{children:[r.jsx(On,{className:"w-4 h-4"}),"Pin Chat"]})})})]}),Dt&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>Ln(null)}),r.jsxs("div",{className:"fixed z-50 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[180px]",style:{top:`${Dt.y}px`,left:`${Dt.x}px`},children:[r.jsxs("button",{onClick:()=>{rn("copy",Dt.message),Ln(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-3",children:[r.jsx(Zr,{className:"w-4 h-4"}),"Copy"]}),r.jsxs("button",{onClick:()=>{rn("forward",Dt.message),Ln(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-3",children:[r.jsx(es,{className:"w-4 h-4"}),"Forward"]}),(m==null?void 0:m.type)==="group"&&r.jsx("button",{onClick:l=>{or(Dt.message,l),Ln(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-3",children:xt.some(l=>(l._id||l.id)===(Dt.message._id||Dt.message.id))?r.jsxs(r.Fragment,{children:[r.jsx(cr,{className:"w-4 h-4"}),"Unpin Message"]}):r.jsxs(r.Fragment,{children:[r.jsx(On,{className:"w-4 h-4"}),"Pin Message"]})})]})]}),at&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>He(null),onMouseMove:ge,onMouseUp:Te,onMouseLeave:Te,children:r.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center overflow-hidden",children:[r.jsx("button",{onClick:()=>He(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsx("button",{onClick:l=>{l.stopPropagation();const p=document.createElement("a");p.href=at.src,p.download=at.alt,document.body.appendChild(p),p.click(),document.body.removeChild(p)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:r.jsx(Jt,{className:"w-5 h-5"})}),r.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[r.jsx("button",{onClick:l=>{l.stopPropagation(),A()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Zoom In",children:r.jsx(Ey,{className:"w-5 h-5"})}),r.jsx("button",{onClick:l=>{l.stopPropagation(),ne()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Zoom Out",children:r.jsx(Iy,{className:"w-5 h-5"})}),r.jsx("button",{onClick:l=>{l.stopPropagation(),ee()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Reset Zoom",children:r.jsx(am,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"absolute bottom-4 left-4 z-10 bg-black/50 text-white px-3 py-2 rounded-lg text-sm",children:[Math.round(he*100),"%"]}),r.jsx("img",{src:at.src,alt:at.alt,className:`object-contain transition-transform duration-200 ${le?"cursor-grabbing":"cursor-grab"}`,style:{transform:`translate(${de.x}px, ${de.y}px) scale(${he})`,maxWidth:"none",maxHeight:"none",width:"auto",height:"auto"},onMouseDown:Y,onClick:l=>l.stopPropagation(),draggable:!1})]})}),$e&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>lt(null),children:r.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center",children:[r.jsx("button",{onClick:()=>lt(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsx("button",{onClick:l=>{l.stopPropagation();const p=document.createElement("a");p.href=$e.src,p.download=$e.alt,document.body.appendChild(p),p.click(),document.body.removeChild(p)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:r.jsx(Jt,{className:"w-5 h-5"})}),r.jsx("video",{src:$e.src,controls:!0,autoPlay:!0,className:"max-w-full max-h-full object-contain",onClick:l=>l.stopPropagation()})]})}),Ye&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>tn(null),children:r.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center",children:[r.jsx("button",{onClick:()=>tn(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsx("button",{onClick:l=>{l.stopPropagation();const p=document.createElement("a");p.href=Ye.src,p.download=Ye.fileName,document.body.appendChild(p),p.click(),document.body.removeChild(p)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:r.jsx(Jt,{className:"w-5 h-5"})}),r.jsx("div",{className:"bg-white rounded-lg shadow-2xl w-full h-full max-w-4xl max-h-[90vh] overflow-hidden",children:Ye.fileType==="application/pdf"?r.jsx("iframe",{src:Ye.src,className:"w-full h-full border-0",title:Ye.fileName,onClick:l=>l.stopPropagation()}):r.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-8",children:[r.jsx(Xt,{className:"w-24 h-24 text-gray-400 mb-4"}),r.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:Ye.fileName}),r.jsxs("p",{className:"text-gray-600 mb-4",children:[(Ye.fileSize/1024/1024).toFixed(2)," MB"]}),r.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["This file type cannot be previewed in the browser.",r.jsx("br",{}),"Click the download button to save and view the file."]}),r.jsx("button",{onClick:l=>{l.stopPropagation();const p=document.createElement("a");p.href=Ye.src,p.download=Ye.fileName,document.body.appendChild(p),p.click(),document.body.removeChild(p)},className:"mt-4 bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors",children:"Download File"})]})})]})}),r.jsx("div",{className:"flex-1 flex flex-col",children:m?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:m.type==="personal"?m.profileImage?r.jsx("img",{src:`${Se}${m.profileImage}`,alt:m.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white font-semibold",children:m.name.charAt(0).toUpperCase()})}):m.profileImage?r.jsx("img",{src:`${Se}${m.profileImage}`,alt:m.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:r.jsx(At,{className:"w-5 h-5 text-white"})})}),r.jsxs("div",{className:`${m.type==="group"?"cursor-pointer hover:bg-gray-50 p-2 rounded-lg transition-colors":""}`,onClick:()=>{m.type==="group"&&(window.location.href=`/group/${m.id}`)},title:m.type==="group"?"Click to view group info":"",children:[r.jsxs("h3",{className:`font-semibold ${m.type==="personal"&&m.isActive===!1?"text-red-700":"text-gray-900"}`,children:[m.name,m.type==="personal"&&m.isActive===!1&&r.jsx("span",{className:"ml-2 text-xs text-red-500",children:"(Disabled)"})]}),r.jsx("p",{className:`text-xs ${m.type==="personal"&&m.isActive===!1?"text-red-400":"text-gray-500"}`,children:m.type==="personal"?m.isActive===!1?"User is disabled - viewing mode only":b(m.id)?r.jsx("span",{className:"text-green-600 font-medium",children:"Online"}):bc(_(m.id).lastSeen):`${m.email}`})]})]}),r.jsxs("div",{className:"flex items-center space-x-4",children:[m.type==="personal"?r.jsxs(r.Fragment,{children:[r.jsx(bp,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var l,p;if(!(!m||m.type!=="personal"))try{const C=(p=(l=(await qi.initiate(m.id,"voice")).data)==null?void 0:l.data)==null?void 0:p.call;C&&C._id&&(Oe(!1),pe({callId:C._id,callType:"voice",otherUser:C.otherUser}),Be(!0),s.emit("call-initiate",{receiverId:m.id,callType:"voice",callId:C._id}))}catch(j){console.error("Failed to initiate call",j)}}}),r.jsx($t,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var l,p;if(!(!m||m.type!=="personal"))try{const C=(p=(l=(await qi.initiate(m.id,"video")).data)==null?void 0:l.data)==null?void 0:p.call;C&&C._id&&(Oe(!1),pe({callId:C._id,callType:"video",otherUser:C.otherUser}),Be(!0),s.emit("call-initiate",{receiverId:m.id,callType:"video",callId:C._id}))}catch(j){console.error("Failed to initiate video call",j)}}})]}):r.jsxs(r.Fragment,{children:[r.jsx(bp,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var l,p,j,C,k;if(!(!m||m.type!=="group")){console.log(" Initiating group VOICE call for:",m.id,m.name);try{const H=(p=(l=(await Tr.initiate(m.id,"voice")).data)==null?void 0:l.data)==null?void 0:p.call;console.log(" ========================================"),console.log(" VOICE CALL INITIATED!"),console.log(" Call ID:",H._id),console.log(" Room Name:",H.roomName),console.log(" Group:",m.name),console.log(" ========================================"),H&&H._id&&(ft(!1),Ge({callId:H._id,callType:"voice",groupId:m.id,roomName:H.roomName,group:{name:m.name,avatar:m.profileImage}}),we(!0),s.emit("group-call-initiate",{groupId:m.id,callType:"voice",callId:H._id}))}catch(N){console.error("Failed to initiate group call",N),console.error("Error response:",(j=N.response)==null?void 0:j.data);const H=((k=(C=N.response)==null?void 0:C.data)==null?void 0:k.message)||"Failed to initiate group call";D.error(H)}}}}),r.jsx($t,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var l,p,j,C,k;if(!(!m||m.type!=="group")){console.log(" Initiating group VIDEO call for:",m.id,m.name);try{const H=(p=(l=(await Tr.initiate(m.id,"video")).data)==null?void 0:l.data)==null?void 0:p.call;console.log(" ========================================"),console.log(" VIDEO CALL INITIATED!"),console.log(" Call ID:",H._id),console.log(" Room Name:",H.roomName),console.log(" Group:",m.name),console.log(" ========================================"),H&&H._id&&(ft(!1),Ge({callId:H._id,callType:"video",groupId:m.id,roomName:H.roomName,group:{name:m.name,avatar:m.profileImage}}),we(!0),s.emit("group-call-initiate",{groupId:m.id,callType:"video",callId:H._id}))}catch(N){console.error("Failed to initiate group video call",N),console.error("Error response:",(j=N.response)==null?void 0:j.data);const H=((k=(C=N.response)==null?void 0:C.data)==null?void 0:k.message)||"Failed to initiate group video call";D.error(H)}}}})]}),r.jsx(Ou,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800"})]})]}),m.type==="group"&&xt.length>0&&r.jsxs("div",{className:"bg-yellow-50 border-b border-yellow-200 px-4 py-2",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(On,{className:"w-4 h-4 text-yellow-600"}),r.jsxs("span",{className:"text-sm font-medium text-yellow-800",children:[xt.length," Pinned Message",xt.length>1?"s":""]})]}),r.jsx("button",{onClick:()=>Qs(!Wn),className:"text-xs text-yellow-700 hover:text-yellow-900 font-medium",children:Wn?"Hide":"Show"})]}),Wn&&r.jsx("div",{className:"mt-2 space-y-2 max-h-48 overflow-y-auto",children:xt.map(l=>{var p,j,C,k;return r.jsx("div",{className:"bg-white rounded-lg p-3 border border-yellow-200 shadow-sm hover:shadow-md transition-shadow cursor-pointer relative group",onClick:()=>{const N=document.getElementById(`message-${l._id||l.id}`);N&&(N.scrollIntoView({behavior:"smooth",block:"center"}),N.classList.add("ring-2","ring-blue-400"),setTimeout(()=>{N.classList.remove("ring-2","ring-blue-400")},2e3))},children:r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("div",{className:"flex-shrink-0 w-7 h-7 rounded-full overflow-hidden bg-gray-200",children:(p=l.sender)!=null&&p.profileImage?r.jsx("img",{src:`${Se}${l.sender.profileImage}`,alt:((j=l.sender)==null?void 0:j.name)||"User",className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-blue-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white text-xs font-medium",children:(((C=l.sender)==null?void 0:C.name)||"U").charAt(0).toUpperCase()})})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-xs font-medium text-gray-700",children:((k=l.sender)==null?void 0:k.name)||"User"}),r.jsx("p",{className:"text-sm text-gray-800 truncate",children:l.message||(l.fileUrl?" File attachment":"No content")})]}),r.jsx("button",{onClick:N=>{N.stopPropagation(),or(l,N)},className:"flex-shrink-0 p-1.5 rounded-full bg-red-100 hover:bg-red-200 text-red-600 transition-colors opacity-0 group-hover:opacity-100",title:"Unpin message",children:r.jsx(cr,{className:"w-4 h-4"})})]})},l._id||l.id)})})]}),r.jsx("div",{ref:hn,className:"flex-1 overflow-y-auto p-4 bg-gray-50 relative",children:r.jsxs("div",{className:"max-w-8xl mx-auto",children:[z&&r.jsx("div",{className:"flex justify-center py-2",children:r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})}),!z&&E&&R.length>0&&r.jsx("div",{className:"flex justify-center py-2",children:r.jsx("button",{onClick:()=>{var p,j,C;const l=((p=R[0])==null?void 0:p._id)||((j=R[0])==null?void 0:j.id);l&&(ks.current=((C=hn.current)==null?void 0:C.scrollHeight)||0,Qo(l))},className:"px-5 py-2.5 text-sm bg-gradient-to-br from-blue-400 to-blue-600 text-white rounded-full shadow-[3px_3px_10px_rgba(59,130,246,0.4),inset_-1px_-1px_6px_rgba(0,0,0,0.1),inset_1px_1px_6px_rgba(255,255,255,0.2)] hover:shadow-[4px_4px_14px_rgba(59,130,246,0.5),inset_-1px_-1px_6px_rgba(0,0,0,0.15),inset_1px_1px_6px_rgba(255,255,255,0.25)] hover:-translate-y-0.5 transition-all duration-200 font-medium",children:"Load Previous Messages"})}),Array.isArray(R)&&R.map((l,p)=>{var H,xe,Ne,Ee,Fe,ze,re;const j=p===0||(()=>{const ie=new Date(l.createdAt||l.timestamp),Pe=new Date(R[p-1].createdAt||R[p-1].timestamp),Le=new Date(ie.getFullYear(),ie.getMonth(),ie.getDate()),Je=new Date(Pe.getFullYear(),Pe.getMonth(),Pe.getDate());return Le.getTime()!==Je.getTime()})();let C=!1;if(typeof l.sender=="object"&&l.sender!==null){const ie=l.sender._id||l.sender.id;C=ie===e.id||ie===e._id||ie===((H=e.id)==null?void 0:H.toString())||ie===((xe=e._id)==null?void 0:xe.toString())}else C=l.sender===e.id||l.sender===e._id||l.sender===((Ne=e.id)==null?void 0:Ne.toString())||l.sender===((Ee=e._id)==null?void 0:Ee.toString());const k=typeof l.sender=="object"?(Fe=l.sender)==null?void 0:Fe.name:"User",N=typeof l.sender=="object"?(ze=l.sender)==null?void 0:ze.profileImage:null;return r.jsxs(zl.Fragment,{children:[j&&r.jsx("div",{className:"flex justify-center my-4",children:r.jsx("div",{className:"bg-gradient-to-br from-gray-200 to-gray-300 text-gray-700 text-xs px-4 py-2 rounded-full font-medium",children:wc(l.createdAt||l.timestamp)})}),r.jsx("div",{id:`message-${l._id||l.id}`,className:`flex ${C?"justify-end":"justify-start"} mb-4`,children:r.jsxs("div",{className:`flex items-start gap-2 max-w-sm lg:max-w-md ${C?"flex-row-reverse":"flex-row"}`,children:[r.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-300 flex-shrink-0",children:C?e.profileImage?r.jsx("img",{src:`${Se}${e.profileImage}`,alt:e.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white text-xs font-medium",children:e.name.charAt(0).toUpperCase()})}):N?r.jsx("img",{src:`${Se}${N}`,alt:k,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-gray-400 flex items-center justify-center",children:r.jsx("span",{className:"text-white text-xs font-medium",children:String(k).charAt(0).toUpperCase()})})}),r.jsxs("div",{className:`relative group flex flex-col px-4 py-3 rounded-2xl transition-all duration-200 ${C?"bg-gradient-to-br from-green-400 to-green-600 text-white rounded-br-md hover:-translate-y-0.5":"bg-gradient-to-br from-gray-100 to-gray-300 text-gray-900 rounded-bl-md hover:-translate-y-0.5"} ${ua&&qo&&Ct(qo)===Ct(l)?"ring-2 ring-blue-400":""}`,onMouseDown:()=>ct(l),onMouseUp:jt,onMouseLeave:jt,onTouchStart:()=>ct(l),onTouchEnd:jt,onContextMenu:ie=>{ie.preventDefault(),Zs(l),fa(!0),(m==null?void 0:m.type)==="group"&&Ln({x:ie.clientX,y:ie.clientY,message:l})},children:[l.messageType==="text"&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:ie=>Gt(Ct(l),ie),className:`absolute top-1 right-1 z-10 p-1 rounded-full transition-all duration-200 ${C?"bg-green-600/80 hover:bg-green-700/80 text-white":"bg-gray-300/80 hover:bg-gray-400/80 text-gray-700"} ${mn===Ct(l)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:r.jsx(ko,{className:"w-3 h-3"})}),mn===Ct(l)&&r.jsxs("div",{className:"message-dropdown-container absolute bottom-full right-1 mb-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[r.jsxs("button",{onClick:()=>rn("copy",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(Zr,{className:"w-4 h-4"}),"Copy"]}),(()=>{var Le,Je,qe,dt;const ie=((Le=l.sender)==null?void 0:Le.id)||((Je=l.sender)==null?void 0:Je._id)||l.sender;return ie===e.id||ie===e._id||ie===((qe=e.id)==null?void 0:qe.toString())||ie===((dt=e._id)==null?void 0:dt.toString())?r.jsxs("button",{onClick:()=>rn("edit",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(jn,{className:"w-4 h-4"}),"Edit"]}):null})(),r.jsxs("button",{onClick:()=>rn("forward",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(es,{className:"w-4 h-4"}),"Forward"]}),(m==null?void 0:m.type)==="group"&&r.jsx("button",{onClick:()=>{or(l),Wt(null)},className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:xt.some(ie=>(ie._id||ie.id)===(l._id||l.id))?r.jsxs(r.Fragment,{children:[r.jsx(cr,{className:"w-4 h-4"}),"Unpin"]}):r.jsxs(r.Fragment,{children:[r.jsx(On,{className:"w-4 h-4"}),"Pin"]})})]})]}),l.fileUrl&&r.jsx("div",{className:"mb-2",children:l.messageType==="image"?r.jsxs("div",{className:"relative group",onMouseDown:()=>ct(l),onMouseUp:jt,onMouseLeave:jt,onTouchStart:()=>ct(l),onTouchEnd:jt,children:[r.jsx("button",{onClick:ie=>Gt(Ct(l),ie),className:`absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 ${C?"bg-green-500/80 hover:bg-green-600/80 text-white":"bg-gray-500/80 hover:bg-gray-600/80 text-white"} ${mn===Ct(l)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:r.jsx(ko,{className:"w-3 h-3"})}),mn===Ct(l)&&r.jsxs("div",{className:"message-dropdown-container absolute bottom-full right-2 mb-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[r.jsxs("button",{onClick:()=>rn("copy",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(Zr,{className:"w-4 h-4"}),"Copy"]}),l.messageType==="text"&&(()=>{var Le,Je,qe,dt;const ie=((Le=l.sender)==null?void 0:Le.id)||((Je=l.sender)==null?void 0:Je._id)||l.sender;return ie===e.id||ie===e._id||ie===((qe=e.id)==null?void 0:qe.toString())||ie===((dt=e._id)==null?void 0:dt.toString())?r.jsxs("button",{onClick:()=>rn("edit",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(jn,{className:"w-4 h-4"}),"Edit"]}):null})(),r.jsxs("button",{onClick:()=>rn("forward",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(es,{className:"w-4 h-4"}),"Forward"]}),(m==null?void 0:m.type)==="group"&&r.jsx("button",{onClick:()=>{or(l),Wt(null)},className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:xt.some(ie=>(ie._id||ie.id)===(l._id||l.id))?r.jsxs(r.Fragment,{children:[r.jsx(cr,{className:"w-4 h-4"}),"Unpin"]}):r.jsxs(r.Fragment,{children:[r.jsx(On,{className:"w-4 h-4"}),"Pin"]})})]}),r.jsx("img",{src:nn(l.fileUrl),alt:l.fileName,className:`max-w-xs rounded-lg ${!C&&!Ze[l.id||l._id]?"blur-sm cursor-pointer":"cursor-pointer"} hover:opacity-90`,onClick:()=>{var ie;!C&&!Ze[l.id||l._id]?Vr(l.fileUrl,l.fileName,l.id||l._id):Re({src:nn(l.fileUrl),alt:l.fileName,sender:((ie=l.sender)==null?void 0:ie.name)||"User",timestamp:l.createdAt||l.timestamp})}}),!C&&!Ze[l.id||l._id]&&r.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-black/60 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1",children:[r.jsx(Jt,{className:"w-3 h-3"}),((l.fileSize||0)/1024/1024).toFixed(1)," MB"]}),Ie[l.id||l._id]&&r.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:r.jsxs("div",{className:"bg-black/60 rounded-lg px-3 py-2 text-center",children:[r.jsx("div",{className:"w-8 h-8 border-4 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-2"}),r.jsxs("p",{className:"text-sm text-white",children:[Ie[l.id||l._id].progress,"%"]})]})})]}):l.messageType==="video"?r.jsxs("div",{className:"relative group",onMouseDown:()=>ct(l),onMouseUp:jt,onMouseLeave:jt,onTouchStart:()=>ct(l),onTouchEnd:jt,children:[r.jsx("button",{onClick:ie=>Gt(Ct(l),ie),className:`absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 ${C?"bg-green-500/80 hover:bg-green-600/80 text-white":"bg-gray-500/80 hover:bg-gray-600/80 text-white"} ${mn===Ct(l)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:r.jsx(ko,{className:"w-3 h-3"})}),mn===Ct(l)&&r.jsxs("div",{className:"message-dropdown-container absolute bottom-full right-2 mb-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[r.jsxs("button",{onClick:()=>rn("copy",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(Zr,{className:"w-4 h-4"}),"Copy"]}),l.messageType==="text"&&(()=>{var Le,Je,qe,dt;const ie=((Le=l.sender)==null?void 0:Le.id)||((Je=l.sender)==null?void 0:Je._id)||l.sender;return ie===e.id||ie===e._id||ie===((qe=e.id)==null?void 0:qe.toString())||ie===((dt=e._id)==null?void 0:dt.toString())?r.jsxs("button",{onClick:()=>rn("edit",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(jn,{className:"w-4 h-4"}),"Edit"]}):null})(),r.jsxs("button",{onClick:()=>rn("forward",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(es,{className:"w-4 h-4"}),"Forward"]}),(m==null?void 0:m.type)==="group"&&r.jsx("button",{onClick:()=>{or(l),Wt(null)},className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:xt.some(ie=>(ie._id||ie.id)===(l._id||l.id))?r.jsxs(r.Fragment,{children:[r.jsx(cr,{className:"w-4 h-4"}),"Unpin"]}):r.jsxs(r.Fragment,{children:[r.jsx(On,{className:"w-4 h-4"}),"Pin"]})})]}),r.jsx("video",{src:nn(l.fileUrl),controls:!0,className:`max-w-xs rounded-lg ${!C&&!Ze[l.id||l._id]?"blur-sm":""} cursor-pointer`,onClick:()=>{var ie;!C&&!Ze[l.id||l._id]?Vr(l.fileUrl,l.fileName,l.id||l._id):lt({src:nn(l.fileUrl),alt:l.fileName,sender:((ie=l.sender)==null?void 0:ie.name)||"User",timestamp:l.createdAt||l.timestamp})}}),!C&&!Ze[l.id||l._id]&&r.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-black/60 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1",children:[r.jsx(Jt,{className:"w-3 h-3"}),((l.fileSize||0)/1024/1024).toFixed(1)," MB"]}),Ie[l.id||l._id]&&r.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:r.jsxs("div",{className:"bg-black/60 rounded-lg px-3 py-2 text-center",children:[r.jsx("div",{className:"w-8 h-8 border-4 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-2"}),r.jsxs("p",{className:"text-sm text-white",children:[Ie[l.id||l._id].progress,"%"]})]})})]}):r.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-white bg-opacity-20 rounded-lg relative cursor-pointer",onMouseDown:()=>ct(l),onMouseUp:jt,onMouseLeave:jt,onTouchStart:()=>ct(l),onTouchEnd:jt,onClick:()=>{var ie;!C&&!Ze[l.id||l._id]?Vr(l.fileUrl,l.fileName,l.id||l._id):tn({src:nn(l.fileUrl),fileName:l.fileName,fileSize:l.fileSize,fileType:l.fileType,sender:((ie=l.sender)==null?void 0:ie.name)||"User",timestamp:l.createdAt||l.timestamp})},children:[r.jsx(Xt,{className:"w-5 h-5"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium truncate",children:l.fileName}),r.jsxs("p",{className:"text-xs opacity-75",children:[(l.fileSize/1024/1024).toFixed(2)," MB"]})]}),!C&&!Ze[l.id||l._id]&&r.jsx("button",{onClick:ie=>{ie.stopPropagation(),Vr(l.fileUrl,l.fileName,l.id||l._id)},className:"p-1 hover:bg-white hover:bg-opacity-20 rounded",disabled:(re=Ie[l.id||l._id])==null?void 0:re.downloading,children:r.jsx(Jt,{className:"w-4 h-4"})}),Ie[l.id||l._id]&&r.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:r.jsxs("div",{className:"bg-white rounded-lg p-2 text-center",children:[r.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mx-auto mb-1"}),r.jsxs("p",{className:"text-xs text-white",children:[Ie[l.id||l._id].progress,"%"]})]})})]})}),l.message&&(nr&&Ct(nr)===Ct(l)?r.jsxs("div",{className:"mb-2",children:[r.jsx("input",{type:"text",value:Fr,onChange:ie=>vr(ie.target.value),className:"w-full px-2 py-1 text-sm bg-white bg-opacity-20 rounded border-none focus:outline-none focus:ring-1 focus:ring-white",autoFocus:!0,onKeyDown:ie=>{ie.key==="Enter"&&ma(),ie.key==="Escape"&&ha()}}),r.jsxs("div",{className:"flex gap-1 mt-1",children:[r.jsx("button",{onClick:ma,className:"text-xs px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700",children:"Save"}),r.jsx("button",{onClick:ha,className:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Cancel"})]})]}):r.jsxs("p",{className:"text-sm mb-1 break-words whitespace-pre-wrap",children:[l.message,(l.isEdited||l.editedAt)&&r.jsx("span",{className:"text-xs opacity-75 ml-1",children:"(edited)"})]})),r.jsxs("div",{className:`flex items-center gap-1 text-xs self-end ${C?"text-green-100":"text-gray-500"}`,children:[r.jsx("span",{children:new Date(l.createdAt||l.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),C&&r.jsx("span",{className:"ml-1 relative inline-flex items-center",title:l.isRead||l.readBy&&l.readBy.length>0?"Seen":"Delivered",children:l.isRead||l.readBy&&l.readBy.length>0?r.jsx("svg",{className:"w-4 h-4 text-blue-500",viewBox:"0 0 16 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:"M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z",fill:"currentColor"})}):r.jsx("svg",{className:"w-4 h-4 opacity-70",viewBox:"0 0 16 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:"M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z",fill:"currentColor"})})})]})]})]})})]},l.id||l._id||p)}),r.jsx("div",{ref:pa})]})}),r.jsx("div",{className:"bg-white border-t border-gray-200 p-4",children:m.type==="personal"&&m.isActive===!1?r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg px-4 py-3 w-full text-center",children:r.jsx("p",{className:"text-red-600 text-sm font-medium",children:"This user is disabled. You can view previous messages but cannot send new ones."})})}):r.jsxs("div",{className:"relative",children:[me&&r.jsx("div",{className:"file-options-container absolute bottom-16 left-4 bg-white rounded-lg shadow-lg border border-gray-200 p-2 z-50",children:r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs("button",{onClick:()=>to("image"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[r.jsx(In,{className:"w-8 h-8 text-green-600 mb-1"}),r.jsx("span",{className:"text-xs text-gray-700",children:"Image"})]}),r.jsxs("button",{onClick:()=>to("video"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[r.jsx($t,{className:"w-8 h-8 text-blue-600 mb-1"}),r.jsx("span",{className:"text-xs text-gray-700",children:"Video"})]}),r.jsxs("button",{onClick:()=>to("document"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[r.jsx(Xt,{className:"w-8 h-8 text-purple-600 mb-1"}),r.jsx("span",{className:"text-xs text-gray-700",children:"Document"})]})]})}),$&&r.jsx("div",{className:"mb-3 p-3 bg-gray-100 rounded-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[B?r.jsx("img",{src:B,alt:"Preview",className:"w-12 h-12 object-cover rounded"}):r.jsx(Xt,{className:"w-8 h-8 text-gray-500"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium",children:$.name}),r.jsxs("p",{className:"text-xs text-gray-500",children:[($.size/1024/1024).toFixed(2)," MB"]})]})]}),r.jsx("button",{onClick:br,className:"text-gray-500 hover:text-gray-700",children:""})]})}),r.jsxs("form",{onSubmit:no,className:"flex items-center space-x-3",children:[r.jsx("button",{type:"button",onClick:()=>ye(!me),className:"p-2 text-gray-500 hover:text-gray-700",title:"Attach file",children:r.jsx(jy,{className:"w-5 h-5"})}),r.jsx("div",{className:"flex-1 relative",children:r.jsx("textarea",{value:W,onChange:l=>F(l.target.value),onKeyDown:l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),(W.trim()||$)&&no(l))},onPaste:l=>{var j;const p=(j=l.clipboardData)==null?void 0:j.items;if(p)for(let C=0;C<p.length;C++){const k=p[C];if(k.type.indexOf("image")!==-1){l.preventDefault();const N=k.getAsFile();if(N){J(N);const H=new FileReader;H.onload=xe=>{ue(xe.target.result)},H.readAsDataURL(N),D.success("Image pasted! Ready to send")}break}}},placeholder:"Type a message",rows:1,className:"w-full py-2 px-4 bg-gray-100 rounded-2xl text-sm focus:outline-none focus:ring-2 focus:ring-green-400 resize-none overflow-y-auto max-h-32",style:{minHeight:"40px",whiteSpace:"pre-wrap",wordWrap:"break-word"}})}),r.jsx("button",{type:"submit",disabled:!W.trim()&&!$,className:"bg-green-500 text-white p-2 rounded-full hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:r.jsx(vc,{className:"w-5 h-5"})})]})]})})]}):r.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:r.jsxs("div",{className:"text-center",children:[r.jsx(hs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Welcome to WhatsApp Chat"}),r.jsx("p",{className:"text-gray-500 max-w-md",children:"Select a conversation from the sidebar to start messaging. Your conversations will appear on the left side."})]})})})]}),Ht&&bt&&r.jsx(r.Fragment,{children:bt.callType==="voice"?r.jsx(dm,{user:e,callData:bt,isIncoming:Ae,onCallEnd:()=>{Be(!1),pe(null),Oe(!1)},onCallAnswer:()=>{Oe(!1)},onCallDecline:()=>{Be(!1),pe(null),Oe(!1)}}):r.jsx(um,{user:e,callData:bt,isIncoming:Ae,onCallEnd:()=>{Be(!1),pe(null),Oe(!1)},onCallAnswer:()=>{Oe(!1)},onCallDecline:()=>{Be(!1),pe(null),Oe(!1)}})}),ve&&_e&&yr&&_e.callType==="video"&&r.jsx(hm,{callData:_e,onAccept:()=>{console.log(" ========================================"),console.log(" ACCEPTING INCOMING VIDEO CALL"),console.log(" Call ID:",_e.callId),console.log(" Room Name:",_e.roomName),console.log(" ========================================"),ft(!1),s&&(_e!=null&&_e.callId)&&(s.emit("group-call-join",{callId:_e.callId,groupId:_e.groupId}),console.log(" Socket notified - Jitsi will handle participants")),console.log(" Using Jitsi internal participant sync (no backend API needed)")},onDecline:()=>{we(!1),Ge(null),ft(!1),s&&(_e!=null&&_e.callId)&&s.emit("group-call-decline",{callId:_e.callId,groupId:_e.groupId})}}),ve&&_e&&!yr&&(_e.callType==="video"?r.jsx(mm,{user:e,callData:_e,onCallEnd:()=>{we(!1),Ge(null),ft(!1)}}):r.jsx(fm,{user:e,callData:_e,isIncoming:yr,onCallEnd:()=>{we(!1),Ge(null),ft(!1)},onCallAnswer:()=>{ft(!1)},onCallDecline:()=>{we(!1),Ge(null),ft(!1)}}))]})},XC=()=>{const{user:e}=fn(),{socket:t,isConnected:n,sendMessage:s,joinGroup:o,leaveGroup:i,onReceiveMessage:a,onReceiveGroupMessage:c,onMessageSent:d,getConnectionStatus:f,isUserOnline:x,getUserStatus:g}=Wo(),[b,_]=h.useState([]),[I,M]=h.useState([]),[v,w]=h.useState(null),[m,y]=h.useState([]),[R,U]=h.useState(""),[W,F]=h.useState(""),[Z,ae]=h.useState(!0),[se,te]=h.useState({}),[fe,L]=h.useState({}),[oe,P]=h.useState("all"),[q,Q]=h.useState(!1),[O,S]=h.useState(!1),E=50,[X,z]=h.useState(null),[G,V]=h.useState(null),[$,J]=h.useState(!1),[B,ue]=h.useState({}),[me,ye]=h.useState(0),[Ie,wt]=h.useState(!1),[Ze,Rt]=h.useState(()=>{try{const u=sessionStorage.getItem("downloadedMessages");return u?JSON.parse(u):{}}catch{return{}}}),[Ht,Be]=h.useState(!1),[bt,pe]=h.useState(null),[Ae,Oe]=h.useState(!1),[Qe,gt]=h.useState(null),[at,He]=h.useState(null),[$e,lt]=h.useState(null),[Ye,tn]=h.useState(null),[he,T]=h.useState(1),[de,ke]=h.useState({x:0,y:0}),[le,De]=h.useState(!1),[Me,tt]=h.useState(null),[Xe,St]=h.useState([]),[Dt,Ln]=h.useState(!1),[xt,kn]=h.useState(null),[Wn,Qs]=h.useState(()=>{try{const u=localStorage.getItem("pinnedChats");return u?JSON.parse(u):[]}catch{return[]}}),A=()=>{T(u=>Math.min(u*1.25,4))},ne=()=>{T(u=>Math.max(u/1.25,.5))},ee=()=>{T(1),ke({x:0,y:0})},Y=u=>{u.preventDefault(),De(!0),ke({x:u.clientX-de.x,y:u.clientY-de.y})},ge=u=>{le&&(u.preventDefault(),ke({x:u.clientX-de.x,y:u.clientY-de.y}))},Te=()=>{De(!1)},Re=u=>{He(u),T(1),ke({x:0,y:0})},[ve,we]=h.useState(!1),[_e,Ge]=h.useState(null),[yr,ft]=h.useState(!1),nn=u=>u&&(/^https?:\/\//i.test(u)?u:`${Se}${u}`),da=u=>u?u.includes("drive.google.com")||u.includes("googleapis.com"):!1,wc=u=>{if(!u)return"";const l=new Date(u),p=new Date,j=new Date(p.getFullYear(),p.getMonth(),p.getDate()),C=new Date(j);C.setDate(C.getDate()-1);const k=new Date(l.getFullYear(),l.getMonth(),l.getDate());return k.getTime()===j.getTime()?l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):k.getTime()===C.getTime()?"Yesterday":Math.floor((j-k)/(1e3*60*60*24))<7?l.toLocaleDateString([],{weekday:"short"}):l.toLocaleDateString([],{day:"numeric",month:"numeric",year:l.getFullYear()!==p.getFullYear()?"numeric":void 0})},bc=u=>{if(!u)return"";const l=new Date(u),p=new Date,j=new Date(p.getFullYear(),p.getMonth(),p.getDate()),C=new Date(j);C.setDate(C.getDate()-1);const k=new Date(l.getFullYear(),l.getMonth(),l.getDate());return k.getTime()===j.getTime()?"Today":k.getTime()===C.getTime()?"Yesterday":Math.floor((j-k)/(1e3*60*60*24))<7?l.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric"}):l.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric",year:l.getFullYear()!==p.getFullYear()?"numeric":void 0})},Xs=u=>{if(!u)return"Last seen recently";const l=new Date,p=new Date(u),j=l-p,C=Math.floor(j/(1e3*60)),k=Math.floor(j/(1e3*60*60)),N=Math.floor(j/(1e3*60*60*24));return C<1?"Online":C<60?`Last seen ${C} minute${C===1?"":"s"} ago`:k<24?`Last seen ${k} hour${k===1?"":"s"} ago`:N===1?"Last seen yesterday":N<7?`Last seen ${N} day${N===1?"":"s"} ago`:`Last seen ${p.toLocaleDateString([],{month:"short",day:"numeric"})}`},[Ns,ua]=h.useState(null),[fa,qo]=h.useState(!1),[Zs,nr]=h.useState(null),[rr,Fr]=h.useState(null),[vr,mn]=h.useState(""),[Wt,Ct]=h.useState(null),ct=u=>((u==null?void 0:u.id)||(u==null?void 0:u._id)||(u==null?void 0:u.messageId)||"").toString(),jt=u=>{Ns&&clearTimeout(Ns);const l=setTimeout(()=>{nr(u),qo(!0)},700);ua(l)},Gt=()=>{Ns&&(clearTimeout(Ns),ua(null))},rn=(u,l)=>{l.stopPropagation(),Ct(Wt===u?null:u)},Sn=(u,l)=>{switch(nr(l),Ct(null),u){case"copy":ha(l);break;case"edit":Yo(l);break;case"forward":pa(l);break}},jc=async u=>{try{const l=await zt.getPinnedMessages(u);St(l.data.pinnedMessages||[])}catch(l){console.error("Error fetching pinned messages:",l)}},Ko=async(u,l)=>{var p,j;if(l&&l.stopPropagation(),!v||v.type!=="group"){D.error("You can only pin messages in groups");return}try{Xe.some(k=>k._id===u._id||k.id===u._id)?(await zt.unpinMessage(v.id,u._id||u.id),St(k=>k.filter(N=>(N._id||N.id)!==(u._id||u.id))),D.success("Message unpinned")):(await zt.pinMessage(v.id,u._id||u.id),St(k=>[...k,u]),D.success("Message pinned"))}catch(C){console.error("Error toggling pin message:",C),D.error(((j=(p=C.response)==null?void 0:p.data)==null?void 0:j.message)||"Failed to pin/unpin message")}},ma=(u,l,p)=>{p.stopPropagation();const j=`${u}-${l}`;Qs(C=>{let k;return C.includes(j)?(k=C.filter(N=>N!==j),D.success("Chat unpinned")):(k=[...C,j],D.success("Chat pinned")),localStorage.setItem("pinnedChats",JSON.stringify(k)),k})},ha=async u=>{try{const l=(u==null?void 0:u.messageType)==="text"?(u==null?void 0:u.message)||"":nn(u==null?void 0:u.fileUrl)||(u==null?void 0:u.fileName)||"";l&&(await navigator.clipboard.writeText(l),D.success("Copied to clipboard"))}catch(l){console.error("Copy failed:",l),D.error("Failed to copy")}},pa=u=>{try{sessionStorage.setItem("forwardMessage",JSON.stringify({id:u.id||u._id,message:u.message,messageType:u.messageType,fileUrl:u.fileUrl,fileName:u.fileName,fileSize:u.fileSize,fileType:u.fileType})),D.success("Message ready to forward"),window.location.href="/forward"}catch(l){console.error("Forward setup failed:",l),D.error("Failed to prepare message for forwarding")}},Yo=u=>{var l,p,j,C;if(u&&u.messageType==="text"){const k=((l=u.sender)==null?void 0:l.id)||((p=u.sender)==null?void 0:p._id)||u.sender;k===e.id||k===e._id||k===((j=e.id)==null?void 0:j.toString())||k===((C=e._id)==null?void 0:C.toString())?(Fr(u),mn(u.message||"")):D.error("You can only edit your own messages")}},hn=async()=>{if(!(!rr||!vr.trim()))try{y(u=>u.map(l=>ct(l)===ct(rr)?{...l,message:vr.trim(),isEdited:!0,editedAt:new Date().toISOString()}:l)),await yt.editMessage(rr.id||rr._id,vr.trim()),Fr(null),mn("")}catch(u){console.error("Failed to edit message:",u),D.error("Failed to edit message")}},ks=()=>{Fr(null),mn("")},zr=h.useRef(null),Br=h.useRef(!0),pn=h.useRef(null),wr=h.useRef(0),Ss=h.useRef(null);h.useEffect(()=>((async()=>{try{console.log(" Loading chat state from database...");const l=await yt.getChatState(),{personalChats:p,groupChats:j}=l.data,C={},k={};p.forEach(N=>{var H,xe,Ne;N.unreadCount>0?C[N.chatId]=N.unreadCount:delete C[N.chatId],N.lastMessage&&N.lastMessage.message&&(k[N.chatId]={id:N.lastMessage._id||N.lastMessage.id,message:N.lastMessage.message,senderName:N.lastMessage.senderName||((H=N.lastMessage.sender)==null?void 0:H.name)||"User",senderId:N.lastMessage.senderId||((xe=N.lastMessage.sender)==null?void 0:xe._id)||((Ne=N.lastMessage.sender)==null?void 0:Ne.id),timestamp:N.lastMessage.createdAt||N.lastMessage.timestamp})}),j.forEach(N=>{var H,xe,Ne;N.unreadCount>0?C[N.chatId]=N.unreadCount:delete C[N.chatId],N.lastMessage&&N.lastMessage.message&&(k[N.chatId]={id:N.lastMessage._id||N.lastMessage.id,message:N.lastMessage.message,senderName:N.lastMessage.senderName||((H=N.lastMessage.sender)==null?void 0:H.name)||"User",senderId:N.lastMessage.senderId||((xe=N.lastMessage.sender)==null?void 0:xe._id)||((Ne=N.lastMessage.sender)==null?void 0:Ne.id),timestamp:N.lastMessage.createdAt||N.lastMessage.timestamp})}),te(C),L(k),console.log(" Chat state loaded from database:",{unreadCounts:C,lastMessages:Object.keys(k).length})}catch(l){console.error("Error loading chat state from database:",l)}})(),ga(),()=>{Lt.removeAllListeners(),Lt.healthCheckInterval&&(clearInterval(Lt.healthCheckInterval),delete Lt.healthCheckInterval)}),[]),h.useEffect(()=>{if(t)return console.log(" Setting up PERSISTENT call listeners for Chat Page..."),t.off("incoming-call"),t.on("incoming-call",u=>{var l;console.log(" Chat Page - Incoming call received:",u),D.success(`Incoming ${u.callType} call from ${((l=u.caller)==null?void 0:l.name)||"Unknown"}`,{duration:5e3,icon:""}),Oe(!0),pe({callId:u.callId,callType:u.callType,caller:u.caller}),Be(!0)}),t.off("call-initiated"),t.on("call-initiated",u=>{console.log(" Chat Page - Call initiated:",u),Oe(!1),pe({callId:u.callId,callType:u.callType,otherUser:u.receiver}),Be(!0)}),t.off("call-error"),t.on("call-error",u=>{console.error(" Chat Page - Call error:",u),D.error(u.error||"Call failed",{duration:4e3})}),t.off("incoming-group-call"),t.on("incoming-group-call",u=>{var l,p;console.log(" ========================================"),console.log(" Chat Page - INCOMING GROUP CALL RECEIVED!"),console.log(" Call ID:",u.callId),console.log(" Call Type:",u.callType),console.log(" Room Name:",u.roomName),console.log(" Group:",u.groupName),console.log(" Initiator:",(l=u.initiator)==null?void 0:l.name),console.log(" ========================================"),D.success(`Incoming group ${u.callType} call from ${((p=u.initiator)==null?void 0:p.name)||"Unknown"} in ${u.groupName}`,{duration:5e3,icon:""}),ft(!0),Ge({callId:u.callId,callType:u.callType,groupId:u.groupId,roomName:u.roomName,group:u.group||{name:u.groupName},initiator:u.initiator}),we(!0)}),t.off("group-call-initiated"),t.on("group-call-initiated",u=>{console.log(" ========================================"),console.log(" Chat Page - GROUP CALL INITIATED!"),console.log(" Call ID:",u.callId),console.log(" Room Name:",u.roomName),console.log(" Call Type:",u.callType),console.log(" ========================================"),ft(!1),Ge({callId:u.callId,callType:u.callType,groupId:u.groupId,roomName:u.roomName,group:u.group}),we(!0)}),t.off("group-call-error"),t.on("group-call-error",u=>{console.error(" Chat Page - Group call error:",u),D.error(u.error||"Group call failed",{duration:4e3})}),()=>{console.log(" Cleaning up PERSISTENT call listeners..."),t.off("incoming-call"),t.off("call-initiated"),t.off("call-error"),t.off("incoming-group-call"),t.off("group-call-initiated"),t.off("group-call-error")}},[t]),h.useEffect(()=>{const u=j=>{console.log(" Chat Page - Received Service Worker Message:",j.data);const C=j.data;if(!C||!C.type){console.warn("Invalid message received from service worker");return}if(C.type==="notification-clicked"||C.type==="answer-call"){console.log(" Processing notification click/answer:",C.type);const k=C.data;if(!k){console.warn("No notification data found");return}if(k.type==="incoming-call"){console.log(" Showing incoming call UI from notification click"),console.log("Call data:",k);const N={callId:k.callId,callType:k.callType||"voice",caller:{_id:k.senderId,name:k.senderName,profileImage:k.senderImage}};console.log("Setting call UI with data:",N),Oe(!0),pe(N),Be(!0),D.success(`Incoming ${N.callType} call from ${N.caller.name}`,{duration:5e3,icon:""})}else if(k.type==="incoming-group-call"){console.log(" Showing incoming group call UI from notification click"),console.log("Group call data:",k);const N={callId:k.callId,callType:k.callType||"voice",groupId:k.groupId,roomName:k.roomName,group:{_id:k.groupId,name:k.groupName},initiator:{_id:k.senderId,name:k.senderName,profileImage:k.senderImage}};console.log("Setting group call UI with data:",N),ft(!0),Ge(N),we(!0),D.success(`Incoming group ${N.callType} call from ${N.initiator.name}`,{duration:5e3,icon:""})}}else C.type==="decline-call"&&(console.log(" Declining call from notification"),Be(!1),we(!1),pe(null),Ge(null))};console.log(" Setting up service worker message listener"),navigator.serviceWorker?(navigator.serviceWorker.addEventListener("message",u),console.log(" Service worker message listener attached")):console.warn(" Service worker not available");const p=new URLSearchParams(window.location.search).get("notificationData");if(p){console.log(" Found notification data in URL");try{const j=atob(p),C=JSON.parse(j);console.log(" Notification data from URL:",C),u({data:C}),window.history.replaceState({},document.title,window.location.pathname)}catch(j){console.error("Error parsing notification data from URL:",j)}}return()=>{console.log(" Removing service worker message listener"),navigator.serviceWorker&&navigator.serviceWorker.removeEventListener("message",u)}},[]),h.useEffect(()=>{const u=()=>{tt(null),kn(null)},l=p=>{p.key==="Escape"&&(tt(null),kn(null))};if(Me||xt)return window.addEventListener("scroll",u,!0),window.addEventListener("keydown",l),()=>{window.removeEventListener("scroll",u,!0),window.removeEventListener("keydown",l)}},[Me,xt]),h.useEffect(()=>{m.length>0&&setTimeout(()=>{Xo()},100)},[m,v]),h.useEffect(()=>(v&&(y([]),Q(!1),S(!1),Br.current=!0,Vr(),sr(),v.type==="group"?(o(v.id),jc(v.id),console.log(" Joined group room for:",v.name)):St([])),()=>{Lt.removeAllListeners(),v&&v.type==="group"&&(i(v.id),console.log(" Left group room for:",v.name)),Lt.healthCheckInterval&&(clearInterval(Lt.healthCheckInterval),delete Lt.healthCheckInterval)}),[v]),h.useEffect(()=>{if(m.length>0){if(Br.current)setTimeout(()=>{Xo(!0),Br.current=!1},100);else if(pn.current){const u=pn.current,l=u.scrollHeight,p=u.scrollTop,j=u.clientHeight;l-p-j<200&&Xo(!1)}}},[m]);const Jo=()=>{!pn.current||O||!q||!v||(Ss.current&&clearTimeout(Ss.current),Ss.current=setTimeout(()=>{var p,j;if(!pn.current||O||!q)return;const u=pn.current;if(u.scrollTop<50&&m.length>0){wr.current=u.scrollHeight;const C=((p=m[0])==null?void 0:p._id)||((j=m[0])==null?void 0:j.id);C&&Vr(C)}},150))};h.useEffect(()=>{const u=pn.current;if(!(!u||!v))return u.addEventListener("scroll",Jo),()=>{u.removeEventListener("scroll",Jo),Ss.current&&clearTimeout(Ss.current)}},[m,O,q,v]);const eo=async()=>{try{console.log(" Refreshing chat state from database...");const u=await yt.getChatState(),{personalChats:l,groupChats:p}=u.data,j={},C={};l.forEach(k=>{var N,H,xe;k.unreadCount>0&&(j[k.chatId]=k.unreadCount),k.lastMessage&&k.lastMessage.message&&(C[k.chatId]={id:k.lastMessage._id||k.lastMessage.id,message:k.lastMessage.message,senderName:k.lastMessage.senderName||((N=k.lastMessage.sender)==null?void 0:N.name)||"User",senderId:k.lastMessage.senderId||((H=k.lastMessage.sender)==null?void 0:H._id)||((xe=k.lastMessage.sender)==null?void 0:xe.id),timestamp:k.lastMessage.createdAt||k.lastMessage.timestamp})}),p.forEach(k=>{var N,H,xe;k.unreadCount>0&&(j[k.chatId]=k.unreadCount),k.lastMessage&&k.lastMessage.message&&(C[k.chatId]={id:k.lastMessage._id||k.lastMessage.id,message:k.lastMessage.message,senderName:k.lastMessage.senderName||((N=k.lastMessage.sender)==null?void 0:N.name)||"User",senderId:k.lastMessage.senderId||((H=k.lastMessage.sender)==null?void 0:H._id)||((xe=k.lastMessage.sender)==null?void 0:xe.id),timestamp:k.lastMessage.createdAt||k.lastMessage.timestamp})}),te(j),L(C),console.log(" Chat state refreshed from database")}catch(u){console.error("Error refreshing chat state:",u)}};h.useEffect(()=>{window.testSocket=()=>{Lt.testConnection()},window.checkSocket=()=>{Lt.logConnectionStatus()},window.forceSocketConnect=()=>{Lt.forceConnectionTest()},console.log(" Socket debugging methods available:"),console.log(" - testSocket() - Test socket connection status"),console.log(" - checkSocket() - Show current socket status"),console.log(" - forceSocketConnect() - Force reconnection")},[]);const ga=async()=>{try{ae(!0);const[u,l]=await Promise.all([an.getActiveUsers(),zt.getMyGroups()]);console.log(" Chat Data Loaded:"),console.log(" Users:",u.data.length),console.log(" Groups:",l.data.length),console.log(" Group Details:",l.data.map(p=>{var j;return{id:p.id,name:p.name,members:((j=p.members)==null?void 0:j.length)||0,avatar:p.avatar?"Has Avatar":"No Avatar"}})),_(u.data.filter(p=>p.id!==e.id)),M(l.data),sr()}catch(u){console.error("Error fetching initial data:",u),D.error("Failed to load chat data")}finally{ae(!1)}},sr=()=>{console.log(" Setting up enhanced socket listeners with Context API...");const u=f();console.log(" Current socket status:",u),a(l=>{var xe,Ne;console.log(" CHATROOM CONTEXT - received message:",l);const p=typeof l.sender=="object"?l.sender.id||l.sender._id:l.sender,j=typeof l.receiver=="object"?l.receiver.id||l.receiver._id:l.receiver,C=l.id||l._id||l.messageId,k=l.message||l.content,N=p===e.id||p===e._id||p===((xe=e.id)==null?void 0:xe.toString())||p===((Ne=e._id)==null?void 0:Ne.toString());if(l._isConfirmation||l.isConfirmMessage||l.isMessageSentConfirmation){console.log(" Skipping confirmation message");return}const H=Qo(l,v,e);if(console.log(" ENHANCED MESSAGE FILTERING:",{senderId:p,receiverId:j,messageId:C,messageText:k,selectedChatId:v==null?void 0:v.id,selectedChatType:v==null?void 0:v.type,currentUserId:e.id,isCurrentUserSender:N,isForCurrentChat:H,messageData:l}),H&&v)console.log(" Processing message for current active chat"),N?console.log(" Message from current user - handled by optimistic updates"):(console.log(" Adding external message to current chat immediately"),y(Ee=>{if(Ee.some(re=>{var dt,sn;const ie=re.id||re._id||re.messageId,Pe=re.message||re.content,Le=((dt=re.sender)==null?void 0:dt.id)||((sn=re.sender)==null?void 0:sn._id)||re.sender,Je=re.createdAt||re.timestamp,qe=l.createdAt||l.timestamp;return!!(ie===C&&C||Pe===k&&String(Le)===String(p)&&qe&&Je&&Math.abs(new Date(qe)-new Date(Je))<5e3||re.isOptimistic&&Pe===k&&String(Le)===String(p)&&qe&&Je&&Math.abs(new Date(qe)-new Date(Je))<1e4)}))return console.log(" Enhanced detection: Message already exists - confirmed duplicate",{messageId:C,messageText:k==null?void 0:k.substring(0,20),senderId:p,isDuplicate:!0}),Ee;console.log(" REAL-TIME: NEW message confirmed - Adding to active chat",{messageId:C,messageText:k==null?void 0:k.substring(0,20),senderId:p,isDuplicate:!1});const ze=to(l,p);return br(v.id,l,p),setTimeout(()=>{eo()},100),[...Ee,ze]}));else if(k&&!N){const Ee=p||l.sender;Ee&&Ee!==e.id&&(console.log(" Incrementing unread count for chat:",Ee),te(Fe=>({...Fe,[Ee]:(Fe[Ee]||0)+1})),br(Ee,l,p),setTimeout(()=>{eo()},100))}}),d(l=>{console.log(" Message sent confirmation received:",l),l&&l.id&&y(p=>{const j=p.filter(k=>!k.isOptimistic),C={id:l.id,message:l.message,messageType:l.messageType||"text",fileUrl:l.fileUrl,fileName:l.fileName,fileSize:l.fileSize,fileType:l.fileType,sender:l.sender,createdAt:l.createdAt||l.timestamp,timestamp:l.timestamp,isOptimistic:!1};return[...j,C]})}),c(l=>{var xe,Ne,Ee,Fe;console.log(" GROUP MESSAGE CONTEXT - received message:",l);const p=typeof l.sender=="object"?l.sender.id||l.sender._id:l.sender,j=l.groupId||((xe=l.group)==null?void 0:xe.id)||((Ne=l.group)==null?void 0:Ne._id),C=l.id||l._id||l.messageId,k=l.message||l.content,N=p===e.id||p===e._id||p===((Ee=e.id)==null?void 0:Ee.toString())||p===((Fe=e._id)==null?void 0:Fe.toString());if(l._isConfirmation||l.isConfirmMessage||l.isMessageSentConfirmation){console.log(" Skipping confirmation message");return}const H=v&&v.type==="group"&&(j===v.id||String(j)===String(v.id));if(console.log(" GROUP MESSAGE FILTERING:",{senderId:p,groupId:j,messageId:C,messageText:k,selectedChatId:v==null?void 0:v.id,selectedChatType:v==null?void 0:v.type,currentUserId:e.id,isCurrentUserSender:N,isForCurrentGroup:H,messageData:l}),H&&v)console.log(" Processing group message for current group"),N?console.log(" Group message from current user - handled by optimistic updates"):(console.log(" Adding external group message to current chat immediately"),y(ze=>{if(ze.some(Pe=>{var Un,Es;const Le=Pe.id||Pe._id||Pe.messageId,Je=Pe.message||Pe.content,qe=((Un=Pe.sender)==null?void 0:Un.id)||((Es=Pe.sender)==null?void 0:Es._id)||Pe.sender,dt=Pe.createdAt||Pe.timestamp,sn=l.createdAt||l.timestamp;return!!(Le===C&&C||Je===k&&String(qe)===String(p)&&sn&&dt&&Math.abs(new Date(sn)-new Date(dt))<5e3||Pe.isOptimistic&&Je===k&&String(qe)===String(p)&&sn&&dt&&Math.abs(new Date(sn)-new Date(dt))<1e4)}))return console.log(" GROUP duplicate detection: Message already exists",{messageId:C,messageText:k==null?void 0:k.substring(0,20),senderId:p==null?void 0:p.toString(),isDuplicate:!0}),ze;console.log(" GROUP REAL-TIME: NEW message confirmed - Adding to active group",{messageId:C,messageText:k==null?void 0:k.substring(0,20),senderId:p,groupId:j});const ie=to(l,p);return br(v.id,l,p),setTimeout(()=>{eo()},100),[...ze,ie]}));else if(k&&!N){const ze=j||l.groupId;ze&&(!v||v.type!=="group"||String(ze)!==String(v.id))&&(console.log(" Incrementing unread count for group:",ze),te(ie=>({...ie,[ze]:(ie[ze]||0)+1})),br(ze,l,p),setTimeout(()=>{eo()},100))}}),t&&(t.off("avatar-updated"),t.on("avatar-updated",l=>{var j,C;console.log(" Profile updated received:",l);const p=((j=l.userId)==null?void 0:j.toString())||l.userId;_(k=>k.map(N=>{var H;return((H=N.id||N._id)==null?void 0:H.toString())===p?{...N,profileImage:l.profileImage,name:l.name}:N})),v&&v.type==="personal"&&((C=v.id||v._id)==null?void 0:C.toString())===p&&w(k=>({...k,profileImage:l.profileImage,name:l.name})),y(k=>k.map(N=>{var xe,Ne,Ee;return((Ee=((xe=N.sender)==null?void 0:xe.id)||((Ne=N.sender)==null?void 0:Ne._id)||N.sender)==null?void 0:Ee.toString())===p?{...N,sender:{...typeof N.sender=="object"?N.sender:{id:N.sender},profileImage:l.profileImage,name:l.name}}:N}))}),t.off("messages-seen"),t.on("messages-seen",l=>{console.log(" Messages seen by user:",l.readBy),v&&v.type==="personal"&&l.chatId===v.id&&y(p=>p.map(j=>{var k,N;return(((k=j.sender)==null?void 0:k.id)||((N=j.sender)==null?void 0:N._id)||j.sender)===e.id?{...j,isRead:!0,readBy:[{user:l.readBy,readAt:l.timestamp}]}:j}))}))},Qo=(u,l,p)=>{var N,H,xe,Ne;if(!l)return!1;const j=((N=u.sender)==null?void 0:N.id)||((H=u.sender)==null?void 0:H._id)||u.sender,C=((xe=u.receiver)==null?void 0:xe.id)||((Ne=u.receiver)==null?void 0:Ne._id)||u.receiver,k=u.chatId||u.chatRoom;return l.type==="personal"&&l.id&&(j===l.id&&C===p.id||j===p.id&&C===l.id||String(j)===String(l.id)||String(C)===String(l.id))?!0:l.type==="group"?k===l.id||u.groupId===l.id:!1},to=(u,l)=>{var p,j;return{id:u.id||u._id||u.messageId,message:u.message||u.content,messageType:u.messageType||"text",fileUrl:u.fileUrl,fileName:u.fileName,fileSize:u.fileSize,fileType:u.fileType,sender:typeof u.sender=="object"?u.sender:{id:l,name:u.senderName||((p=u.sender)==null?void 0:p.name)||"User",profileImage:u.senderProfileImage||((j=u.sender)==null?void 0:j.profileImage)},createdAt:u.createdAt||u.timestamp||new Date().toISOString(),timestamp:u.timestamp||u.createdAt,isFromOtherUser:!(l===e.id||l===e._id)}},br=(u,l,p)=>{var k;const j=p===e.id||p===e._id,C={id:l.id||l._id||l.messageId,message:l.message||l.content,senderName:j?"You":l.senderName||((k=l.sender)==null?void 0:k.name)||"User",senderId:p,timestamp:l.createdAt||l.timestamp||new Date().toISOString()};L(N=>({...N,[u]:C}))},Vr=async(u=null)=>{var l;try{u&&S(!0);let p;const j={limit:E};if(u&&(j.before=u),v.type==="personal"){if(!v.id){console.error("User ID is undefined for personal chat");return}p=await yt.getPersonalMessages(v.id,j)}else{if(!v.id){console.error("Group ID is undefined for group chat");return}p=await yt.getGroupMessages(v.id,j)}let C,k;if(p.data&&typeof p.data=="object"?Array.isArray(p.data.messages)?(C=p.data.messages,k=p.data.hasMore||!1):Array.isArray(p.data)?(C=p.data,k=p.data.length>=E):(C=[],k=!1):(C=[],k=!1),u)y(N=>{const H=new Set(N.map(Ne=>Ne._id||Ne.id));return[...C.filter(Ne=>{const Ee=Ne._id||Ne.id;return!H.has(Ee)}),...N]}),Q(k),S(!1),setTimeout(()=>{if(pn.current&&wr.current>0){const H=pn.current.scrollHeight-wr.current;pn.current.scrollTop=H+100}},0);else if(y(C||[]),Q(k),C&&C.length>0){const N=C[C.length-1];br(v.id,N,((l=N.sender)==null?void 0:l.id)||N.sender)}}catch(p){console.error("Error fetching messages:",p),D.error("Failed to load messages"),y([]),u&&S(!1)}},no=u=>{const l=document.createElement("input");l.type="file",l.style.display="none",u==="image"?l.accept="image/*":u==="video"?l.accept="video/*":u==="document"&&(l.accept=".pdf,.doc,.docx,.txt,.csv,.xls,.xlsx,.ppt,.pptx,.xlsm,.xlsx,.zip,.rar,.7z,.tar,.gz,.bz2,.xz,.iso,.dmg,.img,.bin,.exe,.msi,.dmg,.iso,.tar,.gz,.bz2,.xz,.img,.bin,.exe,.msi"),l.onchange=p=>{const j=p.target.files[0];if(j){if(z(j),j.type.startsWith("image/")){const C=new FileReader;C.onload=k=>V(k.target.result),C.readAsDataURL(j)}else V(null);J(!1)}},document.body.appendChild(l),l.click(),document.body.removeChild(l)},Cs=()=>{z(null),V(null)},ro=async(u,l,p)=>{try{ue(ze=>({...ze,[p]:{progress:0,downloading:!0}}));const j=await fetch(nn(u)),C=j.headers.get("content-length"),k=parseInt(C,10);if(!j.ok)throw new Error("Download failed");const N=j.body.getReader(),H=[];let xe=0;for(;;){const{done:ze,value:re}=await N.read();if(ze)break;H.push(re),xe+=re.length;const ie=k?Math.round(xe/k*100):0;ue(Pe=>({...Pe,[p]:{progress:ie,downloading:!0}}))}const Ne=new Blob(H),Ee=window.URL.createObjectURL(Ne),Fe=document.createElement("a");Fe.href=Ee,Fe.download=l,document.body.appendChild(Fe),Fe.click(),document.body.removeChild(Fe),window.URL.revokeObjectURL(Ee),ue(ze=>({...ze,[p]:{progress:100,downloading:!1}})),Rt(ze=>{const re={...ze,[p]:!0};try{sessionStorage.setItem("downloadedMessages",JSON.stringify(re))}catch{}return re}),setTimeout(()=>{ue(ze=>{const re={...ze};return delete re[p],re})},2e3)}catch(j){console.error("Download failed:",j),ue(C=>({...C,[p]:{progress:0,downloading:!1,error:!0}}))}};h.useEffect(()=>{const u=l=>{$&&!l.target.closest(".file-options-container")&&J(!1),Wt&&!l.target.closest(".message-dropdown-container")&&Ct(null)};return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[$,Wt]);const xa=async u=>{if(u.preventDefault(),!R.trim()&&!X||!v)return;const l=R.trim();U("");try{let p,j="text";X&&(X.type.startsWith("image/")?j="image":X.type.startsWith("video/")?j="video":j="file");const C={id:Date.now(),message:l||(X?X.name:""),messageType:j,fileUrl:X?URL.createObjectURL(X):null,fileName:X?X.name:null,fileSize:X?X.size:null,fileType:X?X.type:null,sender:{id:e.id,name:e.name,profileImage:e.profileImage},createdAt:new Date().toISOString(),timestamp:new Date().toISOString(),isOptimistic:!0};if(y(k=>[...k,C]),br(v.id,{id:C.id,message:C.message,createdAt:C.createdAt},e.id),X){wt(!0),ye(0);const k=new FormData;k.append("file",X),k.append("message",l);const N=H=>{const xe=Math.round(H.loaded*100/H.total);ye(xe),console.log(` Upload progress: ${xe}%`)};try{v.type==="personal"?(k.append("receiver",v.id),p=await yt.sendPersonalMessage(k,N)):(k.append("group",v.id),p=await yt.sendGroupMessage(k,N)),D.success(`File uploaded successfully! (${(X.size/(1024*1024)).toFixed(2)}MB)`)}finally{wt(!1),ye(0),Cs()}}else if(v.type==="personal")try{await s(v.id,l,"text",!1),console.log(" Message sent via context socket")}catch(k){console.warn("Context socket failed, trying API:",k),await yt.sendPersonalMessage({sender:e.id,receiver:v.id,message:l,timestamp:new Date().toISOString()})}else try{await s(v.id,l,"text",!0),console.log(" Group message sent via context socket")}catch(k){console.warn("Context group socket failed, trying API:",k),await yt.sendGroupMessage({sender:e.id,group:v.id,message:l,timestamp:new Date().toISOString()})}console.log(" Message sent successfully")}catch(p){console.error(" Failed to send message:",p),D.error("Failed to send message"),y(j=>j.filter(C=>!C.isOptimistic))}},Xo=(u=!1)=>{var l;(l=zr.current)==null||l.scrollIntoView({behavior:u?"instant":"smooth"})},or=[...b.map(u=>({id:u.id,name:u.name,email:u.email,type:"personal",avatar:u.name.charAt(0).toUpperCase(),profileImage:u.profileImage,lastMessage:fe[u.id]||null})),...I.map(u=>{var l;return{id:u.id,name:u.name,email:`${((l=u.members)==null?void 0:l.length)||0} members`,type:"group",avatar:u.avatar?`${Se}${u.avatar}`:"G",profileImage:u.avatar,lastMessage:fe[u.id]||null}})].sort((u,l)=>{var xe,Ne;const p=`${u.type}-${u.id}`,j=`${l.type}-${l.id}`,C=Wn.includes(p),k=Wn.includes(j);if(C&&!k)return-1;if(!C&&k)return 1;const N=(xe=u.lastMessage)!=null&&xe.timestamp?new Date(u.lastMessage.timestamp).getTime():0;return((Ne=l.lastMessage)!=null&&Ne.timestamp?new Date(l.lastMessage.timestamp).getTime():0)-N}),Nc=(()=>{let u=or;switch(oe){case"unread":u=or.filter(l=>se[l.id]>0);break;case"groups":u=or.filter(l=>l.type==="group");break;case"all":default:u=or;break}return u.filter(l=>l.name.toLowerCase().includes(W.toLowerCase())||l.email.toLowerCase().includes(W.toLowerCase()))})();return Z?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"})}):r.jsxs("div",{className:"h-screen bg-gray-50 flex",children:[r.jsxs("div",{className:"w-full h-screen flex bg-white shadow-lg",children:[r.jsxs("div",{className:"w-1/3 min-w-[300px] max-w-[400px] bg-white border-r border-gray-200 flex flex-col",children:[r.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("button",{onClick:()=>window.history.back(),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",title:"Go back",children:r.jsx(xr,{className:"w-5 h-5"})}),r.jsx("h2",{className:"text-lg text-start font-semibold text-gray-800",children:"Admin Chat"}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:()=>window.location.href="/profile",className:"text-gray-500 hover:text-gray-700",title:"Profile",children:r.jsx(Nn,{className:"w-5 h-5"})}),r.jsx(Ou,{className:"w-5 h-5 text-gray-500 cursor-pointer hover:text-gray-700"})]})]}),r.jsx("div",{className:"flex items-center space-x-3 mb-3",children:r.jsxs("button",{onClick:()=>window.location.href="/profile",className:"flex items-center space-x-3 hover:opacity-80 transition-opacity",children:[e.profileImage?r.jsx("img",{src:`${Se}${e.profileImage}`,alt:"Profile",className:"w-10 h-10 rounded-full object-cover"}):r.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-white font-medium",children:e.name.charAt(0).toUpperCase()})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:e.name}),r.jsx("p",{className:"text-xs text-start text-green-600",children:"Online"})]})]})})]}),r.jsxs("div",{className:"p-3 bg-white border-b border-gray-200",children:[r.jsxs("div",{className:"relative mb-3",children:[r.jsx(Go,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"text",placeholder:"Search or start new chat",value:W,onChange:u=>F(u.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-green-400"})]}),r.jsxs("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:[r.jsx("button",{onClick:()=>P("all"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${oe==="all"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"All"}),r.jsxs("button",{onClick:()=>P("unread"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${oe==="unread"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:["Unread",Object.values(se).reduce((u,l)=>u+l,0)>0&&r.jsx("span",{className:"ml-1 bg-green-500 text-white text-xs rounded-full px-1.5 py-0.5",children:Object.values(se).reduce((u,l)=>u+l,0)})]}),r.jsx("button",{onClick:()=>P("groups"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${oe==="groups"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Groups"})]})]}),r.jsxs("div",{className:"flex-1 overflow-y-auto",children:[Nc.map(u=>{var l;return r.jsx("div",{onClick:()=>{console.log("Selecting chat:",u),w({type:u.type,id:u.id,name:u.name,profileImage:u.profileImage}),se[u.id]&&(te(p=>{const j={...p};return delete j[u.id],j}),yt.updateChatState({chatId:u.id,chatType:u.type,action:"clear_unread"}).catch(p=>{console.error("Error clearing unread count:",p)}))},onContextMenu:p=>{p.preventDefault(),kn({x:p.clientX,y:p.clientY,chat:u})},className:`p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 ${(v==null?void 0:v.id)===u.id&&(v==null?void 0:v.type)===u.type?"bg-green-50":""}`,children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"relative",children:r.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-200 cursor-pointer hover:ring-2 hover:ring-green-400 transition-all",onClick:p=>{p.stopPropagation(),u.profileImage&&gt({image:u.type==="personal"?`${Se}${u.profileImage}`:u.avatar,name:u.name})},children:u.type==="personal"?u.profileImage?r.jsx("img",{src:`${Se}${u.profileImage}`,alt:u.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white font-semibold text-lg",children:u.avatar})}):u.profileImage?r.jsx("img",{src:u.avatar,alt:u.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:r.jsx(At,{className:"w-6 h-6 text-white"})})})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("h3",{className:"font-medium text-gray-900 truncate",children:u.name}),u.type==="group"&&r.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Group"})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[Wn.includes(`${u.type}-${u.id}`)&&r.jsx(On,{className:"w-3 h-3 text-gray-400 fill-gray-400"}),r.jsx("span",{className:"text-xs text-gray-500",children:(l=u.lastMessage)!=null&&l.timestamp?wc(u.lastMessage.timestamp):""}),se[u.id]&&se[u.id]>0&&r.jsx("div",{className:"bg-green-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center",children:se[u.id]>99?"99+":se[u.id]})]})]}),r.jsx("p",{className:"text-sm text-gray-500 truncate",children:u.lastMessage&&u.lastMessage.message?`${u.lastMessage.senderName||"You"}: ${u.lastMessage.message}`:"No messages yet"})]})]})},`${u.type}-${u.id}`)}),Nc.length===0&&r.jsxs("div",{className:"text-center py-8",children:[r.jsx(hs,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-500 text-sm",children:W?"No chats found.":"No chats available."})]})]})]}),Qe&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:()=>gt(null),children:r.jsxs("div",{className:"relative max-w-2xl max-h-[90vh] p-4",children:[r.jsx("button",{onClick:()=>gt(null),className:"absolute top-6 right-6 z-10 bg-white/10 hover:bg-white/20 text-white rounded-full p-2 transition-colors",title:"Close",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsxs("div",{className:"bg-white rounded-lg overflow-hidden shadow-2xl",children:[r.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-4",children:r.jsx("h3",{className:"text-white text-xl font-semibold text-center",children:Qe.name})}),r.jsx("img",{src:Qe.image,alt:Qe.name,className:"w-full h-auto max-h-[70vh] object-contain",onClick:u=>u.stopPropagation()})]})]})}),xt&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>kn(null)}),r.jsx("div",{className:"fixed z-50 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[180px]",style:{top:`${xt.y}px`,left:`${xt.x}px`},children:r.jsx("button",{onClick:u=>{ma(xt.chat.type,xt.chat.id,u),kn(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-3",children:Wn.includes(`${xt.chat.type}-${xt.chat.id}`)?r.jsxs(r.Fragment,{children:[r.jsx(cr,{className:"w-4 h-4"}),"Unpin Chat"]}):r.jsxs(r.Fragment,{children:[r.jsx(On,{className:"w-4 h-4"}),"Pin Chat"]})})})]}),Me&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>tt(null)}),r.jsxs("div",{className:"fixed z-50 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[180px]",style:{top:`${Me.y}px`,left:`${Me.x}px`},children:[r.jsxs("button",{onClick:()=>{Sn("copy",Me.message),tt(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-3",children:[r.jsx(Zr,{className:"w-4 h-4"}),"Copy"]}),r.jsxs("button",{onClick:()=>{Sn("forward",Me.message),tt(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-3",children:[r.jsx(es,{className:"w-4 h-4"}),"Forward"]}),(v==null?void 0:v.type)==="group"&&r.jsx("button",{onClick:u=>{Ko(Me.message,u),tt(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-3",children:Xe.some(u=>(u._id||u.id)===(Me.message._id||Me.message.id))?r.jsxs(r.Fragment,{children:[r.jsx(cr,{className:"w-4 h-4"}),"Unpin Message"]}):r.jsxs(r.Fragment,{children:[r.jsx(On,{className:"w-4 h-4"}),"Pin Message"]})})]})]}),at&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>He(null),onMouseMove:ge,onMouseUp:Te,onMouseLeave:Te,children:r.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center overflow-hidden",children:[r.jsx("button",{onClick:()=>He(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsx("button",{onClick:u=>{u.stopPropagation();const l=document.createElement("a");l.href=at.src,l.download=at.alt,document.body.appendChild(l),l.click(),document.body.removeChild(l)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:r.jsx(Jt,{className:"w-5 h-5"})}),r.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[r.jsx("button",{onClick:u=>{u.stopPropagation(),A()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Zoom In",children:r.jsx(Ey,{className:"w-5 h-5"})}),r.jsx("button",{onClick:u=>{u.stopPropagation(),ne()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Zoom Out",children:r.jsx(Iy,{className:"w-5 h-5"})}),r.jsx("button",{onClick:u=>{u.stopPropagation(),ee()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Reset Zoom",children:r.jsx(am,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"absolute bottom-4 left-4 z-10 bg-black/50 text-white px-3 py-2 rounded-lg text-sm",children:[Math.round(he*100),"%"]}),r.jsx("img",{src:at.src,alt:at.alt,className:`object-contain transition-transform duration-200 ${le?"cursor-grabbing":"cursor-grab"}`,style:{transform:`translate(${de.x}px, ${de.y}px) scale(${he})`,maxWidth:"none",maxHeight:"none",width:"auto",height:"auto"},onMouseDown:Y,onClick:u=>u.stopPropagation(),draggable:!1})]})}),$e&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>lt(null),children:r.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center",children:[r.jsx("button",{onClick:()=>lt(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsx("button",{onClick:u=>{u.stopPropagation();const l=document.createElement("a");l.href=$e.src,l.download=$e.alt,document.body.appendChild(l),l.click(),document.body.removeChild(l)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:r.jsx(Jt,{className:"w-5 h-5"})}),r.jsx("video",{src:$e.src,controls:!0,autoPlay:!0,className:"max-w-full max-h-full object-contain",onClick:u=>u.stopPropagation()})]})}),Ye&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>tn(null),children:r.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center",children:[r.jsx("button",{onClick:()=>tn(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),r.jsx("button",{onClick:u=>{u.stopPropagation();const l=document.createElement("a");l.href=Ye.src,l.download=Ye.fileName,document.body.appendChild(l),l.click(),document.body.removeChild(l)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:r.jsx(Jt,{className:"w-5 h-5"})}),r.jsx("div",{className:"bg-white rounded-lg shadow-2xl w-full h-full max-w-4xl max-h-[90vh] overflow-hidden",children:Ye.fileType==="application/pdf"?r.jsx("iframe",{src:Ye.src,className:"w-full h-full border-0",title:Ye.fileName,onClick:u=>u.stopPropagation()}):r.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-8",children:[r.jsx(Xt,{className:"w-24 h-24 text-gray-400 mb-4"}),r.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:Ye.fileName}),r.jsxs("p",{className:"text-gray-600 mb-4",children:[(Ye.fileSize/1024/1024).toFixed(2)," MB"]}),r.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["This file type cannot be previewed in the browser.",r.jsx("br",{}),"Click the download button to save and view the file."]}),r.jsx("button",{onClick:u=>{u.stopPropagation();const l=document.createElement("a");l.href=Ye.src,l.download=Ye.fileName,document.body.appendChild(l),l.click(),document.body.removeChild(l)},className:"mt-4 bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors",children:"Download File"})]})})]})}),r.jsx("div",{className:"flex-1 flex flex-col",children:v?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:v.type==="personal"?v.profileImage?r.jsx("img",{src:`${Se}${v.profileImage}`,alt:v.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white font-semibold",children:v.name.charAt(0).toUpperCase()})}):v.profileImage?r.jsx("img",{src:`${Se}${v.profileImage}`,alt:v.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:r.jsx(At,{className:"w-5 h-5 text-white"})})}),r.jsxs("div",{className:`cursor-pointer ${v.type==="group"?"hover:bg-gray-50 p-2 rounded-lg transition-colors":""}`,onClick:()=>{v.type==="group"&&(window.location.href=`/group/${v.id}`)},title:v.type==="group"?"Click to view group info":"",children:[r.jsx("h3",{className:"font-semibold text-gray-900",children:v.name}),r.jsx("p",{className:"text-xs text-gray-500",children:v.type==="personal"?x(v.id)?r.jsx("span",{className:"text-green-600 font-medium",children:"Online"}):Xs(g(v.id).lastSeen):`${v.email}`})]})]}),r.jsxs("div",{className:"flex items-center space-x-4",children:[v.type==="personal"?r.jsxs(r.Fragment,{children:[r.jsx(Qi,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var u,l;if(!(!v||v.type!=="personal"))try{const j=(l=(u=(await qi.initiate(v.id,"voice")).data)==null?void 0:u.data)==null?void 0:l.call;j&&j._id&&(Oe(!1),pe({callId:j._id,callType:"voice",otherUser:j.otherUser}),Be(!0),t.emit("call-initiate",{receiverId:v.id,callType:"voice",callId:j._id}))}catch(p){console.error("Failed to initiate call",p)}}}),r.jsx($t,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var u,l;if(!(!v||v.type!=="personal"))try{const j=(l=(u=(await qi.initiate(v.id,"video")).data)==null?void 0:u.data)==null?void 0:l.call;j&&j._id&&(Oe(!1),pe({callId:j._id,callType:"video",otherUser:j.otherUser}),Be(!0),t.emit("call-initiate",{receiverId:v.id,callType:"video",callId:j._id}))}catch(p){console.error("Failed to initiate video call",p)}}})]}):r.jsxs(r.Fragment,{children:[r.jsx(Qi,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var u,l,p,j,C;if(!(!v||v.type!=="group")){console.log("Initiating group call for:",v.id,v.name);try{const N=(l=(u=(await Tr.initiate(v.id,"voice")).data)==null?void 0:u.data)==null?void 0:l.call;N&&N._id&&(ft(!1),Ge({callId:N._id,callType:"voice",groupId:v.id,group:{name:v.name,avatar:v.profileImage}}),we(!0),t.emit("group-call-initiate",{groupId:v.id,callType:"voice",callId:N._id}))}catch(k){console.error("Failed to initiate group call",k),console.error("Error response:",(p=k.response)==null?void 0:p.data);const N=((C=(j=k.response)==null?void 0:j.data)==null?void 0:C.message)||"Failed to initiate group call";D.error(N)}}}}),r.jsx($t,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var u,l,p,j,C;if(!(!v||v.type!=="group")){console.log("Initiating group video call for:",v.id,v.name);try{const N=(l=(u=(await Tr.initiate(v.id,"video")).data)==null?void 0:u.data)==null?void 0:l.call;N&&N._id&&(ft(!1),Ge({callId:N._id,callType:"video",groupId:v.id,group:{name:v.name,avatar:v.profileImage}}),we(!0),t.emit("group-call-initiate",{groupId:v.id,callType:"video",callId:N._id}))}catch(k){console.error("Failed to initiate group video call",k),console.error("Error response:",(p=k.response)==null?void 0:p.data);const N=((C=(j=k.response)==null?void 0:j.data)==null?void 0:C.message)||"Failed to initiate group video call";D.error(N)}}}})]}),r.jsx(Ou,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800"})]})]}),v.type==="group"&&Xe.length>0&&r.jsxs("div",{className:"bg-yellow-50 border-b border-yellow-200 px-4 py-2",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(On,{className:"w-4 h-4 text-yellow-600"}),r.jsxs("span",{className:"text-sm font-medium text-yellow-800",children:[Xe.length," Pinned Message",Xe.length>1?"s":""]})]}),r.jsx("button",{onClick:()=>Ln(!Dt),className:"text-xs text-yellow-700 hover:text-yellow-900 font-medium",children:Dt?"Hide":"Show"})]}),Dt&&r.jsx("div",{className:"mt-2 space-y-2 max-h-48 overflow-y-auto",children:Xe.map(u=>{var l,p,j,C;return r.jsx("div",{className:"bg-white rounded-lg p-3 border border-yellow-200 shadow-sm hover:shadow-md transition-shadow cursor-pointer relative group",onClick:()=>{const k=document.getElementById(`message-${u._id||u.id}`);k&&(k.scrollIntoView({behavior:"smooth",block:"center"}),k.classList.add("ring-2","ring-blue-400"),setTimeout(()=>{k.classList.remove("ring-2","ring-blue-400")},2e3))},children:r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("div",{className:"flex-shrink-0 w-7 h-7 rounded-full overflow-hidden bg-gray-200",children:(l=u.sender)!=null&&l.profileImage?r.jsx("img",{src:`${Se}${u.sender.profileImage}`,alt:((p=u.sender)==null?void 0:p.name)||"User",className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-blue-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white text-xs font-medium",children:(((j=u.sender)==null?void 0:j.name)||"U").charAt(0).toUpperCase()})})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-xs font-medium text-gray-700",children:((C=u.sender)==null?void 0:C.name)||"User"}),r.jsx("p",{className:"text-sm text-gray-800 truncate",children:u.message||(u.fileUrl?" File attachment":"No content")})]}),r.jsx("button",{onClick:k=>{k.stopPropagation(),Ko(u,k)},className:"flex-shrink-0 p-1.5 rounded-full bg-red-100 hover:bg-red-200 text-red-600 transition-colors opacity-0 group-hover:opacity-100",title:"Unpin message",children:r.jsx(cr,{className:"w-4 h-4"})})]})},u._id||u.id)})})]}),r.jsx("div",{ref:pn,className:"flex-1 overflow-y-auto p-4 bg-gray-50 relative",children:r.jsxs("div",{className:"max-w-8xl mx-auto",children:[O&&r.jsx("div",{className:"flex justify-center py-2",children:r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})}),!O&&q&&m.length>0&&r.jsx("div",{className:"flex justify-center py-2",children:r.jsx("button",{onClick:()=>{var l,p,j;const u=((l=m[0])==null?void 0:l._id)||((p=m[0])==null?void 0:p.id);u&&(wr.current=((j=pn.current)==null?void 0:j.scrollHeight)||0,Vr(u))},className:"px-4 py-2 text-sm bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors",children:"Load Previous Messages"})}),Array.isArray(m)&&m.map((u,l)=>{var N,H,xe,Ne,Ee,Fe,ze;const p=l===0||(()=>{const re=new Date(u.createdAt||u.timestamp),ie=new Date(m[l-1].createdAt||m[l-1].timestamp),Pe=new Date(re.getFullYear(),re.getMonth(),re.getDate()),Le=new Date(ie.getFullYear(),ie.getMonth(),ie.getDate());return Pe.getTime()!==Le.getTime()})();let j=!1;if(typeof u.sender=="object"&&u.sender!==null){const re=u.sender._id||u.sender.id;j=re===e.id||re===e._id||re===((N=e.id)==null?void 0:N.toString())||re===((H=e._id)==null?void 0:H.toString())}else j=u.sender===e.id||u.sender===e._id||u.sender===((xe=e.id)==null?void 0:xe.toString())||u.sender===((Ne=e._id)==null?void 0:Ne.toString());const C=typeof u.sender=="object"?(Ee=u.sender)==null?void 0:Ee.name:"User",k=typeof u.sender=="object"?(Fe=u.sender)==null?void 0:Fe.profileImage:null;return r.jsxs(zl.Fragment,{children:[p&&r.jsx("div",{className:"flex justify-center my-4",children:r.jsx("div",{className:"bg-gray-200 text-gray-600 text-xs px-3 py-1 rounded-full",children:bc(u.createdAt||u.timestamp)})}),r.jsx("div",{id:`message-${u._id||u.id}`,className:`flex ${j?"justify-end":"justify-start"} mb-4`,children:r.jsxs("div",{className:`flex items-start gap-2 max-w-sm lg:max-w-md ${j?"flex-row-reverse":"flex-row"}`,children:[r.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-300 flex-shrink-0",children:j?e.profileImage?r.jsx("img",{src:`${Se}${e.profileImage}`,alt:e.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white text-xs font-medium",children:e.name.charAt(0).toUpperCase()})}):k?r.jsx("img",{src:`${Se}${k}`,alt:C,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-gray-400 flex items-center justify-center",children:r.jsx("span",{className:"text-white text-xs font-medium",children:String(C).charAt(0).toUpperCase()})})}),r.jsxs("div",{className:`relative group flex flex-col px-3 py-2 rounded-lg ${j?"bg-green-500 text-white rounded-br-none":"bg-gray-200 text-gray-900 rounded-bl-none"} ${fa&&Zs&&ct(Zs)===ct(u)?"ring-2 ring-blue-400":""}`,onMouseDown:()=>jt(u),onMouseUp:Gt,onMouseLeave:Gt,onTouchStart:()=>jt(u),onTouchEnd:Gt,onContextMenu:re=>{re.preventDefault(),nr(u),qo(!0),(v==null?void 0:v.type)==="group"&&tt({x:re.clientX,y:re.clientY,message:u})},children:[u.messageType==="text"&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:re=>rn(ct(u),re),className:`absolute top-1 right-1 z-10 p-1 rounded-full transition-all duration-200 ${j?"bg-green-600/80 hover:bg-green-700/80 text-white":"bg-gray-300/80 hover:bg-gray-400/80 text-gray-700"} ${Wt===ct(u)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:r.jsx(ko,{className:"w-3 h-3"})}),Wt===ct(u)&&r.jsxs("div",{className:"message-dropdown-container absolute bottom-full right-1 mb-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[r.jsxs("button",{onClick:()=>Sn("copy",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(Zr,{className:"w-4 h-4"}),"Copy"]}),(()=>{var Pe,Le,Je,qe;const re=((Pe=u.sender)==null?void 0:Pe.id)||((Le=u.sender)==null?void 0:Le._id)||u.sender;return re===e.id||re===e._id||re===((Je=e.id)==null?void 0:Je.toString())||re===((qe=e._id)==null?void 0:qe.toString())?r.jsxs("button",{onClick:()=>Sn("edit",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(jn,{className:"w-4 h-4"}),"Edit"]}):null})(),r.jsxs("button",{onClick:()=>Sn("forward",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(es,{className:"w-4 h-4"}),"Forward"]}),(v==null?void 0:v.type)==="group"&&r.jsx("button",{onClick:()=>{Ko(u),Ct(null)},className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:Xe.some(re=>(re._id||re.id)===(u._id||u.id))?r.jsxs(r.Fragment,{children:[r.jsx(cr,{className:"w-4 h-4"}),"Unpin"]}):r.jsxs(r.Fragment,{children:[r.jsx(On,{className:"w-4 h-4"}),"Pin"]})})]})]}),u.fileUrl&&r.jsx("div",{className:"mb-2",children:u.messageType==="image"?r.jsxs("div",{className:"relative group",onMouseDown:()=>jt(u),onMouseUp:Gt,onMouseLeave:Gt,onTouchStart:()=>jt(u),onTouchEnd:Gt,children:[r.jsx("button",{onClick:re=>rn(ct(u),re),className:`absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 ${j?"bg-green-500/80 hover:bg-green-600/80 text-white":"bg-gray-500/80 hover:bg-gray-600/80 text-white"} ${Wt===ct(u)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:r.jsx(ko,{className:"w-3 h-3"})}),Wt===ct(u)&&r.jsxs("div",{className:"message-dropdown-container absolute top-10 right-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[r.jsxs("button",{onClick:()=>Sn("copy",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(Zr,{className:"w-4 h-4"}),"Copy"]}),u.messageType==="text"&&(()=>{var Pe,Le,Je,qe;const re=((Pe=u.sender)==null?void 0:Pe.id)||((Le=u.sender)==null?void 0:Le._id)||u.sender;return re===e.id||re===e._id||re===((Je=e.id)==null?void 0:Je.toString())||re===((qe=e._id)==null?void 0:qe.toString())?r.jsxs("button",{onClick:()=>Sn("edit",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(jn,{className:"w-4 h-4"}),"Edit"]}):null})(),r.jsxs("button",{onClick:()=>Sn("forward",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(es,{className:"w-4 h-4"}),"Forward"]})]}),r.jsx("img",{src:nn(u.fileUrl),alt:u.fileName,className:`max-w-xs rounded-lg ${!j&&!Ze[u.id||u._id]?"blur-sm cursor-pointer":"cursor-pointer"} hover:opacity-90`,onClick:()=>{var re;!j&&!Ze[u.id||u._id]?ro(u.fileUrl,u.fileName,u.id||u._id):Re({src:nn(u.fileUrl),alt:u.fileName,sender:((re=u.sender)==null?void 0:re.name)||"User",timestamp:u.createdAt||u.timestamp})}}),!j&&!Ze[u.id||u._id]&&r.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-black/60 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1",children:[r.jsx(Jt,{className:"w-3 h-3"}),((u.fileSize||0)/1024/1024).toFixed(1)," MB"]}),B[u.id||u._id]&&r.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:r.jsxs("div",{className:"bg-black/60 rounded-lg px-3 py-2 text-center",children:[r.jsx("div",{className:"w-8 h-8 border-4 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-2"}),r.jsxs("p",{className:"text-sm text-white",children:[B[u.id||u._id].progress,"%"]})]})})]}):u.messageType==="video"?r.jsxs("div",{className:"relative group",onMouseDown:()=>jt(u),onMouseUp:Gt,onMouseLeave:Gt,onTouchStart:()=>jt(u),onTouchEnd:Gt,children:[r.jsx("button",{onClick:re=>rn(ct(u),re),className:`absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 ${j?"bg-green-500/80 hover:bg-green-600/80 text-white":"bg-gray-500/80 hover:bg-gray-600/80 text-white"} ${Wt===ct(u)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:r.jsx(ko,{className:"w-3 h-3"})}),Wt===ct(u)&&r.jsxs("div",{className:"message-dropdown-container absolute top-10 right-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[r.jsxs("button",{onClick:()=>Sn("copy",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(Zr,{className:"w-4 h-4"}),"Copy"]}),u.messageType==="text"&&(()=>{var Pe,Le,Je,qe;const re=((Pe=u.sender)==null?void 0:Pe.id)||((Le=u.sender)==null?void 0:Le._id)||u.sender;return re===e.id||re===e._id||re===((Je=e.id)==null?void 0:Je.toString())||re===((qe=e._id)==null?void 0:qe.toString())?r.jsxs("button",{onClick:()=>Sn("edit",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(jn,{className:"w-4 h-4"}),"Edit"]}):null})(),r.jsxs("button",{onClick:()=>Sn("forward",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[r.jsx(es,{className:"w-4 h-4"}),"Forward"]})]}),r.jsx("video",{src:nn(u.fileUrl),controls:!0,className:`max-w-xs rounded-lg ${!j&&!Ze[u.id||u._id]?"blur-sm":""} cursor-pointer`,onClick:()=>{var re;!j&&!Ze[u.id||u._id]?ro(u.fileUrl,u.fileName,u.id||u._id):lt({src:nn(u.fileUrl),alt:u.fileName,sender:((re=u.sender)==null?void 0:re.name)||"User",timestamp:u.createdAt||u.timestamp})}}),!j&&!Ze[u.id||u._id]&&r.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-black/60 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1",children:[r.jsx(Jt,{className:"w-3 h-3"}),((u.fileSize||0)/1024/1024).toFixed(1)," MB"]}),B[u.id||u._id]&&r.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:r.jsxs("div",{className:"bg-black/60 rounded-lg px-3 py-2 text-center",children:[r.jsx("div",{className:"w-8 h-8 border-4 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-2"}),r.jsxs("p",{className:"text-sm text-white",children:[B[u.id||u._id].progress,"%"]})]})})]}):r.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-white bg-opacity-20 rounded-lg relative cursor-pointer",onMouseDown:()=>jt(u),onMouseUp:Gt,onMouseLeave:Gt,onTouchStart:()=>jt(u),onTouchEnd:Gt,onClick:()=>{var re;!j&&!Ze[u.id||u._id]?ro(u.fileUrl,u.fileName,u.id||u._id):tn({src:nn(u.fileUrl),fileName:u.fileName,fileSize:u.fileSize,fileType:u.fileType,sender:((re=u.sender)==null?void 0:re.name)||"User",timestamp:u.createdAt||u.timestamp})},children:[r.jsx(Xt,{className:"w-5 h-5"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium truncate",children:u.fileName}),r.jsxs("p",{className:"text-xs opacity-75",children:[(u.fileSize/1024/1024).toFixed(2)," MB",da(u.fileUrl)&&r.jsx("span",{className:"ml-2 text-blue-400",children:" Google Drive"})]})]}),!j&&!Ze[u.id||u._id]&&r.jsx("button",{onClick:re=>{re.stopPropagation(),da(u.fileUrl)?(window.open(u.fileUrl,"_blank"),D.success("Opening file in Google Drive...")):ro(u.fileUrl,u.fileName,u.id||u._id)},className:"p-1 hover:bg-white hover:bg-opacity-20 rounded",disabled:(ze=B[u.id||u._id])==null?void 0:ze.downloading,children:r.jsx(Jt,{className:"w-4 h-4"})}),B[u.id||u._id]&&r.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:r.jsxs("div",{className:"bg-black/60 rounded-lg px-2 py-1 text-center",children:[r.jsx("div",{className:"w-6 h-6 border-2 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-1"}),r.jsxs("p",{className:"text-xs text-white",children:[B[u.id||u._id].progress,"%"]})]})})]})}),u.message&&(rr&&ct(rr)===ct(u)?r.jsxs("div",{className:"mb-2",children:[r.jsx("input",{type:"text",value:vr,onChange:re=>mn(re.target.value),className:"w-full px-2 py-1 text-sm bg-white bg-opacity-20 rounded border-none focus:outline-none focus:ring-1 focus:ring-white",autoFocus:!0,onKeyDown:re=>{re.key==="Enter"&&hn(),re.key==="Escape"&&ks()}}),r.jsxs("div",{className:"flex gap-1 mt-1",children:[r.jsx("button",{onClick:hn,className:"text-xs px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700",children:"Save"}),r.jsx("button",{onClick:ks,className:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Cancel"})]})]}):r.jsxs("p",{className:"text-sm mb-1 break-words whitespace-pre-wrap",children:[u.message,(u.isEdited||u.editedAt)&&r.jsx("span",{className:"text-xs opacity-75 ml-1",children:"(edited)"})]})),r.jsxs("div",{className:`flex items-center gap-1 text-xs self-end ${j?"text-green-100":"text-gray-500"}`,children:[r.jsx("span",{children:new Date(u.createdAt||u.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),j&&r.jsx("span",{className:"ml-1 relative inline-flex items-center",title:u.isRead||u.readBy&&u.readBy.length>0?"Seen":"Delivered",children:u.isRead||u.readBy&&u.readBy.length>0?r.jsx("svg",{className:"w-4 h-4 text-blue-500",viewBox:"0 0 16 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:"M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z",fill:"currentColor"})}):r.jsx("svg",{className:"w-4 h-4 opacity-70",viewBox:"0 0 16 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:"M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z",fill:"currentColor"})})})]})]})]})})]},u.id||u._id||l)}),r.jsx("div",{ref:zr})]})}),X&&r.jsx("div",{className:"bg-gray-50 border-t border-gray-200 p-3",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[G?r.jsx("img",{src:G,alt:"Preview",className:"w-12 h-12 rounded-lg object-cover"}):r.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:r.jsx(Xt,{className:"w-6 h-6 text-gray-500"})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:X.name}),r.jsxs("p",{className:"text-xs text-gray-500",children:[(X.size/1024/1024).toFixed(2)," MB"]})]})]}),r.jsx("button",{onClick:Cs,className:"text-gray-500 hover:text-gray-700",children:r.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),Ie&&r.jsx("div",{className:"bg-blue-50 border-t border-blue-200 p-4",children:r.jsx("div",{className:"flex items-center space-x-3",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Uploading file..."}),r.jsxs("p",{className:"text-sm font-medium text-blue-900",children:[me,"%"]})]}),r.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2.5",children:r.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${me}%`}})})]})})}),r.jsxs("div",{className:"bg-white border-t border-gray-200 p-4 relative",children:[r.jsxs("form",{onSubmit:xa,className:"flex items-center space-x-3",children:[r.jsx("button",{type:"button",onClick:()=>J(!$),className:"p-2 text-gray-500 hover:text-gray-700",title:"Attach file",children:r.jsx(jy,{className:"w-6 h-6"})}),r.jsx("div",{className:"flex-1 relative",children:r.jsx("textarea",{value:R,onChange:u=>U(u.target.value),onKeyDown:u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),(R.trim()||X)&&!Ie&&xa(u))},onPaste:u=>{var p;const l=(p=u.clipboardData)==null?void 0:p.items;if(l)for(let j=0;j<l.length;j++){const C=l[j];if(C.type.indexOf("image")!==-1){u.preventDefault();const k=C.getAsFile();if(k){z(k);const N=new FileReader;N.onload=H=>{V(H.target.result)},N.readAsDataURL(k),D.success("Image pasted! Ready to send")}break}}},placeholder:"Type a message",rows:1,className:"w-full py-2 px-4 bg-gray-100 rounded-2xl text-sm focus:outline-none focus:ring-2 focus:ring-green-400 resize-none overflow-y-auto max-h-32",style:{minHeight:"40px",whiteSpace:"pre-wrap",wordWrap:"break-word"}})}),r.jsx("button",{type:"submit",disabled:!R.trim()&&!X||Ie,className:"bg-green-500 text-white p-2 rounded-full hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:Ie?r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):r.jsx(vc,{className:"w-5 h-5"})})]}),$&&r.jsx("div",{className:"file-options-container absolute bottom-16 left-4 bg-white rounded-lg shadow-lg border border-gray-200 p-2 z-50",children:r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs("button",{onClick:()=>no("image"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[r.jsx(In,{className:"w-8 h-8 text-green-600 mb-1"}),r.jsx("span",{className:"text-xs text-gray-700",children:"Image"})]}),r.jsxs("button",{onClick:()=>no("video"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[r.jsx($t,{className:"w-8 h-8 text-blue-600 mb-1"}),r.jsx("span",{className:"text-xs text-gray-700",children:"Video"})]}),r.jsxs("button",{onClick:()=>no("document"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[r.jsx(Xt,{className:"w-8 h-8 text-purple-600 mb-1"}),r.jsx("span",{className:"text-xs text-gray-700",children:"Document"})]})]})})]})]}):r.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:r.jsxs("div",{className:"text-center",children:[r.jsx(hs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Welcome to WhatsApp"}),r.jsx("p",{className:"text-gray-500 max-w-md",children:"Select a conversation from the sidebar to start messaging. Your conversations will appear on the left side."})]})})})]}),Ht&&bt&&r.jsx(r.Fragment,{children:bt.callType==="video"?r.jsx(um,{user:e,callData:bt,isIncoming:Ae,onCallEnd:()=>{Be(!1),pe(null)},onCallAnswer:()=>{},onCallDecline:()=>{Be(!1),pe(null)}}):r.jsx(dm,{user:e,callData:bt,isIncoming:Ae,onCallEnd:()=>{Be(!1),pe(null)},onCallAnswer:()=>{},onCallDecline:()=>{Be(!1),pe(null)}})}),ve&&_e&&yr&&_e.callType==="video"&&r.jsx(hm,{callData:_e,onAccept:()=>{console.log(" Chat Page - Accepting incoming video call"),ft(!1),t&&(_e!=null&&_e.callId)&&t.emit("group-call-join",{callId:_e.callId,groupId:_e.groupId})},onDecline:()=>{we(!1),Ge(null),ft(!1),t&&(_e!=null&&_e.callId)&&t.emit("group-call-decline",{callId:_e.callId,groupId:_e.groupId})}}),ve&&_e&&!yr&&(_e.callType==="video"?r.jsx(mm,{user:e,callData:_e,onCallEnd:()=>{we(!1),Ge(null),ft(!1)}}):r.jsx(fm,{user:e,callData:_e,isIncoming:yr,onCallEnd:()=>{we(!1),Ge(null),ft(!1)},onCallAnswer:()=>{ft(!1)},onCallDecline:()=>{we(!1),Ge(null),ft(!1)}}))]})},ZC=()=>{const{user:e}=fn(),t=gr(),[n,s]=h.useState([]),[o,i]=h.useState(!0),[a,c]=h.useState(""),[d,f]=h.useState(!1),[x,g]=h.useState(null),[b,_]=h.useState({name:"",email:"",password:"",role:"user",phone:"",designation:"",bio:"",isActive:!0}),[I,M]=h.useState(""),[v,w]=h.useState(!1),[m,y]=h.useState("list"),[R,U]=h.useState(new Set),W=E=>R.has(E),F=E=>{U(X=>{const z=new Set(X);return z.has(E)?z.delete(E):z.add(E),z})},Z=()=>U(new Set),ae=()=>U(new Set(S.map(E=>E.id))),se=async E=>{if(R.size===0)return;const X=E?"enable":"disable";if(window.confirm(`Are you sure you want to ${X} ${R.size} selected user(s)?`))try{const z=new Map(n.map($=>[$.id,$]));let G=0,V=0;for(const $ of R){const J=z.get($);if(J){if($===(e==null?void 0:e.id)){V++;continue}if(e.role==="admin"&&J.role==="admin"){V++;continue}if((J.isActive??!0)===E){V++;continue}try{await an.toggleUserStatus($),G++}catch(B){console.error(`Failed to toggle user ${$}:`,B),V++}}}G>0&&D.success(`${G} user(s) ${X}d successfully`),V>0&&D.info(`${V} user(s) skipped (already in desired state or cannot be modified)`),Z(),te()}catch(z){console.error("Bulk toggle error",z),window.location.reload()}};h.useEffect(()=>{te()},[]);const te=async()=>{try{i(!0);const E=await an.getUsers();let X=E.data;e.role==="admin"&&(X=E.data.filter(z=>z.role!=="superadmin")),s(X)}catch(E){console.error("Error fetching users:",E),D.error("Failed to load users")}finally{i(!1)}},fe=async E=>{var X,z;if(E.preventDefault(),!b.name.trim()){D.error("Name is required");return}if(!b.email.trim()){D.error("Email is required");return}if(!x&&!b.password.trim()){D.error("Password is required");return}try{const G={name:b.name.trim(),email:b.email.trim(),role:b.role,phone:b.phone.trim(),designation:b.designation.trim(),bio:b.bio.trim(),isActive:b.isActive};x?(b.password.trim()&&(G.password=b.password),await an.updateUser(x.id,G),D.success("User updated successfully")):(G.password=b.password,await an.createUser(G),D.success("User created successfully")),f(!1),g(null),_({name:"",email:"",password:"",role:"user",phone:"",designation:"",bio:"",isActive:!0}),te()}catch(G){console.error("User operation error:",G),D.error(((z=(X=G.response)==null?void 0:X.data)==null?void 0:z.message)||"Operation failed")}},L=async E=>{if(window.confirm("Are you sure you want to delete this user?"))try{await an.deleteUser(E),D.success("User deleted successfully"),te()}catch{D.error("Failed to delete user")}},oe=async(E,X)=>{const z=X?"disable":"enable";if(window.confirm(`Are you sure you want to ${z} this user?`))try{await an.toggleUserStatus(E),D.success(`User ${z}d successfully`),te()}catch{D.error(`Failed to ${z} user`)}},P=E=>{g(E),_({name:E.name||"",email:E.email||"",password:"",role:E.role||"user",phone:E.phone||"",designation:E.designation||"",bio:E.bio||"",isActive:E.isActive!==!1}),M(E.password||""),w(!1),f(!0)},q=()=>{g(null),_({name:"",email:"",password:"",role:"user",phone:"",designation:"",bio:"",isActive:!0}),M(""),f(!0)},Q=E=>{switch(E){case"superadmin":return r.jsx(Dl,{className:"w-4 h-4 text-yellow-600"});case"admin":return r.jsx(Zi,{className:"w-4 h-4 text-blue-600"});default:return r.jsx(Nn,{className:"w-4 h-4 text-gray-600"})}},O=E=>{switch(E){case"superadmin":return"bg-yellow-100 text-yellow-800";case"admin":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},S=n.filter(E=>{var X,z;return E.name.toLowerCase().includes(a.toLowerCase())||E.email.toLowerCase().includes(a.toLowerCase())||((X=E.designation)==null?void 0:X.toLowerCase().includes(a.toLowerCase()))||((z=E.phone)==null?void 0:z.includes(a))});return o?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("div",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"flex justify-between items-center py-6",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("button",{onClick:()=>window.history.back(),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",title:"Go back",children:r.jsx(xr,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),r.jsx("p",{className:"text-gray-600",children:e.role==="superadmin"?"Manage admins and users in the system":"Manage users in your organization"})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"flex items-center rounded-md border border-gray-300 overflow-hidden",children:[r.jsx("button",{className:`px-3 py-2 text-sm ${m==="grid"?"bg-gray-200 text-gray-900":"bg-white text-gray-600"}`,onClick:()=>y("grid"),title:"Grid view",children:r.jsx(BC,{className:"w-4 h-4"})}),r.jsx("button",{className:`px-3 py-2 text-sm ${m==="list"?"bg-gray-200 text-gray-900":"bg-white text-gray-600"}`,onClick:()=>y("list"),title:"List view",children:r.jsx(yc,{className:"w-4 h-4"})})]}),r.jsxs("button",{onClick:()=>t("/time-management"),className:"btn-secondary inline-flex items-center",title:"Time Management Settings",children:[r.jsx(ms,{className:"w-4 h-4 mr-2"}),"Time Settings"]}),r.jsxs("button",{onClick:q,className:"btn-primary inline-flex items-center",children:[r.jsx(cm,{className:"w-4 h-4 mr-2"}),"Add New User"]})]})]})})}),r.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[r.jsx("div",{className:"card p-6 mb-6",children:r.jsxs("div",{className:"relative",children:[r.jsx(Go,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"text",placeholder:"Search users by name, email, designation, or phone...",value:a,onChange:E=>c(E.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),R.size>0&&r.jsxs("div",{className:"card p-4 mb-4 flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-700",children:["Selected ",R.size," user(s)"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:ae,className:"btn-secondary",children:"Select all"}),r.jsx("button",{onClick:Z,className:"btn-secondary",children:"Clear"}),r.jsx("button",{onClick:()=>se(!0),className:"btn-primary",children:"Enable selected"}),r.jsx("button",{onClick:()=>se(!1),className:"btn-secondary text-red-700",children:"Disable selected"})]})]}),m==="grid"?r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(E=>r.jsxs("div",{className:`relative card p-6 transition-all ${E.isActive?"hover:shadow-lg":"bg-gray-50 border-gray-300 opacity-75"}`,children:[r.jsx("label",{className:"absolute top-3 left-3 inline-flex items-center gap-2 bg-white/80 px-2 py-1 rounded shadow",children:r.jsx("input",{type:"checkbox",checked:W(E.id),onChange:()=>F(E.id)})}),r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:`w-12 h-12 ${E.isActive?"bg-primary-100":"bg-gray-100"} rounded-lg flex items-center justify-center overflow-hidden`,children:E.profileImage?r.jsx("img",{src:`${Se}${E.profileImage}`,alt:"Profile",className:`w-12 h-12 rounded-lg object-cover ${E.isActive?"":"grayscale"}`}):r.jsx(Nn,{className:`w-6 h-6 ${E.isActive?"text-primary-600":"text-gray-400"}`})}),r.jsxs("div",{children:[r.jsx("h3",{className:`font-medium ${E.isActive?"text-gray-900":"text-gray-600"}`,children:E.name}),r.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[Q(E.role),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${O(E.role)}`,children:E.role})]})]})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[E.id!==(e==null?void 0:e.id)&&(E.role!=="superadmin"||(e==null?void 0:e.role)==="superadmin")&&r.jsxs("div",{className:"relative inline-flex bg-gray-200 rounded-full p-1 cursor-pointer",onClick:()=>oe(E.id,E.isActive),children:[r.jsx("div",{className:"absolute top-1 bg-white rounded-full shadow-sm transition-transform duration-300",style:{width:"50%",height:"calc(100% - 8px)",left:E.isActive?"4px":"calc(50% + 2px)",transform:"none"}}),r.jsxs("div",{className:`relative z-10 px-4 py-2 text-xs font-medium rounded-full flex items-center space-x-1 transition-colors duration-200 ${E.isActive?"text-primary-600":"text-gray-500"}`,children:[r.jsx(Ru,{className:"w-3 h-3"}),r.jsx("span",{children:"Active"})]}),r.jsxs("div",{className:`relative z-10 px-4 py-2 text-xs font-medium rounded-full flex items-center space-x-1 transition-colors duration-200 ${E.isActive?"text-gray-500":"text-primary-600"}`,children:[r.jsx(qC,{className:"w-3 h-3"}),r.jsx("span",{children:"Disabled"})]})]}),r.jsx("button",{onClick:()=>P(E),className:"text-primary-600 hover:text-primary-900",title:"Edit user",children:r.jsx(jn,{className:"w-4 h-4"})}),E.role!=="superadmin"&&E.id!==(e==null?void 0:e.id)&&r.jsx("button",{onClick:()=>L(E.id),className:"text-red-600 hover:text-red-900",title:"Delete user",children:r.jsx(Ks,{className:"w-4 h-4"})})]})]}),r.jsxs("div",{className:"space-y-2 mb-4",children:[r.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[r.jsx(by,{className:"w-4 h-4 mr-2"}),r.jsx("span",{className:"truncate",children:E.email})]}),r.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[r.jsx(Qi,{className:"w-4 h-4 mr-2"}),r.jsx("span",{children:E.phone||"Not provided"})]}),r.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[r.jsx(lm,{className:"w-4 h-4 mr-2"}),r.jsx("span",{children:E.designation||"Not provided"})]})]}),r.jsx("div",{className:"mb-4",children:r.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:E.bio||"No bio provided"})}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-1",children:[E.isActive?r.jsx(Ru,{className:"w-4 h-4 text-green-600"}):r.jsx(KC,{className:"w-4 h-4 text-red-600"}),r.jsx("span",{className:`text-sm font-medium px-2 py-1 rounded-full ${E.isActive?"text-green-700 bg-green-100":"text-red-700 bg-red-100"}`,children:E.isActive?"Active":"Disabled"})]}),E.lastSeen&&r.jsxs("span",{className:"text-xs text-gray-500",children:["Last seen: ",new Date(E.lastSeen).toLocaleDateString()]})]}),!E.isActive&&E.disabledAt&&r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-2",children:[r.jsxs("div",{className:"flex items-center text-xs text-red-700",children:[r.jsx(_n,{className:"w-3 h-3 mr-1"}),r.jsx("span",{className:"font-medium",children:"Disabled:"}),r.jsx("span",{className:"ml-1",children:new Date(E.disabledAt).toLocaleString()})]}),E.disableReason&&r.jsxs("div",{className:"flex items-center text-xs text-red-600 mt-1",children:[r.jsx("span",{className:"font-medium",children:"Reason:"}),r.jsx("span",{className:"ml-1 capitalize",children:E.disableReason==="auto"?"Auto-disabled":"Manually disabled"})]})]})]})]},E.id))}):r.jsx("div",{className:"card p-0 overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsx("input",{type:"checkbox",onChange:E=>E.target.checked?ae():Z(),checked:R.size>0&&R.size===S.length})}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),r.jsx("th",{className:"px-4 py-3"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map(E=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-4 py-3",children:r.jsx("input",{type:"checkbox",checked:W(E.id),onChange:()=>F(E.id)})}),r.jsx("td",{className:"px-4 py-3",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded bg-gray-100 overflow-hidden flex items-center justify-center",children:E.profileImage?r.jsx("img",{src:`${Se}${E.profileImage}`,alt:"Profile",className:"w-10 h-10 object-cover"}):r.jsx(Nn,{className:"w-5 h-5 text-gray-400"})}),r.jsxs("div",{children:[r.jsx("div",{className:`font-medium ${E.isActive?"text-gray-900":"text-gray-600"}`,children:E.name}),r.jsx("div",{className:"text-xs text-gray-500",children:E.designation||""})]})]})}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${O(E.role)}`,children:E.role})}),r.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:E.email}),r.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:E.phone||""}),r.jsx("td",{className:"px-4 py-3",children:r.jsxs("div",{className:"space-y-1",children:[r.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-full ${E.isActive?"text-green-700 bg-green-100":"text-red-700 bg-red-100"}`,children:E.isActive?"Active":"Disabled"}),!E.isActive&&E.disabledAt&&r.jsx("div",{className:"text-xs text-red-600",title:`Disabled at: ${new Date(E.disabledAt).toLocaleString()}`,children:E.disableReason==="auto"?" Auto":" Manual"})]})}),r.jsx("td",{className:"px-4 py-3",children:r.jsxs("div",{className:"flex items-center gap-2",children:[E.id!==(e==null?void 0:e.id)&&(E.role!=="superadmin"||(e==null?void 0:e.role)==="superadmin")&&r.jsx("button",{className:"text-gray-600 hover:text-gray-900",title:"Toggle status",onClick:()=>oe(E.id,E.isActive),children:E.isActive?r.jsx(Sy,{className:"w-5 h-5 text-green-600"}):r.jsx(ky,{className:"w-5 h-5 text-gray-400"})}),r.jsx("button",{className:"text-primary-600 hover:text-primary-900",title:"Edit",onClick:()=>P(E),children:r.jsx(jn,{className:"w-4 h-4"})}),E.role!=="superadmin"&&E.id!==(e==null?void 0:e.id)&&r.jsx("button",{className:"text-red-600 hover:text-red-900",title:"Delete",onClick:()=>L(E.id),children:r.jsx(Ks,{className:"w-4 h-4"})})]})})]},E.id))})]})})}),S.length===0&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(At,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No users found"}),r.jsx("p",{className:"text-gray-500",children:a?"Try adjusting your search terms.":"No users have been created yet."})]})]}),d&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:x?"Edit User":"Create New User"}),r.jsxs("form",{onSubmit:fe,className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),r.jsx("input",{type:"text",required:!0,value:b.name,onChange:E=>_({...b,name:E.target.value}),className:"input-field",placeholder:"Enter full name"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),r.jsx("input",{type:"email",required:!0,value:b.email,onChange:E=>_({...b,email:E.target.value}),className:"input-field",placeholder:"Enter email address"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[x?"New Password":"Password",x&&r.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(leave blank to keep current)"})]}),r.jsx("input",{type:"password",required:!x,value:b.password,onChange:E=>_({...b,password:E.target.value}),className:"input-field",placeholder:x?"Enter new password (optional)":"Enter password"}),x&&r.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-600",children:"Current Password"}),r.jsxs("button",{type:"button",className:"text-xs text-primary-600 hover:text-primary-800 inline-flex items-center gap-1",onClick:()=>w(E=>!E),children:[v?r.jsx(Lu,{className:"w-3 h-3"}):r.jsx(Uu,{className:"w-3 h-3"}),v?"Hide":"Show"]})]}),r.jsx("input",{type:v?"text":"password",readOnly:!0,value:I||"[Password not available - please set new password]",className:"w-full input-field font-mono"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),r.jsxs("select",{value:b.role,onChange:E=>_({...b,role:E.target.value}),className:"input-field",children:[r.jsx("option",{value:"user",children:"User"}),e.role==="superadmin"&&r.jsx("option",{value:"admin",children:"Admin"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),r.jsx("input",{type:"tel",value:b.phone,onChange:E=>_({...b,phone:E.target.value}),className:"input-field",placeholder:"Enter phone number"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Designation"}),r.jsx("input",{type:"text",value:b.designation,onChange:E=>_({...b,designation:E.target.value}),className:"input-field",placeholder:"Enter designation"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bio"}),r.jsx("textarea",{value:b.bio,onChange:E=>_({...b,bio:E.target.value}),className:"input-field",rows:"3",placeholder:"Enter bio (optional)"})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",id:"isActive",checked:b.isActive,onChange:E=>_({...b,isActive:E.target.checked}),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),r.jsx("label",{htmlFor:"isActive",className:"ml-2 block text-sm text-gray-900",children:"User is active"})]}),r.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[r.jsx("button",{type:"button",onClick:()=>f(!1),className:"btn-secondary",children:"Cancel"}),r.jsx("button",{type:"submit",className:"btn-primary",children:x?"Update User":"Create User"})]})]})]})})]})},e4=()=>{fn();const[e,t]=h.useState(!0),[n,s]=h.useState(new Date),[o,i]=h.useState(0),[a,c]=h.useState({offset:0,synced:!1}),[d,f]=h.useState([]),[x,g]=h.useState([]),[b,_]=h.useState(!1),[I,M]=h.useState(null),[v,w]=h.useState({name:"",enableTime:"",disableTime:"",users:[],applyToAllUsers:!1,days:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]}),m=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];h.useEffect(()=>{y(),R(),U();const S=setInterval(()=>{s(new Date(Date.now()+o))},1e3),E=setInterval(()=>{y()},5*60*1e3);return()=>{clearInterval(S),clearInterval(E)}},[o]);const y=async()=>{try{const S=await bx.getCurrentTime(),E=new Date(S.data.timestamp),X=new Date,z=E.getTime()-X.getTime();i(z),s(E),S.data.usingGlobalTime?(c({offset:S.data.ntpOffset||0,synced:!0,systemTime:S.data.systemTime,diff:S.data.globalTimeDiff}),console.log(" Time synced with Global NTP Server (NOT system time)"),console.log(" NTP Offset:",S.data.globalTimeDiff),console.log(" IST Time:",S.data.formatted)):console.log(" Time synced with backend IST:",S.data.formatted)}catch(S){console.error("Failed to sync time with backend:",S),i(0),c({offset:0,synced:!1}),s(new Date)}},R=async()=>{try{const S=await _s.getSchedules();f(S.data),t(!1)}catch(S){console.error("Error fetching schedules:",S),t(!1)}},U=async()=>{try{const E=(await an.getUsers()).data.filter(X=>X.role==="user");g(E)}catch(S){console.error("Error fetching users:",S)}},W=async S=>{var E,X;if(S.preventDefault(),!v.name.trim()){D.error("Please enter schedule name");return}if(!v.enableTime&&!v.disableTime){D.error("Please set at least one time (Enable or Disable)");return}if(!v.applyToAllUsers&&v.users.length===0){D.error('Please select at least one user or enable "Apply to all users"');return}try{I?(await _s.updateSchedule(I._id,v),D.success("Schedule updated successfully")):(await _s.createSchedule(v),D.success("Schedule created successfully")),_(!1),M(null),fe(),R()}catch(z){console.error("Schedule operation error:",z),D.error(((X=(E=z.response)==null?void 0:E.data)==null?void 0:X.message)||"Operation failed")}},F=async S=>{if(window.confirm("Are you sure you want to delete this schedule?"))try{await _s.deleteSchedule(S),D.success("Schedule deleted successfully"),R()}catch{D.error("Failed to delete schedule")}},Z=async S=>{try{await _s.toggleSchedule(S),R()}catch{D.error("Failed to toggle schedule")}},ae=async(S,E)=>{if(window.confirm(`Reset "${E}"? This will allow it to trigger again today.`))try{await _s.resetTrigger(S),D.success("Schedule reset - can trigger again today"),R()}catch{D.error("Failed to reset schedule")}},se=S=>{M(S),w({name:S.name,enableTime:S.enableTime||"",disableTime:S.disableTime||"",users:S.users.map(E=>E._id),applyToAllUsers:S.applyToAllUsers,days:S.days}),_(!0)},te=()=>{M(null),fe(),_(!0)},fe=()=>{w({name:"",enableTime:"",disableTime:"",users:[],applyToAllUsers:!1,days:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]})},L=S=>{w(E=>({...E,days:E.days.includes(S)?E.days.filter(X=>X!==S):[...E.days,S]}))},oe=S=>{w(E=>({...E,users:E.users.includes(S)?E.users.filter(X=>X!==S):[...E.users,S]}))},P=()=>{w(S=>({...S,users:x.map(E=>E.id)}))},q=()=>{w(S=>({...S,users:[]}))},Q=S=>S.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}),O=S=>S.toLocaleDateString("en-IN",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return e?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:"Loading schedules..."})]})}):r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("div",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:r.jsx("div",{className:"flex justify-between items-center py-6",children:r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("button",{onClick:()=>window.history.back(),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",title:"Go back",children:r.jsx(xr,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[r.jsx(_n,{className:"w-7 h-7 mr-3 text-primary-600"}),"User Scheduler"]}),r.jsx("p",{className:"text-gray-600",children:"Automatically enable or disable selected users at scheduled times"})]})]})})})}),r.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[r.jsx("div",{className:"card p-8 mb-6 bg-gradient-to-r from-primary-50 to-blue-50 border-primary-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[r.jsx(_n,{className:"w-5 h-5 text-primary-600"}),r.jsx("p",{className:"text-sm text-gray-600 font-medium",children:O(n)})]}),r.jsx("h2",{className:"text-4xl font-bold text-gray-900",children:Q(n)}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Current IST Time (India)"}),r.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[r.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium",children:" Global NTP Time"}),a.synced&&r.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-medium",children:[" Offset: ",a.diff]})]})]}),r.jsx("div",{className:"bg-white rounded-full p-6 shadow-lg",children:r.jsx(ms,{className:"w-16 h-16 text-primary-600"})})]})}),r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Scheduled Actions"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Create schedules to automatically enable or disable selected users"})]}),r.jsxs("button",{onClick:te,className:"btn-primary inline-flex items-center",children:[r.jsx(Xi,{className:"w-4 h-4 mr-2"}),"Create Schedule"]})]}),d.length===0?r.jsxs("div",{className:"card p-12 text-center",children:[r.jsx(_n,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No schedules yet"}),r.jsx("p",{className:"text-gray-500 mb-4",children:"Create schedules to automatically enable or disable users at specific times"}),r.jsxs("button",{onClick:te,className:"btn-primary inline-flex items-center",children:[r.jsx(Xi,{className:"w-4 h-4 mr-2"}),"Create Schedule"]})]}):r.jsx("div",{className:"grid gap-6",children:d.map(S=>r.jsx("div",{className:"card p-6",children:r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:S.name}),S.isActive?r.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700",children:"Active"}):r.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700",children:"Inactive"})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-600 mb-3",children:[S.enableTime&&r.jsxs("div",{className:"flex items-center bg-green-50 px-3 py-1.5 rounded-lg border border-green-200",children:[r.jsx("span",{className:"text-green-700 font-medium mr-1",children:""}),r.jsx(ms,{className:"w-4 h-4 mr-1 text-green-600"}),r.jsx("span",{className:"font-medium text-green-700",children:S.enableTime}),r.jsx("span",{className:"ml-1 text-green-600 text-xs",children:"Enable"})]}),S.disableTime&&r.jsxs("div",{className:"flex items-center bg-red-50 px-3 py-1.5 rounded-lg border border-red-200",children:[r.jsx("span",{className:"text-red-700 font-medium mr-1",children:""}),r.jsx(ms,{className:"w-4 h-4 mr-1 text-red-600"}),r.jsx("span",{className:"font-medium text-red-700",children:S.disableTime}),r.jsx("span",{className:"ml-1 text-red-600 text-xs",children:"Disable"})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(At,{className:"w-4 h-4 mr-1"}),r.jsx("span",{children:S.applyToAllUsers?"All Users":`${S.users.length} Selected`})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(_n,{className:"w-4 h-4 mr-1"}),r.jsx("span",{children:S.days.length===7?"Every day":`${S.days.length} days`})]})]}),!S.applyToAllUsers&&S.users.length>0&&r.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[S.users.slice(0,5).map(E=>r.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 rounded-full px-3 py-1",children:[r.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-100 flex items-center justify-center overflow-hidden",children:E.profileImage?r.jsx("img",{src:`${Se}${E.profileImage}`,alt:E.name,className:"w-6 h-6 object-cover"}):r.jsx(Nn,{className:"w-3 h-3 text-primary-600"})}),r.jsx("span",{className:"text-xs text-gray-700",children:E.name})]},E._id)),S.users.length>5&&r.jsxs("span",{className:"text-xs text-gray-500 px-3 py-1",children:["+",S.users.length-5," more"]})]}),r.jsx("div",{className:"flex flex-wrap gap-1",children:m.map(E=>r.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${S.days.includes(E)?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-400"}`,children:E.slice(0,3)},E))}),(S.lastTriggeredEnable||S.lastTriggeredDisable)&&r.jsxs("div",{className:"mt-4 pt-4 border-t text-xs text-gray-500 space-y-1",children:[S.lastTriggeredEnable&&r.jsxs("div",{className:"flex items-center text-green-600",children:[r.jsx("span",{className:"font-medium mr-1",children:" Enable triggered:"}),new Date(S.lastTriggeredEnable).toLocaleString()]}),S.lastTriggeredDisable&&r.jsxs("div",{className:"flex items-center text-red-600",children:[r.jsx("span",{className:"font-medium mr-1",children:" Disable triggered:"}),new Date(S.lastTriggeredDisable).toLocaleString()]})]})]}),r.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[(S.lastTriggeredEnable||S.lastTriggeredDisable)&&r.jsx("button",{onClick:()=>ae(S._id,S.name),className:"text-orange-600 hover:text-orange-900",title:"Reset & allow re-trigger today",children:r.jsx(am,{className:"w-5 h-5"})}),r.jsx("button",{onClick:()=>Z(S._id),className:"text-gray-600 hover:text-gray-900",title:S.isActive?"Disable":"Enable",children:S.isActive?r.jsx(Sy,{className:"w-6 h-6 text-green-600"}):r.jsx(ky,{className:"w-6 h-6 text-gray-400"})}),r.jsx("button",{onClick:()=>se(S),className:"text-primary-600 hover:text-primary-900",children:r.jsx(jn,{className:"w-5 h-5"})}),r.jsx("button",{onClick:()=>F(S._id),className:"text-red-600 hover:text-red-900",children:r.jsx(Ks,{className:"w-5 h-5"})})]})]})},S._id))}),r.jsxs("div",{className:"card p-6 mt-8 bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[r.jsx(zC,{className:"w-5 h-5 mr-2 text-purple-600"}),"How it works"]}),r.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[r.jsx("p",{children:" System uses Global NTP Time Server (time.google.com or pool.ntp.org)"}),r.jsx("p",{children:" Computer/System time is IGNORED - only global internet time is used"}),r.jsx("p",{children:" Global time is converted to IST (Indian Standard Time)"}),r.jsx("p",{children:" The system runs a scheduled job every minute to check time"}),r.jsx("p",{children:" NTP sync happens automatically every hour for accuracy"}),r.jsx("p",{children:" Create schedules to automatically DISABLE selected users at specific times"}),r.jsx("p",{children:" Create schedules to automatically ENABLE selected users at specific times"}),r.jsx("p",{children:" Only selected users in schedules will be affected (not all users)"}),r.jsx("p",{children:" Disabled users are immediately logged out from all devices"})]})]})]}),b&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:r.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:I?"Edit Schedule":"Create New Schedule"}),r.jsxs("form",{onSubmit:W,className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Schedule Name"}),r.jsx("input",{type:"text",required:!0,value:v.name,onChange:S=>w({...v,name:S.target.value}),className:"input-field",placeholder:"e.g., Morning Auto-Enable"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[r.jsxs("label",{className:"block text-sm font-medium text-green-800 mb-1 flex items-center",children:[r.jsx("span",{className:"mr-2",children:""}),"Enable Time (IST)"]}),r.jsx("input",{type:"time",value:v.enableTime,onChange:S=>w({...v,enableTime:S.target.value}),className:"input-field text-lg font-mono",placeholder:"Optional"}),r.jsx("p",{className:"text-xs text-green-700 mt-1",children:"Users will be enabled at this time"})]}),r.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[r.jsxs("label",{className:"block text-sm font-medium text-red-800 mb-1 flex items-center",children:[r.jsx("span",{className:"mr-2",children:""}),"Disable Time (IST)"]}),r.jsx("input",{type:"time",value:v.disableTime,onChange:S=>w({...v,disableTime:S.target.value}),className:"input-field text-lg font-mono",placeholder:"Optional"}),r.jsx("p",{className:"text-xs text-red-700 mt-1",children:"Users will be disabled at this time"})]})]}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:r.jsxs("p",{className:"text-sm text-blue-800",children:[" ",r.jsx("strong",{children:"Tip:"})," Set both times to create a complete on/off schedule. Example: Enable at 09:00, Disable at 18:00"]})}),r.jsxs("div",{className:"flex items-center p-4 bg-gray-50 rounded-lg border border-gray-200",children:[r.jsx("input",{type:"checkbox",id:"applyToAll",checked:v.applyToAllUsers,onChange:S=>w({...v,applyToAllUsers:S.target.checked,users:[]}),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),r.jsxs("label",{htmlFor:"applyToAll",className:"ml-3 block text-sm",children:[r.jsx("span",{className:"font-medium text-gray-900",children:"Apply to all users"}),r.jsx("p",{className:"text-gray-600",children:"This schedule will apply to all regular users at the specified times"})]})]}),!v.applyToAllUsers&&r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Select Users (",v.users.length," selected)"]}),r.jsxs("div",{className:"space-x-2",children:[r.jsx("button",{type:"button",onClick:P,className:"text-xs text-primary-600 hover:text-primary-800",children:"Select All"}),r.jsx("button",{type:"button",onClick:q,className:"text-xs text-gray-600 hover:text-gray-800",children:"Deselect All"})]})]}),r.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 max-h-64 overflow-y-auto",children:[r.jsxs("div",{className:"mb-3 pb-3 border-b flex items-center justify-between",children:[r.jsxs("div",{className:"text-xs text-gray-600",children:["Showing all users (Active: ",x.filter(S=>S.isActive!==!1).length,", Disabled: ",x.filter(S=>S.isActive===!1).length,")"]}),r.jsxs("div",{className:"flex gap-2 text-xs",children:[r.jsx("span",{className:"px-2 py-1 bg-green-50 text-green-700 rounded",children:" Active"}),r.jsx("span",{className:"px-2 py-1 bg-gray-50 text-gray-700 rounded",children:" Disabled"})]})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:x.map(S=>r.jsxs("label",{className:`flex items-center space-x-3 p-3 rounded cursor-pointer transition-colors ${v.users.includes(S.id)?"bg-primary-50 border border-primary-200":S.isActive===!1?"hover:bg-gray-50 opacity-75":"hover:bg-gray-50"}`,children:[r.jsx("input",{type:"checkbox",checked:v.users.includes(S.id),onChange:()=>oe(S.id),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),r.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[r.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center overflow-hidden ${S.isActive===!1?"bg-gray-100":"bg-primary-100"}`,children:S.profileImage?r.jsx("img",{src:`${Se}${S.profileImage}`,alt:S.name,className:`w-8 h-8 object-cover ${S.isActive===!1?"grayscale":""}`}):r.jsx(Nn,{className:`w-4 h-4 ${S.isActive===!1?"text-gray-400":"text-primary-600"}`})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`text-sm font-medium ${S.isActive===!1?"text-gray-600":"text-gray-900"}`,children:S.name}),S.isActive===!1?r.jsx("span",{className:"px-1.5 py-0.5 bg-gray-100 text-gray-600 rounded text-xs",children:"Disabled"}):r.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-600 rounded text-xs",children:"Active"})]}),r.jsx("div",{className:"text-xs text-gray-500",children:S.email})]})]})]},S.id))})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Active Days (",v.days.length," selected)"]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(S=>r.jsx("button",{type:"button",onClick:()=>L(S),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${v.days.includes(S)?"bg-primary-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:S},S))})]}),r.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[r.jsx("button",{type:"button",onClick:()=>{_(!1),M(null),fe()},className:"btn-secondary",children:"Cancel"}),r.jsx("button",{type:"submit",className:"btn-primary",children:I?"Update Schedule":"Create Schedule"})]})]})]})})]})},t4=()=>{const{user:e}=fn(),[t,n]=h.useState([]),[s,o]=h.useState([]),[i,a]=h.useState(!0),[c,d]=h.useState(""),[f,x]=h.useState(!1),[g,b]=h.useState(null),[_,I]=h.useState({name:"",description:"",members:[]}),[M,v]=h.useState(null),[w,m]=h.useState(null);h.useEffect(()=>{y()},[]);const y=async()=>{var L,oe;try{a(!0);const[P,q]=await Promise.all([zt.getGroups(),an.getActiveUsers()]);console.log("Groups response:",P.data),console.log("First group:",P.data[0]),console.log("First group ID:",(L=P.data[0])==null?void 0:L.id),console.log("First group _ID:",(oe=P.data[0])==null?void 0:oe._id);const Q=P.data.map(O=>({...O,id:O.id||O._id}));console.log("Transformed groups:",Q),n(Q),o(q.data.filter(O=>O.id!==e.id))}catch(P){console.error("Error fetching data:",P),D.error("Failed to load data")}finally{a(!1)}},R=async L=>{var oe,P;if(L.preventDefault(),!_.name.trim()){D.error("Group name is required");return}if(_.members.length===0){D.error("Please add at least one member to the group");return}try{console.log("Submitting group data:",_),console.log("Editing group:",g),console.log("Editing group ID:",g==null?void 0:g.id);let q;if(g){if(!g.id){console.error("No group ID found for editing:",g),D.error("Invalid group ID for editing");return}await zt.updateGroup(g.id,_),q=g.id,D.success("Group updated successfully")}else{const Q=await zt.createGroup(_);console.log("Group creation result:",Q.data),q=Q.data.group._id||Q.data.group.id,D.success("Group created successfully")}if(M&&q)try{const Q=new FormData;Q.append("avatar",M),await zt.uploadGroupAvatar(q,Q),D.success("Group avatar uploaded successfully")}catch(Q){console.error("Avatar upload error:",Q),D.error("Group created but avatar upload failed")}x(!1),b(null),I({name:"",description:"",members:[]}),v(null),m(null),y()}catch(q){console.error("Group operation error:",q),D.error(((P=(oe=q.response)==null?void 0:oe.data)==null?void 0:P.message)||"Operation failed")}},U=async L=>{if(window.confirm("Are you sure you want to delete this group?"))try{await zt.deleteGroup(L),D.success("Group deleted successfully"),y()}catch{D.error("Failed to delete group")}},W=L=>{var Q;console.log("Editing group:",L),console.log("Group ID:",L.id),console.log("Group _id:",L._id),console.log("Group members:",L.members),console.log("Group avatar:",L.avatar);const oe=L.id||L._id;if(!oe){console.error("No valid group ID found:",L),D.error("Invalid group selected");return}const P={...L,id:oe};console.log("Group with ID:",P);const q=((Q=L.members)==null?void 0:Q.map(O=>{var E,X;let S;return typeof O.user=="string"?S=O.user:(E=O.user)!=null&&E.id?S=O.user.id:(X=O.user)!=null&&X._id?S=O.user._id:S=O.user,console.log("Extracted member userId:",S,"from:",O.user),{user:S,role:O.role}}))||[];console.log("Extracted members for formData:",q),b(P),I({name:L.name,description:L.description||"",members:q}),v(null),L.avatar?m(`${Se}${L.avatar}`):m(null),x(!0)},F=()=>{b(null),I({name:"",description:"",members:[]}),v(null),m(null),x(!0)},Z=L=>{const oe=L.target.files[0];if(oe){v(oe);const P=new FileReader;P.onload=q=>m(q.target.result),P.readAsDataURL(oe)}},ae=L=>{if(console.log("Adding member:",L),console.log("Current members:",_.members),_.members.find(P=>{var Q,O;return(typeof P.user=="string"?P.user:((Q=P.user)==null?void 0:Q.id)||((O=P.user)==null?void 0:O._id))===L}))console.log("Member already exists"),D.info("Member already added");else{const P={user:L,role:"member"},q=[..._.members,P];console.log("Updated members after add:",q),I(Q=>({name:Q.name,description:Q.description,members:q})),console.log("Member added successfully"),D.success("Member added successfully")}},se=L=>{console.log("Removing member:",L),console.log("Current members before removal:",_.members);const oe=_.members.filter(P=>{var O,S;const q=typeof P.user=="string"?P.user:((O=P.user)==null?void 0:O.id)||((S=P.user)==null?void 0:S._id),Q=q!==L;return console.log("Member ID:",q,"Remove ID:",L,"Should keep:",Q),Q});console.log("Updated members after removal:",oe),console.log("Length before:",_.members.length,"Length after:",oe.length),oe.length<_.members.length?(I(P=>({name:P.name,description:P.description,members:oe})),console.log("Member removed successfully"),D.success("Member removed successfully")):(console.log("Member not found for removal"),D.error("Failed to remove member"))},te=t.filter(L=>{var oe;return L.name.toLowerCase().includes(c.toLowerCase())||((oe=L.description)==null?void 0:oe.toLowerCase().includes(c.toLowerCase()))}),fe=s.filter(L=>{const oe=_.members.find(P=>{var O,S;const q=typeof P.user=="string"?P.user:((O=P.user)==null?void 0:O.id)||((S=P.user)==null?void 0:S._id),Q=L.id||L._id;return q===Q});return f&&oe&&console.log("Filtering out user (already member):",L.name,"ID:",L.id),!oe});return i?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("div",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"flex justify-between items-center py-6",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("button",{onClick:()=>window.history.back(),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",title:"Go back",children:r.jsx(xr,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Group Management"}),r.jsx("p",{className:"text-gray-600",children:"Create and manage groups for team communication"})]})]}),r.jsxs("button",{onClick:F,className:"btn-primary inline-flex items-center",children:[r.jsx(Xi,{className:"w-4 h-4 mr-2"}),"Create Group"]})]})})}),r.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[r.jsx("div",{className:"card p-6 mb-6",children:r.jsxs("div",{className:"relative",children:[r.jsx(Go,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"text",placeholder:"Search groups...",value:c,onChange:L=>d(L.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:te.map(L=>{var oe,P,q;return r.jsxs("div",{className:"card p-6",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center overflow-hidden",children:L.avatar?r.jsx("img",{src:`${Se}${L.avatar}`,alt:"Group avatar",className:"w-12 h-12 rounded-lg object-cover"}):r.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:r.jsx(At,{className:"w-6 h-6 text-green-600"})})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:L.name}),r.jsxs("p",{className:"text-sm text-gray-500",children:[((oe=L.members)==null?void 0:oe.length)||0," members"]})]})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:()=>W(L),className:"text-primary-600 hover:text-primary-900",children:r.jsx(jn,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>U(L.id),className:"text-red-600 hover:text-red-900",children:r.jsx(Ks,{className:"w-4 h-4"})})]})]}),L.description&&r.jsx("p",{className:"text-sm text-gray-600 mb-4",children:L.description}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Members:"}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[(P=L.members)==null?void 0:P.slice(0,3).map((Q,O)=>{var S,E,X;return r.jsxs("div",{className:"flex items-center space-x-1 bg-gray-100 rounded-full px-2 py-1",children:[r.jsx("div",{className:"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-xs font-medium text-primary-600",children:((E=(S=Q.user)==null?void 0:S.name)==null?void 0:E.charAt(0))||"U"})}),r.jsx("span",{className:"text-xs text-gray-700",children:((X=Q.user)==null?void 0:X.name)||"Unknown"})]},O)}),((q=L.members)==null?void 0:q.length)>3&&r.jsxs("span",{className:"text-xs text-gray-500",children:["+",L.members.length-3," more"]})]})]})]},L.id)})}),te.length===0&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(At,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No groups found"}),r.jsx("p",{className:"text-gray-500",children:c?"Try adjusting your search terms.":"Get started by creating your first group."})]})]}),f&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:g?"Edit Group":"Create Group"}),r.jsxs("form",{onSubmit:R,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Group Name"}),r.jsx("input",{type:"text",required:!0,value:_.name,onChange:L=>I({..._,name:L.target.value}),className:"input-field",placeholder:"Enter group name"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),r.jsx("textarea",{value:_.description,onChange:L=>I({..._,description:L.target.value}),className:"input-field",rows:"3",placeholder:"Enter group description (optional)"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Group Avatar"}),r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:"flex-shrink-0",children:w?r.jsx("img",{src:w,alt:"Avatar preview",className:"w-16 h-16 rounded-lg object-cover border-2 border-gray-200"}):r.jsx("div",{className:"w-16 h-16 rounded-lg bg-gray-100 border-2 border-gray-200 flex items-center justify-center",children:r.jsx(In,{className:"w-6 h-6 text-gray-400"})})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("input",{type:"file",accept:"image/*",onChange:Z,className:"hidden",id:"avatar-upload"}),r.jsxs("label",{htmlFor:"avatar-upload",className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 cursor-pointer transition-colors",children:[r.jsx(So,{className:"w-4 h-4 mr-2"}),M?"Change Avatar":"Upload Avatar"]}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PNG, JPG, GIF up to 5MB"})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Members"}),_.members.length>0&&r.jsxs("div",{className:"mb-3",children:[r.jsxs("p",{className:"text-xs text-gray-600 mb-2",children:["Selected Members: (",_.members.length,")"]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:_.members.map(L=>{var Q,O;const oe=typeof L.user=="string"?L.user:((Q=L.user)==null?void 0:Q.id)||((O=L.user)==null?void 0:O._id),P=s.find(S=>S.id===oe||S._id===oe),q=(P==null?void 0:P.name)||(P==null?void 0:P.username)||"Unknown User";return console.log("Rendering member:",{userId:oe,userData:P==null?void 0:P.name,memberName:q}),r.jsxs("div",{className:"flex items-center space-x-2 bg-primary-100 rounded-full px-3 py-1.5",children:[r.jsx("div",{className:"w-5 h-5 bg-primary-500 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-xs font-medium text-white",children:q.charAt(0).toUpperCase()})}),r.jsx("span",{className:"text-sm font-medium text-primary-700",children:q}),r.jsx("button",{type:"button",onClick:()=>{console.log("Remove button clicked for userId:",oe),se(oe)},className:"text-primary-600 hover:text-primary-900 transition-colors",children:r.jsx(ln,{className:"w-3.5 h-3.5"})})]},oe)})})]}),r.jsxs("div",{className:"border border-gray-300 rounded-lg p-3",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Add Members: (No Limit)"}),r.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:fe.length>0?fe.map(L=>{var oe;return r.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded transition-colors",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-xs font-medium text-primary-600",children:((oe=L.name)==null?void 0:oe.charAt(0).toUpperCase())||"U"})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:L.name||L.username||"Unknown"}),r.jsx("p",{className:"text-xs text-gray-500",children:L.email})]})]}),r.jsx("button",{type:"button",onClick:()=>{console.log("Add button clicked for userId:",L.id),ae(L.id)},className:"text-primary-600 hover:text-primary-800 transition-colors",title:`Add ${L.name||L.username}`,children:r.jsx(cm,{className:"w-4 h-4"})})]},L.id)}):r.jsx("div",{className:"text-center py-4 text-sm text-gray-500",children:_.members.length>0?r.jsx("p",{children:"All available users have been added to this group."}):r.jsx("p",{children:"No users available to add."})})})]})]}),r.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[r.jsx("button",{type:"button",onClick:()=>x(!1),className:"btn-secondary",children:"Cancel"}),r.jsx("button",{type:"submit",className:"btn-primary",children:g?"Update":"Create"})]})]})]})})]})},n4=()=>{var b,_,I,M,v,w;const{groupId:e}=Pb(),t=gr();fn();const[n,s]=h.useState(null),[o,i]=h.useState(!0),[a,c]=h.useState(!1);h.useEffect(()=>{d()},[e]);const d=async()=>{try{i(!0);const y=(await zt.getGroups()).data.find(R=>R.id===e);if(!y){D.error("Group not found"),t("/chat");return}s(y)}catch(m){console.error("Error fetching group details:",m),D.error("Failed to load group details"),t("/chat")}finally{i(!1)}},f=m=>{switch(m){case"admin":return r.jsx(Zi,{className:"w-4 h-4 text-blue-600"});default:return r.jsx(Nn,{className:"w-4 h-4 text-gray-600"})}},x=m=>{switch(m){case"admin":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},g=m=>new Date(m).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return o?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):n?r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("div",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"flex items-center py-4",children:[r.jsx("button",{onClick:()=>t("/chat"),className:"mr-4 p-2 text-gray-600 hover:text-gray-900 transition-colors",title:"Back to chat",children:r.jsx(xr,{className:"w-5 h-5"})}),r.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Group Info"})]})})}),r.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[r.jsxs("div",{className:"card p-8 text-center mb-6",children:[r.jsx("div",{className:"flex justify-center mb-6",children:r.jsx("div",{className:"w-32 h-32 rounded-full overflow-hidden bg-gray-100 border-4 border-white shadow-lg",children:n.avatar?r.jsx("img",{src:`${Se}${n.avatar}`,alt:"Group avatar",className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:r.jsx(At,{className:"w-16 h-16 text-white"})})})}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:n.name}),n.description&&r.jsx("p",{className:"text-gray-600 mb-4 max-w-md mx-auto",children:n.description}),r.jsxs("div",{className:"flex items-center justify-center space-x-6 text-sm text-gray-500 mb-6",children:[r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx(At,{className:"w-4 h-4"}),r.jsxs("span",{children:[((b=n.members)==null?void 0:b.length)||0," members"]})]}),r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx(_n,{className:"w-4 h-4"}),r.jsxs("span",{children:["Created ",g(n.createdAt)]})]})]})]}),r.jsxs("div",{className:"card p-6 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Members"}),r.jsxs("button",{onClick:()=>c(!a),className:"text-primary-600 hover:text-primary-800 transition-colors",children:[a?"Hide":"Show"," (",((_=n.members)==null?void 0:_.length)||0,")"]})]}),a&&r.jsx("div",{className:"space-y-3",children:(I=n.members)==null?void 0:I.map((m,y)=>r.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[r.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:m.user.profileImage?r.jsx("img",{src:`${Se}${m.user.profileImage}`,alt:m.user.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-primary-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white font-semibold text-sm",children:m.user.name.charAt(0).toUpperCase()})})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("h4",{className:"font-medium text-gray-900",children:m.user.name}),r.jsxs("div",{className:"flex items-center space-x-1",children:[f(m.role),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${x(m.role)}`,children:m.role})]})]}),r.jsx("p",{className:"text-sm text-gray-500",children:m.user.email})]}),r.jsx("div",{className:"text-xs text-gray-400",children:r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx(ms,{className:"w-3 h-3"}),r.jsxs("span",{children:["Joined ",g(m.joinedAt)]})]})})]},y))})]}),r.jsxs("div",{className:"card p-6 mt-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Group Statistics"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-primary-600",children:((M=n.members)==null?void 0:M.length)||0}),r.jsx("div",{className:"text-sm text-gray-500",children:"Total Members"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-green-600",children:((v=n.members)==null?void 0:v.filter(m=>m.role==="admin").length)||0}),r.jsx("div",{className:"text-sm text-gray-500",children:"Admins"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Math.ceil((((w=n.members)==null?void 0:w.length)||0)/2)}),r.jsx("div",{className:"text-sm text-gray-500",children:"Active Conversations"})]})]})]})]})]}):r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Group not found"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"The group you're looking for doesn't exist."}),r.jsx("button",{onClick:()=>t("/chat"),className:"btn-primary",children:"Back to Chat"})]})})},r4=()=>{const{user:e,setUser:t}=fn(),[n,s]=h.useState({name:"",email:"",phone:"",designation:"",profileImage:"",bio:""}),[o,i]=h.useState(!1),[a,c]=h.useState(!1),[d,f]=h.useState(null),[x,g]=h.useState(null);h.useEffect(()=>{e&&(s({name:e.name||"",email:e.email||"",phone:e.phone||"",designation:e.designation||"",profileImage:e.profileImage||"",bio:e.bio||""}),f(e.profileImage||null))},[e]);const b=w=>{const{name:m,value:y}=w.target;s(R=>({...R,[m]:y}))},_=w=>{const m=w.target.files[0];if(m){g(m);const y=new FileReader;y.onload=R=>{f(R.target.result)},y.readAsDataURL(m)}},I=()=>{g(null),f(null),s(w=>({...w,profileImage:""}))},M=async w=>{var m,y,R,U,W;w.preventDefault(),c(!0);try{const F=new FormData;F.append("name",n.name),n.phone&&n.phone.trim()&&F.append("phone",n.phone.trim()),n.designation&&n.designation.trim()&&F.append("designation",n.designation.trim()),n.bio&&n.bio.trim()&&F.append("bio",n.bio.trim()),x&&F.append("profileImage",x);const ae=((m=(await an.updateProfile(F)).data)==null?void 0:m.user)||{};s(se=>({...se,name:ae.name??se.name,phone:ae.phone??se.phone,designation:ae.designation??se.designation,bio:ae.bio??se.bio,profileImage:ae.profileImage??se.profileImage})),ae.profileImage&&f(ae.profileImage),t(se=>se?{...se,...ae}:ae),D.success("Profile updated successfully"),i(!1),g(null),setTimeout(()=>{window.location.reload()},1e3)}catch(F){console.error("Profile update error:",F);const Z=((R=(y=F.response)==null?void 0:y.data)==null?void 0:R.message)||((W=(U=F.response)==null?void 0:U.data)==null?void 0:W.error)||"Failed to update profile";D.error(Z)}finally{c(!1)}},v=()=>{i(!1),s({name:e.name||"",email:e.email||"",phone:e.phone||"",designation:e.designation||"",profileImage:e.profileImage||"",bio:e.bio||""}),f(e.profileImage||null),g(null)};return r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("div",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"flex items-center justify-between py-6",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx(Al,{to:"/dashboard",className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(xr,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile"}),r.jsx("p",{className:"text-gray-600",children:"Manage your profile information"})]})]}),!o&&r.jsxs("button",{onClick:()=>i(!0),className:"btn-primary inline-flex items-center",children:[r.jsx(jn,{className:"w-4 h-4 mr-2"}),"Edit Profile"]})]})})}),r.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[r.jsx("div",{className:"lg:col-span-1",children:r.jsx("div",{className:"card p-6",children:r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"relative inline-block",children:[d?r.jsx("img",{src:d.startsWith("http")||d.startsWith("data:")?d:`${Se}${d}`,alt:"Profile",className:"w-32 h-32 rounded-full object-cover mx-auto"}):r.jsx("div",{className:"w-32 h-32 bg-primary-100 rounded-full flex items-center justify-center mx-auto",children:r.jsx(Nn,{className:"w-16 h-16 text-primary-600"})}),o&&r.jsx("div",{className:"absolute bottom-0 right-0",children:r.jsxs("label",{className:"bg-primary-600 text-white p-2.5 rounded-full cursor-pointer hover:bg-primary-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center border-2 border-white",children:[r.jsx(FC,{className:"w-4 h-4"}),r.jsx("input",{type:"file",accept:"image/*",onChange:_,className:"hidden"})]})})]}),r.jsx("h2",{className:"text-xl font-bold text-gray-900 mt-4",children:n.name}),r.jsx("p",{className:"text-gray-600",children:n.designation||"No designation"}),r.jsx("p",{className:"text-sm text-gray-500 mt-2",children:n.email}),o&&d&&r.jsxs("button",{onClick:I,className:"mt-2 text-red-600 hover:text-red-700 text-sm inline-flex items-center",children:[r.jsx(ln,{className:"w-4 h-4 mr-1"}),"Remove Image"]})]})})}),r.jsx("div",{className:"lg:col-span-2",children:r.jsxs("div",{className:"card p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:o?"Edit Profile Information":"Profile Information"}),o?r.jsxs("form",{onSubmit:M,className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),r.jsx("input",{type:"text",name:"name",value:n.name,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),r.jsx("input",{type:"tel",name:"phone",value:n.phone,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"+1 (555) 123-4567"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designation"}),r.jsx("input",{type:"text",name:"designation",value:n.designation,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Software Developer"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),r.jsx("input",{type:"email",value:n.email,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),r.jsx("textarea",{name:"bio",value:n.bio,onChange:b,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Tell us about yourself..."})]}),r.jsxs("div",{className:"flex justify-end space-x-4",children:[r.jsx("button",{type:"button",onClick:v,className:"btn-secondary",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:a,className:"btn-primary inline-flex items-center",children:a?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Ny,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(Nn,{className:"w-5 h-5 text-gray-400"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Name"}),r.jsx("p",{className:"text-sm text-gray-600",children:n.name||"Not provided"})]})]}),r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(Qi,{className:"w-5 h-5 text-gray-400"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Phone"}),r.jsx("p",{className:"text-sm text-gray-600",children:n.phone||"Not provided"})]})]}),r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(DC,{className:"w-5 h-5 text-gray-400"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Designation"}),r.jsx("p",{className:"text-sm text-gray-600",children:n.designation||"Not provided"})]})]}),r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(by,{className:"w-5 h-5 text-gray-400"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Email"}),r.jsx("p",{className:"text-sm text-gray-600",children:n.email})]})]})]}),n.bio&&r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 mb-2",children:"Bio"}),r.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-4 rounded-lg",children:n.bio})]})]})]})})]})})]})};function s4(){const e=gr(),[t,n]=h.useState(!0),[s,o]=h.useState([]),[i,a]=h.useState([]),[c,d]=h.useState(new Set),[f,x]=h.useState(new Set),[g,b]=h.useState(null),[_,I]=h.useState(!1),[M,v]=h.useState("users"),[w,m]=h.useState(""),y=te=>te&&(/^https?:\/\//i.test(te)?te:`${Se}${te}`),R=te=>{if(!te&&te!==0)return"";const fe=te/1024/1024;return`${fe.toFixed(fe<.1?2:1)} MB`};h.useEffect(()=>{try{const te=sessionStorage.getItem("forwardMessage");te&&b(JSON.parse(te))}catch{}},[]),h.useEffect(()=>{(async()=>{try{n(!0);const[fe,L]=await Promise.all([an.getActiveUsers(),zt.getGroups()]);o(fe.data||[]),a((L.data||[]).filter(oe=>oe.isActive!==!1))}catch{}finally{n(!1)}})()},[]);const U=te=>{d(fe=>{const L=new Set(fe);return L.has(te)?L.delete(te):L.add(te),L})},W=te=>{x(fe=>{const L=new Set(fe);return L.has(te)?L.delete(te):L.add(te),L})},F=async()=>{if(!(!(g!=null&&g.id)&&!(g!=null&&g._id))&&!(c.size===0&&f.size===0))try{I(!0),await yt.forwardMessage({messageId:g.id||g._id,targets:{users:Array.from(c),groups:Array.from(f)}}),sessionStorage.removeItem("forwardMessage"),e(-1)}catch{I(!1)}};if(t)return r.jsx("div",{className:"p-6",children:"Loading..."});const Z=s.filter(te=>te.name.toLowerCase().includes(w.toLowerCase())||(te.email||"").toLowerCase().includes(w.toLowerCase())),ae=i.filter(te=>te.name.toLowerCase().includes(w.toLowerCase())),se=c.size+f.size;return r.jsxs("div",{className:"h-screen bg-white",children:[r.jsxs("div",{className:"sticky top-0 z-10 bg-gray-100 text-white",children:[r.jsx("div",{className:"max-w-3xl mx-auto px-4 pt-3",children:r.jsx("input",{value:w,onChange:te=>m(te.target.value),placeholder:"Search name or group",className:"w-full bg-white text-gray-800 rounded-full px-4 py-2 text-sm focus:outline-none",type:"text"})}),r.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-2 flex items-center justify-between gap-2",children:[r.jsxs("div",{className:"inline-flex bg-white rounded-full p-1",children:[r.jsx("button",{className:`px-4 py-1 text-sm rounded-full ${M==="users"?"bg-gray-200 text-gray-800":"text-gray-800"}`,onClick:()=>v("users"),children:"Chats"}),r.jsx("button",{className:`px-4 py-1 text-sm rounded-full ${M==="groups"?"bg-gray-200 text-gray-800":"text-gray-800"}`,onClick:()=>v("groups"),children:"Groups"})]}),r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsx("div",{className:"font-semibold -ml-4 whitespace-nowrap text-gray-800",children:"Forward"})}),r.jsxs("div",{className:"text-sm opacity-90 whitespace-nowrap text-gray-800",children:[se," selected"]})]})]}),r.jsxs("div",{className:"max-w-3xl mx-auto px-4 pt-3 pb-24",children:[g&&r.jsx("div",{className:"mb-3",children:r.jsxs("div",{className:"bg-gray-100 rounded-2xl p-3 inline-block max-w-full",children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:r.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Preview"})}),g.messageType==="image"?r.jsxs("div",{className:"max-w-[200px]",children:[r.jsx("img",{src:y(g.fileUrl),alt:g.fileName||"image",className:"rounded-lg w-full h-auto max-h-[150px] object-cover"}),g.message&&r.jsx("div",{className:"mt-2 text-sm text-gray-800 break-words",children:g.message}),r.jsxs("div",{className:"mt-2",children:[c.size>0&&f.size===0&&r.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700",children:"Personal"}),f.size>0&&c.size===0&&r.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700",children:"Group"})]})]}):g.messageType==="video"?r.jsxs("div",{className:"max-w-[200px]",children:[r.jsx("video",{src:y(g.fileUrl),controls:!0,className:"rounded-lg w-full h-auto max-h-[150px] object-cover"}),g.message&&r.jsx("div",{className:"mt-2 text-sm text-gray-800 break-words",children:g.message}),r.jsxs("div",{className:"mt-2",children:[c.size>0&&f.size===0&&r.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700",children:"Personal"}),f.size>0&&c.size===0&&r.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700",children:"Group"})]})]}):g.messageType&&g.messageType!=="text"?r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white rounded-lg shadow-sm",children:[r.jsx("svg",{className:"w-6 h-6 text-gray-600",viewBox:"0 0 24 24",fill:"currentColor",children:r.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM8 18h8v2H8v-2zm0-4h8v2H8v-2zm6-7.5V9h3.5L14 6.5z"})}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:g.fileName||"Attachment"}),r.jsx("div",{className:"text-xs text-gray-500",children:R(g.fileSize)}),g.message&&r.jsx("div",{className:"text-sm text-gray-800 break-words mt-1",children:g.message})]})]}),r.jsxs("div",{className:"mt-2",children:[c.size>0&&f.size===0&&r.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700",children:"Personal"}),f.size>0&&c.size===0&&r.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700",children:"Group"})]})]}):r.jsx("div",{className:"text-sm text-gray-800 break-words max-w-[200px]",children:g.message})]})}),M==="users"?r.jsxs("div",{className:"divide-y border rounded-xl overflow-hidden",children:[Z.map(te=>{var fe,L;return r.jsxs("button",{onClick:()=>U(te.id),className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50",children:[r.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-green-500 text-white flex items-center justify-center",children:te.profileImage?r.jsx("img",{src:`${Se}${te.profileImage}`,alt:te.name,className:"w-full h-full object-cover"}):r.jsx("span",{className:"font-semibold",children:(L=(fe=te.name)==null?void 0:fe[0])==null?void 0:L.toUpperCase()})}),r.jsxs("div",{className:"flex-1 text-left min-w-0",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:te.name}),r.jsx("div",{className:"text-xs text-gray-500 truncate",children:te.email})]}),r.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${c.has(te.id)?"bg-green-500 border-green-500":"border-gray-300"}`,children:c.has(te.id)&&r.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:r.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.414l2.293 2.293 6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},te.id)}),Z.length===0&&r.jsx("div",{className:"p-6 text-center text-sm text-gray-500",children:"No chats found"})]}):r.jsxs("div",{className:"divide-y border rounded-xl overflow-hidden",children:[ae.map(te=>{var L;const fe=te.id||te._id;return r.jsxs("button",{onClick:()=>W(fe),className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50",children:[r.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-green-500 text-white flex items-center justify-center",children:te.avatar?r.jsx("img",{src:`${Se}${te.avatar}`,alt:te.name,className:"w-full h-full object-cover"}):r.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"currentColor",children:r.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V20h14v-3.5C15 14.17 10.33 13 8 13zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V20h6v-3.5c0-2.33-4.67-3.5-7-3.5z"})})}),r.jsxs("div",{className:"flex-1 text-left min-w-0",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:te.name}),r.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[((L=te.members)==null?void 0:L.length)||0," members"]})]}),r.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${f.has(fe)?"bg-green-500 border-green-500":"border-gray-300"}`,children:f.has(fe)&&r.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:r.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.414l2.293 2.293 6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},fe)}),ae.length===0&&r.jsx("div",{className:"p-6 text-center text-sm text-gray-500",children:"No groups found"})]})]}),r.jsx("div",{className:"fixed bottom-0 inset-x-0 bg-white border-t",children:r.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-3 flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:[se," selected"]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{className:"btn-secondary",onClick:()=>e(-1),children:"Cancel"}),r.jsx("button",{className:"btn-primary",disabled:_||se===0,onClick:F,children:"Send"})]})]})})]})}const o4=()=>{fn();const e=gr(),[t,n]=h.useState([]),[s,o]=h.useState(new Date),[i,a]=h.useState(new Date),[c,d]=h.useState(""),[f,x]=h.useState(null),[g,b]=h.useState(!0),[_,I]=h.useState({}),[M,v]=h.useState("grid"),[w,m]=h.useState([]),[y,R]=h.useState(!1),[U,W]=h.useState(null),[F,Z]=h.useState(0),ae=$=>{const J=$.getFullYear(),B=String($.getMonth()+1).padStart(2,"0"),ue=String($.getDate()).padStart(2,"0");return`${J}-${B}-${ue}`},se=$=>{const J=new Date;J.setHours(0,0,0,0);const B=new Date($);return B.setHours(0,0,0,0),B>J};h.useEffect(()=>{te()},[]),h.useEffect(()=>{const $=ae(s),J=_[$];J?(d(J.content),x(J._id),m(J.media||[])):(d(""),x(null),m([]))},[s,_]);const te=async()=>{var $;try{b(!0);const J=localStorage.getItem("token");console.log(" Fetching daily updates from:",`${Se}/api/daily-updates`);const B=await nt.get(`${Se}/api/daily-updates`,{headers:{Authorization:`Bearer ${J}`}});console.log(" Daily updates fetched:",B.data),console.log(" Total updates:",B.data.length),n(B.data);const ue={};B.data.forEach(me=>{const ye=ae(new Date(me.date));ue[ye]=me}),I(ue)}catch(J){console.error(" Error fetching updates:",J),console.error("Error details:",($=J.response)==null?void 0:$.data),D.error("Failed to load updates")}finally{b(!1)}},fe=async $=>{const J=Array.from($.target.files);if(J.length===0)return;R(!0);const B=localStorage.getItem("token");try{const ue=[];for(const me of J){const ye=new FormData;ye.append("file",me);const Ie=await nt.post(`${Se}/api/daily-updates/upload-media`,ye,{headers:{Authorization:`Bearer ${B}`,"Content-Type":"multipart/form-data"}});ue.push(Ie.data)}m([...w,...ue]),D.success(`${ue.length} file(s) uploaded successfully`)}catch(ue){console.error("Error uploading media:",ue),D.error("Failed to upload media")}finally{R(!1)}},L=$=>{m(w.filter((J,B)=>B!==$))},oe=($,J)=>{W($),Z(J)},P=()=>{W(null),Z(0)},q=()=>{U&&F<U.length-1&&Z(F+1)},Q=()=>{F>0&&Z(F-1)},O=$=>{U&&($.key==="Escape"&&P(),$.key==="ArrowRight"&&q(),$.key==="ArrowLeft"&&Q())};h.useEffect(()=>{if(U)return window.addEventListener("keydown",O),()=>window.removeEventListener("keydown",O)},[U,F]);const S=async($,J)=>{try{const ue=await(await fetch($)).blob(),me=window.URL.createObjectURL(ue),ye=document.createElement("a");ye.href=me,ye.download=J||"download",document.body.appendChild(ye),ye.click(),window.URL.revokeObjectURL(me),document.body.removeChild(ye),D.success("Download started!")}catch(B){console.error("Download error:",B),D.error("Failed to download file")}},E=async()=>{var $,J;if(!c.trim()){D.error("Please enter an update");return}if(se(s)){D.error("Cannot create updates for future dates");return}try{const B=localStorage.getItem("token"),ue=ae(s);f?(await nt.put(`${Se}/api/daily-updates/${f}`,{content:c,media:w},{headers:{Authorization:`Bearer ${B}`}}),D.success("Update saved successfully")):(await nt.post(`${Se}/api/daily-updates`,{date:ue,content:c,media:w},{headers:{Authorization:`Bearer ${B}`}}),D.success("Update added successfully")),te()}catch(B){console.error("Error saving update:",B);const ue=((J=($=B.response)==null?void 0:$.data)==null?void 0:J.error)||"Failed to save update";D.error(ue)}},X=async $=>{if(confirm("Are you sure you want to delete this update?"))try{const J=localStorage.getItem("token");await nt.delete(`${Se}/api/daily-updates/${$}`,{headers:{Authorization:`Bearer ${J}`}}),D.success("Update deleted successfully"),d(""),x(null),m([]),te()}catch(J){console.error("Error deleting update:",J),D.error("Failed to delete update")}},z=$=>{const J=$.getFullYear(),B=$.getMonth(),ue=new Date(J,B,1),ye=new Date(J,B+1,0).getDate(),Ie=ue.getDay();return{daysInMonth:ye,startingDayOfWeek:Ie}},G=$=>{if(_[$]){const J=_[$].content.length;return J>500?"bg-gradient-to-br from-green-400 to-green-600":J>200?"bg-gradient-to-br from-blue-400 to-blue-600":"bg-gradient-to-br from-purple-400 to-purple-600"}return""},V=()=>{const{daysInMonth:$,startingDayOfWeek:J}=z(i),B=[],ue=i.toLocaleDateString("en-US",{month:"long",year:"numeric"});for(let me=0;me<J;me++)B.push(r.jsx("div",{className:"p-2"},`empty-${me}`));for(let me=1;me<=$;me++){const ye=new Date(i.getFullYear(),i.getMonth(),me),Ie=ae(ye),wt=ye.toDateString()===s.toDateString(),Ze=ye.toDateString()===new Date().toDateString(),Rt=se(ye),Ht=_[Ie],Be=G(Ie);B.push(r.jsxs("button",{onClick:()=>!Rt&&o(ye),disabled:Rt,className:`
            relative p-3 rounded-xl text-center transition-all transform
            ${Rt?"cursor-not-allowed opacity-40":"hover:scale-105"}
            ${wt?"ring-4 ring-blue-500 ring-offset-2 scale-105":""}
            ${Ht?`${Be} text-white font-bold shadow-lg`:Ze?"bg-gray-100 text-gray-900 font-semibold border-2 border-blue-500":Rt?"bg-gray-100 text-gray-400":"bg-gray-50 hover:bg-gray-100 text-gray-700"}
          `,children:[r.jsx("span",{className:"text-sm",children:me}),Ht&&r.jsx("div",{className:"absolute top-1 right-1",children:r.jsx(Ei,{className:"w-3 h-3 text-white"})})]},me))}return r.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("button",{onClick:()=>a(new Date(i.getFullYear(),i.getMonth()-1)),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(Po,{className:"w-6 h-6 text-gray-600"})}),r.jsx("h3",{className:"text-xl font-bold text-gray-800",children:ue}),r.jsx("button",{onClick:()=>a(new Date(i.getFullYear(),i.getMonth()+1)),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(Lo,{className:"w-6 h-6 text-gray-600"})})]}),r.jsx("div",{className:"grid grid-cols-7 gap-2 text-center mb-3",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(me=>r.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:me},me))}),r.jsx("div",{className:"grid grid-cols-7 gap-2",children:B}),r.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[r.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"Update Length:"}),r.jsxs("div",{className:"flex gap-3 text-xs",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-purple-400 to-purple-600"}),r.jsx("span",{className:"text-gray-600",children:"Short"})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-blue-400 to-blue-600"}),r.jsx("span",{className:"text-gray-600",children:"Medium"})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-green-400 to-green-600"}),r.jsx("span",{className:"text-gray-600",children:"Long"})]})]})]})]})};return r.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50",children:[r.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[r.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6 border border-gray-100",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("button",{onClick:()=>e("/dashboard"),className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:r.jsx(xr,{className:"w-6 h-6 text-gray-700"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Daily Updates"}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track your daily progress and achievements"})]})]}),r.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-blue-100 to-purple-100 px-4 py-3 rounded-xl",children:[r.jsx(Cy,{className:"w-5 h-5 text-blue-600"}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-xs text-gray-600",children:"Total Updates"}),r.jsx("p",{className:"text-xl font-bold text-gray-800",children:t.length})]})]})]})}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[r.jsxs("div",{className:"lg:col-span-1",children:[V(),r.jsxs("div",{className:"mt-6 bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[r.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[r.jsx(ms,{className:"w-5 h-5 text-blue-600"}),"This Month"]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Updates Created"}),r.jsx("span",{className:"text-lg font-bold text-blue-600",children:t.filter($=>{const J=new Date($.date);return J.getMonth()===i.getMonth()&&J.getFullYear()===i.getFullYear()}).length})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Current Streak"}),r.jsxs("span",{className:"text-lg font-bold text-green-600",children:[" ",t.length>0?"1":"0"," days"]})]})]})]})]}),r.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[r.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[r.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-gray-800",children:[r.jsx(jn,{className:"w-6 h-6 text-blue-600"}),r.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:s.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),g?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-4 border-blue-600"})}):r.jsxs(r.Fragment,{children:[se(s)&&r.jsxs("div",{className:"mb-4 bg-yellow-50 border border-yellow-200 rounded-xl p-4 flex items-center gap-3",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("svg",{className:"w-6 h-6 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold text-yellow-800",children:"Future Date Selected"}),r.jsx("p",{className:"text-sm text-yellow-700",children:"You cannot create updates for future dates. Please select today or a past date."})]})]}),r.jsx("textarea",{value:c,onChange:$=>d($.target.value),placeholder:" What amazing things did you accomplish today? Share your progress, learnings, and wins...",className:"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none transition-all",rows:"8",disabled:se(s)}),r.jsxs("div",{className:"mt-4",children:[r.jsxs("label",{className:`flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-xl transition-colors w-fit ${se(s)?"opacity-50 cursor-not-allowed":"hover:bg-gray-200 cursor-pointer"}`,children:[r.jsx(So,{className:"w-5 h-5"}),r.jsx("span",{className:"font-medium",children:"Upload Files (Images/Videos/Documents)"}),r.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*,.pdf,.zip,.cdr,.psd,.ai,.ps,.doc,.docx,.xls,.xlsx",onChange:fe,className:"hidden",disabled:y||se(s)})]}),y&&r.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"Uploading..."})]}),w.length>0&&r.jsx("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-3 gap-3",children:w.map(($,J)=>r.jsxs("div",{className:"relative group rounded-xl overflow-hidden border-2 border-gray-200 cursor-pointer",onClick:()=>$.type==="image"&&oe(w,J),children:[$.type==="image"?r.jsx("img",{src:$.url,alt:$.filename,className:"w-full h-32 object-cover hover:scale-105 transition-transform"}):$.type==="video"?r.jsx("video",{src:$.url,className:"w-full h-32 object-cover",controls:!0}):r.jsxs("div",{className:"w-full h-32 bg-gray-100 flex flex-col items-center justify-center p-4",children:[r.jsx(Xt,{className:"w-12 h-12 text-gray-500 mb-2"}),r.jsx("span",{className:"text-xs text-gray-600 text-center truncate w-full px-2",children:$.filename})]}),r.jsx("button",{onClick:B=>{B.stopPropagation(),L(J)},className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-10",children:r.jsx(ln,{className:"w-4 h-4"})}),r.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2",children:r.jsxs("span",{className:"text-white text-xs flex items-center gap-1 truncate",children:[$.type==="image"?r.jsx(In,{className:"w-3 h-3"}):$.type==="video"?r.jsx($t,{className:"w-3 h-3"}):r.jsx(Xt,{className:"w-3 h-3"}),$.filename]})})]},J))}),r.jsxs("div",{className:"flex gap-3 mt-4",children:[r.jsxs("button",{onClick:E,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all flex items-center justify-center gap-2 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105",children:[r.jsx(Ny,{className:"w-5 h-5"}),f?"Update":"Save"," Daily Update"]}),f&&r.jsxs("button",{onClick:()=>X(f),className:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl hover:from-red-600 hover:to-red-700 transition-all flex items-center gap-2 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105",children:[r.jsx(Ks,{className:"w-5 h-5"}),"Delete"]})]})]})]}),r.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2 text-gray-800",children:[r.jsx(_n,{className:"w-6 h-6 text-purple-600"}),"All Updates"]}),r.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-xl p-1",children:[r.jsx("button",{onClick:()=>v("grid"),className:`p-2 rounded-lg transition-all ${M==="grid"?"bg-white text-blue-600 shadow-md":"text-gray-500 hover:text-gray-700"}`,title:"Grid View",children:r.jsx(im,{className:"w-5 h-5"})}),r.jsx("button",{onClick:()=>v("list"),className:`p-2 rounded-lg transition-all ${M==="list"?"bg-white text-blue-600 shadow-md":"text-gray-500 hover:text-gray-700"}`,title:"List View",children:r.jsx(yc,{className:"w-5 h-5"})})]})]}),t.length===0?r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"bg-gray-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:r.jsx(_n,{className:"w-10 h-10 text-gray-400"})}),r.jsx("p",{className:"text-gray-500 text-lg",children:"No updates yet"}),r.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Start tracking your daily progress!"})]}):M==="grid"?r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar",children:t.map($=>{const J=ae(new Date($.date)),B=G(J),ue=J===ae(s);return r.jsxs("div",{onClick:()=>o(new Date($.date)),className:`${B} p-5 rounded-xl cursor-pointer transition-all transform hover:scale-105 hover:shadow-xl ${ue?"ring-4 ring-blue-500 ring-offset-2 scale-105":"shadow-lg"}`,children:[r.jsxs("div",{className:"flex justify-between items-start mb-3",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-white font-bold text-lg",children:new Date($.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})}),r.jsx("div",{className:"flex items-center gap-2 mt-1",children:r.jsx("span",{className:"text-white/80 text-xs",children:new Date($.updatedAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})})]}),r.jsx(Ei,{className:"w-6 h-6 text-white"})]}),r.jsx("p",{className:"text-white line-clamp-4 text-sm leading-relaxed",children:$.content}),$.media&&$.media.length>0&&r.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 relative",children:[$.media.slice(0,2).map((me,ye)=>r.jsx("div",{className:"relative rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:Ie=>{Ie.stopPropagation(),me.type==="image"?oe($.media,ye):window.open(me.url,"_blank")},children:me.type==="image"?r.jsx("img",{src:me.url,alt:me.filename,className:"w-full h-20 object-cover"}):me.type==="video"?r.jsx("div",{className:"w-full h-20 bg-black/20 flex items-center justify-center",children:r.jsx($t,{className:"w-6 h-6 text-white"})}):r.jsxs("div",{className:"w-full h-20 bg-black/20 flex flex-col items-center justify-center p-2",children:[r.jsx(Xt,{className:"w-5 h-5 text-white mb-1"}),r.jsx("span",{className:"text-white text-[10px] truncate w-full text-center",children:me.filename})]})},ye)),$.media.length>2&&r.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded",children:["+",$.media.length-2," more"]})]}),$.content.length>150&&r.jsx("button",{className:"text-white/90 text-xs font-semibold mt-2 hover:text-white transition-colors",children:"Read more "})]},$._id)})}):r.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar",children:t.map($=>{const J=ae(new Date($.date)),B=G(J),ue=J===ae(s);return r.jsx("div",{onClick:()=>o(new Date($.date)),className:`${B} p-4 rounded-xl cursor-pointer transition-all hover:shadow-xl ${ue?"ring-4 ring-blue-500 ring-offset-2":"shadow-md"}`,children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-lg p-3 text-center min-w-[80px]",children:[r.jsx("div",{className:"text-white font-bold text-2xl",children:new Date($.date).getDate()}),r.jsx("div",{className:"text-white/90 text-xs font-semibold uppercase",children:new Date($.date).toLocaleDateString("en-US",{month:"short"})}),r.jsx("div",{className:"text-white/80 text-xs",children:new Date($.date).getFullYear()})]})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-white font-bold text-base",children:new Date($.date).toLocaleDateString("en-US",{weekday:"long"})}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-white/80 text-xs",children:new Date($.updatedAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}),r.jsx(Ei,{className:"w-5 h-5 text-white"})]})]}),r.jsx("p",{className:"text-white/95 text-sm leading-relaxed line-clamp-2",children:$.content}),$.media&&$.media.length>0&&r.jsxs("div",{className:"mt-3 flex gap-2",children:[$.media.slice(0,3).map((me,ye)=>r.jsx("div",{className:"relative rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:Ie=>{Ie.stopPropagation(),me.type==="image"?oe($.media,ye):window.open(me.url,"_blank")},children:me.type==="image"?r.jsx("img",{src:me.url,alt:me.filename,className:"w-16 h-16 object-cover"}):me.type==="video"?r.jsx("div",{className:"w-16 h-16 bg-black/20 flex items-center justify-center",children:r.jsx($t,{className:"w-4 h-4 text-white"})}):r.jsx("div",{className:"w-16 h-16 bg-black/20 flex flex-col items-center justify-center p-1",children:r.jsx(Xt,{className:"w-4 h-4 text-white"})})},ye)),$.media.length>3&&r.jsx("div",{className:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center",children:r.jsxs("span",{className:"text-white font-bold text-xs",children:["+",$.media.length-3]})})]}),r.jsx("div",{className:"flex items-center justify-between mt-2",children:$.content.length>100&&r.jsx("button",{className:"text-white/90 text-xs font-semibold hover:text-white transition-colors",children:"Read more "})})]})]})},$._id)})})]})]})]})]}),U&&r.jsxs("div",{className:"fixed inset-0 bg-black/95 z-50 flex items-center justify-center",children:[r.jsx("button",{onClick:P,className:"absolute top-4 right-4 bg-white/10 hover:bg-white/20 text-white p-3 rounded-full transition-colors z-10",children:r.jsx(ln,{className:"w-6 h-6"})}),r.jsxs("button",{onClick:()=>S(U[F].url,U[F].filename),className:"absolute top-4 right-20 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-full transition-colors flex items-center gap-2 shadow-lg z-10",children:[r.jsx(Jt,{className:"w-5 h-5"}),r.jsx("span",{className:"text-sm font-semibold",children:"Download"})]}),U.length>1&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:Q,className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Previous",children:r.jsx(Po,{className:"w-8 h-8 text-white stroke-[3]"})}),r.jsx("button",{onClick:q,className:"absolute right-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Next",children:r.jsx(Lo,{className:"w-8 h-8 text-white stroke-[3]"})})]}),U.length>1&&r.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-black/50 text-white px-4 py-2 rounded-full text-sm",children:[F+1," / ",U.length]}),r.jsx("div",{className:"max-w-7xl max-h-[90vh] w-full h-full flex items-center justify-center p-4",children:U[F].type==="image"?r.jsx("img",{src:U[F].url,alt:U[F].filename,className:"max-w-full max-h-full object-contain rounded-lg"}):r.jsx("video",{src:U[F].url,controls:!0,autoPlay:!0,className:"max-w-full max-h-full rounded-lg"})}),r.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex flex-col items-center gap-2",children:[r.jsx("div",{className:"bg-black/50 text-white px-4 py-2 rounded-full text-sm max-w-md truncate",children:U[F].filename}),r.jsx("div",{className:"text-white/60 text-xs",children:"Press ESC to close  Arrow keys to navigate  Click Download to save"})]})]}),r.jsx("style",{dangerouslySetInnerHTML:{__html:`
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: linear-gradient(to bottom, #2563eb, #7c3aed);
        }
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        .line-clamp-3 {
          display: -webkit-box;
          -webkit-line-clamp: 3;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        .line-clamp-4 {
          display: -webkit-box;
          -webkit-line-clamp: 4;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `}})]})},i4=()=>{fn();const e=gr(),[t,n]=h.useState([]);h.useState(""),h.useState(""),h.useState("medium"),h.useState("pending"),h.useState(""),h.useState(null);const[s,o]=h.useState(!0),[i,a]=h.useState("all");h.useState(!1);const[c,d]=h.useState(null),[f,x]=h.useState(!1),[g,b]=h.useState(""),[_,I]=h.useState(!1),[M,v]=h.useState(null),[w,m]=h.useState(0);h.useEffect(()=>{y()},[i]);const y=async()=>{try{o(!0);const P=localStorage.getItem("token"),q=i!=="all"?`?status=${i}`:"",Q=await nt.get(`${Se}/api/tasks${q}`,{headers:{Authorization:`Bearer ${P}`}});n(Q.data)}catch(P){console.error("Error fetching tasks:",P),D.error("Failed to load tasks")}finally{o(!1)}},R=async(P,q)=>{const Q=Array.from(P.target.files);if(Q.length!==0){I(!0);try{const O=localStorage.getItem("token"),S=[];for(const X of Q){const z=new FormData;z.append("file",X);const G=await nt.post(`${Se}/api/tasks/upload-media`,z,{headers:{Authorization:`Bearer ${O}`,"Content-Type":"multipart/form-data"}});S.push(G.data)}const E=await nt.post(`${Se}/api/tasks/${q}/comment`,{text:"",media:S},{headers:{Authorization:`Bearer ${O}`}});n(t.map(X=>X._id===q?E.data:X)),c&&c._id===q&&d(E.data),D.success(`${S.length} file(s) uploaded as comment!`)}catch(O){console.error("Error uploading media:",O),D.error("Failed to upload media")}finally{I(!1)}}},U=async P=>{if(g.trim())try{const q=localStorage.getItem("token"),Q=await nt.post(`${Se}/api/tasks/${P}/comment`,{text:g},{headers:{Authorization:`Bearer ${q}`}});n(t.map(O=>O._id===P?Q.data:O)),c&&c._id===P&&d(Q.data),b(""),D.success("Comment added!")}catch(q){console.error("Error adding comment:",q),D.error("Failed to add comment")}},W=(P,q=0)=>{P.media&&P.media.length>0&&(v(P.media),m(q))},F=()=>{v(null),m(0)},Z=()=>{m(P=>(P+1)%M.length)},ae=()=>{m(P=>(P-1+M.length)%M.length)},se=async(P,q)=>{try{const O=await(await fetch(P)).blob(),S=window.URL.createObjectURL(O),E=document.createElement("a");E.href=S,E.download=q||"download",document.body.appendChild(E),E.click(),document.body.removeChild(E),window.URL.revokeObjectURL(S),D.success("Download started!")}catch(Q){console.error("Error downloading media:",Q),D.error("Failed to download")}},te=async(P,q)=>{try{let Q="pending",O=0;q==="pending"?(Q="in-progress",O=50):q==="in-progress"?(Q="completed",O=100):(Q="pending",O=0),n(E=>E.map(X=>X._id===P?{...X,status:Q,progress:O}:X)),D.success(`Status: ${Q==="in-progress"?"In Progress":Q}`);const S=localStorage.getItem("token");await nt.put(`${Se}/api/tasks/${P}`,{status:Q,progress:O},{headers:{Authorization:`Bearer ${S}`}})}catch(Q){console.error("Error updating task status:",Q),D.error("Failed to update task status"),y()}},fe=async(P,q)=>{try{let Q="pending";q>0&&q<100?Q="in-progress":q===100&&(Q="completed"),n(S=>S.map(E=>E._id===P?{...E,progress:q,status:Q}:E));const O=localStorage.getItem("token");await nt.put(`${Se}/api/tasks/${P}`,{progress:q,status:Q},{headers:{Authorization:`Bearer ${O}`}})}catch(Q){console.error("Error updating progress:",Q),D.error("Failed to update progress"),y()}},L=P=>{switch(P){case"high":return"bg-red-100 text-red-800 border border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border border-yellow-200";case"low":return"bg-green-100 text-green-800 border border-green-200";default:return"bg-gray-100 text-gray-800 border border-gray-200"}},oe=P=>{switch(P){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-blue-100 text-blue-800";case"pending":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return r.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[r.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[r.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 mb-6 border border-white/50",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("button",{onClick:()=>e("/dashboard"),className:"p-2 hover:bg-gray-100 rounded-xl transition-all hover:scale-110",children:r.jsx(xr,{className:"w-6 h-6 text-gray-700"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"My Tasks"}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track and manage your assigned tasks"})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"bg-gradient-to-r from-blue-100 to-blue-200 px-4 py-3 rounded-xl",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-xs text-blue-700 font-medium",children:"Total Tasks"}),r.jsx("p",{className:"text-2xl font-bold text-blue-900",children:t.length})]})}),r.jsx("div",{className:"bg-gradient-to-r from-green-100 to-green-200 px-4 py-3 rounded-xl",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-xs text-green-700 font-medium",children:"Completed"}),r.jsx("p",{className:"text-2xl font-bold text-green-900",children:t.filter(P=>P.status==="completed").length})]})})]})]})}),r.jsx("div",{className:"flex gap-3 mb-6",children:["all","pending","in-progress","completed"].map(P=>{const q=P==="all"?t.length:t.filter(Q=>Q.status===P).length;return r.jsxs("button",{onClick:()=>a(P),className:`flex-1 py-4 px-6 rounded-xl font-semibold capitalize transition-all transform ${i===P?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg scale-105":"bg-white text-gray-700 hover:bg-gray-50 shadow"}`,children:[r.jsx("div",{className:"text-sm opacity-90",children:P==="in-progress"?"In Progress":P}),r.jsx("div",{className:"text-2xl font-bold mt-1",children:q})]},P)})}),s?r.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-12 text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-blue-600 mx-auto"}),r.jsx("p",{className:"text-gray-500 mt-4",children:"Loading your tasks..."})]}):t.length===0?r.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-12 text-center",children:[r.jsx(Ei,{className:"w-20 h-20 text-gray-300 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600 text-lg font-semibold",children:"No tasks found"}),r.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Your admin will assign tasks to you"})]}):r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(P=>{const q=P.progress||0,Q=P.status==="completed",O=P.status==="in-progress";return r.jsxs("div",{className:`bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1 border-2 ${Q?"border-green-200":O?"border-blue-200":"border-gray-200"}`,children:[r.jsx("div",{className:`p-4 rounded-t-2xl ${Q?"bg-gradient-to-r from-green-50 to-emerald-50":O?"bg-gradient-to-r from-blue-50 to-indigo-50":"bg-gradient-to-r from-gray-50 to-slate-50"}`,children:r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[r.jsx("button",{onClick:()=>te(P._id,P.status),className:"flex-shrink-0 group mt-0.5",title:"Click to cycle status",children:Q?r.jsxs("div",{className:"relative",children:[r.jsx(Ei,{className:"w-8 h-8 text-green-600 group-hover:scale-110 transition-transform drop-shadow"}),r.jsx("div",{className:"absolute inset-0 bg-green-400 rounded-full blur-xl opacity-30 group-hover:opacity-50"})]}):O?r.jsxs("div",{className:"relative",children:[r.jsx(Pu,{className:"w-8 h-8 text-blue-600 group-hover:scale-110 transition-transform"}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx("div",{className:"w-3.5 h-3.5 bg-blue-600 rounded-full animate-pulse"})})]}):r.jsx(Pu,{className:"w-8 h-8 text-gray-400 group-hover:text-blue-600 group-hover:scale-110 transition-all"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:`text-base font-bold mb-1 ${Q?"line-through text-gray-500":"text-gray-800"}`,children:P.title}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsx("span",{className:`px-2 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wider ${L(P.priority)}`,children:P.priority}),r.jsx("span",{className:`px-2 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wider ${oe(P.status)}`,children:P.status==="in-progress"?"In Progress":P.status})]})]})]})})}),r.jsxs("div",{className:"p-4",children:[P.description&&r.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2 leading-relaxed",children:P.description}),r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("label",{className:"text-sm font-bold text-gray-700",children:"Progress (Click to edit)"}),r.jsxs("span",{className:`text-lg font-bold ${q===100?"text-green-600":"text-blue-600"}`,children:[q,"%"]})]}),r.jsxs("div",{className:"relative group",children:[r.jsxs("div",{className:"h-8 bg-gray-100 rounded-full overflow-hidden shadow-inner cursor-pointer",children:[r.jsx("div",{className:`h-full transition-all duration-500 ease-out relative ${q===100?"bg-gradient-to-r from-green-400 via-green-500 to-green-600":q>0?"bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600":"bg-gray-200"}`,style:{width:`${q}%`},children:q>0&&r.jsx("div",{className:"absolute inset-0 bg-white/20 animate-pulse"})}),r.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:q,onChange:S=>fe(P._id,parseInt(S.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]}),r.jsx("div",{className:"flex justify-between mt-1 px-1",children:[0,25,50,75,100].map(S=>r.jsxs("button",{onClick:()=>fe(P._id,S),className:"text-[10px] text-gray-400 hover:text-blue-600 font-medium transition-colors",children:[S,"%"]},S))})]})]}),r.jsx("div",{className:"mb-4",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"flex-1 space-y-2",children:[P.startDate&&r.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx(_n,{className:"w-4 h-4 text-blue-600"}),r.jsx("span",{className:"text-gray-600 font-medium",children:"Start:"}),r.jsx("span",{className:"bg-blue-50 text-blue-800 px-2 py-1 rounded text-xs font-semibold",children:new Date(P.startDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),P.dueDate&&r.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx(_n,{className:"w-4 h-4 text-yellow-600"}),r.jsx("span",{className:"text-gray-600 font-medium",children:"Due:"}),r.jsx("span",{className:"bg-yellow-50 text-yellow-800 px-2 py-1 rounded text-xs font-semibold",children:new Date(P.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),P.endDate&&r.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx(_n,{className:"w-4 h-4 text-green-600"}),r.jsx("span",{className:"text-gray-600 font-medium",children:"End:"}),r.jsx("span",{className:"bg-green-50 text-green-800 px-2 py-1 rounded text-xs font-semibold",children:new Date(P.endDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),P.media&&P.media.length>0&&r.jsxs("button",{onClick:()=>W(P,0),className:"flex flex-col items-center gap-1 p-3 bg-purple-50 hover:bg-purple-100 rounded-lg transition-all group",title:`${P.media.length} attachment(s) from task creation`,children:[r.jsx(In,{className:"w-6 h-6 text-purple-600 group-hover:scale-110 transition-transform"}),r.jsx("span",{className:"text-xs font-bold text-purple-600",children:P.media.length})]})]})}),P.comments&&P.comments.length>0&&r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Cr,{className:"w-4 h-4 text-blue-600"}),r.jsxs("h4",{className:"text-xs font-bold text-gray-700",children:["Comments (",P.comments.length,")"]})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("span",{className:"text-xs font-semibold text-gray-700",children:P.comments[P.comments.length-1].userName}),r.jsx("span",{className:"text-[10px] text-gray-500",children:new Date(P.comments[P.comments.length-1].createdAt).toLocaleDateString()})]}),P.comments[P.comments.length-1].text&&r.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:P.comments[P.comments.length-1].text}),P.comments[P.comments.length-1].media&&P.comments[P.comments.length-1].media.length>0&&r.jsxs("div",{className:"flex items-center gap-1.5 mt-2 text-purple-600",children:[r.jsx(In,{className:"w-3.5 h-3.5"}),r.jsxs("span",{className:"text-xs font-medium",children:[P.comments[P.comments.length-1].media.length," attachment",P.comments[P.comments.length-1].media.length>1?"s":""]})]}),P.comments.length>1&&r.jsxs("button",{onClick:()=>{d(P),x(!0)},className:"text-[10px] text-blue-600 hover:underline mt-1",children:["+",P.comments.length-1," more comment",P.comments.length-1>1?"s":""]})]})]}),r.jsxs("div",{className:"flex gap-2 pt-3 border-t border-gray-100",children:[r.jsxs("button",{onClick:()=>{d(P),x(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium",children:[r.jsx(Cr,{className:"w-4 h-4"}),"Add Comment"]}),r.jsxs("label",{className:"flex-1 cursor-pointer",children:[r.jsxs("div",{className:"flex items-center justify-center gap-2 py-2 px-3 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition-colors text-sm font-medium",children:[r.jsx(So,{className:"w-4 h-4"}),_&&(c==null?void 0:c._id)===P._id?"Uploading...":"Upload"]}),r.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:S=>R(S,P._id),className:"hidden",disabled:_})]})]})]})]},P._id)})})]}),f&&c&&r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[r.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-bold",children:c.title}),r.jsx("p",{className:"text-sm opacity-90",children:"Add your comments"})]}),r.jsx("button",{onClick:()=>{x(!1),b("")},className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:r.jsx(ln,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"p-4 max-h-96 overflow-y-auto custom-scrollbar",children:c.comments&&c.comments.length>0?r.jsx("div",{className:"space-y-3",children:c.comments.map((P,q)=>r.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-semibold text-gray-800",children:P.userName}),r.jsx("span",{className:"text-xs text-gray-500",children:new Date(P.createdAt).toLocaleString()})]}),P.text&&r.jsx("p",{className:"text-gray-700 mb-2",children:P.text}),P.media&&P.media.length>0&&r.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:P.media.map((Q,O)=>r.jsxs("div",{onClick:()=>W(P,O),className:"relative aspect-square rounded-lg overflow-hidden cursor-pointer hover:scale-105 transition-transform group",children:[Q.type==="image"?r.jsx("img",{src:Q.url,alt:Q.filename,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:r.jsx($t,{className:"w-8 h-8 text-gray-400"})}),r.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all"})]},O))})]},q))}):r.jsxs("div",{className:"text-center py-8",children:[r.jsx(Cr,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"No comments yet. Be the first to comment!"})]})}),r.jsx("div",{className:"p-4 border-t border-gray-200",children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"text",value:g,onChange:P=>b(P.target.value),onKeyPress:P=>{P.key==="Enter"&&!P.shiftKey&&(P.preventDefault(),U(c._id))},placeholder:"Write your comment...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),r.jsxs("label",{className:"cursor-pointer",children:[r.jsxs("div",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2",children:[r.jsx(In,{className:"w-4 h-4"}),r.jsx("span",{children:_?"Uploading...":"Media"})]}),r.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:P=>c&&R(P,c._id),className:"hidden",disabled:_})]}),r.jsxs("button",{onClick:()=>U(c._id),disabled:!g.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[r.jsx(vc,{className:"w-4 h-4"}),"Send"]})]})})]})}),M&&M.length>0&&r.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:F,children:r.jsxs("div",{className:"relative max-w-5xl w-full",onClick:P=>P.stopPropagation(),children:[r.jsx("button",{onClick:F,className:"absolute top-4 right-4 z-10 p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors",children:r.jsx(ln,{className:"w-6 h-6 text-white"})}),r.jsx("button",{onClick:()=>se(M[w].url,M[w].filename),className:"absolute top-4 right-16 z-10 p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors",title:"Download",children:r.jsx(Jt,{className:"w-6 h-6 text-white"})}),M.length>1&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:ae,className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Previous",children:r.jsx(Po,{className:"w-8 h-8 text-white stroke-[3]"})}),r.jsx("button",{onClick:Z,className:"absolute right-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Next",children:r.jsx(Lo,{className:"w-8 h-8 text-white stroke-[3]"})})]}),r.jsxs("div",{className:"bg-white rounded-lg overflow-hidden max-h-[80vh]",children:[M[w].type==="image"?r.jsx("img",{src:M[w].url,alt:M[w].filename,className:"w-full h-full object-contain max-h-[70vh]"}):r.jsx("video",{src:M[w].url,controls:!0,className:"w-full h-full object-contain max-h-[70vh]"}),r.jsxs("div",{className:"p-4 bg-gray-50",children:[r.jsx("p",{className:"text-sm font-medium text-gray-800",children:M[w].filename}),r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[w+1," of ",M.length]})]})]})]})}),r.jsx("style",{dangerouslySetInnerHTML:{__html:`
        input[type="range"]::-webkit-slider-thumb {
          appearance: none;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          background: white;
          cursor: pointer;
          border: 3px solid currentColor;
          box-shadow: 0 2px 8px rgba(0,0,0,0.2);
          transition: all 0.2s;
        }
        input[type="range"]::-webkit-slider-thumb:hover {
          transform: scale(1.2);
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #888;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #555;
        }
      `}})]})},a4=()=>{var X;fn();const e=gr(),[t,n]=h.useState([]),[s,o]=h.useState([]),[i,a]=h.useState(!0),[c,d]=h.useState(""),[f,x]=h.useState(null),[g,b]=h.useState(null),[_,I]=h.useState(0),[M,v]=h.useState(new Date),[w,m]=h.useState("grid"),[y,R]=h.useState(null),U=z=>{const G=z.getFullYear(),V=String(z.getMonth()+1).padStart(2,"0"),$=String(z.getDate()).padStart(2,"0");return`${G}-${V}-${$}`};h.useEffect(()=>{W()},[]);const W=async()=>{try{a(!0);const z=localStorage.getItem("token");console.log(" Fetching all users from:",`${Se}/api/users`);const G=await nt.get(`${Se}/api/users`,{headers:{Authorization:`Bearer ${z}`}});console.log(" Raw users response:",G.data),console.log(" Total users received:",G.data.length);const V={};G.data.forEach(B=>{V[B.role]=(V[B.role]||0)+1}),console.log(" Users by role:",V);const $=G.data.filter(B=>{const ue=B._id||B.id;return console.log(`Checking user: ${B.name}, role: ${B.role}, _id: ${B._id}, id: ${B.id}`),B.role==="user"&&ue});console.log(" Regular users found:",$.length),console.log(" Filtered Users:",$.map(B=>({_id:B._id,id:B.id,name:B.name,role:B.role}))),o($);const J=[];for(const B of $){const ue=B._id||B.id;if(!ue){console.warn(" User without id:",B);continue}try{console.log(` Fetching updates for: ${B.name} (${ue})`);const me=await nt.get(`${Se}/api/daily-updates/user/${ue}`,{headers:{Authorization:`Bearer ${z}`}});console.log(` ${B.name}: ${me.data.length} updates`),me.data.forEach(ye=>{J.push({...ye,userName:B.name,userEmail:B.email,userImage:B.profileImage})})}catch(me){console.error(` Failed to fetch updates for ${B.name}:`,me.message)}}console.log(" Total updates from all users:",J.length),n(J.sort((B,ue)=>new Date(ue.date)-new Date(B.date)))}catch(z){console.error(" Error fetching data:",z),D.error("Failed to load data")}finally{a(!1)}},F=(z,G)=>{b(z),I(G)},Z=()=>{b(null),I(0)},ae=()=>{g&&_<g.length-1&&I(_+1)},se=()=>{_>0&&I(_-1)},te=z=>z>500?"from-green-400 to-green-600":z>200?"from-blue-400 to-blue-600":"from-purple-400 to-purple-600",fe=f?t.filter(z=>{var $;const G=(($=z.user)==null?void 0:$._id)||z.user,V=f._id||f.id;return G===V}):[],L=s.filter(z=>{var G,V;return!c||((G=z.name)==null?void 0:G.toLowerCase().includes(c.toLowerCase()))||((V=z.email)==null?void 0:V.toLowerCase().includes(c.toLowerCase()))}),oe=z=>t.filter(G=>{var $;return((($=G.user)==null?void 0:$._id)||G.user)===z}).length,P=z=>{const G=z.getFullYear(),V=z.getMonth(),$=new Date(G,V,1),B=new Date(G,V+1,0).getDate(),ue=$.getDay();return{daysInMonth:B,startingDayOfWeek:ue}},q=z=>{if(!f)return{color:"",update:null};const G=f._id||f.id,V=t.find($=>{var ue;const J=((ue=$.user)==null?void 0:ue._id)||$.user,B=U(new Date($.date));return J===G&&B===z});if(V){const $=V.content.length;let J="";return $>500?J="bg-gradient-to-br from-green-400 to-green-600":$>200?J="bg-gradient-to-br from-blue-400 to-blue-600":J="bg-gradient-to-br from-purple-400 to-purple-600",{color:J,update:V}}return{color:"",update:null}},Q=z=>{const G=q(z);G.update&&R(G.update)},O=()=>{R(null)},S=async(z,G)=>{try{const $=await(await fetch(z)).blob(),J=window.URL.createObjectURL($),B=document.createElement("a");B.href=J,B.download=G||"download",document.body.appendChild(B),B.click(),window.URL.revokeObjectURL(J),document.body.removeChild(B),D.success("Download started!")}catch(V){console.error("Download error:",V),D.error("Failed to download file")}},E=()=>{if(!f)return null;const{daysInMonth:z,startingDayOfWeek:G}=P(M),V=[],$=M.toLocaleDateString("en-US",{month:"long",year:"numeric"});for(let J=0;J<G;J++)V.push(r.jsx("div",{className:"p-2"},`empty-${J}`));for(let J=1;J<=z;J++){const B=new Date(M.getFullYear(),M.getMonth(),J),ue=U(B),me=B.toDateString()===new Date().toDateString(),ye=q(ue),Ie=ye.color!=="";V.push(r.jsxs("button",{onClick:()=>Q(ue),disabled:!Ie,className:`
            relative p-1.5 rounded-lg text-center transition-all text-xs
            ${Ie?`${ye.color} text-white font-bold shadow cursor-pointer hover:scale-105`:me?"bg-gray-100 text-gray-900 font-semibold border border-blue-500 cursor-default":"bg-gray-50 text-gray-600 cursor-default"}
          `,children:[r.jsx("span",{children:J}),Ie&&r.jsx("div",{className:"absolute top-0.5 right-0.5",children:r.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})})]},J))}return r.jsxs("div",{className:"bg-white rounded-lg shadow p-3 border border-gray-200 mb-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("button",{onClick:()=>v(new Date(M.getFullYear(),M.getMonth()-1)),className:"p-1 hover:bg-gray-100 rounded transition-colors",children:r.jsx(Po,{className:"w-4 h-4 text-gray-600"})}),r.jsx("h3",{className:"text-sm font-bold text-gray-800",children:$}),r.jsx("button",{onClick:()=>v(new Date(M.getFullYear(),M.getMonth()+1)),className:"p-1 hover:bg-gray-100 rounded transition-colors",children:r.jsx(Lo,{className:"w-4 h-4 text-gray-600"})})]}),r.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["S","M","T","W","T","F","S"].map((J,B)=>r.jsx("div",{className:"text-[10px] font-bold text-gray-500",children:J},B))}),r.jsx("div",{className:"grid grid-cols-7 gap-1",children:V}),r.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:r.jsxs("div",{className:"flex gap-2 text-[10px]",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-3 h-3 rounded bg-gradient-to-br from-purple-400 to-purple-600"}),r.jsx("span",{className:"text-gray-600",children:"Short"})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-3 h-3 rounded bg-gradient-to-br from-blue-400 to-blue-600"}),r.jsx("span",{className:"text-gray-600",children:"Med"})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-3 h-3 rounded bg-gradient-to-br from-green-400 to-green-600"}),r.jsx("span",{className:"text-gray-600",children:"Long"})]})]})})]})};return r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsxs("div",{className:"max-w-7xl mx-auto px-3 py-3",children:[r.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-3 border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:()=>e("/dashboard"),className:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(xr,{className:"w-5 h-5 text-gray-700"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Manage Daily Updates"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Monitor user daily updates"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"bg-blue-50 px-3 py-2 rounded-lg border border-blue-200",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Cy,{className:"w-4 h-4 text-blue-600"}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-[10px] text-gray-600",children:"Updates"}),r.jsx("p",{className:"text-sm font-bold text-gray-800",children:t.length})]})]})}),r.jsx("div",{className:"bg-purple-50 px-3 py-2 rounded-lg border border-purple-200",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(At,{className:"w-4 h-4 text-purple-600"}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-[10px] text-gray-600",children:"Users"}),r.jsx("p",{className:"text-sm font-bold text-gray-800",children:s.filter(z=>oe(z._id||z.id)>0).length})]})]})})]})]})}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-3",children:[r.jsx("div",{className:"lg:col-span-1",children:r.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 sticky top-3",children:[r.jsxs("div",{className:"p-3 border-b border-gray-200",children:[r.jsxs("h2",{className:"text-sm font-bold text-gray-800 mb-2",children:["Users (",s.length,")"]}),r.jsxs("div",{className:"relative",children:[r.jsx(Go,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"text",placeholder:"Search...",value:c,onChange:z=>d(z.target.value),className:"w-full pl-8 pr-2 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]})]}),r.jsx("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto p-2 space-y-1.5 custom-scrollbar",children:i?r.jsx("div",{className:"text-center py-4",children:r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})}):L.length===0?r.jsxs("div",{className:"text-center py-4 text-gray-500",children:[r.jsx(At,{className:"w-8 h-8 text-gray-300 mx-auto mb-1"}),r.jsx("p",{className:"text-xs",children:"No users"})]}):L.map(z=>{var J;const G=z._id||z.id,V=f&&(f._id===G||f.id===G),$=oe(G);return r.jsx("div",{onClick:()=>x(z),className:`p-2.5 rounded-lg cursor-pointer transition-all ${V?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-md":"bg-gray-50 hover:bg-gray-100"}`,children:r.jsxs("div",{className:"flex items-center gap-2",children:[z.profileImage?r.jsx("img",{src:`${Se}${z.profileImage}`,alt:z.name,className:"w-9 h-9 rounded-full object-cover"}):r.jsx("div",{className:`w-9 h-9 rounded-full flex items-center justify-center ${V?"bg-white/20":"bg-blue-500"}`,children:r.jsx("span",{className:"text-white font-bold text-sm",children:(J=z.name)==null?void 0:J.charAt(0).toUpperCase()})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:`text-sm font-semibold truncate ${V?"text-white":"text-gray-800"}`,children:z.name}),$>0&&r.jsxs("div",{className:`text-[10px] font-semibold ${V?"text-white/90":"text-blue-600"}`,children:[$," update",$!==1?"s":""]})]})]})},G)})})]})}),r.jsx("div",{className:"lg:col-span-3",children:i?r.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center border border-gray-200",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"text-gray-500 text-sm mt-3",children:"Loading..."})]}):f?fe.length===0?r.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center border border-gray-200",children:[r.jsx(_n,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),r.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-1",children:[f.name," - No updates"]}),r.jsx("p",{className:"text-sm text-gray-500",children:"User hasn't created any updates yet"})]}):r.jsxs("div",{className:"space-y-3",children:[E(),r.jsx("div",{className:"bg-white rounded-lg shadow p-4 border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[f.profileImage?r.jsx("img",{src:`${Se}${f.profileImage}`,alt:f.name,className:"w-12 h-12 rounded-full object-cover"}):r.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold text-lg",children:(X=f.name)==null?void 0:X.charAt(0).toUpperCase()})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h2",{className:"text-lg font-bold text-gray-800",children:f.name}),r.jsx("p",{className:"text-xs text-gray-500",children:f.email}),r.jsxs("p",{className:"text-xs text-blue-600 font-semibold",children:[fe.length," update",fe.length!==1?"s":""]})]})]}),r.jsxs("div",{className:"flex items-center gap-1 bg-gray-100 rounded-lg p-0.5",children:[r.jsx("button",{onClick:()=>m("grid"),className:`p-1.5 rounded transition-all ${w==="grid"?"bg-white text-blue-600 shadow":"text-gray-500 hover:text-gray-700"}`,title:"Grid View",children:r.jsx(im,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>m("list"),className:`p-1.5 rounded transition-all ${w==="list"?"bg-white text-blue-600 shadow":"text-gray-500 hover:text-gray-700"}`,title:"List View",children:r.jsx(yc,{className:"w-4 h-4"})})]})]})}),w==="grid"?r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3",children:fe.map(z=>{const G=te(z.content.length);return r.jsxs("div",{className:`bg-gradient-to-br ${G} p-3 rounded-xl shadow hover:shadow-lg transition-all`,children:[r.jsx("div",{className:"bg-white/20 backdrop-blur-sm rounded-lg p-2 mb-2",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-white font-bold text-xs",children:new Date(z.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),r.jsxs("span",{className:"text-white/80 text-[10px] flex items-center gap-1",children:[r.jsx(ms,{className:"w-2.5 h-2.5"}),new Date(z.updatedAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]})}),r.jsx("p",{className:"text-white text-xs leading-relaxed mb-2 line-clamp-3",children:z.content}),z.media&&z.media.length>0&&r.jsx("div",{className:"grid grid-cols-3 gap-1 mt-2",children:z.media.slice(0,3).map((V,$)=>{const J=$===2&&z.media.length>3,B=z.media.length-3;return r.jsxs("div",{className:"relative rounded overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>F(z.media,$),children:[V.type==="image"?r.jsx("img",{src:V.url,alt:V.filename,className:"w-full h-14 object-cover"}):V.type==="video"?r.jsx("div",{className:"w-full h-14 bg-black/20 flex items-center justify-center",children:r.jsx($t,{className:"w-4 h-4 text-white"})}):r.jsx("div",{className:"w-full h-14 bg-gray-600/20 flex items-center justify-center",children:r.jsx(Xt,{className:"w-4 h-4 text-white"})}),J&&r.jsx("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center",children:r.jsxs("span",{className:"text-white ml-14 font-bold text-lg",children:["+",B]})})]},`${z._id}-media-${$}`)})}),r.jsxs("div",{className:"mt-2 pt-2 border-t border-white/20 text-white/70 text-[10px]",children:[z.content.length," chars"]})]},z._id)})}):r.jsx("div",{className:"space-y-2",children:fe.map(z=>{const G=te(z.content.length);return r.jsx("div",{className:`bg-gradient-to-r ${G} p-3 rounded-lg shadow hover:shadow-md transition-all`,children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-lg p-2 text-center min-w-[60px]",children:[r.jsx("div",{className:"text-white font-bold text-lg",children:new Date(z.date).getDate()}),r.jsx("div",{className:"text-white/90 text-[10px] font-semibold uppercase",children:new Date(z.date).toLocaleDateString("en-US",{month:"short"})})]})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("span",{className:"text-white font-bold text-sm",children:new Date(z.date).toLocaleDateString("en-US",{weekday:"long"})}),r.jsxs("span",{className:"text-white/80 text-[10px] flex items-center gap-1",children:[r.jsx(ms,{className:"w-2.5 h-2.5"}),new Date(z.updatedAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]}),r.jsx("p",{className:"text-white/95 text-xs leading-relaxed mb-2 line-clamp-2",children:z.content}),z.media&&z.media.length>0&&r.jsx("div",{className:"flex gap-1.5 mb-2",children:z.media.slice(0,4).map((V,$)=>{const J=$===3&&z.media.length>4,B=z.media.length-4;return r.jsxs("div",{className:"relative rounded overflow-hidden cursor-pointer hover:opacity-70 transition-opacity",onClick:()=>F(z.media,$),children:[V.type==="image"?r.jsx("img",{src:V.url,alt:V.filename,className:"w-12 h-12 object-cover"}):V.type==="video"?r.jsx("div",{className:"w-12 h-12 bg-transparent flex items-center justify-center",children:r.jsx($t,{className:"w-3 h-3 text-white"})}):r.jsx("div",{className:"w-12 h-12 bg-gray-600/10 flex items-center justify-center",children:r.jsx(Xt,{className:"w-3 h-3 text-white"})}),J&&r.jsx("div",{className:"absolute inset-0 bg-black/10 flex items-center justify-center",children:r.jsxs("span",{className:"text-white font-bold text-xs",children:["+",B]})})]},`${z._id}-media-${$}`)})}),r.jsxs("span",{className:"text-white/70 text-[10px]",children:[z.content.length," chars"]})]})]})},z._id)})})]}):r.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center border border-gray-200",children:[r.jsx(At,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),r.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-1",children:"Select a User"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Choose from left panel"})]})})]})]}),y&&r.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:r.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-blue-500 to-purple-500 p-6 flex items-center justify-between",children:[r.jsxs("div",{className:"text-white",children:[r.jsx("h3",{className:"text-2xl font-bold mb-1",children:new Date(y.date).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}),r.jsxs("p",{className:"text-white/80 text-sm",children:["Last updated: ",new Date(y.updatedAt).toLocaleString()]})]}),r.jsx("button",{onClick:O,className:"bg-white/20 hover:bg-white/30 text-white p-2 rounded-full transition-colors",children:r.jsx(ln,{className:"w-6 h-6"})})]}),r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Update Content"}),r.jsx("div",{className:"mt-2 bg-gray-50 rounded-xl p-4 border-2 border-gray-200",children:r.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:y.content})})]}),y.media&&y.media.length>0&&r.jsxs("div",{className:"mb-4",children:[r.jsxs("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:["Media (",y.media.length,")"]}),r.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-3 gap-3",children:y.media.map((z,G)=>r.jsxs("div",{className:"relative rounded-xl overflow-hidden cursor-pointer hover:opacity-90 transition-opacity border-2 border-gray-200",onClick:()=>F(y.media,G),children:[z.type==="image"?r.jsx("img",{src:z.url,alt:z.filename,className:"w-full h-32 object-cover"}):z.type==="video"?r.jsx("video",{src:z.url,className:"w-full h-32 object-cover"}):r.jsxs("div",{className:"w-full h-32 bg-gray-100 flex flex-col items-center justify-center p-3",children:[r.jsx(Xt,{className:"w-10 h-10 text-gray-500 mb-2"}),r.jsx("span",{className:"text-xs text-gray-600 text-center truncate w-full",children:z.filename})]}),r.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2",children:r.jsxs("span",{className:"text-white text-xs flex items-center gap-1 truncate",children:[z.type==="image"?r.jsx(In,{className:"w-3 h-3"}):z.type==="video"?r.jsx($t,{className:"w-3 h-3"}):r.jsx(Xt,{className:"w-3 h-3"}),z.filename]})})]},`popup-media-${G}`))})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-200",children:[r.jsx("p",{className:"text-xs font-semibold text-blue-600 mb-1",children:"Character Count"}),r.jsx("p",{className:"text-2xl font-bold text-blue-700",children:y.content.length})]}),y.media&&r.jsxs("div",{className:"bg-purple-50 rounded-xl p-4 border border-purple-200",children:[r.jsx("p",{className:"text-xs font-semibold text-purple-600 mb-1",children:"Media Files"}),r.jsx("p",{className:"text-2xl font-bold text-purple-700",children:y.media.length})]})]})]})]})}),g&&r.jsxs("div",{className:"fixed inset-0 bg-black/95 z-50 flex items-center justify-center",children:[r.jsx("button",{onClick:Z,className:"absolute top-4 right-4 bg-white/10 hover:bg-white/20 text-white p-3 rounded-full transition-colors",children:r.jsx(ln,{className:"w-6 h-6"})}),r.jsxs("button",{onClick:()=>S(g[_].url,g[_].filename),className:"absolute top-4 right-20 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-full transition-colors flex items-center gap-2 shadow-lg",children:[r.jsx(Jt,{className:"w-5 h-5"}),r.jsx("span",{className:"text-sm font-semibold",children:"Download"})]}),g.length>1&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:se,className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Previous",children:r.jsx(Po,{className:"w-8 h-8 text-white stroke-[3]"})}),r.jsx("button",{onClick:ae,className:"absolute right-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Next",children:r.jsx(Lo,{className:"w-8 h-8 text-white stroke-[3]"})})]}),g.length>1&&r.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-black/50 text-white px-4 py-2 rounded-full text-sm",children:[_+1," / ",g.length]}),r.jsx("div",{className:"max-w-7xl max-h-[90vh] w-full h-full flex items-center justify-center p-4",children:g[_].type==="image"?r.jsx("img",{src:g[_].url,alt:g[_].filename,className:"max-w-full max-h-full object-contain rounded-lg"}):r.jsx("video",{src:g[_].url,controls:!0,autoPlay:!0,className:"max-w-full max-h-full rounded-lg"})}),r.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex flex-col items-center gap-2",children:[r.jsx("div",{className:"bg-black/50 text-white px-4 py-2 rounded-full text-sm max-w-md truncate",children:g[_].filename}),r.jsx("div",{className:"text-white/60 text-xs",children:"Press ESC to close  Arrow keys to navigate  Click Download to save"})]})]}),r.jsx("style",{dangerouslySetInnerHTML:{__html:`
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        .line-clamp-3 {
          display: -webkit-box;
          -webkit-line-clamp: 3;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        .line-clamp-4 {
          display: -webkit-box;
          -webkit-line-clamp: 4;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #f3f4f6;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
          border-radius: 10px;
        }
      `}})]})},l4=()=>{fn();const e=gr(),[t,n]=h.useState([]),[s,o]=h.useState(null),[i,a]=h.useState([]),[c,d]=h.useState(!0),[f,x]=h.useState(""),[g,b]=h.useState(!1),[_,I]=h.useState(""),[M,v]=h.useState(""),[w,m]=h.useState("medium"),[y,R]=h.useState("pending"),[U,W]=h.useState(new Date().toISOString().split("T")[0]),[F,Z]=h.useState(""),[ae,se]=h.useState(""),[te,fe]=h.useState(null),[L,oe]=h.useState("grid"),[P,q]=h.useState([]),[Q,O]=h.useState([]),[S,E]=h.useState(null),[X,z]=h.useState(!1),[G,V]=h.useState(""),[$,J]=h.useState(!1),[B,ue]=h.useState(null),[me,ye]=h.useState(0);h.useEffect(()=>{Ie()},[]),h.useEffect(()=>{if(s){const T=s._id||s.id;T&&wt(T)}},[s]);const Ie=async()=>{try{d(!0);const T=localStorage.getItem("token"),de=await nt.get(`${Se}/api/users`,{headers:{Authorization:`Bearer ${T}`}});console.log("Users fetched:",de.data.length);const ke=de.data.filter(le=>le.role==="user"&&(le._id||le.id));console.log("Regular users with id:",ke.length),n(ke)}catch(T){console.error("Error fetching users:",T),D.error("Failed to load users")}finally{d(!1)}},wt=async T=>{var de;try{d(!0);const ke=localStorage.getItem("token");console.log("Fetching tasks for user:",T);const le=await nt.get(`${Se}/api/tasks/user/${T}`,{headers:{Authorization:`Bearer ${ke}`}});console.log("Tasks fetched:",le.data.length),a(le.data)}catch(ke){console.error("Error fetching tasks:",ke),console.error("Error response:",(de=ke.response)==null?void 0:de.data),D.error("Failed to load tasks")}finally{d(!1)}},Ze=T=>{const de=Array.from(T.target.files);de.length!==0&&(q(ke=>[...ke,...de]),de.forEach(ke=>{const le=new FileReader;le.onloadend=()=>{O(De=>[...De,{url:le.result,type:ke.type.startsWith("video/")?"video":"image",name:ke.name}])},le.readAsDataURL(ke)}))},Rt=T=>{q(de=>de.filter((ke,le)=>le!==T)),O(de=>de.filter((ke,le)=>le!==T))},Ht=async()=>{if(P.length===0)return[];const T=localStorage.getItem("token"),de=[];for(const ke of P){const le=new FormData;le.append("file",ke);const De=await nt.post(`${Se}/api/tasks/upload-media`,le,{headers:{Authorization:`Bearer ${T}`,"Content-Type":"multipart/form-data"}});de.push(De.data)}return de},Be=async(T,de)=>{const ke=Array.from(T.target.files);if(ke.length!==0){J(!0);try{const le=localStorage.getItem("token"),De=[];for(const tt of ke){const Xe=new FormData;Xe.append("file",tt);const St=await nt.post(`${Se}/api/tasks/upload-media`,Xe,{headers:{Authorization:`Bearer ${le}`,"Content-Type":"multipart/form-data"}});De.push(St.data)}const Me=await nt.post(`${Se}/api/tasks/${de}/comment`,{text:"",media:De},{headers:{Authorization:`Bearer ${le}`}});a(i.map(tt=>tt._id===de?Me.data:tt)),S&&S._id===de&&E(Me.data),D.success(`${De.length} file(s) uploaded as comment!`)}catch(le){console.error("Error uploading media:",le),D.error("Failed to upload media")}finally{J(!1)}}},bt=async T=>{if(G.trim())try{const de=localStorage.getItem("token"),ke=await nt.post(`${Se}/api/tasks/${T}/comment`,{text:G},{headers:{Authorization:`Bearer ${de}`}});a(i.map(le=>le._id===T?ke.data:le)),S&&S._id===T&&E(ke.data),V(""),D.success("Comment added!")}catch(de){console.error("Error adding comment:",de),D.error("Failed to add comment")}},pe=(T,de=0)=>{T.media&&T.media.length>0&&(ue(T.media),ye(de))},Ae=()=>{ue(null),ye(0)},Oe=()=>{ye(T=>(T+1)%B.length)},Qe=()=>{ye(T=>(T-1+B.length)%B.length)},gt=async(T,de)=>{try{const le=await(await fetch(T)).blob(),De=window.URL.createObjectURL(le),Me=document.createElement("a");Me.href=De,Me.download=de||"download",document.body.appendChild(Me),Me.click(),document.body.removeChild(Me),window.URL.revokeObjectURL(De),D.success("Download started!")}catch(ke){console.error("Error downloading media:",ke),D.error("Failed to download")}},at=async()=>{var T,de,ke;if(!_.trim()){D.error("Please enter task title");return}if(!s){D.error("Please select a user");return}try{J(!0);const le=localStorage.getItem("token"),De=s._id||s.id;console.log("Creating task for user:",De,s.name);let Me=[];P.length>0&&(D.loading("Uploading attachments...",{id:"upload"}),Me=await Ht(),D.dismiss("upload"));const tt={userId:De,title:_,description:M,priority:w,status:y,startDate:U||new Date().toISOString().split("T")[0],dueDate:F||null,endDate:ae||null,media:Me};console.log("Task data:",tt);let Xe;te?(Xe=(await nt.put(`${Se}/api/tasks/${te}/update`,tt,{headers:{Authorization:`Bearer ${le}`}})).data,D.success("Task updated successfully")):(Xe=(await nt.post(`${Se}/api/tasks/assign`,tt,{headers:{Authorization:`Bearer ${le}`}})).data,console.log("Created task with media:",Xe),D.success("Task created successfully!")),lt(),wt(De)}catch(le){console.error("Error creating task:",le),console.error("Error response:",(T=le.response)==null?void 0:T.data);const De=((ke=(de=le.response)==null?void 0:de.data)==null?void 0:ke.error)||"Failed to create task";D.error(De)}finally{J(!1)}},He=async T=>{if(confirm("Are you sure you want to delete this task?"))try{const de=localStorage.getItem("token");await nt.delete(`${Se}/api/tasks/${T}/delete`,{headers:{Authorization:`Bearer ${de}`}}),D.success("Task deleted successfully");const ke=s._id||s.id;wt(ke)}catch(de){console.error("Error deleting task:",de),D.error("Failed to delete task")}},$e=T=>{I(T.title),v(T.description),m(T.priority),R(T.status),W(T.startDate?T.startDate.split("T")[0]:new Date().toISOString().split("T")[0]),Z(T.dueDate?T.dueDate.split("T")[0]:""),se(T.endDate?T.endDate.split("T")[0]:""),fe(T._id),b(!0)},lt=()=>{I(""),v(""),m("medium"),R("pending"),W(new Date().toISOString().split("T")[0]),Z(""),se(""),fe(null),b(!1),q([]),O([])},Ye=T=>{switch(T){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},tn=T=>{switch(T){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-blue-100 text-blue-800";case"pending":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},he=t.filter(T=>T.name.toLowerCase().includes(f.toLowerCase())||T.email.toLowerCase().includes(f.toLowerCase()));return r.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-200  ",children:[r.jsxs("div",{className:"max-w-8xl mx-auto px-4 py-3",children:[r.jsx("div",{className:"bg-white  p-6 mb-2 border border-gray-100",children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("button",{onClick:()=>e("/dashboard"),className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:r.jsx(xr,{className:"w-6 h-6 text-gray-700"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Manage User Tasks"}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and assign tasks to users"})]}),s&&r.jsx("div",{children:r.jsxs("button",{onClick:()=>b(!g),className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 hover:from-blue-700 hover:to-purple-700 transition-all flex items-center justify-center gap-1 font-semibold",children:[r.jsx(Xi,{className:"w-5 h-5"}),"Create New Task for ",s.name]})}),r.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-blue-100 to-purple-100 px-3 py-0.5 ",children:[r.jsx(At,{className:"w-5 h-5 text-blue-600"}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-xs text-gray-600",children:"Total Users"}),r.jsx("p",{className:"text-xl font-bold text-gray-800",children:t.length})]})]})]})}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-2",children:[r.jsx("div",{className:"lg:col-span-1",children:r.jsxs("div",{className:"bg-white shadow p-4 border border-gray-200 sticky top-3 self-start",children:[r.jsx("h2",{className:"text-base font-semibold text-gray-700 mb-3",children:"Select User"}),r.jsxs("div",{className:"relative mb-3",children:[r.jsx(Go,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"text",placeholder:"Search users...",value:f,onChange:T=>x(T.target.value),className:"w-full pl-8 pr-3 py-1.5 text-sm border border-gray-300 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),r.jsx("div",{className:"space-y-1 max-h-[60vh] overflow-y-auto scrollbar-hide",children:he.map(T=>r.jsx("div",{onClick:()=>o(T),className:`p-2 rounded cursor-pointer transition-colors ${(s==null?void 0:s._id)===T._id?"bg-gray-100 ":"bg-blue_500  hover:bg-gray-500"}`,children:r.jsxs("div",{className:"flex items-center gap-2",children:[T.profileImage?r.jsx("img",{src:`${Se}${T.profileImage}`,alt:T.name,className:"w-8 h-8 rounded-full object-cover"}):r.jsx("div",{className:`w-8 h-8 rounded-full bg-blue_500 flex items-center justify-center ${(s==null?void 0:s._id)===T._id?"bg-gray-800/20":"bg-blue-500"}`,children:r.jsx("span",{className:"text-blue_500 text-xs font-semibold",children:T.name.charAt(0).toUpperCase()})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:`text-sm font-medium truncate ${(s==null?void 0:s._id)===T._id?"text-black":"text-blue_500"}`,children:T.name}),r.jsx("p",{className:`text-xs truncate ${(s==null?void 0:s._id)===T._id?"text-gray-800/80":"text-gray-500"}`,children:T.email})]})]})},T._id))})]})}),r.jsx("div",{className:"lg:col-span-2",children:s?r.jsxs(r.Fragment,{children:[g&&r.jsxs("div",{className:"bg-white p-6 border border-gray-100 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-xl font-bold text-gray-800",children:te?"Edit Task":"Create New Task"}),r.jsx("button",{onClick:lt,className:"text-gray-500 hover:text-gray-700",children:r.jsx(ln,{className:"w-6 h-6"})})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Task Title *"}),r.jsx("input",{type:"text",value:_,onChange:T=>I(T.target.value),placeholder:"Enter task title",className:"w-full px-4 py-2 border-2 border-gray-200  focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 ",children:"Description"}),r.jsx("textarea",{value:M,onChange:T=>v(T.target.value),placeholder:"Enter task description",className:"w-full px-4 py-2 border-2 border-gray-200  focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",rows:"4"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 ",children:"Priority"}),r.jsxs("select",{value:w,onChange:T=>m(T.target.value),className:"w-full px-4 py-2 border-2 border-gray-200  focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"low",children:"Low"}),r.jsx("option",{value:"medium",children:"Medium"}),r.jsx("option",{value:"high",children:"High"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 ",children:"Status"}),r.jsxs("select",{value:y,onChange:T=>R(T.target.value),className:"w-full px-4 py-2 border-2 border-gray-200  focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"pending",children:"Pending"}),r.jsx("option",{value:"in-progress",children:"In Progress"}),r.jsx("option",{value:"completed",children:"Completed"})]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 ",children:"Start Date (Auto-filled)"}),r.jsx("input",{type:"date",value:U,onChange:T=>W(T.target.value),className:"w-full px-4 py-2 border-2 border-gray-200  focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-blue-50"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 ",children:"Due Date (Optional)"}),r.jsx("input",{type:"date",value:F,onChange:T=>Z(T.target.value),className:"w-full px-4 py-2 border-2 border-gray-200  focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 ",children:"End Date (Optional)"}),r.jsx("input",{type:"date",value:ae,onChange:T=>se(T.target.value),className:"w-full px-4 py-2 border-2 border-gray-200  focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 ",children:"Attachments (Images/Videos)"}),r.jsxs("label",{className:"cursor-pointer",children:[r.jsxs("div",{className:"flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-gray-300  hover:border-blue-500 hover:bg-blue-50 transition-all",children:[r.jsx(So,{className:"w-5 h-5 text-gray-500"}),r.jsx("span",{className:"text-gray-600 font-medium",children:$?"Uploading...":"Click to upload files"})]}),r.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:Ze,className:"hidden",disabled:$})]}),Q.length>0&&r.jsx("div",{className:"mt-3 grid grid-cols-4 gap-3",children:Q.map((T,de)=>r.jsxs("div",{className:"relative group",children:[r.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-100",children:T.type==="image"?r.jsx("img",{src:T.url,alt:T.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full flex items-center justify-center",children:r.jsx($t,{className:"w-8 h-8 text-gray-400"})})}),r.jsx("button",{onClick:()=>Rt(de),className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg",title:"Remove",children:r.jsx(ln,{className:"w-4 h-4"})}),r.jsx("p",{className:"text-xs text-gray-600 mt-1 truncate",title:T.name,children:T.name})]},de))})]}),r.jsxs("div",{className:"flex gap-2 mb-1",children:[r.jsx("button",{onClick:at,disabled:$,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3  hover:from-blue-700 hover:to-purple-700 transition-all font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:$?"Uploading...":te?"Update Task":"Create Task"}),r.jsx("button",{onClick:lt,disabled:$,className:"px-6 py-3 bg-gray-200 text-gray-700  hover:bg-gray-300 transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})]}),r.jsxs("div",{className:"bg-white p-4 border border-gray-100",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:[s.name,"'s Tasks (",i.length,")"]}),r.jsxs("div",{className:"flex items-center gap-2 bg-gray-100  p-1",children:[r.jsx("button",{onClick:()=>oe("grid"),className:`p-2 transition-all ${L==="grid"?"bg-white text-blue-600 shadow-md":"text-gray-500 hover:text-gray-700"}`,title:"Grid View",children:r.jsx(im,{className:"w-5 h-5"})}),r.jsx("button",{onClick:()=>oe("list"),className:`p-2  transition-all ${L==="list"?"bg-white text-blue-600 shadow-md":"text-gray-500 hover:text-gray-700"}`,title:"List View",children:r.jsx(yc,{className:"w-5 h-5"})})]})]}),c?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-4 border-blue-600"})}):i.length===0?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Pu,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-500 text-lg",children:"No tasks assigned yet"})]}):L==="grid"?r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[600px] overflow-y-auto scrollbar-hide",children:i.map(T=>{const de=T.progress||0,ke=T.status==="completed",le=T.status==="in-progress";return r.jsxs("div",{className:`bg-white rounded-xl shadow-md hover:shadow-lg transition-all border-2 ${ke?"border-green-300":le?"border-blue-300":"border-gray-200"}`,children:[r.jsx("div",{className:`p-4 rounded-t-xl border-b ${ke?"bg-green-50 border-green-200":le?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:`text-base font-bold mb-1 ${ke?"line-through text-gray-500":"text-gray-800"}`,children:T.title}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsx("span",{className:`px-2 py-1 rounded-lg text-[10px] font-bold uppercase ${Ye(T.priority)}`,children:T.priority}),r.jsx("span",{className:`px-2 py-1 rounded-lg text-[10px] font-bold uppercase ${tn(T.status)}`,children:T.status==="in-progress"?"In Progress":T.status})]})]}),r.jsxs("div",{className:"flex gap-1",children:[r.jsx("button",{onClick:()=>$e(T),className:"p-1.5 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors",title:"Edit Task",children:r.jsx(jn,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>He(T._id),className:"p-1.5 text-red-600 hover:bg-red-100 rounded-lg transition-colors",title:"Delete Task",children:r.jsx(Ks,{className:"w-4 h-4"})})]})]})}),r.jsxs("div",{className:"p-4",children:[T.description&&r.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:T.description}),r.jsxs("div",{className:"mb-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("span",{className:"text-xs font-bold text-gray-700",children:"Progress"}),r.jsxs("span",{className:`text-sm font-bold ${de===100?"text-green-600":"text-blue-600"}`,children:[de,"%"]})]}),r.jsx("div",{className:"h-3 bg-gray-200 rounded-full overflow-hidden",children:r.jsx("div",{className:`h-full transition-all duration-300 ${de===100?"bg-gradient-to-r from-green-400 to-green-600":de>0?"bg-gradient-to-r from-blue-400 to-blue-600":"bg-gray-300"}`,style:{width:`${de}%`}})})]}),r.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[r.jsxs("div",{className:"flex-1 space-y-2 text-xs",children:[T.startDate&&r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx("span",{className:"font-semibold w-16",children:"Start:"}),r.jsx("span",{className:"bg-blue-50 px-2 py-1 rounded",children:new Date(T.startDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),T.dueDate&&r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx("span",{className:"font-semibold w-16",children:"Due:"}),r.jsx("span",{className:"bg-yellow-50 px-2 py-1 rounded",children:new Date(T.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),T.endDate&&r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx("span",{className:"font-semibold w-16",children:"End:"}),r.jsx("span",{className:"bg-green-50 px-2 py-1 rounded",children:new Date(T.endDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),T.media&&T.media.length>0&&r.jsxs("button",{onClick:()=>pe(T,0),className:"flex flex-col items-center gap-1 p-2 bg-purple-50 hover:bg-purple-100 rounded-lg transition-all group",title:`${T.media.length} attachment(s) from task creation`,children:[r.jsx(In,{className:"w-5 h-5 text-purple-600 group-hover:scale-110 transition-transform"}),r.jsx("span",{className:"text-[10px] font-bold text-purple-600",children:T.media.length})]})]}),T.comments&&T.comments.length>0&&r.jsxs("div",{className:"mb-3",children:[r.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[r.jsx(Cr,{className:"w-3.5 h-3.5 text-blue-600"}),r.jsxs("h4",{className:"text-xs font-bold text-gray-700",children:["Comments (",T.comments.length,")"]})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[T.comments[T.comments.length-1].text&&r.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:T.comments[T.comments.length-1].text}),T.comments[T.comments.length-1].media&&T.comments[T.comments.length-1].media.length>0&&r.jsxs("div",{className:"flex items-center gap-1.5 mt-2 text-purple-600",children:[r.jsx(In,{className:"w-3.5 h-3.5"}),r.jsxs("span",{className:"text-xs font-medium",children:[T.comments[T.comments.length-1].media.length," attachment",T.comments[T.comments.length-1].media.length>1?"s":""]})]})]})]}),r.jsxs("div",{className:"flex gap-2 pt-3 border-t border-gray-100",children:[r.jsxs("button",{onClick:()=>{E(T),z(!0)},className:"flex-1 flex items-center justify-center gap-1.5 py-2 px-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors text-xs font-medium",children:[r.jsx(Cr,{className:"w-3.5 h-3.5"}),"Comment"]}),r.jsxs("label",{className:"flex-1 cursor-pointer",children:[r.jsxs("div",{className:"flex items-center justify-center gap-1.5 py-2 px-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition-colors text-xs font-medium",children:[r.jsx(So,{className:"w-3.5 h-3.5"}),$&&(S==null?void 0:S._id)===T._id?"Uploading...":"Upload"]}),r.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:De=>Be(De,T._id),className:"hidden",disabled:$})]})]})]})]},T._id)})}):r.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto scrollbar-hide",children:i.map(T=>{const de=T.progress||0,ke=T.status==="completed",le=T.status==="in-progress";return r.jsx("div",{className:`bg-white rounded-xl shadow-md hover:shadow-lg transition-all border-l-4 ${ke?"border-l-green-500":le?"border-l-blue-500":"border-l-gray-300"}`,children:r.jsx("div",{className:"p-4",children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-start justify-between mb-2",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:`text-lg font-bold mb-1 ${ke?"line-through text-gray-500":"text-gray-800"}`,children:T.title}),T.description&&r.jsx("p",{className:"text-gray-600 text-sm line-clamp-2",children:T.description})]}),r.jsxs("div",{className:"flex gap-1 ml-3",children:[r.jsx("button",{onClick:()=>$e(T),className:"p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors",title:"Edit Task",children:r.jsx(jn,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>He(T._id),className:"p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors",title:"Delete Task",children:r.jsx(Ks,{className:"w-4 h-4"})})]})]}),r.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[r.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-bold uppercase ${Ye(T.priority)}`,children:T.priority}),r.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-bold uppercase ${tn(T.status)}`,children:T.status==="in-progress"?"In Progress":T.status})]})]}),r.jsxs("div",{className:"w-64 flex-shrink-0",children:[r.jsxs("div",{className:"mb-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("span",{className:"text-xs font-bold text-gray-700",children:"Progress"}),r.jsxs("span",{className:`text-sm font-bold ${de===100?"text-green-600":"text-blue-600"}`,children:[de,"%"]})]}),r.jsx("div",{className:"h-3 bg-gray-200 rounded-full overflow-hidden",children:r.jsx("div",{className:`h-full transition-all duration-300 ${de===100?"bg-gradient-to-r from-green-400 to-green-600":de>0?"bg-gradient-to-r from-blue-400 to-blue-600":"bg-gray-300"}`,style:{width:`${de}%`}})})]}),r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsxs("div",{className:"flex-1 space-y-1.5 text-xs",children:[T.startDate&&r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-gray-500 font-medium",children:"Start:"}),r.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded font-semibold",children:new Date(T.startDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),T.dueDate&&r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-gray-500 font-medium",children:"Due:"}),r.jsx("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded font-semibold",children:new Date(T.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),T.endDate&&r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-gray-500 font-medium",children:"End:"}),r.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded font-semibold",children:new Date(T.endDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]})]}),T.media&&T.media.length>0&&r.jsxs("button",{onClick:()=>pe(T,0),className:"flex flex-col items-center justify-center gap-0.5 px-2 py-1 bg-purple-50 hover:bg-purple-100 rounded-lg transition-all group min-w-[50px]",title:`${T.media.length} attachment(s) from task creation`,children:[r.jsx(In,{className:"w-4 h-4 text-purple-600 group-hover:scale-110 transition-transform"}),r.jsxs("span",{className:"text-[9px] font-bold text-purple-600",children:[T.media.length," files"]})]})]}),T.comments&&T.comments.length>0&&r.jsx("div",{className:"mt-3",children:r.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx(Cr,{className:"w-3.5 h-3.5 text-blue-600"}),r.jsxs("span",{className:"text-xs font-bold text-gray-700",children:[T.comments.length," comment(s)"]})]}),T.comments[T.comments.length-1].text&&r.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:T.comments[T.comments.length-1].text}),T.comments[T.comments.length-1].media&&T.comments[T.comments.length-1].media.length>0&&r.jsxs("div",{className:"flex items-center gap-1.5 mt-2 text-purple-600",children:[r.jsx(In,{className:"w-3.5 h-3.5"}),r.jsxs("span",{className:"text-xs font-medium",children:[T.comments[T.comments.length-1].media.length," attachment",T.comments[T.comments.length-1].media.length>1?"s":""]})]})]})}),r.jsxs("div",{className:"flex gap-2 mt-3",children:[r.jsxs("button",{onClick:()=>{E(T),z(!0)},className:"flex-1 flex items-center justify-center gap-1.5 py-1.5 px-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors text-xs font-medium",children:[r.jsx(Cr,{className:"w-3.5 h-3.5"}),"Comment"]}),r.jsxs("label",{className:"flex-1 cursor-pointer",children:[r.jsxs("div",{className:"flex items-center justify-center gap-1.5 py-1.5 px-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition-colors text-xs font-medium",children:[r.jsx(So,{className:"w-3.5 h-3.5"}),"Upload"]}),r.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:De=>Be(De,T._id),className:"hidden",disabled:$})]})]})]})]})})},T._id)})})]})]}):r.jsxs("div",{className:"bg-white  p-1 border border-gray-100 text-center",children:[r.jsx(At,{className:"w-20 h-20 text-gray-300 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-500 text-lg",children:"Select a user to manage their tasks"})]})})]})]}),X&&S&&r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[r.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-bold",children:S.title}),r.jsx("p",{className:"text-sm opacity-90",children:"Comments & Discussion"})]}),r.jsx("button",{onClick:()=>{z(!1),V("")},className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:r.jsx(ln,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"p-4 max-h-96 overflow-y-auto scrollbar-hide",children:S.comments&&S.comments.length>0?r.jsx("div",{className:"space-y-3",children:S.comments.map((T,de)=>r.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-semibold text-gray-800",children:T.userName}),r.jsx("span",{className:"text-xs text-gray-500",children:new Date(T.createdAt).toLocaleString()})]}),T.text&&r.jsx("p",{className:"text-gray-700 mb-2",children:T.text}),T.media&&T.media.length>0&&r.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:T.media.map((ke,le)=>r.jsxs("div",{onClick:()=>pe(T,le),className:"relative aspect-square rounded-lg overflow-hidden cursor-pointer hover:scale-105 transition-transform group",children:[ke.type==="image"?r.jsx("img",{src:ke.url,alt:ke.filename,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:r.jsx($t,{className:"w-8 h-8 text-gray-400"})}),r.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all"})]},le))})]},de))}):r.jsxs("div",{className:"text-center py-8",children:[r.jsx(Cr,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-500",children:"No comments yet. Be the first to comment!"})]})}),r.jsx("div",{className:"p-4 border-t border-gray-200",children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"text",value:G,onChange:T=>V(T.target.value),onKeyPress:T=>{T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),bt(S._id))},placeholder:"Write your comment...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),r.jsxs("label",{className:"cursor-pointer",children:[r.jsxs("div",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2",children:[r.jsx(In,{className:"w-4 h-4"}),r.jsx("span",{children:$?"Uploading...":"Media"})]}),r.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:T=>S&&Be(T,S._id),className:"hidden",disabled:$})]}),r.jsxs("button",{onClick:()=>bt(S._id),disabled:!G.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[r.jsx(vc,{className:"w-4 h-4"}),"Send"]})]})})]})}),B&&B.length>0&&r.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:Ae,children:r.jsxs("div",{className:"relative max-w-5xl w-full",onClick:T=>T.stopPropagation(),children:[r.jsx("button",{onClick:Ae,className:"absolute top-4 right-4 z-10 p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors",children:r.jsx(ln,{className:"w-6 h-6 text-white"})}),r.jsx("button",{onClick:()=>gt(B[me].url,B[me].filename),className:"absolute top-4 right-16 z-10 p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors",title:"Download",children:r.jsx(Jt,{className:"w-6 h-6 text-white"})}),B.length>1&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:Qe,className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Previous",children:r.jsx(Po,{className:"w-8 h-8 text-white stroke-[3]"})}),r.jsx("button",{onClick:Oe,className:"absolute right-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Next",children:r.jsx(Lo,{className:"w-8 h-8 text-white stroke-[3]"})})]}),r.jsxs("div",{className:"bg-white rounded-lg overflow-hidden max-h-[80vh]",children:[B[me].type==="image"?r.jsx("img",{src:B[me].url,alt:B[me].filename,className:"w-full h-full object-contain max-h-[70vh]"}):r.jsx("video",{src:B[me].url,controls:!0,className:"w-full h-full object-contain max-h-[70vh]"}),r.jsxs("div",{className:"p-4 bg-gray-50",children:[r.jsx("p",{className:"text-sm font-medium text-gray-800",children:B[me].filename}),r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[me+1," of ",B.length]})]})]})]})}),r.jsx("style",{dangerouslySetInnerHTML:{__html:`
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `}})]})},Ty=({size:e="md"})=>{const t={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12",xl:"w-16 h-16"};return r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("div",{className:`${t[e]} animate-spin rounded-full border-4 border-gray-200 border-t-primary-600`})})};function Cn({children:e,allowedRoles:t}){const{user:n,loading:s}=fn();return s?r.jsx(Ty,{}):n?t&&!t.includes(n.role)?r.jsx(ki,{to:"/dashboard",replace:!0}):e:r.jsx(ki,{to:"/login",replace:!0})}function c4(){return r.jsx(DS,{children:r.jsx(n1,{children:r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(q1,{position:"top-right"}),r.jsx(d4,{})]})})})}function d4(){const{user:e,loading:t}=fn();return t?r.jsx(Ty,{}):r.jsx(r.Fragment,{children:e?r.jsx(UC,{user:e,children:r.jsxs(_h,{children:[r.jsx(Pt,{path:"/login",element:r.jsx(ki,{to:"/dashboard",replace:!0})}),r.jsx(Pt,{path:"/dashboard",element:r.jsx(Cn,{children:e&&e.role==="user"?r.jsx(jp,{}):r.jsx(JC,{})})}),r.jsx(Pt,{path:"/user-dashboard",element:r.jsx(Cn,{allowedRoles:["user"],children:r.jsx(jp,{})})}),r.jsx(Pt,{path:"/chat",element:r.jsx(Cn,{children:r.jsx(XC,{})})}),r.jsx(Pt,{path:"/users",element:r.jsx(Cn,{allowedRoles:["superadmin","admin"],children:r.jsx(ZC,{})})}),r.jsx(Pt,{path:"/time-management",element:r.jsx(Cn,{allowedRoles:["superadmin","admin"],children:r.jsx(e4,{})})}),r.jsx(Pt,{path:"/groups",element:r.jsx(Cn,{allowedRoles:["admin"],children:r.jsx(t4,{})})}),r.jsx(Pt,{path:"/group/:groupId",element:r.jsx(Cn,{children:r.jsx(n4,{})})}),r.jsx(Pt,{path:"/profile",element:r.jsx(Cn,{children:r.jsx(r4,{})})}),r.jsx(Pt,{path:"/forward",element:r.jsx(Cn,{children:r.jsx(s4,{})})}),r.jsx(Pt,{path:"/daily-update",element:r.jsx(Cn,{children:r.jsx(o4,{})})}),r.jsx(Pt,{path:"/tasks",element:r.jsx(Cn,{children:r.jsx(i4,{})})}),r.jsx(Pt,{path:"/manage-daily-updates",element:r.jsx(Cn,{allowedRoles:["superadmin","admin"],children:r.jsx(a4,{})})}),r.jsx(Pt,{path:"/manage-tasks",element:r.jsx(Cn,{allowedRoles:["superadmin","admin"],children:r.jsx(l4,{})})}),r.jsx(Pt,{path:"/",element:r.jsx(ki,{to:"/dashboard",replace:!0})})]})}):r.jsxs(_h,{children:[r.jsx(Pt,{path:"/login",element:r.jsx(YC,{})}),r.jsx(Pt,{path:"*",element:r.jsx(ki,{to:"/login",replace:!0})})]})})}pd.createRoot(document.getElementById("root")).render(r.jsx(zl.StrictMode,{children:r.jsx(c4,{})}));
