import{r as u,a as Ai,L as Cr,u as ps,R as In,b as _i,B as Ri,c as Jn,d as gt,N as er}from"./vendor-c1c21ce7.js";import{o as Ui,g as Li,i as Pi,a as Oi}from"./firebase-b734f118.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(i){if(i.ep)return;i.ep=!0;const c=r(i);fetch(i.href,c)}})();var No={exports:{}},_r={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $i=u,Fi=Symbol.for("react.element"),Di=Symbol.for("react.fragment"),zi=Object.prototype.hasOwnProperty,Bi=$i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Gi={key:!0,ref:!0,__self:!0,__source:!0};function ko(s,t,r){var n,i={},c=null,a=null;r!==void 0&&(c=""+r),t.key!==void 0&&(c=""+t.key),t.ref!==void 0&&(a=t.ref);for(n in t)zi.call(t,n)&&!Gi.hasOwnProperty(n)&&(i[n]=t[n]);if(s&&s.defaultProps)for(n in t=s.defaultProps,t)i[n]===void 0&&(i[n]=t[n]);return{$$typeof:Fi,type:s,key:c,ref:a,props:i,_owner:Bi.current}}_r.Fragment=Di;_r.jsx=ko;_r.jsxs=ko;No.exports=_r;var e=No.exports,on={},Kn=Ai;on.createRoot=Kn.createRoot,on.hydrateRoot=Kn.hydrateRoot;let qi={data:""},Vi=s=>typeof window=="object"?((s?s.querySelector("#_goober"):window._goober)||Object.assign((s||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:s||qi,Hi=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Wi=/\/\*[^]*?\*\/|  +/g,Xn=/\n+/g,us=(s,t)=>{let r="",n="",i="";for(let c in s){let a=s[c];c[0]=="@"?c[1]=="i"?r=c+" "+a+";":n+=c[1]=="f"?us(a,c):c+"{"+us(a,c[1]=="k"?"":t)+"}":typeof a=="object"?n+=us(a,t?t.replace(/([^,])+/g,m=>c.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,C=>/&/.test(C)?C.replace(/&/g,m):m?m+" "+C:C)):c):a!=null&&(c=/^--/.test(c)?c:c.replace(/[A-Z]/g,"-$&").toLowerCase(),i+=us.p?us.p(c,a):c+":"+a+";")}return r+(t&&i?t+"{"+i+"}":i)+n},ns={},So=s=>{if(typeof s=="object"){let t="";for(let r in s)t+=r+So(s[r]);return t}return s},Yi=(s,t,r,n,i)=>{let c=So(s),a=ns[c]||(ns[c]=(C=>{let b=0,j=11;for(;b<C.length;)j=101*j+C.charCodeAt(b++)>>>0;return"go"+j})(c));if(!ns[a]){let C=c!==s?s:(b=>{let j,T,_=[{}];for(;j=Hi.exec(b.replace(Wi,""));)j[4]?_.shift():j[3]?(T=j[3].replace(Xn," ").trim(),_.unshift(_[0][T]=_[0][T]||{})):_[0][j[1]]=j[2].replace(Xn," ").trim();return _[0]})(s);ns[a]=us(i?{["@keyframes "+a]:C}:C,r?"":"."+a)}let m=r&&ns.g?ns.g:null;return r&&(ns.g=ns[a]),((C,b,j,T)=>{T?b.data=b.data.replace(T,C):b.data.indexOf(C)===-1&&(b.data=j?C+b.data:b.data+C)})(ns[a],t,n,m),a},Ji=(s,t,r)=>s.reduce((n,i,c)=>{let a=t[c];if(a&&a.call){let m=a(r),C=m&&m.props&&m.props.className||/^go/.test(m)&&m;a=C?"."+C:m&&typeof m=="object"?m.props?"":us(m,""):m===!1?"":m}return n+i+(a??"")},"");function Rr(s){let t=this||{},r=s.call?s(t.p):s;return Yi(r.unshift?r.raw?Ji(r,[].slice.call(arguments,1),t.p):r.reduce((n,i)=>Object.assign(n,i&&i.call?i(t.p):i),{}):r,Vi(t.target),t.g,t.o,t.k)}let Co,an,ln;Rr.bind({g:1});let as=Rr.bind({k:1});function Ki(s,t,r,n){us.p=t,Co=s,an=r,ln=n}function xs(s,t){let r=this||{};return function(){let n=arguments;function i(c,a){let m=Object.assign({},c),C=m.className||i.className;r.p=Object.assign({theme:an&&an()},m),r.o=/ *go\d+/.test(C),m.className=Rr.apply(r,n)+(C?" "+C:""),t&&(m.ref=a);let b=s;return s[0]&&(b=m.as||s,delete m.as),ln&&b[0]&&ln(m),Co(b,m)}return t?t(i):i}}var Xi=s=>typeof s=="function",Ir=(s,t)=>Xi(s)?s(t):s,Zi=(()=>{let s=0;return()=>(++s).toString()})(),Io=(()=>{let s;return()=>{if(s===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");s=!t||t.matches}return s}})(),Qi=20,Tn="default",To=(s,t)=>{let{toastLimit:r}=s.settings;switch(t.type){case 0:return{...s,toasts:[t.toast,...s.toasts].slice(0,r)};case 1:return{...s,toasts:s.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case 2:let{toast:n}=t;return To(s,{type:s.toasts.find(a=>a.id===n.id)?1:0,toast:n});case 3:let{toastId:i}=t;return{...s,toasts:s.toasts.map(a=>a.id===i||i===void 0?{...a,dismissed:!0,visible:!1}:a)};case 4:return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==t.toastId)};case 5:return{...s,pausedAt:t.time};case 6:let c=t.time-(s.pausedAt||0);return{...s,pausedAt:void 0,toasts:s.toasts.map(a=>({...a,pauseDuration:a.pauseDuration+c}))}}},br=[],Eo={toasts:[],pausedAt:void 0,settings:{toastLimit:Qi}},Xt={},Mo=(s,t=Tn)=>{Xt[t]=To(Xt[t]||Eo,s),br.forEach(([r,n])=>{r===t&&n(Xt[t])})},Ao=s=>Object.keys(Xt).forEach(t=>Mo(s,t)),ea=s=>Object.keys(Xt).find(t=>Xt[t].toasts.some(r=>r.id===s)),Ur=(s=Tn)=>t=>{Mo(t,s)},ta={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},sa=(s={},t=Tn)=>{let[r,n]=u.useState(Xt[t]||Eo),i=u.useRef(Xt[t]);u.useEffect(()=>(i.current!==Xt[t]&&n(Xt[t]),br.push([t,n]),()=>{let a=br.findIndex(([m])=>m===t);a>-1&&br.splice(a,1)}),[t]);let c=r.toasts.map(a=>{var m,C,b;return{...s,...s[a.type],...a,removeDelay:a.removeDelay||((m=s[a.type])==null?void 0:m.removeDelay)||(s==null?void 0:s.removeDelay),duration:a.duration||((C=s[a.type])==null?void 0:C.duration)||(s==null?void 0:s.duration)||ta[a.type],style:{...s.style,...(b=s[a.type])==null?void 0:b.style,...a.style}}});return{...r,toasts:c}},ra=(s,t="blank",r)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:s,pauseDuration:0,...r,id:(r==null?void 0:r.id)||Zi()}),lr=s=>(t,r)=>{let n=ra(t,s,r);return Ur(n.toasterId||ea(n.id))({type:2,toast:n}),n.id},U=(s,t)=>lr("blank")(s,t);U.error=lr("error");U.success=lr("success");U.loading=lr("loading");U.custom=lr("custom");U.dismiss=(s,t)=>{let r={type:3,toastId:s};t?Ur(t)(r):Ao(r)};U.dismissAll=s=>U.dismiss(void 0,s);U.remove=(s,t)=>{let r={type:4,toastId:s};t?Ur(t)(r):Ao(r)};U.removeAll=s=>U.remove(void 0,s);U.promise=(s,t,r)=>{let n=U.loading(t.loading,{...r,...r==null?void 0:r.loading});return typeof s=="function"&&(s=s()),s.then(i=>{let c=t.success?Ir(t.success,i):void 0;return c?U.success(c,{id:n,...r,...r==null?void 0:r.success}):U.dismiss(n),i}).catch(i=>{let c=t.error?Ir(t.error,i):void 0;c?U.error(c,{id:n,...r,...r==null?void 0:r.error}):U.dismiss(n)}),s};var na=1e3,oa=(s,t="default")=>{let{toasts:r,pausedAt:n}=sa(s,t),i=u.useRef(new Map).current,c=u.useCallback((T,_=na)=>{if(i.has(T))return;let z=setTimeout(()=>{i.delete(T),a({type:4,toastId:T})},_);i.set(T,z)},[]);u.useEffect(()=>{if(n)return;let T=Date.now(),_=r.map(z=>{if(z.duration===1/0)return;let R=(z.duration||0)+z.pauseDuration-(T-z.createdAt);if(R<0){z.visible&&U.dismiss(z.id);return}return setTimeout(()=>U.dismiss(z.id,t),R)});return()=>{_.forEach(z=>z&&clearTimeout(z))}},[r,n,t]);let a=u.useCallback(Ur(t),[t]),m=u.useCallback(()=>{a({type:5,time:Date.now()})},[a]),C=u.useCallback((T,_)=>{a({type:1,toast:{id:T,height:_}})},[a]),b=u.useCallback(()=>{n&&a({type:6,time:Date.now()})},[n,a]),j=u.useCallback((T,_)=>{let{reverseOrder:z=!1,gutter:R=8,defaultPosition:F}=_||{},f=r.filter(L=>(L.position||F)===(T.position||F)&&L.height),O=f.findIndex(L=>L.id===T.id),g=f.filter((L,J)=>J<O&&L.visible).length;return f.filter(L=>L.visible).slice(...z?[g+1]:[0,g]).reduce((L,J)=>L+(J.height||0)+R,0)},[r]);return u.useEffect(()=>{r.forEach(T=>{if(T.dismissed)c(T.id,T.removeDelay);else{let _=i.get(T.id);_&&(clearTimeout(_),i.delete(T.id))}})},[r,c]),{toasts:r,handlers:{updateHeight:C,startPause:m,endPause:b,calculateOffset:j}}},ia=as`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,aa=as`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,la=as`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,ca=xs("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${s=>s.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${ia} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${aa} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${s=>s.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${la} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,da=as`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,ua=xs("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${s=>s.secondary||"#e0e0e0"};
  border-right-color: ${s=>s.primary||"#616161"};
  animation: ${da} 1s linear infinite;
`,ma=as`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,ha=as`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,ga=xs("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${s=>s.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${ma} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${ha} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${s=>s.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,fa=xs("div")`
  position: absolute;
`,pa=xs("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,xa=as`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,ba=xs("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${xa} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,ya=({toast:s})=>{let{icon:t,type:r,iconTheme:n}=s;return t!==void 0?typeof t=="string"?u.createElement(ba,null,t):t:r==="blank"?null:u.createElement(pa,null,u.createElement(ua,{...n}),r!=="loading"&&u.createElement(fa,null,r==="error"?u.createElement(ca,{...n}):u.createElement(ga,{...n})))},wa=s=>`
0% {transform: translate3d(0,${s*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,va=s=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${s*-150}%,-1px) scale(.6); opacity:0;}
`,ja="0%{opacity:0;} 100%{opacity:1;}",Na="0%{opacity:1;} 100%{opacity:0;}",ka=xs("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Sa=xs("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Ca=(s,t)=>{let r=s.includes("top")?1:-1,[n,i]=Io()?[ja,Na]:[wa(r),va(r)];return{animation:t?`${as(n)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${as(i)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Ia=u.memo(({toast:s,position:t,style:r,children:n})=>{let i=s.height?Ca(s.position||t||"top-center",s.visible):{opacity:0},c=u.createElement(ya,{toast:s}),a=u.createElement(Sa,{...s.ariaProps},Ir(s.message,s));return u.createElement(ka,{className:s.className,style:{...i,...r,...s.style}},typeof n=="function"?n({icon:c,message:a}):u.createElement(u.Fragment,null,c,a))});Ki(u.createElement);var Ta=({id:s,className:t,style:r,onHeightUpdate:n,children:i})=>{let c=u.useCallback(a=>{if(a){let m=()=>{let C=a.getBoundingClientRect().height;n(s,C)};m(),new MutationObserver(m).observe(a,{subtree:!0,childList:!0,characterData:!0})}},[s,n]);return u.createElement("div",{ref:c,className:t,style:r},i)},Ea=(s,t)=>{let r=s.includes("top"),n=r?{top:0}:{bottom:0},i=s.includes("center")?{justifyContent:"center"}:s.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Io()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(r?1:-1)}px)`,...n,...i}},Ma=Rr`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,gr=16,Aa=({reverseOrder:s,position:t="top-center",toastOptions:r,gutter:n,children:i,toasterId:c,containerStyle:a,containerClassName:m})=>{let{toasts:C,handlers:b}=oa(r,c);return u.createElement("div",{"data-rht-toaster":c||"",style:{position:"fixed",zIndex:9999,top:gr,left:gr,right:gr,bottom:gr,pointerEvents:"none",...a},className:m,onMouseEnter:b.startPause,onMouseLeave:b.endPause},C.map(j=>{let T=j.position||t,_=b.calculateOffset(j,{reverseOrder:s,gutter:n,defaultPosition:t}),z=Ea(T,_);return u.createElement(Ta,{id:j.id,key:j.id,onHeightUpdate:b.updateHeight,className:j.visible?Ma:"",style:z},j.type==="custom"?Ir(j.message,j):i?i(j):u.createElement(Ia,{toast:j,position:T}))}))};function _o(s,t){return function(){return s.apply(t,arguments)}}const{toString:_a}=Object.prototype,{getPrototypeOf:En}=Object,{iterator:Lr,toStringTag:Ro}=Symbol,Pr=(s=>t=>{const r=_a.call(t);return s[r]||(s[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Vt=s=>(s=s.toLowerCase(),t=>Pr(t)===s),Or=s=>t=>typeof t===s,{isArray:Fs}=Array,Ps=Or("undefined");function cr(s){return s!==null&&!Ps(s)&&s.constructor!==null&&!Ps(s.constructor)&&Mt(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const Uo=Vt("ArrayBuffer");function Ra(s){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(s):t=s&&s.buffer&&Uo(s.buffer),t}const Ua=Or("string"),Mt=Or("function"),Lo=Or("number"),dr=s=>s!==null&&typeof s=="object",La=s=>s===!0||s===!1,yr=s=>{if(Pr(s)!=="object")return!1;const t=En(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Ro in s)&&!(Lr in s)},Pa=s=>{if(!dr(s)||cr(s))return!1;try{return Object.keys(s).length===0&&Object.getPrototypeOf(s)===Object.prototype}catch{return!1}},Oa=Vt("Date"),$a=Vt("File"),Fa=Vt("Blob"),Da=Vt("FileList"),za=s=>dr(s)&&Mt(s.pipe),Ba=s=>{let t;return s&&(typeof FormData=="function"&&s instanceof FormData||Mt(s.append)&&((t=Pr(s))==="formdata"||t==="object"&&Mt(s.toString)&&s.toString()==="[object FormData]"))},Ga=Vt("URLSearchParams"),[qa,Va,Ha,Wa]=["ReadableStream","Request","Response","Headers"].map(Vt),Ya=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ur(s,t,{allOwnKeys:r=!1}={}){if(s===null||typeof s>"u")return;let n,i;if(typeof s!="object"&&(s=[s]),Fs(s))for(n=0,i=s.length;n<i;n++)t.call(null,s[n],n,s);else{if(cr(s))return;const c=r?Object.getOwnPropertyNames(s):Object.keys(s),a=c.length;let m;for(n=0;n<a;n++)m=c[n],t.call(null,s[m],m,s)}}function Po(s,t){if(cr(s))return null;t=t.toLowerCase();const r=Object.keys(s);let n=r.length,i;for(;n-- >0;)if(i=r[n],t===i.toLowerCase())return i;return null}const Ns=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),Oo=s=>!Ps(s)&&s!==Ns;function cn(){const{caseless:s,skipUndefined:t}=Oo(this)&&this||{},r={},n=(i,c)=>{const a=s&&Po(r,c)||c;yr(r[a])&&yr(i)?r[a]=cn(r[a],i):yr(i)?r[a]=cn({},i):Fs(i)?r[a]=i.slice():(!t||!Ps(i))&&(r[a]=i)};for(let i=0,c=arguments.length;i<c;i++)arguments[i]&&ur(arguments[i],n);return r}const Ja=(s,t,r,{allOwnKeys:n}={})=>(ur(t,(i,c)=>{r&&Mt(i)?s[c]=_o(i,r):s[c]=i},{allOwnKeys:n}),s),Ka=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),Xa=(s,t,r,n)=>{s.prototype=Object.create(t.prototype,n),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:t.prototype}),r&&Object.assign(s.prototype,r)},Za=(s,t,r,n)=>{let i,c,a;const m={};if(t=t||{},s==null)return t;do{for(i=Object.getOwnPropertyNames(s),c=i.length;c-- >0;)a=i[c],(!n||n(a,s,t))&&!m[a]&&(t[a]=s[a],m[a]=!0);s=r!==!1&&En(s)}while(s&&(!r||r(s,t))&&s!==Object.prototype);return t},Qa=(s,t,r)=>{s=String(s),(r===void 0||r>s.length)&&(r=s.length),r-=t.length;const n=s.indexOf(t,r);return n!==-1&&n===r},el=s=>{if(!s)return null;if(Fs(s))return s;let t=s.length;if(!Lo(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=s[t];return r},tl=(s=>t=>s&&t instanceof s)(typeof Uint8Array<"u"&&En(Uint8Array)),sl=(s,t)=>{const n=(s&&s[Lr]).call(s);let i;for(;(i=n.next())&&!i.done;){const c=i.value;t.call(s,c[0],c[1])}},rl=(s,t)=>{let r;const n=[];for(;(r=s.exec(t))!==null;)n.push(r);return n},nl=Vt("HTMLFormElement"),ol=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,i){return n.toUpperCase()+i}),Zn=(({hasOwnProperty:s})=>(t,r)=>s.call(t,r))(Object.prototype),il=Vt("RegExp"),$o=(s,t)=>{const r=Object.getOwnPropertyDescriptors(s),n={};ur(r,(i,c)=>{let a;(a=t(i,c,s))!==!1&&(n[c]=a||i)}),Object.defineProperties(s,n)},al=s=>{$o(s,(t,r)=>{if(Mt(s)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=s[r];if(Mt(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},ll=(s,t)=>{const r={},n=i=>{i.forEach(c=>{r[c]=!0})};return Fs(s)?n(s):n(String(s).split(t)),r},cl=()=>{},dl=(s,t)=>s!=null&&Number.isFinite(s=+s)?s:t;function ul(s){return!!(s&&Mt(s.append)&&s[Ro]==="FormData"&&s[Lr])}const ml=s=>{const t=new Array(10),r=(n,i)=>{if(dr(n)){if(t.indexOf(n)>=0)return;if(cr(n))return n;if(!("toJSON"in n)){t[i]=n;const c=Fs(n)?[]:{};return ur(n,(a,m)=>{const C=r(a,i+1);!Ps(C)&&(c[m]=C)}),t[i]=void 0,c}}return n};return r(s,0)},hl=Vt("AsyncFunction"),gl=s=>s&&(dr(s)||Mt(s))&&Mt(s.then)&&Mt(s.catch),Fo=((s,t)=>s?setImmediate:t?((r,n)=>(Ns.addEventListener("message",({source:i,data:c})=>{i===Ns&&c===r&&n.length&&n.shift()()},!1),i=>{n.push(i),Ns.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Mt(Ns.postMessage)),fl=typeof queueMicrotask<"u"?queueMicrotask.bind(Ns):typeof process<"u"&&process.nextTick||Fo,pl=s=>s!=null&&Mt(s[Lr]),D={isArray:Fs,isArrayBuffer:Uo,isBuffer:cr,isFormData:Ba,isArrayBufferView:Ra,isString:Ua,isNumber:Lo,isBoolean:La,isObject:dr,isPlainObject:yr,isEmptyObject:Pa,isReadableStream:qa,isRequest:Va,isResponse:Ha,isHeaders:Wa,isUndefined:Ps,isDate:Oa,isFile:$a,isBlob:Fa,isRegExp:il,isFunction:Mt,isStream:za,isURLSearchParams:Ga,isTypedArray:tl,isFileList:Da,forEach:ur,merge:cn,extend:Ja,trim:Ya,stripBOM:Ka,inherits:Xa,toFlatObject:Za,kindOf:Pr,kindOfTest:Vt,endsWith:Qa,toArray:el,forEachEntry:sl,matchAll:rl,isHTMLForm:nl,hasOwnProperty:Zn,hasOwnProp:Zn,reduceDescriptors:$o,freezeMethods:al,toObjectSet:ll,toCamelCase:ol,noop:cl,toFiniteNumber:dl,findKey:Po,global:Ns,isContextDefined:Oo,isSpecCompliantForm:ul,toJSONObject:ml,isAsyncFn:hl,isThenable:gl,setImmediate:Fo,asap:fl,isIterable:pl};function Re(s,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}D.inherits(Re,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:D.toJSONObject(this.config),code:this.code,status:this.status}}});const Do=Re.prototype,zo={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{zo[s]={value:s}});Object.defineProperties(Re,zo);Object.defineProperty(Do,"isAxiosError",{value:!0});Re.from=(s,t,r,n,i,c)=>{const a=Object.create(Do);D.toFlatObject(s,a,function(j){return j!==Error.prototype},b=>b!=="isAxiosError");const m=s&&s.message?s.message:"Error",C=t==null&&s?s.code:t;return Re.call(a,m,C,r,n,i),s&&a.cause==null&&Object.defineProperty(a,"cause",{value:s,configurable:!0}),a.name=s&&s.name||"Error",c&&Object.assign(a,c),a};const xl=null;function dn(s){return D.isPlainObject(s)||D.isArray(s)}function Bo(s){return D.endsWith(s,"[]")?s.slice(0,-2):s}function Qn(s,t,r){return s?s.concat(t).map(function(i,c){return i=Bo(i),!r&&c?"["+i+"]":i}).join(r?".":""):t}function bl(s){return D.isArray(s)&&!s.some(dn)}const yl=D.toFlatObject(D,{},null,function(t){return/^is[A-Z]/.test(t)});function $r(s,t,r){if(!D.isObject(s))throw new TypeError("target must be an object");t=t||new FormData,r=D.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(F,f){return!D.isUndefined(f[F])});const n=r.metaTokens,i=r.visitor||j,c=r.dots,a=r.indexes,C=(r.Blob||typeof Blob<"u"&&Blob)&&D.isSpecCompliantForm(t);if(!D.isFunction(i))throw new TypeError("visitor must be a function");function b(R){if(R===null)return"";if(D.isDate(R))return R.toISOString();if(D.isBoolean(R))return R.toString();if(!C&&D.isBlob(R))throw new Re("Blob is not supported. Use a Buffer instead.");return D.isArrayBuffer(R)||D.isTypedArray(R)?C&&typeof Blob=="function"?new Blob([R]):Buffer.from(R):R}function j(R,F,f){let O=R;if(R&&!f&&typeof R=="object"){if(D.endsWith(F,"{}"))F=n?F:F.slice(0,-2),R=JSON.stringify(R);else if(D.isArray(R)&&bl(R)||(D.isFileList(R)||D.endsWith(F,"[]"))&&(O=D.toArray(R)))return F=Bo(F),O.forEach(function(L,J){!(D.isUndefined(L)||L===null)&&t.append(a===!0?Qn([F],J,c):a===null?F:F+"[]",b(L))}),!1}return dn(R)?!0:(t.append(Qn(f,F,c),b(R)),!1)}const T=[],_=Object.assign(yl,{defaultVisitor:j,convertValue:b,isVisitable:dn});function z(R,F){if(!D.isUndefined(R)){if(T.indexOf(R)!==-1)throw Error("Circular reference detected in "+F.join("."));T.push(R),D.forEach(R,function(O,g){(!(D.isUndefined(O)||O===null)&&i.call(t,O,D.isString(g)?g.trim():g,F,_))===!0&&z(O,F?F.concat(g):[g])}),T.pop()}}if(!D.isObject(s))throw new TypeError("data must be an object");return z(s),t}function eo(s){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function Mn(s,t){this._pairs=[],s&&$r(s,this,t)}const Go=Mn.prototype;Go.append=function(t,r){this._pairs.push([t,r])};Go.toString=function(t){const r=t?function(n){return t.call(this,n,eo)}:eo;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};function wl(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function qo(s,t,r){if(!t)return s;const n=r&&r.encode||wl;D.isFunction(r)&&(r={serialize:r});const i=r&&r.serialize;let c;if(i?c=i(t,r):c=D.isURLSearchParams(t)?t.toString():new Mn(t,r).toString(n),c){const a=s.indexOf("#");a!==-1&&(s=s.slice(0,a)),s+=(s.indexOf("?")===-1?"?":"&")+c}return s}class vl{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){D.forEach(this.handlers,function(n){n!==null&&t(n)})}}const to=vl,Vo={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},jl=typeof URLSearchParams<"u"?URLSearchParams:Mn,Nl=typeof FormData<"u"?FormData:null,kl=typeof Blob<"u"?Blob:null,Sl={isBrowser:!0,classes:{URLSearchParams:jl,FormData:Nl,Blob:kl},protocols:["http","https","file","blob","url","data"]},An=typeof window<"u"&&typeof document<"u",un=typeof navigator=="object"&&navigator||void 0,Cl=An&&(!un||["ReactNative","NativeScript","NS"].indexOf(un.product)<0),Il=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Tl=An&&window.location.href||"http://localhost",El=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:An,hasStandardBrowserEnv:Cl,hasStandardBrowserWebWorkerEnv:Il,navigator:un,origin:Tl},Symbol.toStringTag,{value:"Module"})),jt={...El,...Sl};function Ml(s,t){return $r(s,new jt.classes.URLSearchParams,{visitor:function(r,n,i,c){return jt.isNode&&D.isBuffer(r)?(this.append(n,r.toString("base64")),!1):c.defaultVisitor.apply(this,arguments)},...t})}function Al(s){return D.matchAll(/\w+|\[(\w*)]/g,s).map(t=>t[0]==="[]"?"":t[1]||t[0])}function _l(s){const t={},r=Object.keys(s);let n;const i=r.length;let c;for(n=0;n<i;n++)c=r[n],t[c]=s[c];return t}function Ho(s){function t(r,n,i,c){let a=r[c++];if(a==="__proto__")return!0;const m=Number.isFinite(+a),C=c>=r.length;return a=!a&&D.isArray(i)?i.length:a,C?(D.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!m):((!i[a]||!D.isObject(i[a]))&&(i[a]=[]),t(r,n,i[a],c)&&D.isArray(i[a])&&(i[a]=_l(i[a])),!m)}if(D.isFormData(s)&&D.isFunction(s.entries)){const r={};return D.forEachEntry(s,(n,i)=>{t(Al(n),i,r,0)}),r}return null}function Rl(s,t,r){if(D.isString(s))try{return(t||JSON.parse)(s),D.trim(s)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(s)}const _n={transitional:Vo,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",i=n.indexOf("application/json")>-1,c=D.isObject(t);if(c&&D.isHTMLForm(t)&&(t=new FormData(t)),D.isFormData(t))return i?JSON.stringify(Ho(t)):t;if(D.isArrayBuffer(t)||D.isBuffer(t)||D.isStream(t)||D.isFile(t)||D.isBlob(t)||D.isReadableStream(t))return t;if(D.isArrayBufferView(t))return t.buffer;if(D.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let m;if(c){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Ml(t,this.formSerializer).toString();if((m=D.isFileList(t))||n.indexOf("multipart/form-data")>-1){const C=this.env&&this.env.FormData;return $r(m?{"files[]":t}:t,C&&new C,this.formSerializer)}}return c||i?(r.setContentType("application/json",!1),Rl(t)):t}],transformResponse:[function(t){const r=this.transitional||_n.transitional,n=r&&r.forcedJSONParsing,i=this.responseType==="json";if(D.isResponse(t)||D.isReadableStream(t))return t;if(t&&D.isString(t)&&(n&&!this.responseType||i)){const a=!(r&&r.silentJSONParsing)&&i;try{return JSON.parse(t,this.parseReviver)}catch(m){if(a)throw m.name==="SyntaxError"?Re.from(m,Re.ERR_BAD_RESPONSE,this,null,this.response):m}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:jt.classes.FormData,Blob:jt.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};D.forEach(["delete","get","head","post","put","patch"],s=>{_n.headers[s]={}});const Rn=_n,Ul=D.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ll=s=>{const t={};let r,n,i;return s&&s.split(`
`).forEach(function(a){i=a.indexOf(":"),r=a.substring(0,i).trim().toLowerCase(),n=a.substring(i+1).trim(),!(!r||t[r]&&Ul[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},so=Symbol("internals");function Xs(s){return s&&String(s).trim().toLowerCase()}function wr(s){return s===!1||s==null?s:D.isArray(s)?s.map(wr):String(s)}function Pl(s){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(s);)t[n[1]]=n[2];return t}const Ol=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function Xr(s,t,r,n,i){if(D.isFunction(n))return n.call(this,t,r);if(i&&(t=r),!!D.isString(t)){if(D.isString(n))return t.indexOf(n)!==-1;if(D.isRegExp(n))return n.test(t)}}function $l(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function Fl(s,t){const r=D.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(s,n+r,{value:function(i,c,a){return this[n].call(this,t,i,c,a)},configurable:!0})})}class Fr{constructor(t){t&&this.set(t)}set(t,r,n){const i=this;function c(m,C,b){const j=Xs(C);if(!j)throw new Error("header name must be a non-empty string");const T=D.findKey(i,j);(!T||i[T]===void 0||b===!0||b===void 0&&i[T]!==!1)&&(i[T||C]=wr(m))}const a=(m,C)=>D.forEach(m,(b,j)=>c(b,j,C));if(D.isPlainObject(t)||t instanceof this.constructor)a(t,r);else if(D.isString(t)&&(t=t.trim())&&!Ol(t))a(Ll(t),r);else if(D.isObject(t)&&D.isIterable(t)){let m={},C,b;for(const j of t){if(!D.isArray(j))throw TypeError("Object iterator must return a key-value pair");m[b=j[0]]=(C=m[b])?D.isArray(C)?[...C,j[1]]:[C,j[1]]:j[1]}a(m,r)}else t!=null&&c(r,t,n);return this}get(t,r){if(t=Xs(t),t){const n=D.findKey(this,t);if(n){const i=this[n];if(!r)return i;if(r===!0)return Pl(i);if(D.isFunction(r))return r.call(this,i,n);if(D.isRegExp(r))return r.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=Xs(t),t){const n=D.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||Xr(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let i=!1;function c(a){if(a=Xs(a),a){const m=D.findKey(n,a);m&&(!r||Xr(n,n[m],m,r))&&(delete n[m],i=!0)}}return D.isArray(t)?t.forEach(c):c(t),i}clear(t){const r=Object.keys(this);let n=r.length,i=!1;for(;n--;){const c=r[n];(!t||Xr(this,this[c],c,t,!0))&&(delete this[c],i=!0)}return i}normalize(t){const r=this,n={};return D.forEach(this,(i,c)=>{const a=D.findKey(n,c);if(a){r[a]=wr(i),delete r[c];return}const m=t?$l(c):String(c).trim();m!==c&&delete r[c],r[m]=wr(i),n[m]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return D.forEach(this,(n,i)=>{n!=null&&n!==!1&&(r[i]=t&&D.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(i=>n.set(i)),n}static accessor(t){const n=(this[so]=this[so]={accessors:{}}).accessors,i=this.prototype;function c(a){const m=Xs(a);n[m]||(Fl(i,a),n[m]=!0)}return D.isArray(t)?t.forEach(c):c(t),this}}Fr.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);D.reduceDescriptors(Fr.prototype,({value:s},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(n){this[r]=n}}});D.freezeMethods(Fr);const qt=Fr;function Zr(s,t){const r=this||Rn,n=t||r,i=qt.from(n.headers);let c=n.data;return D.forEach(s,function(m){c=m.call(r,c,i.normalize(),t?t.status:void 0)}),i.normalize(),c}function Wo(s){return!!(s&&s.__CANCEL__)}function Ds(s,t,r){Re.call(this,s??"canceled",Re.ERR_CANCELED,t,r),this.name="CanceledError"}D.inherits(Ds,Re,{__CANCEL__:!0});function Yo(s,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?s(r):t(new Re("Request failed with status code "+r.status,[Re.ERR_BAD_REQUEST,Re.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Dl(s){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return t&&t[1]||""}function zl(s,t){s=s||10;const r=new Array(s),n=new Array(s);let i=0,c=0,a;return t=t!==void 0?t:1e3,function(C){const b=Date.now(),j=n[c];a||(a=b),r[i]=C,n[i]=b;let T=c,_=0;for(;T!==i;)_+=r[T++],T=T%s;if(i=(i+1)%s,i===c&&(c=(c+1)%s),b-a<t)return;const z=j&&b-j;return z?Math.round(_*1e3/z):void 0}}function Bl(s,t){let r=0,n=1e3/t,i,c;const a=(b,j=Date.now())=>{r=j,i=null,c&&(clearTimeout(c),c=null),s(...b)};return[(...b)=>{const j=Date.now(),T=j-r;T>=n?a(b,j):(i=b,c||(c=setTimeout(()=>{c=null,a(i)},n-T)))},()=>i&&a(i)]}const Tr=(s,t,r=3)=>{let n=0;const i=zl(50,250);return Bl(c=>{const a=c.loaded,m=c.lengthComputable?c.total:void 0,C=a-n,b=i(C),j=a<=m;n=a;const T={loaded:a,total:m,progress:m?a/m:void 0,bytes:C,rate:b||void 0,estimated:b&&m&&j?(m-a)/b:void 0,event:c,lengthComputable:m!=null,[t?"download":"upload"]:!0};s(T)},r)},ro=(s,t)=>{const r=s!=null;return[n=>t[0]({lengthComputable:r,total:s,loaded:n}),t[1]]},no=s=>(...t)=>D.asap(()=>s(...t)),Gl=jt.hasStandardBrowserEnv?((s,t)=>r=>(r=new URL(r,jt.origin),s.protocol===r.protocol&&s.host===r.host&&(t||s.port===r.port)))(new URL(jt.origin),jt.navigator&&/(msie|trident)/i.test(jt.navigator.userAgent)):()=>!0,ql=jt.hasStandardBrowserEnv?{write(s,t,r,n,i,c){const a=[s+"="+encodeURIComponent(t)];D.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),D.isString(n)&&a.push("path="+n),D.isString(i)&&a.push("domain="+i),c===!0&&a.push("secure"),document.cookie=a.join("; ")},read(s){const t=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Vl(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function Hl(s,t){return t?s.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):s}function Jo(s,t,r){let n=!Vl(t);return s&&(n||r==!1)?Hl(s,t):t}const oo=s=>s instanceof qt?{...s}:s;function ks(s,t){t=t||{};const r={};function n(b,j,T,_){return D.isPlainObject(b)&&D.isPlainObject(j)?D.merge.call({caseless:_},b,j):D.isPlainObject(j)?D.merge({},j):D.isArray(j)?j.slice():j}function i(b,j,T,_){if(D.isUndefined(j)){if(!D.isUndefined(b))return n(void 0,b,T,_)}else return n(b,j,T,_)}function c(b,j){if(!D.isUndefined(j))return n(void 0,j)}function a(b,j){if(D.isUndefined(j)){if(!D.isUndefined(b))return n(void 0,b)}else return n(void 0,j)}function m(b,j,T){if(T in t)return n(b,j);if(T in s)return n(void 0,b)}const C={url:c,method:c,data:c,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:m,headers:(b,j,T)=>i(oo(b),oo(j),T,!0)};return D.forEach(Object.keys({...s,...t}),function(j){const T=C[j]||i,_=T(s[j],t[j],j);D.isUndefined(_)&&T!==m||(r[j]=_)}),r}const Ko=s=>{const t=ks({},s);let{data:r,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:c,headers:a,auth:m}=t;if(t.headers=a=qt.from(a),t.url=qo(Jo(t.baseURL,t.url,t.allowAbsoluteUrls),s.params,s.paramsSerializer),m&&a.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),D.isFormData(r)){if(jt.hasStandardBrowserEnv||jt.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(D.isFunction(r.getHeaders)){const C=r.getHeaders(),b=["content-type","content-length"];Object.entries(C).forEach(([j,T])=>{b.includes(j.toLowerCase())&&a.set(j,T)})}}if(jt.hasStandardBrowserEnv&&(n&&D.isFunction(n)&&(n=n(t)),n||n!==!1&&Gl(t.url))){const C=i&&c&&ql.read(c);C&&a.set(i,C)}return t},Wl=typeof XMLHttpRequest<"u",Yl=Wl&&function(s){return new Promise(function(r,n){const i=Ko(s);let c=i.data;const a=qt.from(i.headers).normalize();let{responseType:m,onUploadProgress:C,onDownloadProgress:b}=i,j,T,_,z,R;function F(){z&&z(),R&&R(),i.cancelToken&&i.cancelToken.unsubscribe(j),i.signal&&i.signal.removeEventListener("abort",j)}let f=new XMLHttpRequest;f.open(i.method.toUpperCase(),i.url,!0),f.timeout=i.timeout;function O(){if(!f)return;const L=qt.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders()),q={data:!m||m==="text"||m==="json"?f.responseText:f.response,status:f.status,statusText:f.statusText,headers:L,config:s,request:f};Yo(function(W){r(W),F()},function(W){n(W),F()},q),f=null}"onloadend"in f?f.onloadend=O:f.onreadystatechange=function(){!f||f.readyState!==4||f.status===0&&!(f.responseURL&&f.responseURL.indexOf("file:")===0)||setTimeout(O)},f.onabort=function(){f&&(n(new Re("Request aborted",Re.ECONNABORTED,s,f)),f=null)},f.onerror=function(J){const q=J&&J.message?J.message:"Network Error",Q=new Re(q,Re.ERR_NETWORK,s,f);Q.event=J||null,n(Q),f=null},f.ontimeout=function(){let J=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const q=i.transitional||Vo;i.timeoutErrorMessage&&(J=i.timeoutErrorMessage),n(new Re(J,q.clarifyTimeoutError?Re.ETIMEDOUT:Re.ECONNABORTED,s,f)),f=null},c===void 0&&a.setContentType(null),"setRequestHeader"in f&&D.forEach(a.toJSON(),function(J,q){f.setRequestHeader(q,J)}),D.isUndefined(i.withCredentials)||(f.withCredentials=!!i.withCredentials),m&&m!=="json"&&(f.responseType=i.responseType),b&&([_,R]=Tr(b,!0),f.addEventListener("progress",_)),C&&f.upload&&([T,z]=Tr(C),f.upload.addEventListener("progress",T),f.upload.addEventListener("loadend",z)),(i.cancelToken||i.signal)&&(j=L=>{f&&(n(!L||L.type?new Ds(null,s,f):L),f.abort(),f=null)},i.cancelToken&&i.cancelToken.subscribe(j),i.signal&&(i.signal.aborted?j():i.signal.addEventListener("abort",j)));const g=Dl(i.url);if(g&&jt.protocols.indexOf(g)===-1){n(new Re("Unsupported protocol "+g+":",Re.ERR_BAD_REQUEST,s));return}f.send(c||null)})},Jl=(s,t)=>{const{length:r}=s=s?s.filter(Boolean):[];if(t||r){let n=new AbortController,i;const c=function(b){if(!i){i=!0,m();const j=b instanceof Error?b:this.reason;n.abort(j instanceof Re?j:new Ds(j instanceof Error?j.message:j))}};let a=t&&setTimeout(()=>{a=null,c(new Re(`timeout ${t} of ms exceeded`,Re.ETIMEDOUT))},t);const m=()=>{s&&(a&&clearTimeout(a),a=null,s.forEach(b=>{b.unsubscribe?b.unsubscribe(c):b.removeEventListener("abort",c)}),s=null)};s.forEach(b=>b.addEventListener("abort",c));const{signal:C}=n;return C.unsubscribe=()=>D.asap(m),C}},Kl=Jl,Xl=function*(s,t){let r=s.byteLength;if(!t||r<t){yield s;return}let n=0,i;for(;n<r;)i=n+t,yield s.slice(n,i),n=i},Zl=async function*(s,t){for await(const r of Ql(s))yield*Xl(r,t)},Ql=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const t=s.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},io=(s,t,r,n)=>{const i=Zl(s,t);let c=0,a,m=C=>{a||(a=!0,n&&n(C))};return new ReadableStream({async pull(C){try{const{done:b,value:j}=await i.next();if(b){m(),C.close();return}let T=j.byteLength;if(r){let _=c+=T;r(_)}C.enqueue(new Uint8Array(j))}catch(b){throw m(b),b}},cancel(C){return m(C),i.return()}},{highWaterMark:2})},ao=64*1024,{isFunction:fr}=D,ec=(({Request:s,Response:t})=>({Request:s,Response:t}))(D.global),{ReadableStream:lo,TextEncoder:co}=D.global,uo=(s,...t)=>{try{return!!s(...t)}catch{return!1}},tc=s=>{s=D.merge.call({skipUndefined:!0},ec,s);const{fetch:t,Request:r,Response:n}=s,i=t?fr(t):typeof fetch=="function",c=fr(r),a=fr(n);if(!i)return!1;const m=i&&fr(lo),C=i&&(typeof co=="function"?(R=>F=>R.encode(F))(new co):async R=>new Uint8Array(await new r(R).arrayBuffer())),b=c&&m&&uo(()=>{let R=!1;const F=new r(jt.origin,{body:new lo,method:"POST",get duplex(){return R=!0,"half"}}).headers.has("Content-Type");return R&&!F}),j=a&&m&&uo(()=>D.isReadableStream(new n("").body)),T={stream:j&&(R=>R.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(R=>{!T[R]&&(T[R]=(F,f)=>{let O=F&&F[R];if(O)return O.call(F);throw new Re(`Response type '${R}' is not supported`,Re.ERR_NOT_SUPPORT,f)})});const _=async R=>{if(R==null)return 0;if(D.isBlob(R))return R.size;if(D.isSpecCompliantForm(R))return(await new r(jt.origin,{method:"POST",body:R}).arrayBuffer()).byteLength;if(D.isArrayBufferView(R)||D.isArrayBuffer(R))return R.byteLength;if(D.isURLSearchParams(R)&&(R=R+""),D.isString(R))return(await C(R)).byteLength},z=async(R,F)=>{const f=D.toFiniteNumber(R.getContentLength());return f??_(F)};return async R=>{let{url:F,method:f,data:O,signal:g,cancelToken:L,timeout:J,onDownloadProgress:q,onUploadProgress:Q,responseType:W,headers:pe,withCredentials:ge="same-origin",fetchOptions:be}=Ko(R),te=t||fetch;W=W?(W+"").toLowerCase():"text";let le=Kl([g,L&&L.toAbortSignal()],J),M=null;const ne=le&&le.unsubscribe&&(()=>{le.unsubscribe()});let I;try{if(Q&&b&&f!=="get"&&f!=="head"&&(I=await z(pe,O))!==0){let A=new r(F,{method:"POST",body:O,duplex:"half"}),Z;if(D.isFormData(O)&&(Z=A.headers.get("content-type"))&&pe.setContentType(Z),A.body){const[S,E]=ro(I,Tr(no(Q)));O=io(A.body,ao,S,E)}}D.isString(ge)||(ge=ge?"include":"omit");const G=c&&"credentials"in r.prototype,K={...be,signal:le,method:f.toUpperCase(),headers:pe.normalize().toJSON(),body:O,duplex:"half",credentials:G?ge:void 0};M=c&&new r(F,K);let Y=await(c?te(M,be):te(F,K));const k=j&&(W==="stream"||W==="response");if(j&&(q||k&&ne)){const A={};["status","statusText","headers"].forEach(H=>{A[H]=Y[H]});const Z=D.toFiniteNumber(Y.headers.get("content-length")),[S,E]=q&&ro(Z,Tr(no(q),!0))||[];Y=new n(io(Y.body,ao,S,()=>{E&&E(),ne&&ne()}),A)}W=W||"text";let w=await T[D.findKey(T,W)||"text"](Y,R);return!k&&ne&&ne(),await new Promise((A,Z)=>{Yo(A,Z,{data:w,headers:qt.from(Y.headers),status:Y.status,statusText:Y.statusText,config:R,request:M})})}catch(G){throw ne&&ne(),G&&G.name==="TypeError"&&/Load failed|fetch/i.test(G.message)?Object.assign(new Re("Network Error",Re.ERR_NETWORK,R,M),{cause:G.cause||G}):Re.from(G,G&&G.code,R,M)}}},sc=new Map,Xo=s=>{let t=s?s.env:{};const{fetch:r,Request:n,Response:i}=t,c=[n,i,r];let a=c.length,m=a,C,b,j=sc;for(;m--;)C=c[m],b=j.get(C),b===void 0&&j.set(C,b=m?new Map:tc(t)),j=b;return b};Xo();const mn={http:xl,xhr:Yl,fetch:{get:Xo}};D.forEach(mn,(s,t)=>{if(s){try{Object.defineProperty(s,"name",{value:t})}catch{}Object.defineProperty(s,"adapterName",{value:t})}});const mo=s=>`- ${s}`,rc=s=>D.isFunction(s)||s===null||s===!1,Zo={getAdapter:(s,t)=>{s=D.isArray(s)?s:[s];const{length:r}=s;let n,i;const c={};for(let a=0;a<r;a++){n=s[a];let m;if(i=n,!rc(n)&&(i=mn[(m=String(n)).toLowerCase()],i===void 0))throw new Re(`Unknown adapter '${m}'`);if(i&&(D.isFunction(i)||(i=i.get(t))))break;c[m||"#"+a]=i}if(!i){const a=Object.entries(c).map(([C,b])=>`adapter ${C} `+(b===!1?"is not supported by the environment":"is not available in the build"));let m=r?a.length>1?`since :
`+a.map(mo).join(`
`):" "+mo(a[0]):"as no adapter specified";throw new Re("There is no suitable adapter to dispatch the request "+m,"ERR_NOT_SUPPORT")}return i},adapters:mn};function Qr(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new Ds(null,s)}function ho(s){return Qr(s),s.headers=qt.from(s.headers),s.data=Zr.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),Zo.getAdapter(s.adapter||Rn.adapter,s)(s).then(function(n){return Qr(s),n.data=Zr.call(s,s.transformResponse,n),n.headers=qt.from(n.headers),n},function(n){return Wo(n)||(Qr(s),n&&n.response&&(n.response.data=Zr.call(s,s.transformResponse,n.response),n.response.headers=qt.from(n.response.headers))),Promise.reject(n)})}const Qo="1.12.2",Dr={};["object","boolean","number","function","string","symbol"].forEach((s,t)=>{Dr[s]=function(n){return typeof n===s||"a"+(t<1?"n ":" ")+s}});const go={};Dr.transitional=function(t,r,n){function i(c,a){return"[Axios v"+Qo+"] Transitional option '"+c+"'"+a+(n?". "+n:"")}return(c,a,m)=>{if(t===!1)throw new Re(i(a," has been removed"+(r?" in "+r:"")),Re.ERR_DEPRECATED);return r&&!go[a]&&(go[a]=!0,console.warn(i(a," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(c,a,m):!0}};Dr.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function nc(s,t,r){if(typeof s!="object")throw new Re("options must be an object",Re.ERR_BAD_OPTION_VALUE);const n=Object.keys(s);let i=n.length;for(;i-- >0;){const c=n[i],a=t[c];if(a){const m=s[c],C=m===void 0||a(m,c,s);if(C!==!0)throw new Re("option "+c+" must be "+C,Re.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Re("Unknown option "+c,Re.ERR_BAD_OPTION)}}const vr={assertOptions:nc,validators:Dr},Kt=vr.validators;class Er{constructor(t){this.defaults=t||{},this.interceptors={request:new to,response:new to}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const c=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?c&&!String(n.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+c):n.stack=c}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=ks(this.defaults,r);const{transitional:n,paramsSerializer:i,headers:c}=r;n!==void 0&&vr.assertOptions(n,{silentJSONParsing:Kt.transitional(Kt.boolean),forcedJSONParsing:Kt.transitional(Kt.boolean),clarifyTimeoutError:Kt.transitional(Kt.boolean)},!1),i!=null&&(D.isFunction(i)?r.paramsSerializer={serialize:i}:vr.assertOptions(i,{encode:Kt.function,serialize:Kt.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),vr.assertOptions(r,{baseUrl:Kt.spelling("baseURL"),withXsrfToken:Kt.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let a=c&&D.merge(c.common,c[r.method]);c&&D.forEach(["delete","get","head","post","put","patch","common"],R=>{delete c[R]}),r.headers=qt.concat(a,c);const m=[];let C=!0;this.interceptors.request.forEach(function(F){typeof F.runWhen=="function"&&F.runWhen(r)===!1||(C=C&&F.synchronous,m.unshift(F.fulfilled,F.rejected))});const b=[];this.interceptors.response.forEach(function(F){b.push(F.fulfilled,F.rejected)});let j,T=0,_;if(!C){const R=[ho.bind(this),void 0];for(R.unshift(...m),R.push(...b),_=R.length,j=Promise.resolve(r);T<_;)j=j.then(R[T++],R[T++]);return j}_=m.length;let z=r;for(;T<_;){const R=m[T++],F=m[T++];try{z=R(z)}catch(f){F.call(this,f);break}}try{j=ho.call(this,z)}catch(R){return Promise.reject(R)}for(T=0,_=b.length;T<_;)j=j.then(b[T++],b[T++]);return j}getUri(t){t=ks(this.defaults,t);const r=Jo(t.baseURL,t.url,t.allowAbsoluteUrls);return qo(r,t.params,t.paramsSerializer)}}D.forEach(["delete","get","head","options"],function(t){Er.prototype[t]=function(r,n){return this.request(ks(n||{},{method:t,url:r,data:(n||{}).data}))}});D.forEach(["post","put","patch"],function(t){function r(n){return function(c,a,m){return this.request(ks(m||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:c,data:a}))}}Er.prototype[t]=r(),Er.prototype[t+"Form"]=r(!0)});const jr=Er;class Un{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(c){r=c});const n=this;this.promise.then(i=>{if(!n._listeners)return;let c=n._listeners.length;for(;c-- >0;)n._listeners[c](i);n._listeners=null}),this.promise.then=i=>{let c;const a=new Promise(m=>{n.subscribe(m),c=m}).then(i);return a.cancel=function(){n.unsubscribe(c)},a},t(function(c,a,m){n.reason||(n.reason=new Ds(c,a,m),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new Un(function(i){t=i}),cancel:t}}}const oc=Un;function ic(s){return function(r){return s.apply(null,r)}}function ac(s){return D.isObject(s)&&s.isAxiosError===!0}const hn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(hn).forEach(([s,t])=>{hn[t]=s});const lc=hn;function ei(s){const t=new jr(s),r=_o(jr.prototype.request,t);return D.extend(r,jr.prototype,t,{allOwnKeys:!0}),D.extend(r,t,null,{allOwnKeys:!0}),r.create=function(i){return ei(ks(s,i))},r}const ot=ei(Rn);ot.Axios=jr;ot.CanceledError=Ds;ot.CancelToken=oc;ot.isCancel=Wo;ot.VERSION=Qo;ot.toFormData=$r;ot.AxiosError=Re;ot.Cancel=ot.CanceledError;ot.all=function(t){return Promise.all(t)};ot.spread=ic;ot.isAxiosError=ac;ot.mergeConfig=ks;ot.AxiosHeaders=qt;ot.formToJSON=s=>Ho(D.isHTMLForm(s)?new FormData(s):s);ot.getAdapter=Zo.getAdapter;ot.HttpStatusCode=lc;ot.default=ot;const He=ot,ti="https://internalchat.pizeonfly.com/api",we=ti.replace(/\/?api\/?$/,""),fe=He.create({baseURL:ti,headers:{"Content-Type":"application/json"},timeout:5*60*1e3});fe.interceptors.request.use(s=>{const t=localStorage.getItem("token");return t&&(s.headers.Authorization=`Bearer ${t}`),s},s=>Promise.reject(s));fe.interceptors.response.use(s=>s,s=>{var t;return((t=s.response)==null?void 0:t.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(s)});const tr={login:(s,t)=>fe.post("/auth/login",{email:s,password:t}),registerSuperAdmin:(s,t,r)=>fe.post("/auth/register-superadmin",{name:s,email:t,password:r}),getCurrentUser:()=>fe.get("/auth/me"),checkSuperAdmin:()=>fe.get("/auth/check-superadmin")},St={getUsers:()=>fe.get("/users"),getActiveUsers:()=>fe.get("/users/active"),createUser:s=>fe.post("/users",s),updateUser:(s,t)=>fe.put(`/users/${s}`,t),deleteUser:s=>fe.delete(`/users/${s}`),toggleUserStatus:s=>fe.put(`/users/${s}/toggle-status`),updateProfile:s=>{const t=s instanceof FormData?s:(()=>{const r=new FormData;return Object.entries(s||{}).forEach(([n,i])=>{i!=null&&r.append(n,i)}),r})();return fe.put("/users/profile",t,{headers:{"Content-Type":"multipart/form-data"}})}},Gt={getGroups:()=>fe.get("/groups"),getMyGroups:()=>fe.get("/groups/my-groups"),createGroup:s=>fe.post("/groups",s),addMembers:(s,t)=>fe.post(`/groups/${s}/members`,{members:t}),removeMember:(s,t)=>fe.delete(`/groups/${s}/members/${t}`),updateGroup:(s,t)=>fe.put(`/groups/${s}`,t),deleteGroup:s=>fe.delete(`/groups/${s}`),uploadGroupAvatar:(s,t)=>fe.post(`/groups/${s}/avatar`,t,{headers:{"Content-Type":"multipart/form-data"}})},et={getPersonalMessages:(s,t={})=>fe.get(`/messages/personal/${s}`,{params:t}),getGroupMessages:(s,t={})=>fe.get(`/messages/group/${s}`,{params:t}),sendPersonalMessage:(s,t)=>s instanceof FormData?fe.post("/messages/personal",s,{headers:{"Content-Type":"multipart/form-data"},timeout:10*60*1e3,maxContentLength:100*1024*1024,maxBodyLength:100*1024*1024,onUploadProgress:t}):fe.post("/messages/personal",s),sendGroupMessage:(s,t)=>s instanceof FormData?fe.post("/messages/group",s,{headers:{"Content-Type":"multipart/form-data"},timeout:10*60*1e3,maxContentLength:100*1024*1024,maxBodyLength:100*1024*1024,onUploadProgress:t}):fe.post("/messages/group",s),markAsRead:s=>fe.put(`/messages/${s}/read`),getUnreadCount:()=>fe.get("/messages/unread/count"),getChatState:()=>fe.get("/messages/chat-state"),updateChatState:s=>fe.post("/messages/chat-state",s),forwardMessage:s=>fe.post("/messages/forward",s),editMessage:(s,t)=>fe.put(`/messages/${s}`,{message:t})},nr={getHistory:(s={})=>fe.get("/calls/history",{params:s}),initiate:(s,t="voice",r=null)=>fe.post("/calls/initiate",{receiverId:s,callType:t,offer:r}),answer:(s,t)=>fe.put(`/calls/${s}/answer`,{answer:t}),decline:s=>fe.put(`/calls/${s}/decline`),end:s=>fe.put(`/calls/${s}/end`),addIceCandidate:(s,t,r,n)=>fe.post(`/calls/${s}/ice-candidate`,{candidate:t,sdpMLineIndex:r,sdpMid:n}),getDetails:s=>fe.get(`/calls/${s}`),updateNotes:(s,t)=>fe.put(`/calls/${s}/notes`,{notes:t}),delete:s=>fe.delete(`/calls/${s}`)},is={test:()=>fe.get("/group-calls/test"),initiate:(s,t="voice")=>fe.post("/group-calls/initiate",{groupId:s,callType:t}),join:s=>fe.post(`/group-calls/${s}/join`),leave:s=>fe.post(`/group-calls/${s}/leave`),end:s=>fe.post(`/group-calls/${s}/end`),updateMuteStatus:(s,t)=>fe.put(`/group-calls/${s}/mute`,{isMuted:t}),updateVideoStatus:(s,t)=>fe.put(`/group-calls/${s}/video`,{isVideoEnabled:t}),removeParticipant:(s,t)=>fe.delete(`/group-calls/${s}/participant/${t}`),getDetails:s=>fe.get(`/group-calls/${s}`),getActiveCalls:s=>fe.get(`/group-calls/group/${s}/active`),getHistory:(s,t={})=>fe.get(`/group-calls/group/${s}/history`,{params:t}),endAllActive:()=>fe.post("/group-calls/debug/end-all-active")},si={getSettings:()=>fe.get("/time-settings"),updateSettings:s=>fe.put("/time-settings",s),getCurrentTime:()=>fe.get("/time-settings/current-time")},js={getSchedules:()=>fe.get("/scheduled-disable"),getSchedule:s=>fe.get(`/scheduled-disable/${s}`),createSchedule:s=>fe.post("/scheduled-disable",s),updateSchedule:(s,t)=>fe.put(`/scheduled-disable/${s}`,t),deleteSchedule:s=>fe.delete(`/scheduled-disable/${s}`),toggleSchedule:s=>fe.put(`/scheduled-disable/${s}/toggle`),resetTrigger:s=>fe.put(`/scheduled-disable/${s}/reset-trigger`)},cc=Object.freeze(Object.defineProperty({__proto__:null,API_ORIGIN:we,authAPI:tr,callsAPI:nr,default:fe,groupCallsAPI:is,groupsAPI:Gt,messagesAPI:et,scheduledDisableAPI:js,timeSettingsAPI:si,usersAPI:St},Symbol.toStringTag,{value:"Module"})),ri={API_URL:"https://internalchat.pizeonfly.com/api",SOCKET_URL:"https://internalchat.pizeonfly.com",TURN_URL:"turn:internalchat.pizeonfly.com:3478",TURN_USERNAME:"webrtcuser",TURN_PASSWORD:{}.VITE_TURN_PASSWORD||"o4Ps!xl4"},dc={apiKey:"AIzaSyAntZL8-YIMYI5Fs19kGrccYOR2nIpIWPM",authDomain:"extractor-9843e.firebaseapp.com",projectId:"extractor-9843e",storageBucket:"extractor-9843e.firebasestorage.app",messagingSenderId:"1029960130572",appId:"1:1029960130572:web:692b0189efa3b22a9d4e29"},uc="BBniT8kgqBbeYvWgHMUMcHAcfB2lBfvSrVIkzxKC7Ppi3D9WfboQHzpMf333gP6IlbU1IMQ_X58xeHI2-2w9YfY",ni=ri.API_URL.replace(/\/?api\/?$/,"");function mc(s){const t="=".repeat((4-s.length%4)%4),r=(s+t).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(r);return Uint8Array.from([...n].map(i=>i.charCodeAt(0)))}const hc=()=>"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window,gc=async()=>{try{return(await He.get(`${ni}/api/push-notifications/vapid-public-key`)).data}catch(s){throw console.error("Failed to get VAPID key:",s),s}},fc=async()=>{if(!("Notification"in window))return console.log("This browser does not support notifications"),"denied";if(Notification.permission==="granted")return console.log(" Notification permission already granted"),"granted";if(Notification.permission==="denied")return console.warn(" Notification permission is denied. Please enable it in browser settings."),"denied";console.log(" Requesting notification permission...");const s=await Notification.requestPermission();return s==="granted"?console.log(" Notification permission granted!"):console.warn(" Notification permission denied by user"),s},pc=async()=>{if(!("serviceWorker"in navigator))throw new Error("Service Workers not supported");try{const s=await navigator.serviceWorker.register("/push-sw.js",{scope:"/"});return console.log(" Service Worker registered:",s),s}catch(s){throw console.error(" Service Worker registration failed:",s),s}},xc=async s=>{try{if(!hc())throw new Error("Push notifications are not supported");if(await fc()!=="granted")throw new Error("Notification permission denied");const{publicKey:r,configured:n}=await gc();if(!n||!r)throw new Error("Push notifications not configured on server");const i=await pc();await navigator.serviceWorker.ready;const c=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:mc(r)});console.log(" Push subscription created:",c);const a=localStorage.getItem("token");return await He.post(`${ni}/api/push-notifications/subscribe`,{...c.toJSON(),userId:s},{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}),console.log(" Push subscription saved to server"),localStorage.setItem("pushSubscriptionEndpoint",c.endpoint),{success:!0,subscription:c}}catch(t){return console.error(" Push subscription failed:",t),{success:!1,error:t.message}}},bc=async()=>{try{if(!("serviceWorker"in navigator))return{subscribed:!1};const s=await navigator.serviceWorker.getRegistration();if(!s)return{subscribed:!1};const t=await s.pushManager.getSubscription();return{subscribed:!!t,subscription:t}}catch(s){return console.error(" Check subscription failed:",s),{subscribed:!1}}},gn=async s=>{try{console.log(" Initializing push notifications...");const{subscribed:t}=await bc();return t?(console.log(" Already subscribed to push notifications"),{success:!0,alreadySubscribed:!0}):await xc(s)}catch(t){return console.error(" Push initialization failed:",t),{success:!1,error:t.message}}};let en=null,Mr=null;function yc(){try{return en||(en=Pi(dc),Mr=Oi(en),console.log(" Firebase initialized")),!0}catch(s){return console.error(" Firebase initialization failed:",s),!1}}async function wc(s){try{if(!yc())return{success:!1,error:"Firebase init failed"};if(await Notification.requestPermission()!=="granted")return{success:!1,error:"Permission denied"};const r=await Li(Mr,{vapidKey:uc});if(r){console.log(" FCM Token:",r.substring(0,20)+"...");const n=ri.API_URL.replace(/\/?api\/?$/,""),i=localStorage.getItem("token");return await He.post(`${n}/api/fcm-notifications/register`,{userId:s,token:r},{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),console.log(" FCM token registered with backend"),localStorage.setItem("fcmToken",r),{success:!0,token:r}}return{success:!1,error:"No token available"}}catch(t){return console.error(" FCM registration failed:",t),{success:!1,error:t.message}}}async function fn(s){try{console.log(" Initializing FCM...");const t=await wc(s);return t.success&&Mr&&Ui(Mr,r=>{console.log(" FCM message received:",r);const{title:n,body:i,icon:c}=r.notification||{};Notification.permission==="granted"&&new Notification(n||"New Message",{body:i||"You have a new message",icon:c||"/icon.png"})}),t}catch(t){return console.error(" FCM init failed:",t),{success:!1,error:t.message}}}const oi=u.createContext(),It=()=>{const s=u.useContext(oi);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},vc=({children:s})=>{const[t,r]=u.useState(null),[n,i]=u.useState(!0);u.useEffect(()=>{localStorage.getItem("token")?tr.getCurrentUser().then(j=>{var T;r(j.data.user),(T=j.data.user)!=null&&T._id&&fn(j.data.user._id).then(_=>{if(_.success)console.log(" FCM initialized");else return console.log(" FCM failed, trying Web Push..."),gn(j.data.user._id)}).then(_=>{_&&_.success&&console.log(" Web Push initialized")}).catch(_=>{console.log(" Notifications failed:",_)})}).catch(j=>{console.error("Auth check failed:",j),localStorage.removeItem("token")}).finally(()=>{i(!1)}):i(!1)},[]);const C={user:t,setUser:r,login:async(b,j)=>{var T,_,z,R;try{const F=await tr.login(b,j),{token:f,user:O}=F.data;return localStorage.setItem("token",f),r(O),O!=null&&O._id&&fn(O._id).then(g=>{if(g.success)console.log(" FCM enabled");else return console.log(" FCM failed, trying Web Push..."),gn(O._id)}).then(g=>{g&&g.success&&console.log(" Web Push enabled")}).catch(g=>{console.log(" Notifications failed:",g)}),{success:!0,data:F.data}}catch(F){return(_=(T=F.response)==null?void 0:T.data)!=null&&_.disabled?{success:!1,error:"Your account has been disabled by administrator",disabled:!0}:{success:!1,error:((R=(z=F.response)==null?void 0:z.data)==null?void 0:R.message)||"Login failed"}}},registerSuperAdmin:async(b,j,T)=>{var _,z;try{const R=await tr.registerSuperAdmin(b,j,T),{token:F,user:f}=R.data;return localStorage.setItem("token",F),r(f),{success:!0,data:R.data}}catch(R){return{success:!1,error:((z=(_=R.response)==null?void 0:_.data)==null?void 0:z.message)||"Registration failed"}}},logout:()=>{localStorage.removeItem("token"),r(null)},loading:n};return e.jsx(oi.Provider,{value:C,children:s})},jc="modulepreload",Nc=function(s){return"/"+s},fo={},kc=function(t,r,n){if(!r||r.length===0)return t();const i=document.getElementsByTagName("link");return Promise.all(r.map(c=>{if(c=Nc(c),c in fo)return;fo[c]=!0;const a=c.endsWith(".css"),m=a?'[rel="stylesheet"]':"";if(!!n)for(let j=i.length-1;j>=0;j--){const T=i[j];if(T.href===c&&(!a||T.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${m}`))return;const b=document.createElement("link");if(b.rel=a?"stylesheet":jc,a||(b.as="script",b.crossOrigin=""),b.href=c,document.head.appendChild(b),a)return new Promise((j,T)=>{b.addEventListener("load",j),b.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${c}`)))})})).then(()=>t()).catch(c=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=c,window.dispatchEvent(a),!a.defaultPrevented)throw c})},Qt=Object.create(null);Qt.open="0";Qt.close="1";Qt.ping="2";Qt.pong="3";Qt.message="4";Qt.upgrade="5";Qt.noop="6";const Nr=Object.create(null);Object.keys(Qt).forEach(s=>{Nr[Qt[s]]=s});const pn={type:"error",data:"parser error"},ii=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",ai=typeof ArrayBuffer=="function",li=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s&&s.buffer instanceof ArrayBuffer,Ln=({type:s,data:t},r,n)=>ii&&t instanceof Blob?r?n(t):po(t,n):ai&&(t instanceof ArrayBuffer||li(t))?r?n(t):po(new Blob([t]),n):n(Qt[s]+(t||"")),po=(s,t)=>{const r=new FileReader;return r.onload=function(){const n=r.result.split(",")[1];t("b"+(n||""))},r.readAsDataURL(s)};function xo(s){return s instanceof Uint8Array?s:s instanceof ArrayBuffer?new Uint8Array(s):new Uint8Array(s.buffer,s.byteOffset,s.byteLength)}let tn;function Sc(s,t){if(ii&&s.data instanceof Blob)return s.data.arrayBuffer().then(xo).then(t);if(ai&&(s.data instanceof ArrayBuffer||li(s.data)))return t(xo(s.data));Ln(s,!1,r=>{tn||(tn=new TextEncoder),t(tn.encode(r))})}const bo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Qs=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let s=0;s<bo.length;s++)Qs[bo.charCodeAt(s)]=s;const Cc=s=>{let t=s.length*.75,r=s.length,n,i=0,c,a,m,C;s[s.length-1]==="="&&(t--,s[s.length-2]==="="&&t--);const b=new ArrayBuffer(t),j=new Uint8Array(b);for(n=0;n<r;n+=4)c=Qs[s.charCodeAt(n)],a=Qs[s.charCodeAt(n+1)],m=Qs[s.charCodeAt(n+2)],C=Qs[s.charCodeAt(n+3)],j[i++]=c<<2|a>>4,j[i++]=(a&15)<<4|m>>2,j[i++]=(m&3)<<6|C&63;return b},Ic=typeof ArrayBuffer=="function",Pn=(s,t)=>{if(typeof s!="string")return{type:"message",data:ci(s,t)};const r=s.charAt(0);return r==="b"?{type:"message",data:Tc(s.substring(1),t)}:Nr[r]?s.length>1?{type:Nr[r],data:s.substring(1)}:{type:Nr[r]}:pn},Tc=(s,t)=>{if(Ic){const r=Cc(s);return ci(r,t)}else return{base64:!0,data:s}},ci=(s,t)=>{switch(t){case"blob":return s instanceof Blob?s:new Blob([s]);case"arraybuffer":default:return s instanceof ArrayBuffer?s:s.buffer}},di=String.fromCharCode(30),Ec=(s,t)=>{const r=s.length,n=new Array(r);let i=0;s.forEach((c,a)=>{Ln(c,!1,m=>{n[a]=m,++i===r&&t(n.join(di))})})},Mc=(s,t)=>{const r=s.split(di),n=[];for(let i=0;i<r.length;i++){const c=Pn(r[i],t);if(n.push(c),c.type==="error")break}return n};function Ac(){return new TransformStream({transform(s,t){Sc(s,r=>{const n=r.length;let i;if(n<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,n);else if(n<65536){i=new Uint8Array(3);const c=new DataView(i.buffer);c.setUint8(0,126),c.setUint16(1,n)}else{i=new Uint8Array(9);const c=new DataView(i.buffer);c.setUint8(0,127),c.setBigUint64(1,BigInt(n))}s.data&&typeof s.data!="string"&&(i[0]|=128),t.enqueue(i),t.enqueue(r)})}})}let sn;function pr(s){return s.reduce((t,r)=>t+r.length,0)}function xr(s,t){if(s[0].length===t)return s.shift();const r=new Uint8Array(t);let n=0;for(let i=0;i<t;i++)r[i]=s[0][n++],n===s[0].length&&(s.shift(),n=0);return s.length&&n<s[0].length&&(s[0]=s[0].slice(n)),r}function _c(s,t){sn||(sn=new TextDecoder);const r=[];let n=0,i=-1,c=!1;return new TransformStream({transform(a,m){for(r.push(a);;){if(n===0){if(pr(r)<1)break;const C=xr(r,1);c=(C[0]&128)===128,i=C[0]&127,i<126?n=3:i===126?n=1:n=2}else if(n===1){if(pr(r)<2)break;const C=xr(r,2);i=new DataView(C.buffer,C.byteOffset,C.length).getUint16(0),n=3}else if(n===2){if(pr(r)<8)break;const C=xr(r,8),b=new DataView(C.buffer,C.byteOffset,C.length),j=b.getUint32(0);if(j>Math.pow(2,53-32)-1){m.enqueue(pn);break}i=j*Math.pow(2,32)+b.getUint32(4),n=3}else{if(pr(r)<i)break;const C=xr(r,i);m.enqueue(Pn(c?C:sn.decode(C),t)),n=0}if(i===0||i>s){m.enqueue(pn);break}}}})}const ui=4;function nt(s){if(s)return Rc(s)}function Rc(s){for(var t in nt.prototype)s[t]=nt.prototype[t];return s}nt.prototype.on=nt.prototype.addEventListener=function(s,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+s]=this._callbacks["$"+s]||[]).push(t),this};nt.prototype.once=function(s,t){function r(){this.off(s,r),t.apply(this,arguments)}return r.fn=t,this.on(s,r),this};nt.prototype.off=nt.prototype.removeListener=nt.prototype.removeAllListeners=nt.prototype.removeEventListener=function(s,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks["$"+s];if(!r)return this;if(arguments.length==1)return delete this._callbacks["$"+s],this;for(var n,i=0;i<r.length;i++)if(n=r[i],n===t||n.fn===t){r.splice(i,1);break}return r.length===0&&delete this._callbacks["$"+s],this};nt.prototype.emit=function(s){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+s],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n)r[n].apply(this,t)}return this};nt.prototype.emitReserved=nt.prototype.emit;nt.prototype.listeners=function(s){return this._callbacks=this._callbacks||{},this._callbacks["$"+s]||[]};nt.prototype.hasListeners=function(s){return!!this.listeners(s).length};const zr=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,r)=>r(t,0))(),Dt=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),Uc="arraybuffer";function mi(s,...t){return t.reduce((r,n)=>(s.hasOwnProperty(n)&&(r[n]=s[n]),r),{})}const Lc=Dt.setTimeout,Pc=Dt.clearTimeout;function Br(s,t){t.useNativeTimers?(s.setTimeoutFn=Lc.bind(Dt),s.clearTimeoutFn=Pc.bind(Dt)):(s.setTimeoutFn=Dt.setTimeout.bind(Dt),s.clearTimeoutFn=Dt.clearTimeout.bind(Dt))}const Oc=1.33;function $c(s){return typeof s=="string"?Fc(s):Math.ceil((s.byteLength||s.size)*Oc)}function Fc(s){let t=0,r=0;for(let n=0,i=s.length;n<i;n++)t=s.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}function hi(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Dc(s){let t="";for(let r in s)s.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(s[r]));return t}function zc(s){let t={},r=s.split("&");for(let n=0,i=r.length;n<i;n++){let c=r[n].split("=");t[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}return t}class Bc extends Error{constructor(t,r,n){super(t),this.description=r,this.context=n,this.type="TransportError"}}class On extends nt{constructor(t){super(),this.writable=!1,Br(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,r,n){return super.emitReserved("error",new Bc(t,r,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const r=Pn(t,this.socket.binaryType);this.onPacket(r)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,r={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(r)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const r=Dc(t);return r.length?"?"+r:""}}class Gc extends On{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const r=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||r()})),this.writable||(n++,this.once("drain",function(){--n||r()}))}else r()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const r=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};Mc(t,this.socket.binaryType).forEach(r),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Ec(t,r=>{this.doWrite(r,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",r=this.query||{};return this.opts.timestampRequests!==!1&&(r[this.opts.timestampParam]=hi()),!this.supportsBinary&&!r.sid&&(r.b64=1),this.createUri(t,r)}}let gi=!1;try{gi=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const qc=gi;function Vc(){}class Hc extends Gc{constructor(t){if(super(t),typeof location<"u"){const r=location.protocol==="https:";let n=location.port;n||(n=r?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||n!==t.port}}doWrite(t,r){const n=this.request({method:"POST",data:t});n.on("success",r),n.on("error",(i,c)=>{this.onError("xhr post error",i,c)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(r,n)=>{this.onError("xhr poll error",r,n)}),this.pollXhr=t}}class Zt extends nt{constructor(t,r,n){super(),this.createRequest=t,Br(this,n),this._opts=n,this._method=n.method||"GET",this._uri=r,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var t;const r=mi(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(r);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&n.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var i;n.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},n.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=Zt.requestsCount++,Zt.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Vc,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Zt.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Zt.requestsCount=0;Zt.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",yo);else if(typeof addEventListener=="function"){const s="onpagehide"in Dt?"pagehide":"unload";addEventListener(s,yo,!1)}}function yo(){for(let s in Zt.requests)Zt.requests.hasOwnProperty(s)&&Zt.requests[s].abort()}const Wc=function(){const s=fi({xdomain:!1});return s&&s.responseType!==null}();class Yc extends Hc{constructor(t){super(t);const r=t&&t.forceBase64;this.supportsBinary=Wc&&!r}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new Zt(fi,this.uri(),t)}}function fi(s){const t=s.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||qc))return new XMLHttpRequest}catch{}if(!t)try{return new Dt[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const pi=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Jc extends On{get name(){return"websocket"}doOpen(){const t=this.uri(),r=this.opts.protocols,n=pi?{}:mi(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,r,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let r=0;r<t.length;r++){const n=t[r],i=r===t.length-1;Ln(n,this.supportsBinary,c=>{try{this.doWrite(n,c)}catch{}i&&zr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",r=this.query||{};return this.opts.timestampRequests&&(r[this.opts.timestampParam]=hi()),this.supportsBinary||(r.b64=1),this.createUri(t,r)}}const rn=Dt.WebSocket||Dt.MozWebSocket;class Kc extends Jc{createSocket(t,r,n){return pi?new rn(t,r,n):r?new rn(t,r):new rn(t)}doWrite(t,r){this.ws.send(r)}}class Xc extends On{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const r=_c(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=t.readable.pipeThrough(r).getReader(),i=Ac();i.readable.pipeTo(t.writable),this._writer=i.writable.getWriter();const c=()=>{n.read().then(({done:m,value:C})=>{m||(this.onPacket(C),c())}).catch(m=>{})};c();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let r=0;r<t.length;r++){const n=t[r],i=r===t.length-1;this._writer.write(n).then(()=>{i&&zr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const Zc={websocket:Kc,webtransport:Xc,polling:Yc},Qc=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ed=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function xn(s){if(s.length>8e3)throw"URI too long";const t=s,r=s.indexOf("["),n=s.indexOf("]");r!=-1&&n!=-1&&(s=s.substring(0,r)+s.substring(r,n).replace(/:/g,";")+s.substring(n,s.length));let i=Qc.exec(s||""),c={},a=14;for(;a--;)c[ed[a]]=i[a]||"";return r!=-1&&n!=-1&&(c.source=t,c.host=c.host.substring(1,c.host.length-1).replace(/;/g,":"),c.authority=c.authority.replace("[","").replace("]","").replace(/;/g,":"),c.ipv6uri=!0),c.pathNames=td(c,c.path),c.queryKey=sd(c,c.query),c}function td(s,t){const r=/\/{2,9}/g,n=t.replace(r,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&n.splice(0,1),t.slice(-1)=="/"&&n.splice(n.length-1,1),n}function sd(s,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,c){i&&(r[i]=c)}),r}const bn=typeof addEventListener=="function"&&typeof removeEventListener=="function",kr=[];bn&&addEventListener("offline",()=>{kr.forEach(s=>s())},!1);class hs extends nt{constructor(t,r){if(super(),this.binaryType=Uc,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(r=t,t=null),t){const n=xn(t);r.hostname=n.host,r.secure=n.protocol==="https"||n.protocol==="wss",r.port=n.port,n.query&&(r.query=n.query)}else r.host&&(r.hostname=xn(r.host).host);Br(this,r),this.secure=r.secure!=null?r.secure:typeof location<"u"&&location.protocol==="https:",r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},r.transports.forEach(n=>{const i=n.prototype.name;this.transports.push(i),this._transportsByName[i]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=zc(this.opts.query)),bn&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},kr.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const r=Object.assign({},this.opts.query);r.EIO=ui,r.transport=t,this.id&&(r.sid=this.id);const n=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&hs.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const r=this.createTransport(t);r.open(),this.setTransport(r)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",r=>this._onClose("transport close",r))}onOpen(){this.readyState="open",hs.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const r=new Error("server error");r.code=t.data,this._onError(r);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(r+=$c(i)),n>0&&r>this._maxPayload)return this.writeBuffer.slice(0,n);r+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,zr(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,r,n){return this._sendPacket("message",t,r,n),this}send(t,r,n){return this._sendPacket("message",t,r,n),this}_sendPacket(t,r,n,i){if(typeof r=="function"&&(i=r,r=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const c={type:t,data:r,options:n};this.emitReserved("packetCreate",c),this.writeBuffer.push(c),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),t()},n=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():t()}):this.upgrading?n():t()),this}_onError(t){if(hs.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,r){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),bn&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const n=kr.indexOf(this._offlineEventListener);n!==-1&&kr.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,r),this.writeBuffer=[],this._prevBufferLen=0}}}hs.protocol=ui;class rd extends hs{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let r=this.createTransport(t),n=!1;hs.priorWebsocketSuccess=!1;const i=()=>{n||(r.send([{type:"ping",data:"probe"}]),r.once("packet",T=>{if(!n)if(T.type==="pong"&&T.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;hs.priorWebsocketSuccess=r.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(j(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{const _=new Error("probe error");_.transport=r.name,this.emitReserved("upgradeError",_)}}))};function c(){n||(n=!0,j(),r.close(),r=null)}const a=T=>{const _=new Error("probe error: "+T);_.transport=r.name,c(),this.emitReserved("upgradeError",_)};function m(){a("transport closed")}function C(){a("socket closed")}function b(T){r&&T.name!==r.name&&c()}const j=()=>{r.removeListener("open",i),r.removeListener("error",a),r.removeListener("close",m),this.off("close",C),this.off("upgrading",b)};r.once("open",i),r.once("error",a),r.once("close",m),this.once("close",C),this.once("upgrading",b),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{n||r.open()},200):r.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const r=[];for(let n=0;n<t.length;n++)~this.transports.indexOf(t[n])&&r.push(t[n]);return r}}let nd=class extends rd{constructor(t,r={}){const n=typeof t=="object"?t:r;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(i=>Zc[i]).filter(i=>!!i)),super(t,n)}};function od(s,t="",r){let n=s;r=r||typeof location<"u"&&location,s==null&&(s=r.protocol+"//"+r.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s.charAt(1)==="/"?s=r.protocol+s:s=r.host+s),/^(https?|wss?):\/\//.test(s)||(typeof r<"u"?s=r.protocol+"//"+s:s="https://"+s),n=xn(s)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const c=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+c+":"+n.port+t,n.href=n.protocol+"://"+c+(r&&r.port===n.port?"":":"+n.port),n}const id=typeof ArrayBuffer=="function",ad=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s.buffer instanceof ArrayBuffer,xi=Object.prototype.toString,ld=typeof Blob=="function"||typeof Blob<"u"&&xi.call(Blob)==="[object BlobConstructor]",cd=typeof File=="function"||typeof File<"u"&&xi.call(File)==="[object FileConstructor]";function $n(s){return id&&(s instanceof ArrayBuffer||ad(s))||ld&&s instanceof Blob||cd&&s instanceof File}function Sr(s,t){if(!s||typeof s!="object")return!1;if(Array.isArray(s)){for(let r=0,n=s.length;r<n;r++)if(Sr(s[r]))return!0;return!1}if($n(s))return!0;if(s.toJSON&&typeof s.toJSON=="function"&&arguments.length===1)return Sr(s.toJSON(),!0);for(const r in s)if(Object.prototype.hasOwnProperty.call(s,r)&&Sr(s[r]))return!0;return!1}function dd(s){const t=[],r=s.data,n=s;return n.data=yn(r,t),n.attachments=t.length,{packet:n,buffers:t}}function yn(s,t){if(!s)return s;if($n(s)){const r={_placeholder:!0,num:t.length};return t.push(s),r}else if(Array.isArray(s)){const r=new Array(s.length);for(let n=0;n<s.length;n++)r[n]=yn(s[n],t);return r}else if(typeof s=="object"&&!(s instanceof Date)){const r={};for(const n in s)Object.prototype.hasOwnProperty.call(s,n)&&(r[n]=yn(s[n],t));return r}return s}function ud(s,t){return s.data=wn(s.data,t),delete s.attachments,s}function wn(s,t){if(!s)return s;if(s&&s._placeholder===!0){if(typeof s.num=="number"&&s.num>=0&&s.num<t.length)return t[s.num];throw new Error("illegal attachments")}else if(Array.isArray(s))for(let r=0;r<s.length;r++)s[r]=wn(s[r],t);else if(typeof s=="object")for(const r in s)Object.prototype.hasOwnProperty.call(s,r)&&(s[r]=wn(s[r],t));return s}const md=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],hd=5;var De;(function(s){s[s.CONNECT=0]="CONNECT",s[s.DISCONNECT=1]="DISCONNECT",s[s.EVENT=2]="EVENT",s[s.ACK=3]="ACK",s[s.CONNECT_ERROR=4]="CONNECT_ERROR",s[s.BINARY_EVENT=5]="BINARY_EVENT",s[s.BINARY_ACK=6]="BINARY_ACK"})(De||(De={}));class gd{constructor(t){this.replacer=t}encode(t){return(t.type===De.EVENT||t.type===De.ACK)&&Sr(t)?this.encodeAsBinary({type:t.type===De.EVENT?De.BINARY_EVENT:De.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let r=""+t.type;return(t.type===De.BINARY_EVENT||t.type===De.BINARY_ACK)&&(r+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(r+=t.nsp+","),t.id!=null&&(r+=t.id),t.data!=null&&(r+=JSON.stringify(t.data,this.replacer)),r}encodeAsBinary(t){const r=dd(t),n=this.encodeAsString(r.packet),i=r.buffers;return i.unshift(n),i}}function wo(s){return Object.prototype.toString.call(s)==="[object Object]"}class Fn extends nt{constructor(t){super(),this.reviver=t}add(t){let r;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");r=this.decodeString(t);const n=r.type===De.BINARY_EVENT;n||r.type===De.BINARY_ACK?(r.type=n?De.EVENT:De.ACK,this.reconstructor=new fd(r),r.attachments===0&&super.emitReserved("decoded",r)):super.emitReserved("decoded",r)}else if($n(t)||t.base64)if(this.reconstructor)r=this.reconstructor.takeBinaryData(t),r&&(this.reconstructor=null,super.emitReserved("decoded",r));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let r=0;const n={type:Number(t.charAt(0))};if(De[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===De.BINARY_EVENT||n.type===De.BINARY_ACK){const c=r+1;for(;t.charAt(++r)!=="-"&&r!=t.length;);const a=t.substring(c,r);if(a!=Number(a)||t.charAt(r)!=="-")throw new Error("Illegal attachments");n.attachments=Number(a)}if(t.charAt(r+1)==="/"){const c=r+1;for(;++r&&!(t.charAt(r)===","||r===t.length););n.nsp=t.substring(c,r)}else n.nsp="/";const i=t.charAt(r+1);if(i!==""&&Number(i)==i){const c=r+1;for(;++r;){const a=t.charAt(r);if(a==null||Number(a)!=a){--r;break}if(r===t.length)break}n.id=Number(t.substring(c,r+1))}if(t.charAt(++r)){const c=this.tryParse(t.substr(r));if(Fn.isPayloadValid(n.type,c))n.data=c;else throw new Error("invalid payload")}return n}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,r){switch(t){case De.CONNECT:return wo(r);case De.DISCONNECT:return r===void 0;case De.CONNECT_ERROR:return typeof r=="string"||wo(r);case De.EVENT:case De.BINARY_EVENT:return Array.isArray(r)&&(typeof r[0]=="number"||typeof r[0]=="string"&&md.indexOf(r[0])===-1);case De.ACK:case De.BINARY_ACK:return Array.isArray(r)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class fd{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const r=ud(this.reconPack,this.buffers);return this.finishedReconstruction(),r}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const pd=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Fn,Encoder:gd,get PacketType(){return De},protocol:hd},Symbol.toStringTag,{value:"Module"}));function Bt(s,t,r){return s.on(t,r),function(){s.off(t,r)}}const xd=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class bi extends nt{constructor(t,r,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=r,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Bt(t,"open",this.onopen.bind(this)),Bt(t,"packet",this.onpacket.bind(this)),Bt(t,"error",this.onerror.bind(this)),Bt(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...r){var n,i,c;if(xd.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(r.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(r),this;const a={type:De.EVENT,data:r};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof r[r.length-1]=="function"){const j=this.ids++,T=r.pop();this._registerAckCallback(j,T),a.id=j}const m=(i=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||i===void 0?void 0:i.writable,C=this.connected&&!(!((c=this.io.engine)===null||c===void 0)&&c._hasPingExpired());return this.flags.volatile&&!m||(C?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(t,r){var n;const i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[t]=r;return}const c=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let m=0;m<this.sendBuffer.length;m++)this.sendBuffer[m].id===t&&this.sendBuffer.splice(m,1);r.call(this,new Error("operation has timed out"))},i),a=(...m)=>{this.io.clearTimeoutFn(c),r.apply(this,m)};a.withError=!0,this.acks[t]=a}emitWithAck(t,...r){return new Promise((n,i)=>{const c=(a,m)=>a?i(a):n(m);c.withError=!0,r.push(c),this.emit(t,...r)})}_addToQueue(t){let r;typeof t[t.length-1]=="function"&&(r=t.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...c)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),r&&r(i)):(this._queue.shift(),r&&r(null,...c)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const r=this._queue[0];r.pending&&!t||(r.pending=!0,r.tryCount++,this.flags=r.flags,this.emit.apply(this,r.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:De.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,r){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,r),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(n=>String(n.id)===t)){const n=this.acks[t];delete this.acks[t],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case De.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case De.EVENT:case De.BINARY_EVENT:this.onevent(t);break;case De.ACK:case De.BINARY_ACK:this.onack(t);break;case De.DISCONNECT:this.ondisconnect();break;case De.CONNECT_ERROR:this.destroy();const n=new Error(t.data.message);n.data=t.data.data,this.emitReserved("connect_error",n);break}}onevent(t){const r=t.data||[];t.id!=null&&r.push(this.ack(t.id)),this.connected?this.emitEvent(r):this.receiveBuffer.push(Object.freeze(r))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const r=this._anyListeners.slice();for(const n of r)n.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const r=this;let n=!1;return function(...i){n||(n=!0,r.packet({type:De.ACK,id:t,data:i}))}}onack(t){const r=this.acks[t.id];typeof r=="function"&&(delete this.acks[t.id],r.withError&&t.data.unshift(null),r.apply(this,t.data))}onconnect(t,r){this.id=t,this.recovered=r&&this._pid===r,this._pid=r,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:De.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const r=this._anyListeners;for(let n=0;n<r.length;n++)if(t===r[n])return r.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const r=this._anyOutgoingListeners;for(let n=0;n<r.length;n++)if(t===r[n])return r.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const r=this._anyOutgoingListeners.slice();for(const n of r)n.apply(this,t.data)}}}function zs(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}zs.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*s);s=Math.floor(t*10)&1?s+r:s-r}return Math.min(s,this.max)|0};zs.prototype.reset=function(){this.attempts=0};zs.prototype.setMin=function(s){this.ms=s};zs.prototype.setMax=function(s){this.max=s};zs.prototype.setJitter=function(s){this.jitter=s};class vn extends nt{constructor(t,r){var n;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(r=t,t=void 0),r=r||{},r.path=r.path||"/socket.io",this.opts=r,Br(this,r),this.reconnection(r.reconnection!==!1),this.reconnectionAttempts(r.reconnectionAttempts||1/0),this.reconnectionDelay(r.reconnectionDelay||1e3),this.reconnectionDelayMax(r.reconnectionDelayMax||5e3),this.randomizationFactor((n=r.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new zs({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(r.timeout==null?2e4:r.timeout),this._readyState="closed",this.uri=t;const i=r.parser||pd;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=r.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var r;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(r=this.backoff)===null||r===void 0||r.setMin(t),this)}randomizationFactor(t){var r;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(r=this.backoff)===null||r===void 0||r.setJitter(t),this)}reconnectionDelayMax(t){var r;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(r=this.backoff)===null||r===void 0||r.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new nd(this.uri,this.opts);const r=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=Bt(r,"open",function(){n.onopen(),t&&t()}),c=m=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",m),t?t(m):this.maybeReconnectOnOpen()},a=Bt(r,"error",c);if(this._timeout!==!1){const m=this._timeout,C=this.setTimeoutFn(()=>{i(),c(new Error("timeout")),r.close()},m);this.opts.autoUnref&&C.unref(),this.subs.push(()=>{this.clearTimeoutFn(C)})}return this.subs.push(i),this.subs.push(a),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(Bt(t,"ping",this.onping.bind(this)),Bt(t,"data",this.ondata.bind(this)),Bt(t,"error",this.onerror.bind(this)),Bt(t,"close",this.onclose.bind(this)),Bt(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(r){this.onclose("parse error",r)}}ondecoded(t){zr(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,r){let n=this.nsps[t];return n?this._autoConnect&&!n.active&&n.connect():(n=new bi(this,t,r),this.nsps[t]=n),n}_destroy(t){const r=Object.keys(this.nsps);for(const n of r)if(this.nsps[n].active)return;this._close()}_packet(t){const r=this.encoder.encode(t);for(let n=0;n<r.length;n++)this.engine.write(r[n],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,r){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,r),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const r=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},r);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Zs={};function sr(s,t){typeof s=="object"&&(t=s,s=void 0),t=t||{};const r=od(s,t.path||"/socket.io"),n=r.source,i=r.id,c=r.path,a=Zs[i]&&c in Zs[i].nsps,m=t.forceNew||t["force new connection"]||t.multiplex===!1||a;let C;return m?C=new vn(n,t):(Zs[i]||(Zs[i]=new vn(n,t)),C=Zs[i]),r.query&&!t.query&&(t.query=r.queryKey),C.socket(r.path,t)}Object.assign(sr,{Manager:vn,Socket:bi,io:sr,connect:sr});const yi=u.createContext(),Bs=()=>{const s=u.useContext(yi);if(!s)throw new Error("useSocket must be used within a SocketProvider");return s},bd=({children:s,user:t})=>{const[r,n]=u.useState(null),[i,c]=u.useState(!1),[a,m]=u.useState([]),[C,b]=u.useState(0),[j,T]=u.useState(Date.now()),[_,z]=u.useState([]),R=async S=>{try{if(console.log(" Starting push notification initialization..."),typeof Notification<"u"&&Notification.permission==="denied"){console.warn(" Notification permission is denied. Skipping push notification setup."),U("Enable notifications in browser settings to receive alerts when offline",{icon:"",duration:5e3});return}if(console.log(" Attempting FCM registration..."),(await fn(S)).success){console.log(" Push notifications initialized (FCM)"),U.success(" Notifications enabled! You'll get alerts when offline",{duration:3e3});return}console.log(" FCM failed, trying Web Push...");const H=await gn(S);H.success?(console.log(" Push notifications initialized (Web Push)"),U.success(" Notifications enabled! You'll get alerts when offline",{duration:3e3})):(console.warn(" Push notifications not initialized:",H.error),H.error.includes("permission")&&U("Enable notifications in browser settings to receive alerts when offline",{icon:"",duration:5e3}))}catch(E){console.error(" Push notification initialization error:",E)}},F=S=>{if(t&&(t.role==="admin"||t.role==="superadmin")){const H=` DISABLED USER LOGIN ATTEMPT

${S.userName} (${S.userEmail}) is trying to access the system`;U.error(H,{duration:8e3,position:"top-center",style:{background:"#fef2f2",color:"#dc2626",border:"2px solid #ef4444",fontSize:"14px",fontWeight:"bold",padding:"16px",borderRadius:"8px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",whiteSpace:"pre-line"},icon:"",className:"toast-admin-alert"});const ee=Date.now()+Math.random();z(V=>[...V,{...S,id:ee}])}},f=async S=>{try{const{usersAPI:E}=await kc(()=>Promise.resolve().then(()=>cc),void 0);await E.toggleUserStatus(S);const H=_.find(ee=>ee.userId===S);z(ee=>ee.filter(V=>V.userId!==S)),H&&U.success(` User ${H.userName} has been activated successfully!`,{duration:4e3,position:"top-right"})}catch(E){console.error("Error activating user:",E),U.error("Failed to activate user. Please try again.")}},O=S=>{z(E=>E.filter(H=>H.id!==S))},g={autoConnect:!0,transports:["websocket","polling"],upgrade:!0,rememberUpgrade:!0,timeout:2e4,forceNew:!0,reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:1e4,maxReconnectionAttempts:1/0};u.useEffect(()=>{if(t&&t.id){console.log(" Initializing socket connection for user:",t.name),console.log(" Socket URL:","https://internalchat.pizeonfly.com"),r&&(console.log(" Closing existing socket connection"),r.close(),n(null));const S=localStorage.getItem("token"),E=sr("https://internalchat.pizeonfly.com",{...g,auth:{token:S}});E.on("connect",()=>{b(0),T(Date.now()),c(!0),console.log(" Socket connected - ID:",E.id),console.log(" Connected as user:",t.name),console.log(" Connection URL:",E.io.uri),E.emit("join",t.id),console.log(` User ${t.id} joined personal room`),R(t.id),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",V=>{if(console.log(" Service worker message received:",V.data),V.data.type==="send-reply"){const{replyText:ue,receiver:je,sender:Te}=V.data.data;console.log(" Sending reply from notification:",ue),E.emit("send-message",{receiver:je,message:ue,messageType:"text",sender:Te,timestamp:new Date().toISOString()}),U.success(" Reply sent!",{duration:2e3,position:"top-right"})}}),Q(E),pe(E)}),E.on("disconnect",V=>{c(!1),console.log(" Socket disconnected - Reason:",V),console.log(" Disconnected user:",t.name),W(),ge(),L(E)}),E.on("connect_error",V=>{console.error(" Socket connection error:",V),c(!1),V.message&&V.message.includes("WebSocket")&&(console.log(" WebSocket connection failed, trying polling transport"),E.io.opts.transports=["polling"],setTimeout(()=>E.connect(),1e3)),L(E)}),E.on("reconnect",V=>{b(0),console.log(" Socket reconnected after",V,"attempts"),console.log(" New Socket ID:",E.id),c(!0),E.emit("join",t.id)}),E.on("reconnect_error",V=>{console.error(" Socket reconnection error:",V)}),E.on("reconnect_failed",()=>{console.error(" Socket reconnection failed"),c(!1)}),E.on("ping",V=>{T(Date.now()),console.log(" Ping received - Connection alive, timestamp:",new Date(Date.now()).toLocaleTimeString())}),E.on("pong",V=>{T(Date.now()),console.log(" Pong received - Connection confirmed, timestamp:",new Date(Date.now()).toLocaleTimeString())}),E.on("connect_timeout",()=>{console.log(" Socket connection timed out")}),E.on("reconnect_error",V=>{console.error(" Reconnection error:",V.message)}),E.on("reconnect_failed",()=>{console.error(" Reconnection failed permanently - forcing reconnect"),b(1/0)}),E.on("force-logout",V=>{console.log(" Force logout received:",V),localStorage.removeItem("token"),window.location.href="/login"}),E.on("admin_notification",V=>{F(V)}),E.on("user-online",V=>{var ue;console.log(" User came online:",(ue=V.user)==null?void 0:ue.name),m(je=>je.find($e=>$e.userId===V.userId)?je.map($e=>$e.userId===V.userId?{...$e,isOnline:!0,lastSeen:new Date}:$e):[...je,{...V,isOnline:!0,lastSeen:new Date}])}),E.on("user-offline",V=>{var ue;console.log(" User went offline:",(ue=V.user)==null?void 0:ue.name),m(je=>je.find($e=>$e.userId===V.userId)?je.map($e=>$e.userId===V.userId?{...$e,isOnline:!1,lastSeen:new Date}:$e):je)}),E.on("online-users",V=>{console.log(" Initial online users:",V.map(ue=>{var je;return((je=ue.user)==null?void 0:je.name)||ue.name})),m(V.map(ue=>({...ue,isOnline:!0,lastSeen:new Date})))}),n(E);const H=()=>{document.hidden?(console.log(" User left tab - marking as away"),E&&E.connected&&E.emit("user-away",{userId:t.id})):(console.log(" User returned to tab - marking as active"),E&&E.connected&&E.emit("user-active",{userId:t.id}))},ee=()=>{console.log(" User closing tab/window - disconnecting immediately"),E&&E.connected&&(E.emit("force-disconnect",{userId:t.id}),E.disconnect())};return document.addEventListener("visibilitychange",H),window.addEventListener("beforeunload",ee),()=>{console.log(" Cleaning up socket connection"),document.removeEventListener("visibilitychange",H),window.removeEventListener("beforeunload",ee),W(),ge(),E&&E.connected&&E.emit("force-disconnect",{userId:t.id}),E.close(),n(null),c(!1),m([])}}else r&&(console.log(" Disconnecting socket - no user"),r.close(),n(null),c(!1),m([]))},[t==null?void 0:t.id]);const L=S=>{if(console.log(" Starting reconnection logic"),C<5){const E=1e3*Math.pow(2,C);console.log(` Reconnecting in ${E}ms...`),setTimeout(()=>{b(H=>H+1),S.connect()},E)}else console.log(" Max reconnections reached, manual reconnection forced"),S.connect()};let J,q;const Q=S=>{J&&clearInterval(J),J=setInterval(()=>{const E=Date.now()-j;console.log(`Time since last ping: ${E}ms`),S&&i&&E>45e3&&(console.log(" Proactive ping sent to prevent timeout"),S.emit("ping",{timestamp:Date.now()}),T(Date.now())),E>18e4?(console.log(" Extended timeout reached - checking connection"),S&&S.connected&&i?(console.log(" Connection verified, resetting last ping"),T(Date.now())):(console.log(" Disconnection confirmed, reconnecting..."),S.connect())):console.log(` Socket maintained: ${E}ms since last ping`)},25e3)},W=()=>{J&&(clearInterval(J),J=null)},pe=S=>{q&&clearInterval(q),q=setInterval(()=>{S&&S.connected&&S.emit("client-heartbeat",{t:Date.now()})},2e3)},ge=()=>{q&&(clearInterval(q),q=null)},Z={socket:r,isConnected:i,onlineUsers:a,notifications:_,sendMessage:(S,E,H="text",ee=!1,V=null)=>{if(console.log(" sendMessage called with:",{receiverId:S,content:E,messageType:H,isGroupChat:ee,attachment:V,socketStatus:{socket:!!r,isConnected:i,socketId:r==null?void 0:r.id}}),r&&i){console.log(" Emitting send-message event...");let ue;return ee?(ue={sender:t.id,groupId:S,message:E,messageType:H,timestamp:new Date().toISOString()},r.emit("send-group-message",ue)):(ue={sender:t.id,receiver:S,message:E,messageType:H,timestamp:new Date().toISOString()},r.emit("send-message",ue)),console.log(" Message sent successfully:",ue),!0}else throw console.error(" Cannot send message: Socket not connected"),new Error("Socket not connected. Please check your connection.")},markMessageRead:(S,E)=>{r&&i&&(r.emit("mark-message-read",{messageId:S,senderId:E}),console.log(" Message read marked for:",{messageId:S,senderId:E}))},startTyping:S=>{r&&i&&r.emit("typing",{sender:t.id,receiver:S,isTyping:!0})},stopTyping:S=>{r&&i&&r.emit("typing",{sender:t.id,receiver:S,isTyping:!1})},isUserOnline:S=>{const E=a.find(H=>H.userId===S);return E?E.isOnline:!1},getUserStatus:S=>{const E=a.find(H=>H.userId===S);return E?{isOnline:E.isOnline,lastSeen:E.lastSeen}:{isOnline:!1,lastSeen:null}},joinGroup:S=>{r&&i&&(r.emit("join-group",S),console.log(" Joined group room:",S))},leaveGroup:S=>{r&&i&&(r.emit("leave-group",S),console.log(" Left group room:",S))},onReceiveMessage:S=>{r&&(r.off("receive-message"),r.on("receive-message",E=>{console.log(" Received message:",E),S(E)}))},onReceiveGroupMessage:S=>{r&&(r.off("receive-group-message"),r.on("receive-group-message",E=>{console.log(" Received group message:",E),S(E)}))},onMessageSent:S=>{r&&(r.off("message-sent"),r.on("message-sent",E=>{console.log(" Message sent confirmation:",E),S(E)}))},onProfileUpdated:S=>{r&&(r.off("avatar-updated"),r.on("avatar-updated",E=>{console.log(" Profile updated:",E),S(E)}))},handleActivateUser:f,handleCloseNotification:O,getConnectionStatus:()=>({isConnected:i,reconnectAttempts:C,lastPing:new Date(j).toLocaleString(),socketId:r==null?void 0:r.id})};return e.jsx(yi.Provider,{value:Z,children:s})};var yd={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const wd=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ve=(s,t)=>{const r=u.forwardRef(({color:n="currentColor",size:i=24,strokeWidth:c=2,absoluteStrokeWidth:a,children:m,...C},b)=>u.createElement("svg",{ref:b,...yd,width:i,height:i,stroke:n,strokeWidth:a?Number(c)*24/Number(i):c,className:`lucide lucide-${wd(s)}`,...C},[...t.map(([j,T])=>u.createElement(j,T)),...(Array.isArray(m)?m:[m])||[]]));return r.displayName=`${s}`,r},es=ve("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),nn=ve("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),vd=ve("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),$t=ve("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),jd=ve("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),rr=ve("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),jn=ve("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),_s=ve("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Os=ve("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),$s=ve("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Nn=ve("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),gs=ve("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Rs=ve("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Ar=ve("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),vt=ve("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),kn=ve("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Sn=ve("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ms=ve("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]),Us=ve("Forward",[["polyline",{points:"15 17 20 12 15 7",key:"1w3sku"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]),Dn=ve("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),Ot=ve("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Nd=ve("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),kd=ve("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),Gr=ve("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),wi=ve("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),vi=ve("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Sd=ve("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),os=ve("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),fs=ve("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),Cd=ve("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),Cn=ve("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),Id=ve("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]),ji=ve("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),At=ve("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),vo=ve("PhoneCall",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]]),Td=ve("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]),or=ve("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),ir=ve("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Ed=ve("Power",[["path",{d:"M18.36 6.64a9 9 0 1 1-12.73 0",key:"phirl6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"12",key:"aemgbe"}]]),zn=ve("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Ni=ve("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Gs=ve("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),qr=ve("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Bn=ve("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ar=ve("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),ki=ve("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]),Si=ve("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),Ss=ve("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Ci=ve("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Ls=ve("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Gn=ve("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),_t=ve("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),lt=ve("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),ht=ve("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),Md=ve("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Ct=ve("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ii=ve("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Ti=ve("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Ad=()=>{const[s,t]=u.useState({name:"",email:"",password:"",confirmPassword:""}),[r,n]=u.useState("user"),[i,c]=u.useState(!1),[a,m]=u.useState(!1),[C,b]=u.useState(!1),[j,T]=u.useState(!0),[_,z]=u.useState(!1),[R,F]=u.useState(!1),{login:f,registerSuperAdmin:O}=It();u.useEffect(()=>{(async()=>{try{const W=await tr.checkSuperAdmin();b(W.data.exists)}catch(W){console.error("Error checking super admin:",W)}finally{T(!1)}})()},[]);const g=[{value:"user",label:"User",icon:_t,description:"Chat with other users"},{value:"admin",label:"Admin",icon:ar,description:"Manage users and groups"},{value:"superadmin",label:"Super Admin",icon:Ar,description:"Full system access"}],L=Q=>{t({...s,[Q.target.name]:Q.target.value})},J=async Q=>{Q.preventDefault(),m(!0);try{if(i&&r==="superadmin"){if(s.password!==s.confirmPassword){U.error("Passwords do not match");return}const W=await O(s.name,s.email,s.password);W.success?U.success("Super Admin registered successfully!"):U.error(W.error)}else{const W=await f(s.email,s.password);W.success?U.success("Login successful!"):W.disabled?U.error("Your account has been disabled by administrator"):U.error(W.error)}}catch{U.error("An error occurred. Please try again.")}finally{m(!1)}},q=()=>{if(!i&&C){U.error("Super admin already exists. Please login instead.");return}c(!i),t({name:"",email:"",password:"",confirmPassword:""})};return j?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-primary-100 flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-md w-full space-y-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"mt-6 text-3xl font-bold text-gray-900",children:"Internal Chat App"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Checking system status..."}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx("div",{className:"w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"})})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-primary-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"mt-6 text-3xl font-bold text-gray-900",children:"Internal Chat App"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:i?"Register as Super Admin":"Sign in to your account"})]}),e.jsxs("div",{className:"card p-8",children:[!i&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Role"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:g.map(Q=>{const W=Q.icon;return e.jsx("button",{type:"button",onClick:()=>n(Q.value),className:`p-3 rounded-lg border-2 transition-all ${r===Q.value?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(W,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:Q.label}),e.jsx("div",{className:"text-sm text-gray-500",children:Q.description})]})]})},Q.value)})})]}),e.jsxs("form",{onSubmit:J,className:"space-y-6",children:[i&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Full Name"}),e.jsx("input",{id:"name",name:"name",type:"text",required:!0,value:s.name,onChange:L,className:"input-field mt-1",placeholder:"Enter your full name"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,value:s.email,onChange:L,className:"input-field mt-1",placeholder:"Enter your email"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{id:"password",name:"password",type:_?"text":"password",required:!0,value:s.password,onChange:L,className:"input-field pr-10",placeholder:"Enter your password"}),e.jsx("button",{type:"button","aria-label":_?"Hide password":"Show password",onClick:()=>z(!_),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600",children:_?e.jsx(kn,{className:"w-5 h-5"}):e.jsx(Sn,{className:"w-5 h-5"})})]})]}),i&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:R?"text":"password",required:!0,value:s.confirmPassword,onChange:L,className:"input-field pr-10",placeholder:"Confirm your password"}),e.jsx("button",{type:"button","aria-label":R?"Hide password":"Show password",onClick:()=>F(!R),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600",children:R?e.jsx(kn,{className:"w-5 h-5"}):e.jsx(Sn,{className:"w-5 h-5"})})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:a,className:"w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:a?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),i?"Registering...":"Signing in..."]}):i?"Register Super Admin":"Sign In"})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:q,disabled:j,className:"text-sm text-primary-600 hover:text-primary-500 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Checking system status...":i?"Already have an account? Sign in":C?"Super admin already exists. Please login instead.":"Need to register Super Admin? Click here"})})]})]})]})})},qn=({user:s,callData:t,isIncoming:r=!1,onCallEnd:n,onCallAnswer:i,onCallDecline:c})=>{var S,E,H,ee,V,ue,je,Te,$e,ct,Ze,st,ft,ze,it;const{socket:a}=Bs(),[m,C]=u.useState(r?"incoming":"outgoing"),[b,j]=u.useState(!1),[T,_]=u.useState(0),[z,R]=u.useState(null),[F,f]=u.useState({x:window.innerWidth-350,y:20}),[O,g]=u.useState(!1),[L,J]=u.useState({x:0,y:0}),q=u.useRef(null),Q=u.useRef(null),W=u.useRef(null),pe=u.useRef(null),ge=u.useRef(null),te=(()=>{var Qe,Xe,Fe,Ie,We,Ye;const de=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}],Ce=(Xe=(Qe=import.meta)==null?void 0:Qe.env)==null?void 0:Xe.VITE_TURN_URL,Ge=(Ie=(Fe=import.meta)==null?void 0:Fe.env)==null?void 0:Ie.VITE_TURN_USERNAME,qe=(Ye=(We=import.meta)==null?void 0:We.env)==null?void 0:Ye.VITE_TURN_CREDENTIAL;return Ce&&Ge&&qe&&de.push({urls:Ce,username:Ge,credential:qe}),{iceServers:de}})(),le=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return console.error("WebRTC not supported in this browser or requires HTTPS"),R("Audio calls require HTTPS connection or are not supported in this browser. Please use HTTPS or try a different browser."),!1;if(typeof RTCPeerConnection>"u")return console.error("RTCPeerConnection not supported"),R("WebRTC is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari."),!1;W.current=new RTCPeerConnection(te),W.current.onicecandidate=Ce=>{if(Ce.candidate&&a)try{a.emit("ice-candidate",{callId:t.callId,candidate:Ce.candidate.candidate,sdpMLineIndex:Ce.candidate.sdpMLineIndex,sdpMid:Ce.candidate.sdpMid})}catch(Ge){console.error("Error sending ICE candidate:",Ge)}},W.current.ontrack=Ce=>{if(console.log(" Remote audio track received:",Ce),console.log(" Track details:",{kind:Ce.track.kind,label:Ce.track.label,enabled:Ce.track.enabled,readyState:Ce.track.readyState,streamsCount:Ce.streams.length}),Ce.streams&&Ce.streams[0]){const Ge=Ce.streams[0];console.log(" Setting remote audio stream:",Ge),console.log(" Stream tracks:",Ge.getTracks()),Q.current&&(Q.current.srcObject=Ge,Ge.getAudioTracks().forEach(qe=>{qe.enabled=m==="connected",console.log(" Remote audio track enabled:",qe.enabled,"callStatus:",m)}),Q.current.volume!==void 0&&(Q.current.volume=1),m==="connected"?(Q.current.muted=!1,Q.current.play().catch(qe=>{qe.name!=="AbortError"&&console.error(" Error playing remote audio:",qe)}),console.log(" Remote audio playing after call connected")):(Q.current.muted=!0,console.log(" Remote audio muted until call is accepted")))}},W.current.onconnectionstatechange=()=>{const Ce=W.current.connectionState;Ce==="connected"?(C("connected"),M()):(Ce==="disconnected"||Ce==="failed")&&A()};const de=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});return pe.current=de,q.current&&(q.current.srcObject=de),de.getAudioTracks().forEach(Ce=>{W.current.addTrack(Ce,de)}),!0}catch(de){return console.error("Error initializing WebRTC:",de),de.name==="NotAllowedError"||de.name==="PermissionDeniedError"?R("Microphone access denied. Please allow microphone permissions in your browser settings."):de.name==="NotFoundError"||de.name==="DevicesNotFoundError"?R("No microphone found. Please connect a microphone and try again."):de.name==="NotReadableError"||de.name==="TrackStartError"?R("Microphone is being used by another application. Please close other apps and try again."):de.name==="OverconstrainedError"?R("Could not access microphone with the required settings."):de.name==="SecurityError"?R("Audio calls require HTTPS connection. Please access the site via HTTPS."):R(`Failed to access microphone: ${de.message||"Unknown error"}`),!1}},M=()=>{ge.current=setInterval(()=>{_(de=>de+1)},1e3)},ne=()=>{ge.current&&(clearInterval(ge.current),ge.current=null)},I=de=>{const Ce=Math.floor(de/60),Ge=de%60;return`${Ce.toString().padStart(2,"0")}:${Ge.toString().padStart(2,"0")}`},G=de=>{g(!0);const Ce=de.currentTarget.getBoundingClientRect();J({x:de.clientX-Ce.left,y:de.clientY-Ce.top})},K=de=>{if(!O)return;const Ce=de.clientX-L.x,Ge=de.clientY-L.y,qe=window.innerWidth-320,Qe=window.innerHeight-200;f({x:Math.max(0,Math.min(Ce,qe)),y:Math.max(0,Math.min(Ge,Qe))})},Y=()=>{g(!1)};u.useEffect(()=>{if(O)return document.addEventListener("mousemove",K),document.addEventListener("mouseup",Y),()=>{document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",Y)}},[O,L]);const k=async()=>{await le()&&(C("connecting"),i&&i(),a&&a.emit("call-answer",{callId:t.callId}))},w=()=>{C("declined"),c&&c(),a&&a.emit("call-decline",{callId:t.callId})},A=()=>{ne(),W.current&&(W.current.close(),W.current=null),pe.current&&(pe.current.getTracks().forEach(de=>de.stop()),pe.current=null),C("ended"),n&&n(),a&&a.emit("call-end",{callId:t.callId})},Z=()=>{if(pe.current){const de=pe.current.getAudioTracks()[0];de&&(de.enabled=!de.enabled,j(!de.enabled))}};return u.useEffect(()=>{if(!a)return;const de=async Fe=>{if(Fe.callId===t.callId){C("connecting");try{const Ie=await W.current.createOffer();await W.current.setLocalDescription(Ie),a.emit("call-offer",{callId:t.callId,offer:Ie})}catch{R("Failed to establish connection")}}},Ce=async Fe=>{if(Fe.callId===t.callId)try{const Ie=W.current.signalingState;if(console.log(" Processing offer, current state:",Ie),Ie==="stable"){await W.current.setRemoteDescription(Fe.offer);const We=await W.current.createAnswer();await W.current.setLocalDescription(We),a.emit("call-answer-webrtc",{callId:t.callId,answer:We})}else console.warn(" Cannot process offer in state:",Ie),R("Call connection not ready")}catch(Ie){console.error(" Failed to handle call offer:",Ie),R("Failed to establish connection")}},Ge=async Fe=>{if(Fe.callId===t.callId)try{const Ie=W.current.signalingState;console.log(" Processing answer, current state:",Ie),Ie==="have-local-offer"||Ie==="have-local-pranswer"?(await W.current.setRemoteDescription(Fe.answer),console.log(" Answer processed successfully")):Ie==="stable"?console.log(" Connection already established, skipping answer"):(console.warn(" Cannot process answer in state:",Ie),R("Call connection not ready"))}catch(Ie){console.error(" Failed to handle call answer:",Ie),R("Failed to establish connection")}},qe=async Fe=>{if(Fe.callId===t.callId&&W.current)try{const Ie=new RTCIceCandidate({candidate:Fe.candidate,sdpMLineIndex:Fe.sdpMLineIndex,sdpMid:Fe.sdpMid});await W.current.addIceCandidate(Ie)}catch{}},Qe=Fe=>{Fe.callId===t.callId&&(C("declined"),A())},Xe=Fe=>{Fe.callId===t.callId&&A()};return a.on("call-answered",de),a.on("call-offer",Ce),a.on("call-answer-webrtc",Ge),a.on("ice-candidate",qe),a.on("call-declined",Qe),a.on("call-ended",Xe),()=>{a.off("call-answered",de),a.off("call-offer",Ce),a.off("call-answer-webrtc",Ge),a.off("ice-candidate",qe),a.off("call-declined",Qe),a.off("call-ended",Xe)}},[a,t.callId]),u.useEffect(()=>{!r&&m==="outgoing"&&le()},[r,m]),u.useEffect(()=>{m==="connected"&&Q.current&&(Q.current.muted=!1,Q.current.volume=1,Q.current.play().catch(de=>{de.name!=="AbortError"&&console.error(" Error playing remote audio after call connected:",de)}),console.log(" Remote audio unmuted after call connected"))},[m]),u.useEffect(()=>()=>{ne(),W.current&&W.current.close(),pe.current&&pe.current.getTracks().forEach(de=>de.stop())},[]),r&&m==="incoming"?e.jsx("div",{className:"fixed z-50",style:{left:F.x,top:F.y},children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl p-6 w-80 text-center shadow-2xl border border-gray-700 relative",children:[e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("button",{onMouseDown:G,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})})}),e.jsx("div",{className:"mb-4",children:(S=t==null?void 0:t.caller)!=null&&S.avatar?e.jsx("img",{src:t.caller.avatar,alt:t.caller.name,className:"w-16 h-16 rounded-full mx-auto object-cover border-2 border-white"}):e.jsx("div",{className:"w-16 h-16 rounded-full mx-auto bg-green-500 text-white flex items-center justify-center text-lg font-bold border-2 border-white",children:((H=(E=t==null?void 0:t.caller)==null?void 0:E.name)==null?void 0:H.charAt(0))||"U"})}),e.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:((ee=t==null?void 0:t.caller)==null?void 0:ee.name)||"Unknown"}),e.jsx("p",{className:"text-gray-300 mb-6 text-sm",children:" Incoming voice call..."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:w,className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{onClick:k,className:"w-12 h-12 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})})]})]})}):z?e.jsx("div",{className:"fixed z-50",style:{left:F.x,top:F.y},children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl p-6 w-80 text-center shadow-2xl border border-gray-700 relative",children:[e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("button",{onMouseDown:G,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})})}),e.jsx("div",{className:"text-4xl mb-3",children:""}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Call Error"}),e.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:z}),e.jsx("button",{onClick:A,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:"Close"})]})}):e.jsx("div",{className:"fixed z-50",style:{left:F.x,top:F.y},children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 p-6 w-80 text-center text-white relative",children:[e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("button",{onMouseDown:G,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})})}),e.jsx("audio",{ref:q,muted:!0,autoPlay:!0}),e.jsx("audio",{ref:Q,autoPlay:!0}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-sm text-gray-300 mb-2",children:m==="connecting"?"Connecting...":m==="connected"?"Voice Call":m==="outgoing"?"Calling...":"Call"}),e.jsx("h1",{className:"text-lg font-semibold",children:((V=t==null?void 0:t.otherUser)==null?void 0:V.name)||((ue=t==null?void 0:t.caller)==null?void 0:ue.name)||"Unknown"}),m==="connected"&&e.jsx("p",{className:"text-gray-300 mt-1 text-sm",children:I(T)})]}),e.jsx("div",{className:"mb-6",children:(je=t==null?void 0:t.otherUser)!=null&&je.avatar||(Te=t==null?void 0:t.caller)!=null&&Te.avatar?e.jsx("img",{src:(($e=t==null?void 0:t.otherUser)==null?void 0:$e.avatar)||((ct=t==null?void 0:t.caller)==null?void 0:ct.avatar),alt:((Ze=t==null?void 0:t.otherUser)==null?void 0:Ze.name)||((st=t==null?void 0:t.caller)==null?void 0:st.name),className:"w-20 h-20 rounded-full object-cover shadow-2xl border-2 border-white mx-auto"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-green-500 flex items-center justify-center text-2xl font-bold shadow-2xl border-2 border-white mx-auto",children:((it=((ft=t==null?void 0:t.otherUser)==null?void 0:ft.name)||((ze=t==null?void 0:t.caller)==null?void 0:ze.name))==null?void 0:it.charAt(0))||"U"})}),e.jsxs("div",{className:"mb-4 text-center",children:[m==="outgoing"&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-gray-300 text-sm",children:"Calling..."})]}),m==="connecting"&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce"}),e.jsx("span",{className:"text-gray-300 text-sm",children:"Connecting..."})]}),m==="connected"&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-gray-300 text-sm",children:"Connected"})]})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[m==="connected"&&e.jsx("button",{onClick:Z,className:`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${b?"bg-red-500 hover:bg-red-600":"bg-white bg-opacity-20 hover:bg-opacity-30"}`,title:b?"Unmute":"Mute",children:b?e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),e.jsx("button",{onClick:A,className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",title:"End Call",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),m==="connected"&&e.jsxs("div",{className:"mt-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"w-1 h-2 bg-green-400 rounded"}),e.jsx("div",{className:"w-1 h-3 bg-green-400 rounded"}),e.jsx("div",{className:"w-1 h-4 bg-green-400 rounded"}),e.jsx("div",{className:"w-1 h-3 bg-green-400 rounded"}),e.jsx("div",{className:"w-1 h-2 bg-green-400 rounded"})]}),e.jsx("span",{className:"text-xs text-gray-300 mt-1 block",children:"Good quality"})]})]})})},Vn=({user:s,callData:t,isIncoming:r=!1,onCallEnd:n,onCallAnswer:i,onCallDecline:c})=>{var V,ue,je,Te,$e,ct,Ze,st,ft,ze,it,de,Ce,Ge,qe,Qe,Xe,Fe,Ie,We,Ye,pt;const{socket:a,isConnected:m}=Bs(),[C,b]=u.useState(r?"incoming":"outgoing"),[j,T]=u.useState(!1),[_,z]=u.useState((t==null?void 0:t.callType)==="video"),[R,F]=u.useState(0),[f,O]=u.useState(null),g=u.useRef(null),L=u.useRef(null),J=u.useRef(null),q=u.useRef(null),Q=u.useRef(null),W=u.useRef(null),pe=u.useRef(!1),ge=u.useRef(null),be=u.useRef(!1),te=u.useRef(!1),le=u.useRef([]),M=u.useRef(!1),I=(()=>{var re,Ee,Pe,dt,xt,Rt;const ae=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}],x=(Ee=(re=import.meta)==null?void 0:re.env)==null?void 0:Ee.VITE_TURN_URL,oe=(dt=(Pe=import.meta)==null?void 0:Pe.env)==null?void 0:dt.VITE_TURN_USERNAME,xe=(Rt=(xt=import.meta)==null?void 0:xt.env)==null?void 0:Rt.VITE_TURN_CREDENTIAL;return x&&oe&&xe&&ae.push({urls:x,username:oe,credential:xe}),{iceServers:ae}})();u.useEffect(()=>(console.log("WebRTCCall useEffect - callData:",t,"isIncoming:",r),t&&t.callId&&m&&!M.current&&G(),()=>{H()}),[t==null?void 0:t.callId,m]),u.useEffect(()=>(C==="connected"&&Q.current?W.current=setInterval(()=>{const ae=Math.floor((Date.now()-Q.current)/1e3);F(ae)},1e3):W.current&&(clearInterval(W.current),W.current=null),()=>{W.current&&clearInterval(W.current)}),[C]),u.useEffect(()=>{window.remoteStream&&L.current&&_&&(console.log(" Restoring remote video stream after remount"),L.current.srcObject=window.remoteStream,L.current.play().catch(ae=>{ae.name!=="AbortError"&&console.error(" Error playing restored remote video:",ae)}))},[_,L.current]),u.useEffect(()=>{window.remoteStream&&L.current&&!L.current.srcObject&&(console.log(" Video ref available, attaching stored remote stream"),L.current.srcObject=window.remoteStream,L.current.play().catch(ae=>{ae.name!=="AbortError"&&console.error(" Error playing stored remote video:",ae)}))},[L.current]);const G=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){console.error("WebRTC not supported in this browser or requires HTTPS"),O("Video calls require HTTPS connection or are not supported in this browser. Please use HTTPS or try a different browser.");return}if(typeof RTCPeerConnection>"u"){console.error("RTCPeerConnection not supported"),O("WebRTC is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");return}pe.current=!1,ge.current=null,be.current=!1,te.current=!1,le.current=[],M.current=!1;const ae={audio:!0,video:_?{width:640,height:480}:!1};try{J.current=await navigator.mediaDevices.getUserMedia(ae)}catch(re){re.name==="NotAllowedError"||re.name==="PermissionDeniedError"?O("Camera/microphone access denied. Please allow access and try again."):re.name==="NotFoundError"||re.name==="DevicesNotFoundError"?O("Camera/microphone not found. Please check your devices."):re.name==="NotReadableError"||re.name==="TrackStartError"?O("Camera/microphone is being used by another application."):re.name==="SecurityError"?O("Video calls require HTTPS connection. Please access the site via HTTPS."):O(`Media access failed: ${re.message}`);return}J.current.getAudioTracks().forEach(re=>{re.enabled=!0}),J.current.getVideoTracks().forEach(re=>{re.enabled=!0}),g.current&&(g.current.srcObject=J.current,g.current.play().catch(()=>{}));try{q.current=new RTCPeerConnection(I)}catch(re){O(`Failed to create peer connection: ${re.message}`);return}try{J.current.getTracks().forEach(re=>{q.current.addTrack(re,J.current)})}catch(re){O(`Failed to add tracks to peer connection: ${re.message}`);return}q.current.ontrack=re=>{if(console.log(" Remote track received:",re),console.log(" Event streams:",re.streams),console.log(" Remote video ref:",L.current),console.log(" isVideoEnabled:",_),re.streams&&re.streams[0]){const Ee=re.streams[0];if(console.log(" Setting remote video stream:",Ee),console.log(" Stream tracks:",Ee.getTracks()),window.remoteStream||(window.remoteStream=Ee),L.current)xe(Ee);else{console.log(" Remote video ref not available, waiting...");const Pe=()=>{L.current?(console.log(" Remote video ref now available, setting stream"),xe(Ee)):setTimeout(Pe,100)};Pe()}}else console.error(" No remote video ref or stream available")};const xe=re=>{if(!L.current){console.error(" Cannot attach stream: remote video ref not available");return}console.log(" Attaching remote stream to video element"),(async()=>{try{L.current&&(L.current.srcObject=re,console.log(" Set srcObject on remote video element"),L.current.readyState>=2?(await L.current.play(),console.log(" Remote video playing successfully")):L.current.addEventListener("loadeddata",async()=>{try{L.current&&(await L.current.play(),console.log(" Remote video playing after load"))}catch(Pe){Pe.name!=="AbortError"&&console.error(" Error playing remote video after load:",Pe)}},{once:!0}))}catch(Pe){Pe.name!=="AbortError"&&console.error(" Error playing remote video:",Pe)}})(),re.getAudioTracks().forEach(Pe=>{Pe.enabled=!0,console.log(" Remote audio track enabled:",Pe)}),re.getVideoTracks().forEach(Pe=>{Pe.enabled=!0,console.log(" Remote video track enabled:",Pe)}),L.current&&L.current.volume!==void 0&&(L.current.volume=1),z(!0)};q.current.onicecandidate=re=>{re.candidate&&a&&a.emit("ice-candidate",{callId:t.callId,candidate:re.candidate.candidate,sdpMLineIndex:re.candidate.sdpMLineIndex,sdpMid:re.candidate.sdpMid})},q.current.onconnectionstatechange=()=>{const re=q.current.connectionState;console.log(" Connection state changed:",re),re==="connected"?(console.log(" WebRTC connection established"),b("connected"),Q.current=Date.now()):(re==="disconnected"||re==="failed")&&(console.log(" WebRTC connection failed:",re),Z())},K(),M.current=!0,r||await k()}catch{M.current=!1,O("Failed to access camera/microphone. Please check permissions.")}},K=()=>{if(a){if(console.log("Setting up socket listeners for call:",t.callId,"isIncoming:",r),M.current){console.log("Socket listeners already set up, skipping...");return}a.off("call-answered"),a.off("call-declined"),a.off("call-ended"),a.off("call-error"),a.off("call-offer"),a.off("ice-candidate"),a.on("call-answered",async ae=>{if(console.log(" Call answered received:",ae),ae.callId===t.callId){if(ge.current===ae.callId)return;try{if(ae.answer&&q.current){const x=typeof ae.answer=="string"?JSON.parse(ae.answer):ae.answer,oe=q.current.signalingState;console.log(" Processing answer, current state:",oe),oe==="have-local-offer"&&!pe.current&&(await q.current.setRemoteDescription(x),console.log(" Set remote description, new state:",q.current.signalingState),pe.current=!0,ge.current=ae.callId,setTimeout(()=>{Y()},100))}b("connected"),Q.current=Date.now()}catch(x){console.error(" Failed to handle call answer:",x),O("Failed to handle call answer")}}}),a.on("call-declined",ae=>{ae.callId===t.callId&&(b("declined"),setTimeout(()=>{n&&n()},2e3))}),a.on("call-ended",ae=>{ae.callId===t.callId&&Z()}),a.on("ice-candidate",async ae=>{if(console.log(" ICE candidate received:",ae),ae.callId===t.callId&&q.current)try{const x=q.current.signalingState,oe=q.current.remoteDescription;console.log(" Current signaling state:",x),console.log(" Remote description:",oe?"set":"null"),oe&&(x==="stable"||x==="have-local-offer"||x==="have-remote-offer")?(await q.current.addIceCandidate({candidate:ae.candidate,sdpMLineIndex:ae.sdpMLineIndex,sdpMid:ae.sdpMid}),console.log(" ICE candidate added successfully")):(console.log(" Queuing ICE candidate for later (remote description not set)"),le.current.push({candidate:ae.candidate,sdpMLineIndex:ae.sdpMLineIndex,sdpMid:ae.sdpMid}))}catch(x){console.error(" Failed to add ICE candidate:",x),console.log(" Queuing failed ICE candidate for later"),le.current.push({candidate:ae.candidate,sdpMLineIndex:ae.sdpMLineIndex,sdpMid:ae.sdpMid})}}),a.on("call-error",ae=>{O(ae.error)}),a.on("call-offer",async ae=>{if(console.log("Received call-offer event:",ae),ae.callId===t.callId&&r)try{const x=typeof ae.offer=="string"?JSON.parse(ae.offer):ae.offer;if(console.log("Parsed offer:",x),!q.current&&!M.current&&(console.log("Peer connection not ready, initializing WebRTC..."),await G()),q.current){const oe=q.current.signalingState;console.log("Received offer, current state:",oe),oe==="stable"?(await q.current.setRemoteDescription(x),console.log("Set remote description, new state:",q.current.signalingState),setTimeout(()=>{Y()},100)):console.log("Cannot set remote description in state:",oe)}else console.error("Peer connection not available when handling offer")}catch(x){console.error("Failed to handle call offer:",x),O("Failed to handle call offer")}})}},Y=async()=>{if(le.current.length>0&&q.current)if(console.log(" Processing queued ICE candidates:",le.current.length),q.current.remoteDescription){for(const x of le.current)try{await q.current.addIceCandidate(x),console.log(" Queued ICE candidate added successfully")}catch(oe){console.error(" Failed to add queued ICE candidate:",oe)}le.current=[],console.log(" All queued ICE candidates processed")}else console.log(" Cannot process queued ICE candidates: remote description not set")},k=async()=>{try{if(!M.current){O("WebRTC not initialized yet");return}if(!q.current){O("Peer connection not available");return}if(!a||!a.connected){O("Socket connection not available");return}if(!t||!t.callId){O("Call data not available");return}if(te.current)return;const ae=q.current.signalingState;if(ae!=="stable"){O(`Cannot create offer in state: ${ae}`);return}const x=await q.current.createOffer();await q.current.setLocalDescription(x),te.current=!0,console.log("Sending call-offer with offer:",x),a.emit("call-offer",{callId:t.callId,offer:x}),console.log("Call-offer sent for call:",t.callId),b("ringing")}catch(ae){O(`Failed to create call offer: ${ae.message}`)}},w=async()=>{try{if(q.current){const ae=q.current.signalingState;if(console.log("Answering call, current state:",ae),ae==="have-remote-offer"){const x=await q.current.createAnswer();await q.current.setLocalDescription(x),a.emit("call-answer",{callId:t.callId,answer:x}),b("connected"),Q.current=Date.now(),i&&i()}else ae==="stable"?(console.log("Offer not set yet, this indicates a timing issue"),O("Call offer not processed yet. Please wait a moment and try again.")):(console.error("Cannot answer call in state:",ae),O(`Cannot answer call in current state: ${ae}`))}else O("Call connection not ready")}catch(ae){console.error("Failed to answer call:",ae),O("Failed to answer call")}},A=()=>{a&&a.emit("call-decline",{callId:t.callId}),b("declined"),c&&c(),setTimeout(()=>{n&&n()},1e3)},Z=()=>{be.current||(be.current=!0,a&&a.emit("call-end",{callId:t.callId}),b("ended"),n&&n())},S=()=>{J.current&&(J.current.getAudioTracks().forEach(x=>{x.enabled=j}),T(!j))},E=()=>{if(J.current){const ae=J.current.getVideoTracks(),x=!_;if(ae.forEach(oe=>{oe.enabled=x}),z(x),x&&L.current){console.log("Video enabled, ensuring remote video is visible");const oe=window.remoteStream||L.current.srcObject;oe&&(L.current.srcObject=null,setTimeout(()=>{L.current&&(L.current.srcObject=oe,L.current.play().catch(xe=>{xe.name!=="AbortError"&&console.error("Error playing remote video after toggle:",xe)}))},100))}}},H=()=>{window.remoteStream&&(window.remoteStream=null),J.current&&J.current.getTracks().forEach(ae=>ae.stop()),q.current&&q.current.close(),W.current&&clearInterval(W.current)},ee=ae=>{const x=Math.floor(ae/60),oe=ae%60;return`${x}:${oe.toString().padStart(2,"0")}`};return f?e.jsx("div",{className:"call-error-container",children:e.jsxs("div",{className:"call-error",children:[e.jsx("div",{className:"error-icon",children:""}),e.jsx("h3",{children:"Call Error"}),e.jsx("p",{children:f}),e.jsx("button",{className:"btn btn-primary",onClick:n,children:"Close"})]})}):e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 overflow-hidden w-96",children:[e.jsx("div",{className:"bg-black bg-opacity-20 px-6 py-4 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-200",children:(V=t==null?void 0:t.otherUser)!=null&&V.avatar||(ue=t==null?void 0:t.receiver)!=null&&ue.avatar||(je=t==null?void 0:t.caller)!=null&&je.avatar?e.jsx("img",{src:((Te=t.otherUser)==null?void 0:Te.avatar)||(($e=t.receiver)==null?void 0:$e.avatar)||((ct=t.caller)==null?void 0:ct.avatar),alt:((Ze=t.otherUser)==null?void 0:Ze.name)||((st=t.receiver)==null?void 0:st.name)||((ft=t.caller)==null?void 0:ft.name),className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-lg",children:((Ge=(Ce=((ze=t==null?void 0:t.otherUser)==null?void 0:ze.name)||((it=t==null?void 0:t.receiver)==null?void 0:it.name)||((de=t==null?void 0:t.caller)==null?void 0:de.name))==null?void 0:Ce.charAt(0))==null?void 0:Ge.toUpperCase())||"U"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white text-lg",children:((qe=t==null?void 0:t.otherUser)==null?void 0:qe.name)||((Qe=t==null?void 0:t.receiver)==null?void 0:Qe.name)||((Xe=t==null?void 0:t.caller)==null?void 0:Xe.name)||"Unknown"}),e.jsxs("p",{className:"text-sm text-gray-300",children:[C==="incoming"&&"Incoming call...",C==="outgoing"&&"Calling...",C==="ringing"&&"Ringing...",C==="connected"&&`Connected - ${ee(R)}`,C==="declined"&&"Call declined",C==="ended"&&"Call ended"]})]})]})}),e.jsx("div",{className:"relative h-80 bg-black",children:_?e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:L,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute bottom-3 right-3 w-24 h-20 bg-gray-800 rounded-lg overflow-hidden border-2 border-white",children:e.jsx("video",{ref:g,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"})})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-32 h-32 rounded-full bg-gray-700 flex items-center justify-center mb-4",children:e.jsx("span",{className:"text-3xl text-white",children:((pt=(Ye=((Fe=t==null?void 0:t.otherUser)==null?void 0:Fe.name)||((Ie=t==null?void 0:t.receiver)==null?void 0:Ie.name)||((We=t==null?void 0:t.caller)==null?void 0:We.name))==null?void 0:Ye.charAt(0))==null?void 0:pt.toUpperCase())||"U"})}),e.jsx("p",{className:"text-white text-sm",children:"Audio Only Call"})]})})}),e.jsx("div",{className:"bg-black bg-opacity-20 p-6",children:e.jsxs("div",{className:"flex justify-center space-x-4",children:[C==="incoming"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:A,title:"Decline",children:e.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{className:"w-16 h-16 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:w,title:"Answer",children:e.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})})]}),C==="connected"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`w-14 h-14 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${j?"bg-red-500 hover:bg-red-600 text-white":"bg-white bg-opacity-20 hover:bg-opacity-30 text-white"}`,onClick:S,title:j?"Unmute":"Mute",children:j?e.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),(t==null?void 0:t.callType)==="video"&&e.jsx("button",{className:`w-14 h-14 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${_?"bg-white bg-opacity-20 hover:bg-opacity-30 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,onClick:E,title:_?"Disable Video":"Enable Video",children:_?e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}):e.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]})}),e.jsx("button",{className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:Z,title:"End Call",children:e.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(C==="outgoing"||C==="ringing")&&e.jsx("button",{className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:Z,title:"Cancel Call",children:e.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]})})},Hn=({user:s,callData:t,isIncoming:r=!1,onCallEnd:n,onCallAnswer:i,onCallDecline:c})=>{var Cs,ls,Is,cs,rt,Oe;const{socket:a,isConnected:m}=Bs(),[C,b]=u.useState(r?"incoming":"outgoing"),[j,T]=u.useState(!1),[_,z]=u.useState((t==null?void 0:t.callType)==="video"),[R,F]=u.useState(0),[f,O]=u.useState(null),[g,L]=u.useState([]),[J,q]=u.useState(!1),[Q,W]=u.useState({x:window.innerWidth-400,y:20}),[pe,ge]=u.useState(!1),[be,te]=u.useState({x:0,y:0}),[le,M]=u.useState(!1),[ne,I]=u.useState(!1),G=u.useRef(null),K=u.useRef(null),Y=u.useRef(null),k=u.useRef(null),w=u.useRef(new Map),A=u.useRef(null),Z=u.useRef(null),S=u.useRef(!1),E=u.useRef(null),H=u.useRef(!1),ee=u.useRef(null),V=u.useRef(!1),ue=u.useRef(!1),je=u.useRef([]),Te=u.useRef(new Map),$e=u.useRef(new Set),Ze=(()=>{var ce,Se,Me,me,Ne,ut;const p=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}],X=(Se=(ce=import.meta)==null?void 0:ce.env)==null?void 0:Se.VITE_TURN_URL,B=(me=(Me=import.meta)==null?void 0:Me.env)==null?void 0:me.VITE_TURN_USERNAME,$=(ut=(Ne=import.meta)==null?void 0:Ne.env)==null?void 0:ut.VITE_TURN_CREDENTIAL;return X&&B&&$&&p.push({urls:X,username:B,credential:$}),{iceServers:p,iceCandidatePoolSize:10,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}})();u.useEffect(()=>(t&&t.callId&&t.groupId&&m?(console.log(" Initializing WebRTC for group call:",{callId:t.callId,groupId:t.groupId,callType:t.callType,isIncoming:r}),st()):console.log(" Waiting for call data to initialize WebRTC:",{hasCallData:!!t,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId),isConnected:m}),()=>{xe()}),[t,m]),u.useEffect(()=>{if(!(t!=null&&t.callId)||!m)return;const p=setInterval(()=>{Xe()},3e3);return()=>clearInterval(p)},[g,m,t==null?void 0:t.callId]),u.useEffect(()=>(C==="connected"&&A.current?Z.current=setInterval(()=>{const p=Math.floor((Date.now()-A.current)/1e3);F(p)},1e3):Z.current&&(clearInterval(Z.current),Z.current=null),()=>{Z.current&&clearInterval(Z.current)}),[C]);const st=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){console.error("WebRTC not supported in this browser or requires HTTPS"),O("Video calls require HTTPS connection or are not supported in this browser. Please use HTTPS or try a different browser.");return}if(typeof RTCPeerConnection>"u"){console.error("RTCPeerConnection not supported"),O("WebRTC is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");return}H.current=!1,ee.current=null,V.current=!1,ue.current=!1,je.current=[],$e.current.clear(),S.current=!1;const p={audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:1,latency:.01},video:_?{width:{ideal:640,max:1280},height:{ideal:480,max:720},frameRate:{ideal:30,max:60}}:!1};try{k.current=await navigator.mediaDevices.getUserMedia(p),console.log(" Media stream obtained successfully")}catch($){console.error(" Media access error:",$),$.name==="NotAllowedError"||$.name==="PermissionDeniedError"?O("Camera/microphone access denied. Please allow access and try again."):$.name==="NotFoundError"||$.name==="DevicesNotFoundError"?O("Camera/microphone not found. Please check your devices."):$.name==="NotReadableError"||$.name==="TrackStartError"?O("Camera/microphone is being used by another application."):$.name==="SecurityError"?O("Video calls require HTTPS connection. Please access the site via HTTPS."):O(`Media access failed: ${$.message}`);return}if(k.current.getAudioTracks().forEach($=>{$.enabled=!0}),k.current.getVideoTracks().forEach($=>{$.enabled=_}),K.current&&(K.current.srcObject=k.current,K.current.play().catch(()=>{})),Y.current&&(Y.current.srcObject=k.current,Y.current.muted=!0,Y.current.play().catch(()=>{})),ft(),S.current=!0,console.log(" Setting call as established to allow ICE candidates"),I(!0),!r)await qe();else{console.log(" Incoming call - joining via API to get participants");try{await is.join(t.callId)}catch($){console.error("Error joining incoming call:",$)}}}catch{S.current=!1,O("Failed to access camera/microphone. Please check permissions.")}},ft=()=>{a&&(a.off("group-call-initiated"),a.off("group-call-joined"),a.off("group-call-left"),a.off("group-call-ended"),a.off("group-call-error"),a.off("group-call-participant-joined"),a.off("group-call-participant-left"),a.off("group-call-offer"),a.off("group-call-answer"),a.off("group-call-ice-candidate"),a.on("group-call-initiated",p=>{p.callId===t.callId&&(console.log("Group call initiated:",p),b("ringing"))}),a.on("group-call-joined",async p=>{var X,B;if(p.callId===t.callId){console.log("Group call joined:",p),b("connected"),I(!0),A.current=Date.now();try{const $=await fetch(`/api/group-calls/${t.callId}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if($.ok){const ce=await $.json(),Me=(((B=(X=ce==null?void 0:ce.data)==null?void 0:X.call)==null?void 0:B.participants)||[]).filter(Ne=>Ne&&Ne.isActive).map(Ne=>{const ut=typeof Ne.user=="object"&&Ne.user?Ne.user:typeof Ne.user=="string"&&Ne.user?{_id:Ne.user}:typeof Ne.userId=="string"&&Ne.userId?{_id:Ne.userId}:typeof Ne.userId=="object"&&Ne.userId?Ne.userId:typeof Ne._id=="string"&&Ne._id?{_id:Ne._id}:typeof Ne.id=="string"&&Ne.id?{_id:Ne.id}:{},bt=ut._id||ut.id;return{...ut,id:bt,name:ut.name||Ne.name}}).filter(Ne=>Ne.id&&Ne.id!==s.id),me=Fe(Me);me.length>0?(console.log(" Found existing participants:",Me),L(me),await Qe(me)):console.log(" No existing participants found"),G.current=setInterval(We,5e3)}}catch($){console.error("Error fetching call details:",$)}}}),a.on("group-call-left",p=>{p.callId===t.callId&&!le&&(console.log("Group call left:",p),b("ended"),n&&n())}),a.on("group-call-ended",p=>{var X;p.callId===t.callId&&!le&&(console.log("Group call ended:",p),p.reason==="Initiator left the call"?U.success(`Call ended - ${((X=p.endedBy)==null?void 0:X.name)||"Host"} left the call`):U.success("Call ended"),b("ended"),n&&n())}),a.on("group-call-error",p=>{console.error("Group call error:",p),O(p.error)}),a.on("group-call-participant-joined",p=>{var X,B;if(p.callId===t.callId){console.log(" Participant joined socket event:",{data:p,newParticipant:p.newParticipant,hasNewParticipant:!!p.newParticipant,newParticipantId:(X=p.newParticipant)==null?void 0:X.id,newParticipantName:(B=p.newParticipant)==null?void 0:B.name}),console.log(" Current participants before adding:",g),L(ce=>{const Se={...p.newParticipant,id:p.newParticipant.id||p.newParticipant._id};if(ce.some(Ne=>Ne.id===Se.id))return console.log(" Participant already exists, skipping duplicate"),ce;const me=[...ce,Se];return console.log(" Updated participants after adding:",me),me});const $={...p.newParticipant,id:p.newParticipant.id||p.newParticipant._id};Ie($)}}),a.on("group-call-participant-left",p=>{p.callId===t.callId&&(console.log(" Participant left:",p),L(X=>{const B=X.filter($=>$.id!==p.leftParticipant.id);return console.log(" Updated participants after removal:",B),B}),it(p.leftParticipant.id))}),a.on("group-call-offer",async p=>{p.callId===t.callId&&(console.log("Group call offer received:",p),await de(p))}),a.on("group-call-answer",async p=>{p.callId===t.callId&&(console.log("Group call answer received:",p),await Ce(p))}),a.on("group-call-ice-candidate",async p=>{p.callId===t.callId&&(console.log("Group call ICE candidate received:",p),await Ge(p))}))},ze=async p=>{try{console.log(" Creating peer connection for target user:",p);const X=new RTCPeerConnection(Ze);if(k.current){const B=k.current.getAudioTracks(),$=k.current.getVideoTracks();B.forEach(ce=>{ce.enabled=!j;const Se=X.addTrack(ce,k.current);if(console.log(" Added audio track to peer connection:",ce.label,"enabled:",ce.enabled),Se&&Se.getParameters){const Me=Se.getParameters();Me.encodings&&Me.encodings[0]&&(Me.encodings[0].maxBitrate=64e3,Me.encodings[0].priority="high",Se.setParameters(Me))}}),$.forEach(ce=>{ce.enabled=_;const Se=X.addTrack(ce,k.current);if(console.log(" Added video track to peer connection:",ce.label,"enabled:",ce.enabled),Se&&Se.getParameters){const Me=Se.getParameters();Me.encodings&&Me.encodings[0]&&(Me.encodings[0].maxBitrate=1e6,Me.encodings[0].maxFramerate=30,Se.setParameters(Me))}})}return X.ontrack=B=>{console.log(" Remote track received from:",p),console.log(" Track details:",{kind:B.track.kind,label:B.track.label,enabled:B.track.enabled,readyState:B.track.readyState,streamsCount:B.streams.length});const $=B.streams[0];$&&(console.log(" Remote stream received:",{id:$.id,active:$.active,audioTracks:$.getAudioTracks().length,videoTracks:$.getVideoTracks().length}),$.getAudioTracks().forEach(Se=>{console.log(" Processing remote audio track:",Se.label,"enabled:",Se.enabled),Se.enabled=!0}),L(Se=>{const Me=Se.map(me=>me.id===p?{...me,stream:$}:me);return console.log(" Updated participants with stream:",Me),Me}))},X.onicecandidate=B=>{if(B.candidate)if(console.log(" ICE candidate generated for:",p),p&&a&&(t!=null&&t.callId)&&(t!=null&&t.groupId)){const $={callId:t.callId,groupId:t.groupId,targetUserId:p,candidate:B.candidate.candidate,sdpMLineIndex:B.candidate.sdpMLineIndex,sdpMid:B.candidate.sdpMid};console.log(" Sending ICE candidate immediately"),a.emit("group-call-ice-candidate",$)}else{console.warn(" ICE candidate queued - missing data:",{hasTargetUserId:!!p,hasSocket:!!a,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId)});const $=String(p||"unknown");Te.current.has($)||Te.current.set($,[]),Te.current.get($).push({candidate:B.candidate.candidate,sdpMLineIndex:B.candidate.sdpMLineIndex,sdpMid:B.candidate.sdpMid})}else console.log(" ICE gathering completed for:",p)},X.onconnectionstatechange=()=>{const B=X.connectionState;console.log(` Connection state with ${p}:`,B),B==="connected"?(console.log(` Connected to ${p}`),L($=>$.map(ce=>ce.id===p?{...ce,isConnected:!0}:ce))):B==="failed"||B==="closed"?(console.error(` Connection ${B} with ${p}`),L($=>$.map(ce=>ce.id===p?{...ce,isConnected:!1}:ce)),B==="failed"&&w.current.has(p)&&(console.log(` Will attempt to reconnect to ${p} in 3 seconds`),setTimeout(()=>{if(w.current.has(p)){console.log(` Recreating connection to ${p}`),it(p);const $=ze(p);$&&$.createOffer().then(ce=>{$.setLocalDescription(ce),a&&(t!=null&&t.callId)&&(t!=null&&t.groupId)&&a.emit("group-call-offer",{callId:t.callId,groupId:t.groupId,targetUserId:p,offer:ce})}).catch(ce=>console.error("Error recreating offer:",ce))}},3e3))):B==="disconnected"&&(console.warn(` Temporarily disconnected from ${p}`),L($=>$.map(ce=>ce.id===p?{...ce,isConnected:!1}:ce)))},X.oniceconnectionstatechange=()=>{var $;const B=X.iceConnectionState;console.log(` ICE state with ${p}:`,B),B==="connected"||B==="completed"?console.log(` ICE connected with ${p}`):B==="failed"?(console.error(` ICE failed with ${p}`),U.error(`Connection issue with ${(($=g.find(ce=>ce.id===p))==null?void 0:$.name)||"participant"}`)):B==="disconnected"&&console.warn(` ICE disconnected with ${p}`)},w.current.set(p,X),setTimeout(()=>{Pe(p)},100),X}catch(X){console.error("Error creating peer connection:",X)}},it=p=>{const X=w.current.get(String(p));X&&(X.close(),w.current.delete(p))},de=async p=>{var X,B,$,ce;try{console.log(" Group call offer data received:",{data:p,from:p.from,hasFrom:!!p.from,fromId:(X=p.from)==null?void 0:X.id,fromName:(B=p.from)==null?void 0:B.name,hasOffer:!!p.offer});const Se=p.from.id||p.from._id;if(!Se){console.error(" Cannot handle offer: missing from user ID",{from:p.from,hasId:!!(($=p.from)!=null&&$.id),hasUnderscoreId:!!((ce=p.from)!=null&&ce._id)});return}const Me=await ze(Se);if(Me)try{await Me.setRemoteDescription(p.offer);const me=await Me.createAnswer();console.log(" Created answer for participant:",Se,{hasAnswer:!!me,answerType:me==null?void 0:me.type,answerSdp:me!=null&&me.sdp?me.sdp.substring(0,100)+"...":"No SDP"}),await Me.setLocalDescription(me),t&&t.callId&&t.groupId&&me?(a.emit("group-call-answer",{callId:t.callId,groupId:t.groupId,targetUserId:Se,answer:me}),Ee(Se),setTimeout(()=>{Pe(Se)},100)):console.warn("Skipping answer: call data not ready yet",{hasCallData:!!t,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId),hasAnswer:!!me})}catch(me){console.error("Error creating answer for participant:",Se,me)}}catch(Se){console.error("Error handling group call offer:",Se)}},Ce=async p=>{var X,B,$,ce,Se,Me,me;try{console.log(" Group call answer data received:",{data:p,from:p.from,hasFrom:!!p.from,fromId:(X=p.from)==null?void 0:X.id,fromUnderscoreId:(B=p.from)==null?void 0:B._id,fromName:($=p.from)==null?void 0:$.name,hasAnswer:!!p.answer});const Ne=p.from.id||p.from._id;if(!Ne){console.error(" Cannot handle answer: missing from user ID",{from:p.from,hasId:!!((ce=p.from)!=null&&ce.id),hasUnderscoreId:!!((Se=p.from)!=null&&Se._id)});return}const ut=`${Ne}-${((me=(Me=p.answer)==null?void 0:Me.sdp)==null?void 0:me.substring(0,50))||"unknown"}`;if($e.current.has(ut)){console.log(" Answer already processed, skipping duplicate:",ut);return}const bt=w.current.get(Ne);if(bt)if(console.log(" Peer connection state for",Ne,":",{connectionState:bt.connectionState,iceConnectionState:bt.iceConnectionState,signalingState:bt.signalingState,currentRemoteDescription:!!bt.currentRemoteDescription}),bt.signalingState==="have-local-offer"||bt.signalingState==="have-local-pranswer")try{await bt.setRemoteDescription(p.answer),$e.current.add(ut),console.log(" Answer processed for participant:",Ne),setTimeout(()=>{Pe(Ne)},100)}catch(bs){console.error(" Failed to set remote description for",Ne,":",bs)}else console.warn(" Cannot set remote description - wrong signaling state:",{participant:Ne,signalingState:bt.signalingState,expectedStates:["have-local-offer","have-local-pranswer"]});else console.warn(" No peer connection found for participant:",Ne)}catch(Ne){console.error("Error handling group call answer:",Ne)}},Ge=async p=>{var X,B,$,ce;try{console.log(" Received ICE candidate from:",((X=p.from)==null?void 0:X.name)||((B=p.from)==null?void 0:B.id));const Se=(($=p.from)==null?void 0:$.id)||((ce=p.from)==null?void 0:ce._id);if(!Se){console.error(" Cannot handle ICE candidate: missing from user ID");return}const Me=w.current.get(Se);if(Me&&Me.remoteDescription)try{await Me.addIceCandidate({candidate:p.candidate,sdpMLineIndex:p.sdpMLineIndex,sdpMid:p.sdpMid}),console.log(" ICE candidate added for:",Se)}catch(me){console.error(" Failed to add ICE candidate:",me.message)}else{console.log(" Queuing ICE candidate for:",Se);const me=String(Se);Te.current.has(me)||Te.current.set(me,[]),Te.current.get(me).push({candidate:p.candidate,sdpMLineIndex:p.sdpMLineIndex,sdpMid:p.sdpMid})}}catch(Se){console.error("Error handling group call ICE candidate:",Se)}},qe=async()=>{try{await is.join(t.callId),a&&a.emit("group-call-join",{callId:t.callId,groupId:t.groupId})}catch(p){console.error("Error joining group call:",p),O("Failed to join group call")}},Qe=async p=>{try{for(const X of p)if(X.id!==s.id&&X.isActive){console.log(`Creating mesh connection with ${X.name}`);const B=await ze(X.id);if(B)try{const $=await B.createOffer();console.log(" Created offer for participant:",X.id,{hasOffer:!!$,offerType:$==null?void 0:$.type,offerSdp:$!=null&&$.sdp?$.sdp.substring(0,100)+"...":"No SDP"}),await B.setLocalDescription($),t&&t.callId&&t.groupId&&$?(a.emit("group-call-offer",{callId:t.callId,groupId:t.groupId,targetUserId:X.id,offer:$}),Ee(X.id),setTimeout(()=>{Pe(X.id)},100)):console.warn("Skipping offer: call data not ready yet",{hasCallData:!!t,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId),hasOffer:!!$})}catch($){console.error("Error creating offer for participant:",X.id,$)}}}catch(X){console.error("Error establishing mesh connections:",X)}},Xe=async()=>{try{const p=g||[];for(const X of p){const B=X&&(X.id||X._id);if(!(!B||B===s.id)&&!w.current.get(B)){const $=await ze(B);if($)try{const ce=await $.createOffer();await $.setLocalDescription(ce),t&&t.callId&&t.groupId&&ce&&(a.emit("group-call-offer",{callId:t.callId,groupId:t.groupId,targetUserId:B,offer:ce}),Ee(B),setTimeout(()=>{Pe(B)},100))}catch(ce){console.error("Error reconciling offer for participant:",B,ce)}}}}catch(p){console.error("Error reconciling peer connections:",p)}},Fe=p=>{const X=new Set,B=[];for(const $ of p||[]){const ce=$&&($.id||$._id);ce&&(X.has(ce)||(X.add(ce),B.push($)))}return B},Ie=async p=>{try{console.log(" New participant data received:",{newParticipant:p,hasId:!!(p!=null&&p.id),id:p==null?void 0:p.id,hasName:!!(p!=null&&p.name),name:p==null?void 0:p.name,currentUserId:s==null?void 0:s.id});const X=p.id||p._id;if(X&&X!==s.id){console.log(`New participant joined: ${p.name} (ID: ${X})`);const B=await ze(X);if(B)try{const $=await B.createOffer();console.log(" Created offer for new participant:",X,{hasOffer:!!$,offerType:$==null?void 0:$.type,offerSdp:$!=null&&$.sdp?$.sdp.substring(0,100)+"...":"No SDP"}),await B.setLocalDescription($),t&&t.callId&&t.groupId&&$?(a.emit("group-call-offer",{callId:t.callId,groupId:t.groupId,targetUserId:X,offer:$}),Ee(X),setTimeout(()=>{Pe(X)},100)):console.warn("Skipping offer: call data not ready yet",{hasCallData:!!t,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId),hasOffer:!!$})}catch($){console.error("Error creating offer for new participant:",X,$)}}}catch(X){console.error("Error handling participant joined:",X)}},We=async()=>{var p,X;if(t!=null&&t.callId)try{const B=await fetch(`/api/group-calls/${t.callId}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(B.ok){const $=await B.json(),Se=(((X=(p=$==null?void 0:$.data)==null?void 0:p.call)==null?void 0:X.participants)||[]).filter(me=>me&&me.isActive).map(me=>{const Ne=typeof me.user=="object"&&me.user?me.user:typeof me.user=="string"&&me.user?{_id:me.user}:typeof me.userId=="string"&&me.userId?{_id:me.userId}:typeof me.userId=="object"&&me.userId?me.userId:typeof me._id=="string"&&me._id?{_id:me._id}:typeof me.id=="string"&&me.id?{_id:me.id}:{},ut=Ne._id||Ne.id;return{...Ne,id:ut,name:Ne.name||me.name}}).filter(me=>me.id&&me.id!==s.id),Me=Fe(Se);Me.length>0&&L(Me)}}catch(B){console.error("Error refreshing participants:",B)}},Ye=async()=>{try{await qe(),await We(),G.current=setInterval(We,5e3),i&&i()}catch(p){console.error("Error answering group call:",p),O("Failed to answer group call")}},pt=()=>{a&&a.emit("group-call-leave",{callId:t.callId,groupId:t.groupId}),b("declined"),c&&c(),setTimeout(()=>{n&&n()},1e3)},ae=()=>{le||(M(!0),I(!1),xe(),G.current&&(clearInterval(G.current),G.current=null),a&&a.emit("group-call-leave",{callId:t.callId,groupId:t.groupId}),b("ended"),n&&n())},x=()=>{if(k.current){const p=k.current.getAudioTracks(),X=!j;p.forEach(B=>{B.enabled=!X}),T(X),is.updateMuteStatus(t.callId,X).then(()=>console.log(" Mute status updated on server")).catch(B=>console.error("Error updating mute status:",B))}},oe=()=>{if(k.current){const p=k.current.getVideoTracks(),X=!_;p.forEach(B=>{B.enabled=X}),z(X),is.updateVideoStatus(t.callId,X).then(()=>console.log(" Video status updated on server")).catch(B=>console.error("Error updating video status:",B))}},xe=()=>{window.remoteStreams&&(window.remoteStreams=new Map),k.current&&k.current.getTracks().forEach(p=>p.stop()),w.current&&(w.current.forEach(p=>{p.close()}),w.current.clear()),$e.current.clear(),Z.current&&clearInterval(Z.current)},re=p=>{const X=Math.floor(p/60),B=p%60;return`${X}:${B.toString().padStart(2,"0")}`},Ee=p=>{const X=Te.current.get(String(p))||Te.current.get("unknown");X&&X.length>0&&a&&t&&(console.log(` Sending ${X.length} queued ICE candidates for ${p}`),X.forEach($=>{const ce={callId:t.callId,groupId:t.groupId,targetUserId:p,candidate:$.candidate,sdpMLineIndex:$.sdpMLineIndex,sdpMid:$.sdpMid};a.emit("group-call-ice-candidate",ce)}),Te.current.delete(p));const B=Te.current.get("unknown");B&&B.length>0&&a&&t&&(console.log(` Sending ${B.length} 'unknown' queued ICE candidates to ${p}`),B.forEach($=>{const ce={callId:t.callId,groupId:t.groupId,targetUserId:p,candidate:$.candidate,sdpMLineIndex:$.sdpMLineIndex,sdpMid:$.sdpMid};a.emit("group-call-ice-candidate",ce)}))},Pe=async p=>{const X=w.current.get(p);if(!X){console.warn(" No peer connection found to process queued candidates for:",p);return}const B=Te.current.get(p);if(!B||B.length===0){console.log(" No queued ICE candidates to process for:",p);return}console.log(` Processing ${B.length} queued ICE candidates for ${p}`);for(const $ of B)try{await X.addIceCandidate({candidate:$.candidate,sdpMLineIndex:$.sdpMLineIndex,sdpMid:$.sdpMid}),console.log(" Queued ICE candidate added for:",p)}catch(ce){console.error(" Failed to add queued ICE candidate for:",p,ce)}Te.current.delete(String(p)),Te.current.delete("unknown"),console.log(` Finished processing queued ICE candidates for ${p}`)},dt=p=>{if(p.target.closest(".call-controls"))return;ge(!0);const X=E.current.getBoundingClientRect();te({x:p.clientX-X.left,y:p.clientY-X.top})},xt=p=>{if(!pe)return;const X=p.clientX-be.x,B=p.clientY-be.y,$=window.innerWidth-400,ce=window.innerHeight-300;W({x:Math.max(0,Math.min(X,$)),y:Math.max(0,Math.min(B,ce))})},Rt=()=>{ge(!1)};return u.useEffect(()=>{if(pe)return document.addEventListener("mousemove",xt),document.addEventListener("mouseup",Rt),()=>{document.removeEventListener("mousemove",xt),document.removeEventListener("mouseup",Rt)}},[pe,be]),u.useEffect(()=>{k.current&&Y.current&&(Y.current.srcObject=k.current,Y.current.muted=!0,Y.current.play().catch(()=>{}))},[k.current,Y.current]),f?e.jsx("div",{className:"fixed bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 p-6 z-50 transition-all duration-300",style:{left:Q.x,top:Q.y,width:"400px",height:"300px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:""}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Group Call Error"}),e.jsx("p",{className:"text-sm text-gray-300 mb-4",children:f}),e.jsx("button",{onClick:n,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:"Close"})]})}):J?e.jsx("div",{ref:E,className:"fixed bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 z-50 transition-all duration-300 hover:shadow-3xl",style:{left:Q.x,top:Q.y,width:"320px",height:"80px"},children:e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:(Cs=t==null?void 0:t.group)!=null&&Cs.avatar?e.jsx("img",{src:t.group.avatar,alt:t.group.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-blue-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"G"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white text-sm",children:((ls=t==null?void 0:t.group)==null?void 0:ls.name)||"Group Call"}),e.jsx("p",{className:"text-xs text-gray-300",children:C==="connected"?`${g.length+1} participants`:"Group call..."})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onMouseDown:dt,className:"p-1.5 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),q(!1)},className:"p-1.5 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:"Expand",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),ae()},className:"p-1.5 bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors",title:"End Call",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})}):e.jsxs("div",{ref:E,className:"fixed bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 overflow-hidden z-50 transition-all duration-300",style:{left:Q.x,top:Q.y,width:"500px",height:"600px"},children:[e.jsxs("div",{className:"bg-black bg-opacity-20 px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:(Is=t==null?void 0:t.group)!=null&&Is.avatar?e.jsx("img",{src:t.group.avatar,alt:t.group.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-blue-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold",children:"G"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white text-sm",children:((cs=t==null?void 0:t.group)==null?void 0:cs.name)||"Group Call"}),e.jsxs("p",{className:"text-xs text-gray-300",children:[C==="incoming"&&"Incoming group call...",C==="outgoing"&&"Joining group call...",C==="ringing"&&"Ringing...",C==="connected"&&`Connected - ${re(R)}`,C==="declined"&&"Call declined",C==="ended"&&"Call ended"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onMouseDown:dt,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),q(!0)},className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:"Minimize",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),n()},className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:"Close",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("audio",{ref:Y,muted:!0,autoPlay:!0,style:{display:"none"}}),g.map((p,X)=>p.stream&&e.jsx("audio",{autoPlay:!0,playsInline:!0,ref:B=>{B&&p.stream&&(B.srcObject=p.stream,B.volume=1,B.muted=!1,B.play().catch($=>console.log("Audio play error:",$)))},style:{display:"none"}},`audio-${p.id}-${X}`)),e.jsx("div",{className:"relative h-80 bg-black",children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute bottom-3 right-3 w-24 h-20 bg-gray-800 rounded-lg overflow-hidden border-2 border-white",children:e.jsx("video",{ref:K,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"grid grid-cols-2 gap-2 p-2 h-full",children:g.map((p,X)=>{var B,$,ce,Se;return e.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:p.stream?e.jsx(e.Fragment,{children:t.callType==="video"?e.jsx("video",{autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover",ref:Me=>{Me&&p.stream&&(Me.srcObject=p.stream)}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center relative",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center mb-2",children:e.jsx("span",{className:"text-white text-xl font-semibold",children:(($=(B=p.name)==null?void 0:B.charAt(0))==null?void 0:$.toUpperCase())||"U"})}),e.jsx("p",{className:"text-white text-sm font-medium",children:p.name}),e.jsxs("div",{className:"flex items-center justify-center mt-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-green-400 text-xs ml-1",children:"Speaking"})]})]})})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-600 flex items-center justify-center mb-2",children:e.jsx("span",{className:"text-white text-lg",children:((Se=(ce=p.name)==null?void 0:ce.charAt(0))==null?void 0:Se.toUpperCase())||"U"})}),e.jsx("p",{className:"text-white text-xs",children:p.name})]})})},`${p.id}-${X}`)})})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-center py-4 border-b border-gray-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center mb-2 mx-auto",children:e.jsx("span",{className:"text-2xl text-white",children:"G"})}),e.jsx("p",{className:"text-white text-sm font-medium",children:"Group Audio Call"}),e.jsxs("p",{className:"text-gray-300 text-xs mt-1",children:[g.length+1," participant",g.length+1!==1?"s":""]})]})}),e.jsx("div",{className:"flex-1 p-4 overflow-y-auto",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-800 rounded-lg",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${j?"bg-red-600":"bg-green-600"}`,children:e.jsx("span",{className:"text-white text-sm font-semibold",children:((Oe=(rt=s.name)==null?void 0:rt.charAt(0))==null?void 0:Oe.toUpperCase())||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-white text-sm font-medium",children:[s.name," (You)"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${j?"bg-red-500":"bg-green-500 animate-pulse"}`}),e.jsx("span",{className:`text-xs ml-1 ${j?"text-red-400":"text-green-400"}`,children:j?"Muted":"Speaking"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-gray-300 text-xs",children:"Host"}),j&&e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mt-1"})]})]}),g.map((p,X)=>{var B,$;return e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-800 rounded-lg",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${p.stream?"bg-blue-600":"bg-gray-600"}`,children:e.jsx("span",{className:"text-white text-sm font-semibold",children:(($=(B=p.name)==null?void 0:B.charAt(0))==null?void 0:$.toUpperCase())||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-sm font-medium",children:p.name}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${p.stream?"bg-green-500 animate-pulse":"bg-yellow-500"}`}),e.jsx("span",{className:`text-xs ml-1 ${p.stream?"text-green-400":"text-yellow-400"}`,children:p.stream?"Speaking":"Connecting..."})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-gray-300 text-xs",children:"Participant"}),p.stream&&e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-1 animate-pulse"})]})]},`${p.id}-${X}`)}),g.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-400 text-sm",children:"Waiting for other participants..."})})]})})]})}),e.jsxs("div",{className:"bg-black bg-opacity-20 p-4",children:[e.jsxs("div",{className:"call-controls flex justify-center space-x-3",onMouseDown:p=>p.stopPropagation(),children:[C==="incoming"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:pt,title:"Decline",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{className:"w-12 h-12 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:Ye,title:"Answer",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})})]}),C==="connected"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${j?"bg-red-500 hover:bg-red-600 text-white":"bg-white bg-opacity-20 hover:bg-opacity-30 text-white"}`,onClick:x,title:j?"Unmute":"Mute",children:j?e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),(t==null?void 0:t.callType)==="video"&&e.jsx("button",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${_?"bg-white bg-opacity-20 hover:bg-opacity-30 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,onClick:oe,title:_?"Disable Video":"Enable Video",children:_?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}):e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]})}),e.jsx("button",{className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:ae,title:"End Call",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(C==="outgoing"||C==="ringing")&&e.jsx("button",{className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:ae,title:"Cancel Call",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),C==="connected"&&!_&&e.jsxs("div",{className:"mt-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-2",children:[e.jsx("div",{className:"w-1 h-2 bg-green-400 rounded"}),e.jsx("div",{className:"w-1 h-3 bg-green-400 rounded"}),e.jsx("div",{className:"w-1 h-4 bg-green-400 rounded"}),e.jsx("div",{className:"w-1 h-3 bg-green-400 rounded"}),e.jsx("div",{className:"w-1 h-2 bg-green-400 rounded"})]}),e.jsx("span",{className:"text-xs text-gray-300",children:"Good audio quality"})]})]})]})},Wn=({user:s,callData:t,onCallEnd:r})=>{var ne,I;const[n,i]=u.useState(1),[c,a]=u.useState(""),[m,C]=u.useState(!1),[b,j]=u.useState(!1),[T,_]=u.useState(!1),[z,R]=u.useState(!1),[F,f]=u.useState({x:100,y:100}),[O,g]=u.useState({width:800,height:600}),L=u.useRef(null),J=u.useRef({x:0,y:0}),q=u.useRef({x:0,y:0,width:0,height:0});u.useEffect(()=>{var Z;const G=(t==null?void 0:t.roomName)||`group-${t==null?void 0:t.groupId}-${Date.now()}`,K=`vpaas-magic-cookie-06fa758e7c18435681a16b81d4c43676/${G}`,Y=encodeURIComponent((s==null?void 0:s.name)||"User"),k=encodeURIComponent((s==null?void 0:s.email)||""),w=`https://8x8.vc/${K}?displayName=${Y}&email=${k}&config.startWithAudioMuted=false&config.startWithVideoMuted=${(t==null?void 0:t.callType)==="voice"}&config.prejoinPageEnabled=true`;console.log(" ========================================"),console.log(" JITSI VIDEO CALL"),console.log(" Room:",G),console.log(" Full Room:",K),console.log(" User:",s==null?void 0:s.name),console.log(" URL:",w),console.log(" ========================================"),a(w),U.success(`Joining ${((Z=t==null?void 0:t.group)==null?void 0:Z.name)||"group call"}`,{icon:"",duration:2e3});const A=setTimeout(()=>{i(S=>S+1),console.log(" Participant count updated (simulated)")},3e4);return()=>clearTimeout(A)},[t,s]);const Q=G=>{b||(_(!0),J.current={x:G.clientX-F.x,y:G.clientY-F.y})},W=G=>{if(T&&!b&&f({x:G.clientX-J.current.x,y:G.clientY-J.current.y}),z&&!b){const K=Math.max(400,q.current.width+(G.clientX-q.current.x)),Y=Math.max(300,q.current.height+(G.clientY-q.current.y));g({width:K,height:Y})}},pe=()=>{_(!1),R(!1)},ge=G=>{b||(G.stopPropagation(),R(!0),q.current={x:G.clientX,y:G.clientY,width:O.width,height:O.height})};u.useEffect(()=>{if(T||z)return window.addEventListener("mousemove",W),window.addEventListener("mouseup",pe),()=>{window.removeEventListener("mousemove",W),window.removeEventListener("mouseup",pe)}},[T,z,F,O]);const be=()=>{console.log(" Ending call"),r&&r()},te=()=>{C(!m)},le=()=>{j(!b)};if(!c)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-500 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-white text-lg",children:"Preparing call..."})]})});if(m)return e.jsx("div",{className:"fixed bottom-4 right-4 z-50 bg-gradient-to-r from-gray-900 to-gray-800 rounded-xl shadow-2xl cursor-pointer hover:shadow-3xl transition-all",onClick:te,children:e.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center animate-pulse",children:e.jsx(ht,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white text-sm",children:((ne=t==null?void 0:t.group)==null?void 0:ne.name)||"Video Call"}),e.jsxs("p",{className:"text-xs text-gray-300 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Call in progress"]})]})]})});const M=b?{position:"fixed",inset:0,width:"100%",height:"100%"}:{position:"fixed",left:F.x,top:F.y,width:O.width,height:O.height};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 z-40"}),e.jsxs("div",{ref:L,className:`z-50 bg-gray-900 rounded-xl shadow-2xl overflow-hidden flex flex-col ${T?"cursor-grabbing":""} ${b?"":"border-2 border-gray-700"}`,style:M,children:[e.jsxs("div",{className:`bg-gradient-to-r from-gray-900 to-gray-800 px-4 py-3 flex items-center justify-between border-b border-gray-700 shadow-lg ${b?"":"cursor-grab active:cursor-grabbing"}`,onMouseDown:Q,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow-lg",children:e.jsx(lt,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white text-sm",children:((I=t==null?void 0:t.group)==null?void 0:I.name)||"Video Call"}),e.jsxs("p",{className:"text-xs text-gray-300 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Group ",(t==null?void 0:t.callType)==="voice"?"Voice":"Video"," Call"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:te,className:"p-2 hover:bg-gray-700 rounded-lg transition-all text-gray-400 hover:text-white",title:"Minimize",children:e.jsx(Cd,{size:18})}),e.jsx("button",{onClick:le,className:"p-2 hover:bg-gray-700 rounded-lg transition-all text-gray-400 hover:text-white",title:b?"Exit Fullscreen":"Fullscreen",children:e.jsx(Sd,{size:18})}),e.jsxs("button",{onClick:be,className:"px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg transition-all text-white font-semibold shadow-lg hover:shadow-xl flex items-center gap-2",title:"End Call",children:[e.jsx(Ct,{size:16}),"End"]})]})]}),e.jsx("div",{className:"flex-1 relative bg-black",children:e.jsx("iframe",{src:c,allow:"camera; microphone; fullscreen; display-capture; autoplay",className:"w-full h-full border-0",title:"Jitsi Meet",onLoad:()=>{console.log(" Jitsi iframe loaded successfully"),U.success("Call connected",{icon:"",duration:2e3})},onError:()=>{console.error(" Jitsi iframe load error"),U.error("Failed to load call")}})}),!b&&e.jsx("div",{className:"absolute bottom-0 right-0 w-8 h-8 cursor-nwse-resize hover:bg-blue-500 hover:bg-opacity-30 transition-all",onMouseDown:ge,title:"Drag to resize",children:e.jsxs("div",{className:"absolute bottom-1 right-1 flex flex-col gap-0.5",children:[e.jsxs("div",{className:"flex gap-0.5 justify-end",children:[e.jsx("div",{className:"w-1 h-1 bg-gray-500 rounded-full"}),e.jsx("div",{className:"w-1 h-1 bg-gray-500 rounded-full"})]}),e.jsx("div",{className:"flex gap-0.5 justify-end",children:e.jsx("div",{className:"w-1 h-1 bg-gray-500 rounded-full"})})]})}),!b&&e.jsx("div",{className:"absolute top-3 right-1/2 transform translate-x-1/2 flex gap-1 pointer-events-none",children:e.jsx(Id,{size:16,className:"text-gray-500"})})]})]})},Yn=({callData:s,onAccept:t,onDecline:r})=>{var a,m;const n=((a=s==null?void 0:s.group)==null?void 0:a.name)||(s==null?void 0:s.groupName)||"Group Call",i=((m=s==null?void 0:s.initiator)==null?void 0:m.name)||"Someone",c=(s==null?void 0:s.callType)||"video";return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 animate-fadeIn",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-800 rounded-2xl shadow-2xl p-8 w-96 text-center text-white animate-slideUp",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-white bg-opacity-20 flex items-center justify-center mx-auto animate-pulse",children:e.jsx(ht,{size:48,className:"text-white"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-32 h-32 rounded-full border-4 border-white border-opacity-30 animate-ping"})})]}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:n}),e.jsxs("p",{className:"text-blue-100 mb-1",children:[i," is starting a ",c," call"]}),e.jsx("p",{className:"text-sm text-blue-200 mb-8",children:c==="video"?"Video call with screen sharing":"Voice call"}),e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white bg-opacity-20 px-4 py-2 rounded-full mb-8",children:[e.jsx(ht,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:c==="video"?"Video Call":"Voice Call"})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:r,className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-110 active:scale-95",title:"Decline",children:e.jsx(Td,{size:24})}),e.jsx("button",{onClick:t,className:"w-16 h-16 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-110 active:scale-95 animate-bounce",title:"Accept",children:e.jsx(or,{size:24})})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-blue-100",children:"Incoming call..."})]})]}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
        @keyframes fadeIn {
          from {
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }

        @keyframes slideUp {
          from {
            transform: translateY(100px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }

        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }

        .animate-slideUp {
          animation: slideUp 0.4s ease-out;
        }
      `}})]})},_d=()=>{const{user:s,logout:t}=It(),{socket:r,notifications:n,handleActivateUser:i,handleCloseNotification:c}=Bs(),[a,m]=u.useState({totalUsers:0,totalGroups:0,activeUsers:0,disabledUsers:0}),[C,b]=u.useState(!0),[j,T]=u.useState(!1),[_,z]=u.useState(!1),[R,F]=u.useState(!1),[f,O]=u.useState(null),[g,L]=u.useState(!1),[J,q]=u.useState(!1),[Q,W]=u.useState(null),[pe,ge]=u.useState(!1);u.useEffect(()=>{be()},[]),u.useEffect(()=>{if(r)return console.log(" Setting up Admin Dashboard call listeners..."),r.off("incoming-call"),r.on("incoming-call",M=>{var ne;console.log(" Admin Dashboard - Incoming call received:",M),U.success(`Incoming ${M.callType} call from ${((ne=M.caller)==null?void 0:ne.name)||"Unknown"}`,{duration:5e3,icon:""}),L(!0),O({callId:M.callId,callType:M.callType,caller:M.caller}),F(!0)}),r.off("call-initiated"),r.on("call-initiated",M=>{console.log(" Admin Dashboard - Call initiated:",M),L(!1),O({callId:M.callId,callType:M.callType,otherUser:M.receiver}),F(!0)}),r.off("call-error"),r.on("call-error",M=>{console.error(" Admin Dashboard - Call error:",M),U.error(M.error||"Call failed",{duration:4e3})}),r.off("incoming-group-call"),r.on("incoming-group-call",M=>{var ne;console.log(" Admin Dashboard - Incoming group call received:",M),U.success(`Incoming group ${M.callType} call from ${((ne=M.initiator)==null?void 0:ne.name)||"Unknown"}`,{duration:5e3,icon:""}),ge(!0),W({callId:M.callId,callType:M.callType,groupId:M.groupId,roomName:M.roomName,group:M.group||{name:M.groupName},initiator:M.initiator}),q(!0)}),r.off("group-call-initiated"),r.on("group-call-initiated",M=>{console.log(" Admin Dashboard - Group call initiated:",M),ge(!1),W({callId:M.callId,callType:M.callType,groupId:M.groupId,roomName:M.roomName,group:M.group}),q(!0)}),r.off("group-call-error"),r.on("group-call-error",M=>{console.error(" Admin Dashboard - Group call error:",M),U.error(M.error||"Group call failed",{duration:4e3})}),()=>{r.off("incoming-call"),r.off("call-initiated"),r.off("call-error"),r.off("incoming-group-call"),r.off("group-call-initiated"),r.off("group-call-error")}},[r]),u.useEffect(()=>{const M=ne=>{if(j){const I=document.querySelector(".notification-panel");I&&!I.contains(ne.target)&&T(!1)}};return j&&document.addEventListener("mousedown",M),()=>{document.removeEventListener("mousedown",M)}},[j]),u.useEffect(()=>{const M=ne=>{if(_){const I=document.querySelector(".account-menu-container");I&&!I.contains(ne.target)&&z(!1)}};return _&&document.addEventListener("mousedown",M),()=>{document.removeEventListener("mousedown",M)}},[_]);const be=async()=>{try{b(!0);const[M,ne]=await Promise.all([s.role==="user"?St.getActiveUsers():St.getUsers(),Gt.getMyGroups()]),I=Array.isArray(M.data)?M.data:[],G=I.filter(Y=>(Y.isActive??!0)===!0).length,K=I.filter(Y=>(Y.isActive??!0)===!1).length;m({totalUsers:I.length,totalGroups:ne.data.length,activeUsers:G,disabledUsers:K})}catch{U.error("Failed to load dashboard data")}finally{b(!1)}},te=M=>{switch(M){case"superadmin":return e.jsx(Ar,{className:"w-5 h-5 text-yellow-600"});case"admin":return e.jsx(ar,{className:"w-5 h-5 text-blue-600"});default:return e.jsx(_t,{className:"w-5 h-5 text-gray-600"})}},le=M=>{switch(M){case"superadmin":return"bg-yellow-100 text-yellow-800";case"admin":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return C?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs(Cr,{to:"/profile",className:"flex items-center space-x-3 hover:opacity-80 transition-opacity",children:[s.profileImage?e.jsx("img",{src:`${we}${s.profileImage}`,alt:"Profile",className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-primary-600 font-medium text-lg",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("p",{className:"text-gray-600",children:["Welcome back, ",s.name,"!"]})]})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[(s.role==="admin"||s.role==="superadmin")&&e.jsx("div",{className:"relative",children:e.jsxs("button",{onClick:()=>T(!j),className:"relative p-2 text-gray-600 hover:text-primary-600 hover:bg-gray-100 rounded-full transition-colors",children:[e.jsx(nn,{className:"w-6 h-6"}),n.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:n.length})]})}),e.jsxs("div",{className:"relative account-menu-container",children:[e.jsx("button",{onClick:()=>z(M=>!M),className:`px-3 py-1 rounded-full text-sm font-medium hover:opacity-90 transition ${le(s.role)}`,children:e.jsxs("div",{className:"flex items-center space-x-1",children:[te(s.role),e.jsx("span",{className:"capitalize",children:s.role})]})}),_&&e.jsx("div",{className:"absolute right-0 mt-2 w-44 bg-white border border-gray-200 rounded-md shadow-lg z-20",children:e.jsxs("button",{onClick:()=>{z(!1),t(),U.success("Logged out successfully")},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[e.jsx(wi,{className:"w-4 h-4"}),e.jsx("span",{children:"Logout"})]})})]})]})]})})}),j&&(s.role==="admin"||s.role==="superadmin")&&e.jsx("div",{className:"notification-panel bg-white border-b shadow-sm",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(nn,{className:"w-5 h-5 text-primary-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Notifications"}),n.length>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:n.length})]}),e.jsx("button",{onClick:()=>T(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ct,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"space-y-3",children:n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(nn,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{children:"No notifications yet"})]}):n.map(M=>e.jsx("div",{className:"border border-orange-200 bg-orange-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(_t,{className:"w-4 h-4 text-orange-600"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-sm font-bold text-orange-700 flex items-center gap-2",children:[e.jsx("span",{children:""}),"Disabled User Login Attempt"]}),e.jsxs("div",{className:"mt-1 text-sm",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:M.userName}),e.jsx("div",{className:"text-gray-600",children:M.userEmail}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Time: ",new Date(M.timestamp).toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>i(M.userId),className:"flex items-center space-x-1 bg-green-600 text-white px-3 py-1.5 rounded-md text-xs font-medium hover:bg-green-700 transition-colors",children:[e.jsx(jn,{className:"w-3 h-3"}),e.jsx("span",{children:"Activate"})]}),e.jsxs("button",{onClick:()=>c(M.id),className:"flex items-center space-x-1 bg-gray-100 text-gray-700 px-3 py-1.5 rounded-md text-xs font-medium hover:bg-gray-200 transition-colors",children:[e.jsx(Ct,{className:"w-3 h-3"}),e.jsx("span",{children:"Close"})]})]})]})},M.id))})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:e.jsx(lt,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.totalUsers})]})]})}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100",children:e.jsx(fs,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"My Groups"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.totalGroups})]})]})}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100",children:e.jsx(lt,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.activeUsers})]})]})}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-red-100",children:e.jsx(lt,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Disabled Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.disabledUsers})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quick Chat"}),e.jsx(fs,{className:"w-5 h-5 text-gray-400"})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Start chatting with other users or join group conversations."}),e.jsxs("a",{href:"/chat",className:"btn-primary inline-flex items-center",children:[e.jsx(fs,{className:"w-4 h-4 mr-2"}),"Open Chat"]})]}),s.role!=="user"&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Management"}),e.jsx(Bn,{className:"w-5 h-5 text-gray-400"})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:s.role==="superadmin"?"Manage admins and view all users in the system.":"Manage users and create groups for team communication."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("a",{href:"/users",className:"btn-secondary w-full inline-flex items-center justify-center",children:[e.jsx(Gn,{className:"w-4 h-4 mr-2"}),s.role==="superadmin"?"Manage Admins":"Manage Users"]}),s.role==="admin"&&e.jsxs("a",{href:"/groups",className:"btn-primary w-full inline-flex items-center justify-center",children:[e.jsx(ir,{className:"w-4 h-4 mr-2"}),"Manage Groups"]}),e.jsxs("a",{href:"/manage-daily-updates",className:"btn-secondary w-full inline-flex items-center justify-center",children:[e.jsx(os,{className:"w-4 h-4 mr-2"}),"Manage Daily Updates"]}),e.jsxs("a",{href:"/manage-tasks",className:"btn-primary w-full inline-flex items-center justify-center",children:[e.jsx(ar,{className:"w-4 h-4 mr-2"}),"Manage Tasks"]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Account Info"}),e.jsx(_t,{className:"w-5 h-5 text-gray-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Name:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:s.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Email:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:s.email})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Role:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${le(s.role)}`,children:s.role})]})]})]}),s.role==="superadmin"&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"System Overview"}),e.jsx(Ar,{className:"w-5 h-5 text-yellow-600"})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You have full access to manage the entire system including admins and all users."}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:" Create and manage admin accounts"}),e.jsx("p",{children:" View all system users"}),e.jsx("p",{children:" Monitor system activity"})]})]})]})]}),R&&f&&e.jsx(e.Fragment,{children:f.callType==="voice"?e.jsx(qn,{user:s,callData:f,isIncoming:g,onCallEnd:()=>{F(!1),O(null),L(!1)},onCallAnswer:()=>{L(!1)},onCallDecline:()=>{F(!1),O(null),L(!1)}}):e.jsx(Vn,{user:s,callData:f,isIncoming:g,onCallEnd:()=>{F(!1),O(null),L(!1)},onCallAnswer:()=>{L(!1)},onCallDecline:()=>{F(!1),O(null),L(!1)}})}),J&&Q&&pe&&Q.callType==="video"&&e.jsx(Yn,{callData:Q,onAccept:()=>{console.log(" Admin Dashboard - Accepting incoming video call"),ge(!1),r&&(Q!=null&&Q.callId)&&r.emit("group-call-join",{callId:Q.callId,groupId:Q.groupId})},onDecline:()=>{q(!1),W(null),ge(!1),r&&(Q!=null&&Q.callId)&&r.emit("group-call-decline",{callId:Q.callId,groupId:Q.groupId})}}),J&&Q&&!pe&&(Q.callType==="video"?e.jsx(Wn,{user:s,callData:Q,onCallEnd:()=>{q(!1),W(null),ge(!1)}}):e.jsx(Hn,{user:s,callData:Q,isIncoming:pe,onCallEnd:()=>{q(!1),W(null),ge(!1)},onCallAnswer:()=>{ge(!1)},onCallDecline:()=>{q(!1),W(null),ge(!1)}}))]})};class Rd{constructor(){this.socket=null,this.isConnected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.reconnectDelay=1e3,this.pingInterval=null,this.lastPingTime=Date.now(),this.currentUserId=null,this.listeners=new Map,this.isConnecting=!1}connect(){if(this.isConnecting)return this.socket;if(this.socket&&this.socket.connected)return this.socket;console.log(" Creating new socket connection..."),this.isConnecting=!0,this.socket&&(this.socket.disconnect(),this.socket=null);const t=localStorage.getItem("token");return this.socket=sr("https://internalchat.pizeonfly.com",{autoConnect:!0,reconnection:!0,reconnectionDelay:this.reconnectDelay,reconnectionAttempts:this.maxReconnectAttempts,maxReconnectionAttempts:this.maxReconnectAttempts,timeout:2e4,forceNew:!0,multiplex:!1,transports:["websocket","polling"],auth:{token:t}}),this.setupEventHandlers(),this.isConnecting=!1,this.socket}setupEventHandlers(){this.socket.on("connect",()=>{this.isConnected=!0,this.reconnectAttempts=0,this.lastPingTime=Date.now(),console.log(" ===== SOCKET CONNECTED ===== "),console.log(" Socket ID:",this.socket.id),console.log(" Connection URL:",this.socket.io.uri),console.log(" Transport:",this.socket.io.engine.transport.name),console.log(" Current User ID:",this.currentUserId),console.log(" Active listeners:",this.listeners.size),console.log("========================================"),this.currentUserId&&this.joinUserRoom(this.currentUserId),this.startPingMonitoring(),this.setupMessageListeners(),this.socket.emit("ping",{timestamp:Date.now()}),console.log(" Enhanced connection alive detection initiated")}),this.socket.on("disconnect",t=>{this.isConnected=!1,console.log(" ===== SOCKET DISCONNECTED ===== "),console.log(" Reason:",t),console.log(" Attempting reconnection..."),console.log("========================================"),this.stopPingMonitoring(),this.attemptReconnection()}),this.socket.on("connect_error",t=>{console.error(" ===== CONNECTION ERROR ===== "),console.error(" Error:",t.message),console.error(" URL:",t.type),console.error(" Status:",t.description),console.error("========================================="),this.attemptReconnection()}),this.socket.on("reconnect",t=>{console.log(" ===== RECONNECTION SUCCESSFUL ===== "),console.log(" Attempts tried:",t),console.log(" New Socket ID:",this.socket.id),console.log("==============================================")}),this.socket.on("ping",t=>{this.lastPingTime=Date.now(),console.log(" Ping received - Connection alive, timestamp:",new Date(this.lastPingTime).toLocaleTimeString())}),this.socket.on("pong",t=>{this.lastPingTime=Date.now(),console.log(" Pong received - Connection confirmed, timestamp:",new Date(this.lastPingTime).toLocaleTimeString())}),this.socket.on("connect_timeout",()=>{console.log(" ===== CONNECTION TIMEOUT ===== "),console.log(" Socket connection timed out"),console.log("======================================")}),this.socket.on("reconnect_error",t=>{console.error(" ===== RECONNECTION ERROR ===== "),console.error("Error:",t.message),console.error("========================================")}),this.socket.on("reconnect_failed",()=>{console.error(" ===== FAILED RECONNECTION ===== "),console.error(" Socket reconnection permanently failed"),console.error(" Attempting force reconnect..."),console.error("===========================================")})}setupMessageListeners(){console.log(" ===== SETTING UP MESSAGE LISTENERS ===== "),console.log(" Total listeners to register:",this.listeners.size);for(const[t,r]of this.listeners)this.socket&&(this.socket.removeAllListeners(t),this.socket.on(t,r),console.log(` Re-registered listener: ${t}`));console.log(" ===== ALL LISTENERS ACTIVE ===== "),console.log(" Socket ready for real-time messaging"),console.log("========================================")}maintainConnection(){console.log(" ===== MAINTAINING PERSISTENT CONNECTION ===== "),!this.isConnected||!this.socket?(console.log(" Socket disconnected, reconnecting..."),this.connect()):(console.log(" Socket is connected, maintaining listeners"),this.setupMessageListeners(),this.socket&&this.isConnected&&(this.socket.emit("ping",{timestamp:Date.now()}),this.lastPingTime=Date.now(),console.log("Keep-alive ping sent - Connection maintained"),setTimeout(()=>{this.socket&&this.isConnected&&this.socket.emit("pong",{timestamp:Date.now()})},100))),console.log("==============================================")}forceChatroomReception(){console.log(" FORCING CHATROOM MESSAGE RECEPTION"),this.socket&&this.isConnected?(this.setupMessageListeners(),console.log(" Chatroom reception listeners reinforced")):(console.log(" Socket not available for chatroom reinforcement"),this.connect()),console.log("=====")}startPingMonitoring(){this.pingInterval&&clearInterval(this.pingInterval),this.pingInterval=setInterval(()=>{const t=Date.now()-this.lastPingTime;if(console.log(` Health check: Time since last ping: ${t}ms`),this.socket&&this.isConnected&&t>45e3&&(console.log(" Proactive ping sent to prevent timeout"),this.socket.emit("ping",{timestamp:Date.now()}),this.lastPingTime=Date.now()),t>18e4){if(console.log(" Extended timeout reached - checking real disconnection"),this.socket&&this.socket.connected&&this.isConnected){console.log(" Socket connection verified alive, resetting timer"),this.lastPingTime=Date.now();return}console.log(" Real disconnection confirmed, force reconnecting..."),this.forceReconnect()}else console.log(` Socket health maintained: ${t}ms response time`)},25e3)}stopPingMonitoring(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null)}attemptReconnection(){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log(" ===== ATTEMPTING RECONNECTION ===== "),console.log(` Attempt: ${this.reconnectAttempts}/${this.maxReconnectAttempts}`),console.log(` Delay: ${this.reconnectDelay*this.reconnectAttempts}ms`),console.log("===================="),setTimeout(()=>{console.log(" Executing reconnection..."),this.connect()},this.reconnectDelay*this.reconnectAttempts)):(console.log(" ===== MAX ATTEMPTS REACHED ===== "),console.log(" Forcing socket reset..."),setTimeout(()=>{this.forceReconnect()},this.reconnectDelay*5),console.log("====================================="))}forceReconnect(){console.log(" Force reconnecting socket..."),this.stopPingMonitoring(),this.reconnectAttempts=0,this.socket&&(this.socket.disconnect(),this.socket=null),setTimeout(()=>{this.connect()},2e3)}disconnect(){this.stopPingMonitoring(),this.listeners.clear(),this.socket&&(this.socket.disconnect(),this.socket=null),this.isConnected=!1,this.currentUserId=null}joinUserRoom(t){this.currentUserId=t,this.socket&&this.isConnected?(this.socket.emit("join",t),console.log(" Joined user room:",t)):console.log(" Waiting to join user room after connection...")}joinGroupRoom(t){this.socket&&this.socket.emit("join-group",t)}leaveGroupRoom(t){this.socket&&this.socket.emit("leave-group",t)}sendPersonalMessage(t){var r;if(console.log(" ===== SENDING PERSONAL MESSAGE ===== "),console.log(" Data:",t),console.log(" Socket available:",!!this.socket),console.log(" Socket connected:",this.isConnected),console.log(" Socket ID:",(r=this.socket)==null?void 0:r.id),!this.socket||!this.isConnected){console.log(" Socket not connected, connecting first..."),this.connect(),setTimeout(()=>{this.socket&&this.isConnected?(console.log(" Retrying message send after connection"),this.socket.emit("send-message",t),console.log(" Personal message retry sent successfully")):console.error(" Still not connected after retry")},2e3);return}this.ensureConnected(),this.socket&&this.isConnected?(this.socket.emit("send-message",t),console.log(" Personal message sent successfully"),setTimeout(()=>{this.socket&&this.isConnected&&this.socket.emit("ping",{timestamp:Date.now()})},100)):console.error(" Socket lost connection before sending message"),console.log("=============================================")}sendGroupMessage(t){var r;if(console.log(" ===== SENDING GROUP MESSAGE ===== "),console.log(" Data:",t),console.log(" Socket available:",!!this.socket),console.log(" Socket connected:",this.isConnected),console.log(" Socket ID:",(r=this.socket)==null?void 0:r.id),!this.socket||!this.isConnected){console.log(" Socket not connected, connecting first..."),this.connect(),setTimeout(()=>{this.socket&&this.isConnected?(console.log(" Retrying group message send after connection"),this.socket.emit("send-group-message",t),console.log(" Group message retry sent successfully")):console.error(" Still not connected after retry")},2e3);return}this.socket.emit("send-group-message",t),console.log(" Group message sent successfully"),console.log("============================================")}onReceiveMessage(t){console.log(" Registering onReceiveMessage listener"),this.registerListener("receive-message",r=>{console.log(" Received message:",r);const n={...r,_isExternalMessage:!0,_timestamp:new Date().toISOString()};t(n)}),setTimeout(()=>{this.socket&&this.isConnected&&(this.socket.off("receive-message"),this.socket.on("receive-message",r=>{console.log(" Maintained receive-message listener:",r);const n={...r,_isExternalMessage:!0,_timestamp:new Date().toISOString()};t(n)}),console.log(" Listener re-registered for chatroom persistence"))},1e3)}onReceiveGroupMessage(t){console.log(" Registering onReceiveGroupMessage listener"),this.registerListener("receive-group-message",r=>{console.log(" Received group message:",r);const n={...r,_isExternalMessage:!0,_timestamp:new Date().toISOString()};t(n)})}onMessageSent(t){console.log(" Registering onMessageSent listener"),this.registerListener("message-sent",r=>{console.log(" Message sent confirmation:",r);const n={...r,_isOurMessage:!0,_isConfirmation:!0,_timestamp:new Date().toISOString()};t(n)})}registerListener(t,r){this.listeners.set(t,r),console.log(` Stored listener for event: ${t}`),this.socket&&this.isConnected?(this.socket.off(t),this.socket.on(t,r),console.log(` Listener immediately registered for event: ${t}`)):console.log(` Listener queued for event: ${t} (waiting for connection)`)}onGroupMessageSent(t){this.registerListener("group-message-sent",t)}onTyping(t){this.registerListener("user-typing",t)}sendTyping(t){this.socket&&this.isConnected&&this.socket.emit("typing",t)}onError(t){this.registerListener("error",t)}onAvatarUpdate(t){this.registerListener("avatar-updated",t)}onUserProfileUpdate(t){this.registerListener("user-profile-updated",t)}removeAllListeners(){this.listeners.clear(),this.socket&&(this.socket.removeAllListeners(),this.socket.on("connect",()=>{this.isConnected=!0,this.reconnectAttempts=0,this.lastPingTime=Date.now(),this.currentUserId&&this.joinUserRoom(this.currentUserId),this.startPingMonitoring(),this.setupMessageListeners()}))}ensureConnected(){return!this.socket||!this.isConnected?(console.log(" Ensuring socket connection..."),this.connect()):!0}getConnectionStatus(){var t;return{isConnected:this.isConnected,socketId:(t=this.socket)==null?void 0:t.id,lastPing:new Date(this.lastPingTime).toLocaleString(),listenersCount:this.listeners.size}}logConnectionStatus(){var t,r,n,i,c,a,m;console.log(" ===== SOCKET STATUS REPORT ===== "),console.log(" Is Connected:",this.isConnected?" YES":" NO"),console.log(" Socket ID:",((t=this.socket)==null?void 0:t.id)||"N/A"),console.log(" Connection URL:",((n=(r=this.socket)==null?void 0:r.io)==null?void 0:n.uri)||"N/A"),console.log(" Transport:",((m=(a=(c=(i=this.socket)==null?void 0:i.io)==null?void 0:c.engine)==null?void 0:a.transport)==null?void 0:m.name)||"N/A"),console.log(" Current User ID:",this.currentUserId||"Not set"),console.log(" Active Listeners:",this.listeners.size),console.log(" Reconnect Attempts:",this.reconnectAttempts),console.log(" Last Ping:",new Date(this.lastPingTime).toLocaleTimeString()),console.log(" Listeners registered:",Array.from(this.listeners.keys()).join(", ")||"None"),console.log("========================================")}testConnection(){console.log(" ===== TESTING SOCKET CONNECTION ===== "),this.logConnectionStatus(),this.socket&&(console.log(" Emitting test ping..."),this.socket.emit("ping")),console.log("============================================")}forceConnectionTest(){console.log(" ===== MANUAL CONNECTION FORCE TEST ===== "),this.connect(),setTimeout(()=>{this.testConnection()},3e3),console.log("=============================================")}reset(){console.log(" Resetting socket service..."),this.disconnect(),this.currentUserId=null,this.listeners.clear(),this.reconnectAttempts=0,this.isConnecting=!1,clearTimeout(this.reconnectTimeout)}}const mt=new Rd,jo=()=>{const{user:s,logout:t}=It(),r=ps(),{socket:n,isConnected:i,sendMessage:c,joinGroup:a,leaveGroup:m,onReceiveMessage:C,onReceiveGroupMessage:b,onMessageSent:j,getConnectionStatus:T,isUserOnline:_,getUserStatus:z}=Bs(),[R,F]=u.useState([]),[f,O]=u.useState([]),[g,L]=u.useState(null),[J,q]=u.useState([]),[Q,W]=u.useState(""),[pe,ge]=u.useState(""),[be,te]=u.useState(!0),[le,M]=u.useState({}),[ne,I]=u.useState({}),[G,K]=u.useState("all"),[Y,k]=u.useState(!1),[w,A]=u.useState(!1),Z=50,[S,E]=u.useState(null),[H,ee]=u.useState(null),[V,ue]=u.useState(!1),[je,Te]=u.useState({}),[$e,ct]=u.useState(()=>{try{const o=sessionStorage.getItem("downloadedMessages");return o?JSON.parse(o):{}}catch{return{}}}),[Ze,st]=u.useState(!1),[ft,ze]=u.useState(null),[it,de]=u.useState(!1),[Ce,Ge]=u.useState(null),[qe,Qe]=u.useState(null),[Xe,Fe]=u.useState(null),[Ie,We]=u.useState(null),[Ye,pt]=u.useState(1),[ae,x]=u.useState({x:0,y:0}),[oe,xe]=u.useState(!1),[re,Ee]=u.useState(!1),Pe=()=>{pt(o=>Math.min(o*1.25,4))},dt=()=>{pt(o=>Math.max(o/1.25,.5))},xt=()=>{pt(1),x({x:0,y:0})},Rt=o=>{o.preventDefault(),xe(!0),x({x:o.clientX-ae.x,y:o.clientY-ae.y})},Cs=o=>{oe&&(o.preventDefault(),x({x:o.clientX-ae.x,y:o.clientY-ae.y}))},ls=()=>{xe(!1)},Is=o=>{Qe(o),pt(1),x({x:0,y:0})},[cs,rt]=u.useState(!1),[Oe,p]=u.useState(null),[X,B]=u.useState(!1),$=o=>o&&(/^https?:\/\//i.test(o)?o:`${we}${o}`),ce=o=>{if(!o)return"";const d=new Date(o),h=new Date,N=new Date(h.getFullYear(),h.getMonth(),h.getDate()),v=new Date(N);v.setDate(v.getDate()-1);const y=new Date(d.getFullYear(),d.getMonth(),d.getDate());return y.getTime()===N.getTime()?d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):y.getTime()===v.getTime()?"Yesterday":Math.floor((N-y)/(1e3*60*60*24))<7?d.toLocaleDateString([],{weekday:"short"}):d.toLocaleDateString([],{day:"numeric",month:"numeric",year:d.getFullYear()!==h.getFullYear()?"numeric":void 0})},Se=o=>{if(!o)return"";const d=new Date(o),h=new Date,N=new Date(h.getFullYear(),h.getMonth(),h.getDate()),v=new Date(N);v.setDate(v.getDate()-1);const y=new Date(d.getFullYear(),d.getMonth(),d.getDate());return y.getTime()===N.getTime()?"Today":y.getTime()===v.getTime()?"Yesterday":Math.floor((N-y)/(1e3*60*60*24))<7?d.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric"}):d.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric",year:d.getFullYear()!==h.getFullYear()?"numeric":void 0})},Me=o=>{if(!o)return"Last seen recently";const d=new Date,h=new Date(o),N=d-h,v=Math.floor(N/(1e3*60)),y=Math.floor(N/(1e3*60*60)),P=Math.floor(N/(1e3*60*60*24));return v<1?"Last seen just now":v<60?`Last seen ${v} minute${v===1?"":"s"} ago`:y<24?`Last seen ${y} hour${y===1?"":"s"} ago`:P===1?"Last seen yesterday":P<7?`Last seen ${P} day${P===1?"":"s"} ago`:`Last seen ${h.toLocaleDateString([],{month:"short",day:"numeric"})}`},[me,Ne]=u.useState(null),[ut,bt]=u.useState(!1),[bs,Ts]=u.useState(null),[Ht,Wt]=u.useState(null),[ds,ts]=u.useState(""),[Tt,Ut]=u.useState(null),at=o=>((o==null?void 0:o.id)||(o==null?void 0:o._id)||(o==null?void 0:o.messageId)||"").toString(),Je=o=>{me&&clearTimeout(me);const d=setTimeout(()=>{Ts(o),bt(!0)},700);Ne(d)},tt=()=>{me&&(clearTimeout(me),Ne(null))},yt=(o,d)=>{d.stopPropagation(),Ut(Tt===o?null:o)},Lt=(o,d)=>{switch(Ts(d),Ut(null),o){case"copy":zt(d);break;case"edit":Hr(d);break;case"forward":Vr(d);break}},zt=async o=>{try{const d=(o==null?void 0:o.messageType)==="text"?(o==null?void 0:o.message)||"":$(o==null?void 0:o.fileUrl)||(o==null?void 0:o.fileName)||"";d&&(await navigator.clipboard.writeText(d),U.success("Copied to clipboard"))}catch(d){console.error("Copy failed:",d),U.error("Failed to copy")}},Vr=o=>{try{sessionStorage.setItem("forwardMessage",JSON.stringify({id:o.id||o._id,message:o.message,messageType:o.messageType,fileUrl:o.fileUrl,fileName:o.fileName,fileSize:o.fileSize,fileType:o.fileType})),U.success("Message ready to forward"),window.location.href="/forward"}catch(d){console.error("Forward setup failed:",d),U.error("Failed to prepare message for forwarding")}},Hr=o=>{var d,h,N,v;if(o&&o.messageType==="text"){const y=((d=o.sender)==null?void 0:d.id)||((h=o.sender)==null?void 0:h._id)||o.sender;y===s.id||y===s._id||y===((N=s.id)==null?void 0:N.toString())||y===((v=s._id)==null?void 0:v.toString())?(Wt(o),ts(o.message||"")):U.error("You can only edit your own messages")}},mr=async()=>{if(!(!Ht||!ds.trim()))try{q(o=>o.map(d=>at(d)===at(Ht)?{...d,message:ds.trim(),isEdited:!0,editedAt:new Date().toISOString()}:d)),await et.editMessage(Ht.id||Ht._id,ds.trim()),Wt(null),ts("")}catch(o){console.error("Failed to edit message:",o),U.error("Failed to edit message")}},qs=()=>{Wt(null),ts("")},Vs=u.useRef(null),Es=u.useRef(!0),Nt=u.useRef(null),wt=u.useRef(0),Yt=u.useRef(null),Jt=u.useRef(!1);u.useEffect(()=>((async()=>{try{console.log(" Loading chat state from database for UserDashboard...");const d=await et.getChatState(),{personalChats:h,groupChats:N}=d.data,v={},y={};h.forEach(P=>{var he,ye,ke;P.unreadCount>0&&(v[P.chatId]=P.unreadCount),P.lastMessage&&P.lastMessage.message&&(y[P.chatId]={id:P.lastMessage._id||P.lastMessage.id,message:P.lastMessage.message,senderName:P.lastMessage.senderName||((he=P.lastMessage.sender)==null?void 0:he.name)||"User",senderId:P.lastMessage.senderId||((ye=P.lastMessage.sender)==null?void 0:ye._id)||((ke=P.lastMessage.sender)==null?void 0:ke.id),timestamp:P.lastMessage.createdAt||P.lastMessage.timestamp})}),N.forEach(P=>{var he,ye,ke;P.unreadCount>0&&(v[P.chatId]=P.unreadCount),P.lastMessage&&P.lastMessage.message&&(y[P.chatId]={id:P.lastMessage._id||P.lastMessage.id,message:P.lastMessage.message,senderName:P.lastMessage.senderName||((he=P.lastMessage.sender)==null?void 0:he.name)||"User",senderId:P.lastMessage.senderId||((ye=P.lastMessage.sender)==null?void 0:ye._id)||((ke=P.lastMessage.sender)==null?void 0:ke.id),timestamp:P.lastMessage.createdAt||P.lastMessage.timestamp})}),M(v),I(y),console.log(" UserDashboard chat state loaded from database:",{unreadCounts:v,lastMessages:Object.keys(y).length})}catch(d){console.error("Error loading chat state from database:",d)}})(),Wr(),Ws(),()=>{}),[]),u.useEffect(()=>{if(n)return console.log(" Setting up PERSISTENT call listeners for UserDashboard..."),n.off("incoming-call"),n.on("incoming-call",o=>{var d;console.log(" UserDashboard - Incoming call received:",o),U.success(`Incoming ${o.callType} call from ${((d=o.caller)==null?void 0:d.name)||"Unknown"}`,{duration:5e3,icon:""}),de(!0),ze({callId:o.callId,callType:o.callType,caller:o.caller}),st(!0)}),n.off("call-initiated"),n.on("call-initiated",o=>{console.log(" UserDashboard - Call initiated:",o),de(!1),ze({callId:o.callId,callType:o.callType,otherUser:o.receiver}),st(!0)}),n.off("call-error"),n.on("call-error",o=>{console.error(" UserDashboard - Call error:",o),U.error(o.error||"Call failed",{duration:4e3})}),n.off("incoming-group-call"),n.on("incoming-group-call",o=>{var d,h;console.log(" ========================================"),console.log(" UserDashboard - INCOMING GROUP CALL RECEIVED!"),console.log(" Call ID:",o.callId),console.log(" Call Type:",o.callType),console.log(" Room Name:",o.roomName),console.log(" Group:",o.groupName),console.log(" Initiator:",(d=o.initiator)==null?void 0:d.name),console.log(" ========================================"),U.success(`Incoming group ${o.callType} call from ${((h=o.initiator)==null?void 0:h.name)||"Unknown"}`,{duration:5e3,icon:""}),B(!0),p({callId:o.callId,callType:o.callType,groupId:o.groupId,roomName:o.roomName,group:o.group||{name:o.groupName},initiator:o.initiator}),rt(!0)}),n.off("group-call-initiated"),n.on("group-call-initiated",o=>{console.log(" ========================================"),console.log(" UserDashboard - GROUP CALL INITIATED!"),console.log(" Call ID:",o.callId),console.log(" Room Name:",o.roomName),console.log(" Call Type:",o.callType),console.log(" ========================================"),B(!1),p({callId:o.callId,callType:o.callType,groupId:o.groupId,roomName:o.roomName,group:o.group}),rt(!0)}),n.off("group-call-error"),n.on("group-call-error",o=>{console.error(" UserDashboard - Group call error:",o),U.error(o.error||"Group call failed",{duration:4e3})}),()=>{console.log(" Cleaning up PERSISTENT call listeners..."),n.off("incoming-call"),n.off("call-initiated"),n.off("call-error"),n.off("incoming-group-call"),n.off("group-call-initiated"),n.off("group-call-error")}},[n]),u.useEffect(()=>(g&&(q([]),k(!1),A(!1),Es.current=!0,ys(),Ws(),g.type==="group"&&(a(g.id),console.log(" UserDashboard joined group room for:",g.name))),()=>{mt.removeAllListeners(),g&&g.type==="group"&&(m(g.id),console.log(" UserDashboard left group room for:",g.name)),mt.healthCheckInterval&&(clearInterval(mt.healthCheckInterval),delete mt.healthCheckInterval)}),[g]),u.useEffect(()=>{if(J.length>0){if(Es.current)setTimeout(()=>{Ms(!0),Es.current=!1},100);else if(Jt.current)setTimeout(()=>{Ms(!1),Jt.current=!1},100);else if(Nt.current){const o=Nt.current,d=o.scrollHeight,h=o.scrollTop,N=o.clientHeight;d-h-N<200&&Ms(!1)}}},[J]);const Hs=()=>{!Nt.current||w||!Y||!g||(Yt.current&&clearTimeout(Yt.current),Yt.current=setTimeout(()=>{var h,N;if(!Nt.current||w||!Y)return;const o=Nt.current;if(o.scrollTop<50&&J.length>0){wt.current=o.scrollHeight;const v=((h=J[0])==null?void 0:h._id)||((N=J[0])==null?void 0:N.id);v&&ys(v)}},150))};u.useEffect(()=>{const o=Nt.current;if(!(!o||!g))return o.addEventListener("scroll",Hs),()=>{o.removeEventListener("scroll",Hs),Yt.current&&clearTimeout(Yt.current)}},[J,w,Y,g]);const ss=async()=>{try{console.log(" Refreshing UserDashboard chat state from database...");const o=await et.getChatState(),{personalChats:d,groupChats:h}=o.data,N={},v={};d.forEach(y=>{var P,he,ye;y.unreadCount>0&&(N[y.chatId]=y.unreadCount),y.lastMessage&&y.lastMessage.message&&(v[y.chatId]={id:y.lastMessage._id||y.lastMessage.id,message:y.lastMessage.message,senderName:y.lastMessage.senderName||((P=y.lastMessage.sender)==null?void 0:P.name)||"User",senderId:y.lastMessage.senderId||((he=y.lastMessage.sender)==null?void 0:he._id)||((ye=y.lastMessage.sender)==null?void 0:ye.id),timestamp:y.lastMessage.createdAt||y.lastMessage.timestamp})}),h.forEach(y=>{var P,he,ye;y.unreadCount>0&&(N[y.chatId]=y.unreadCount),y.lastMessage&&y.lastMessage.message&&(v[y.chatId]={id:y.lastMessage._id||y.lastMessage.id,message:y.lastMessage.message,senderName:y.lastMessage.senderName||((P=y.lastMessage.sender)==null?void 0:P.name)||"User",senderId:y.lastMessage.senderId||((he=y.lastMessage.sender)==null?void 0:he._id)||((ye=y.lastMessage.sender)==null?void 0:ye.id),timestamp:y.lastMessage.createdAt||y.lastMessage.timestamp})}),M(N),I(v),console.log(" UserDashboard chat state refreshed from database")}catch(o){console.error("Error refreshing UserDashboard chat state:",o)}};u.useEffect(()=>{window.testSocketDashboard=()=>{mt.testConnection()},window.checkSocketDashboard=()=>{mt.logConnectionStatus()},window.forceSocketConnectDashboard=()=>{mt.forceConnectionTest()},console.log(" UserDashboard Socket debugging methods available:"),console.log(" - testSocketDashboard() - Test socket connection status"),console.log(" - checkSocketDashboard() - Show current socket status"),console.log(" - forceSocketConnectDashboard() - Force reconnection")},[]);const Wr=async()=>{try{te(!0);const[o,d]=await Promise.all([St.getActiveUsers(),Gt.getMyGroups()]);console.log(" UserDashboard Data Loaded:"),console.log(" Users:",o.data.length),console.log(" Groups:",d.data.length),console.log(" Group Details:",d.data.map(h=>{var N;return{id:h.id,name:h.name,members:((N=h.members)==null?void 0:N.length)||0,avatar:h.avatar?"Has Avatar":"No Avatar"}})),F(o.data.filter(h=>h.id!==s.id)),O(d.data)}catch(o){console.error("Error fetching dashboard data:",o),U.error("Failed to load dashboard data")}finally{te(!1)}},Ws=()=>{console.log(" Setting up enhanced UserDashboard socket listeners with Context API...");const o=T();console.log(" Current socket status:",o),C(d=>{var ye,ke;console.log(" USERDASHBOARD CONTEXT - received message:",d);const h=typeof d.sender=="object"?d.sender.id||d.sender._id:d.sender,N=typeof d.receiver=="object"?d.receiver.id||d.receiver._id:d.receiver,v=d.id||d._id||d.messageId,y=d.message||d.content,P=h===s.id||h===s._id||h===((ye=s.id)==null?void 0:ye.toString())||h===((ke=s._id)==null?void 0:ke.toString());if(d._isConfirmation||d.isConfirmMessage||d.isMessageSentConfirmation){console.log(" Skipping confirmation message");return}const he=Yr(d,g,s);if(console.log(" ENHANCED USERDASHBOARD MESSAGE FILTERING:",{senderId:h,receiverId:N,messageId:v,messageText:y,selectedChatId:g==null?void 0:g.id,selectedChatType:g==null?void 0:g.type,currentUserId:s.id,isCurrentUserSender:P,isForCurrentChat:he,messageData:d}),he&&g)console.log(" Processing message for current active dashboard chat"),P?console.log(" Message from current user - handled by optimistic updates"):(console.log(" Adding external message to current dashboard chat immediately"),q(Ue=>{if(Ue.some(ie=>{var kt,Ft;const Ae=ie.id||ie._id||ie.messageId,_e=ie.message||ie.content,Ve=((kt=ie.sender)==null?void 0:kt.id)||((Ft=ie.sender)==null?void 0:Ft._id)||ie.sender,Be=ie.createdAt||ie.timestamp,Ke=d.createdAt||d.timestamp;return!!(Ae===v&&v||_e===y&&String(Ve)===String(h)&&Ke&&Be&&Math.abs(new Date(Ke)-new Date(Be))<5e3||ie.isOptimistic&&_e===y&&String(Ve)===String(h)&&Ke&&Be&&Math.abs(new Date(Ke)-new Date(Be))<1e4)}))return console.log(" UserDashboard enhanced detection: Message already exists - confirmed duplicate",{messageId:v,messageText:y==null?void 0:y.substring(0,20),senderId:h,isDuplicate:!0}),Ue;console.log(" REAL-TIME USERDASHBOARD: NEW message confirmed - Adding to active chat",{messageId:v,messageText:y==null?void 0:y.substring(0,20),senderId:h,isDuplicate:!1});const se=Ys(d,h);return Et(g.id,d,h),setTimeout(()=>{ss()},100),[...Ue,se]}));else if(y&&!P){const Ue=h||d.sender;Ue&&Ue!==s.id&&(console.log(" Incrementing unread count for dashboard chat:",Ue),M(Le=>({...Le,[Ue]:(Le[Ue]||0)+1})),Et(Ue,d,h),setTimeout(()=>{ss()},100))}}),j(d=>{console.log(" Dashboard message sent confirmation received:",d),d&&d.id&&q(h=>{const N=h.filter(y=>!y.isOptimistic),v={id:d.id,message:d.message,messageType:d.messageType||"text",fileUrl:d.fileUrl,fileName:d.fileName,fileSize:d.fileSize,fileType:d.fileType,sender:d.sender,createdAt:d.createdAt||d.timestamp,timestamp:d.timestamp,isOptimistic:!1};return[...N,v]})}),b(d=>{var ye,ke,Ue,Le;console.log(" USERDASHBOARD GROUP MESSAGE CONTEXT - received message:",d);const h=typeof d.sender=="object"?d.sender.id||d.sender._id:d.sender,N=d.groupId||((ye=d.group)==null?void 0:ye.id)||((ke=d.group)==null?void 0:ke._id),v=d.id||d._id||d.messageId,y=d.message||d.content,P=h===s.id||h===s._id||h===((Ue=s.id)==null?void 0:Ue.toString())||h===((Le=s._id)==null?void 0:Le.toString());if(d._isConfirmation||d.isConfirmMessage||d.isMessageSentConfirmation){console.log(" Skipping confirmation message");return}const he=g&&g.type==="group"&&(N===g.id||String(N)===String(g.id));if(console.log(" USERDASHBOARD GROUP MESSAGE FILTERING:",{senderId:h,groupId:N,messageId:v,messageText:y,selectedChatId:g==null?void 0:g.id,selectedChatType:g==null?void 0:g.type,currentUserId:s.id,isCurrentUserSender:P,isForCurrentGroup:he,messageData:d}),he&&g)console.log(" Processing group message for current UserDashboard group"),P?console.log(" Group message from current user - handled by optimistic updates"):(console.log(" Adding external group message to current dashboard chat immediately"),q(se=>{if(se.some(_e=>{var vs,hr;const Ve=_e.id||_e._id||_e.messageId,Be=_e.message||_e.content,Ke=((vs=_e.sender)==null?void 0:vs.id)||((hr=_e.sender)==null?void 0:hr._id)||_e.sender,kt=_e.createdAt||_e.timestamp,Ft=d.createdAt||d.timestamp;return!!(Ve===v&&v||Be===y&&String(Ke)===String(h)&&Ft&&kt&&Math.abs(new Date(Ft)-new Date(kt))<5e3||_e.isOptimistic&&Be===y&&String(Ke)===String(h)&&Ft&&kt&&Math.abs(new Date(Ft)-new Date(kt))<1e4)}))return console.log(" USERDASHBOARD GROUP duplicate detection: Message already exists",{messageId:v,messageText:y==null?void 0:y.substring(0,20),senderId:h==null?void 0:h.toString(),isDuplicate:!0}),se;console.log(" USERDASHBOARD GROUP REAL-TIME: NEW message confirmed - Adding to active group",{messageId:v,messageText:y==null?void 0:y.substring(0,20),senderId:h,groupId:N});const Ae=Ys(d,h);return Et(g.id,d,h),setTimeout(()=>{ss()},100),[...se,Ae]}));else if(y&&!P){const se=N||d.groupId;se&&(!g||g.type!=="group"||String(se)!==String(g.id))&&(console.log(" UserDashboard incrementing unread count for group:",se),M(Ae=>({...Ae,[se]:(Ae[se]||0)+1})),Et(se,d,h),setTimeout(()=>{ss()},100))}}),n&&(n.off("avatar-updated"),n.on("avatar-updated",d=>{var N,v;console.log(" Profile updated received:",d);const h=((N=d.userId)==null?void 0:N.toString())||d.userId;F(y=>y.map(P=>{var he;return((he=P.id||P._id)==null?void 0:he.toString())===h?{...P,profileImage:d.profileImage,name:d.name}:P})),g&&g.type==="personal"&&((v=g.id||g._id)==null?void 0:v.toString())===h&&L(y=>({...y,profileImage:d.profileImage,name:d.name})),q(y=>y.map(P=>{var ye,ke,Ue;return((Ue=((ye=P.sender)==null?void 0:ye.id)||((ke=P.sender)==null?void 0:ke._id)||P.sender)==null?void 0:Ue.toString())===h?{...P,sender:{...typeof P.sender=="object"?P.sender:{id:P.sender},profileImage:d.profileImage,name:d.name}}:P}))}),n.off("messages-seen"),n.on("messages-seen",d=>{console.log(" Messages seen by user:",d.readBy),g&&g.type==="personal"&&d.chatId===g.id&&q(h=>h.map(N=>{var y,P;return(((y=N.sender)==null?void 0:y.id)||((P=N.sender)==null?void 0:P._id)||N.sender)===s.id?{...N,isRead:!0,readBy:[{user:d.readBy,readAt:d.timestamp}]}:N}))}))},Yr=(o,d,h)=>{var P,he,ye,ke;if(!d)return!1;const N=((P=o.sender)==null?void 0:P.id)||((he=o.sender)==null?void 0:he._id)||o.sender,v=((ye=o.receiver)==null?void 0:ye.id)||((ke=o.receiver)==null?void 0:ke._id)||o.receiver,y=o.chatId||o.chatRoom;return d.type==="personal"&&d.id&&(N===d.id&&v===h.id||N===h.id&&v===d.id||String(N)===String(d.id)||String(v)===String(d.id))?!0:d.type==="group"?y===d.id||o.groupId===d.id:!1},Ys=(o,d)=>{var h,N;return{id:o.id||o._id||o.messageId,message:o.message||o.content,messageType:o.messageType||"text",fileUrl:o.fileUrl,fileName:o.fileName,fileSize:o.fileSize,fileType:o.fileType,sender:typeof o.sender=="object"?o.sender:{id:d,name:o.senderName||((h=o.sender)==null?void 0:h.name)||"User",profileImage:o.senderProfileImage||((N=o.sender)==null?void 0:N.profileImage)},createdAt:o.createdAt||o.timestamp||new Date().toISOString(),timestamp:o.timestamp||o.createdAt,isFromOtherUser:!(d===s.id||d===s._id)}},Et=(o,d,h)=>{const N=h===s.id||h===s._id;I(v=>{var y;return{...v,[o]:{id:d.id||d._id||d.messageId,message:d.message||d.content,senderName:N?"You":d.senderName||((y=d.sender)==null?void 0:y.name)||"User",senderId:h,timestamp:d.createdAt||d.timestamp||new Date().toISOString()}}})},ys=async(o=null)=>{var d;try{o&&A(!0);let h;const N={limit:Z};if(o&&(N.before=o),g.type==="personal"){if(!g.id){console.error("User ID is undefined for personal chat");return}h=await et.getPersonalMessages(g.id,N)}else{if(!g.id){console.error("Group ID is undefined for group chat");return}h=await et.getGroupMessages(g.id,N)}let v,y;if(h.data&&typeof h.data=="object"?Array.isArray(h.data.messages)?(v=h.data.messages,y=h.data.hasMore||!1):Array.isArray(h.data)?(v=h.data,y=h.data.length>=Z):(v=[],y=!1):(v=[],y=!1),o)q(P=>{const he=new Set(P.map(ke=>ke._id||ke.id));return[...v.filter(ke=>{const Ue=ke._id||ke.id;return!he.has(Ue)}),...P]}),k(y),A(!1),setTimeout(()=>{if(Nt.current&&wt.current>0){const he=Nt.current.scrollHeight-wt.current;Nt.current.scrollTop=he+100}},0);else if(q(v||[]),k(y),v&&v.length>0){const P=v[v.length-1];Et(g.id,P,((d=P.sender)==null?void 0:d.id)||P.sender)}}catch(h){console.error("Error fetching messages:",h),U.error("Failed to load messages"),q([]),o&&A(!1)}},ws=o=>{const d=document.createElement("input");d.type="file",d.style.display="none",o==="image"?d.accept="image/*":o==="video"?d.accept="video/*":o==="document"&&(d.accept=".pdf,.doc,.docx,.txt,.csv,.xls,.xlsx,.ppt,.pptx,.xlsm,.xlsx,.zip,.rar,.7z,.tar,.gz,.bz2,.xz,.iso,.dmg,.img,.bin,.exe,.msi,.dmg,.iso,.tar,.gz,.bz2,.xz,.img,.bin,.exe,.msi"),d.onchange=h=>{const N=h.target.files[0];if(N){if(E(N),N.type.startsWith("image/")){const v=new FileReader;v.onload=y=>ee(y.target.result),v.readAsDataURL(N)}else ee(null);ue(!1)}},document.body.appendChild(d),d.click(),document.body.removeChild(d)},Js=()=>{E(null),ee(null)},rs=async(o,d,h)=>{try{Te(se=>({...se,[h]:{progress:0,downloading:!0}}));const N=await fetch($(o)),v=N.headers.get("content-length"),y=parseInt(v,10);if(!N.ok)throw new Error("Download failed");const P=N.body.getReader(),he=[];let ye=0;for(;;){const{done:se,value:ie}=await P.read();if(se)break;he.push(ie),ye+=ie.length;const Ae=y?Math.round(ye/y*100):0;Te(_e=>({..._e,[h]:{progress:Ae,downloading:!0}}))}const ke=new Blob(he),Ue=window.URL.createObjectURL(ke),Le=document.createElement("a");Le.href=Ue,Le.download=d,document.body.appendChild(Le),Le.click(),document.body.removeChild(Le),window.URL.revokeObjectURL(Ue),Te(se=>({...se,[h]:{progress:100,downloading:!1}})),ct(se=>{const ie={...se,[h]:!0};try{sessionStorage.setItem("downloadedMessages",JSON.stringify(ie))}catch{}return ie}),setTimeout(()=>{Te(se=>{const ie={...se};return delete ie[h],ie})},2e3)}catch(N){console.error("Download failed:",N),Te(v=>({...v,[h]:{progress:0,downloading:!1,error:!0}}))}};u.useEffect(()=>{const o=d=>{V&&!d.target.closest(".file-options-container")&&ue(!1),Tt&&!d.target.closest(".message-dropdown-container")&&Ut(null)};return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[V,Tt]);const Jr=async o=>{if(o.preventDefault(),!Q.trim()&&!S||!g)return;if(g.type==="personal"&&g.isActive===!1){U.error("Cannot send messages to disabled users");return}const d=Q.trim();W("");try{let h={sender:s.id,message:d,messageType:"text"};if(g.type==="personal"?h.receiver=g.id:h.group=g.id,S){const N=new FormData;g.type==="personal"?N.append("receiver",g.id):N.append("group",g.id),N.append("message",d),N.append("file",S);let v="file";S.type.startsWith("image/")?v="image":S.type.startsWith("video/")&&(v="video");const y={id:Date.now(),message:d||S.name,messageType:v,fileUrl:URL.createObjectURL(S),fileName:S.name,fileSize:S.size,fileType:S.type,sender:{id:s.id,name:s.name,profileImage:s.profileImage},createdAt:new Date().toISOString(),timestamp:new Date().toISOString(),isOptimistic:!0};q(P=>[...P,y]),Jt.current=!0,Et(g.id,{id:y.id,message:y.message,createdAt:y.createdAt},s.id),g.type==="personal"?await et.sendPersonalMessage(N):await et.sendGroupMessage(N),Js()}else{const N={id:Date.now(),message:d,messageType:"text",sender:{id:s.id,name:s.name,profileImage:s.profileImage},createdAt:new Date().toISOString(),timestamp:new Date().toISOString(),isOptimistic:!0};if(q(v=>[...v,N]),Jt.current=!0,Et(g.id,{id:N.id,message:N.message,createdAt:N.createdAt},s.id),g.type==="personal")try{await c(g.id,d,"text",!1),console.log(" Dashboard message sent via context socket")}catch(v){console.warn("Context socket failed, trying API:",v),await et.sendPersonalMessage(h)}else try{await c(g.id,d,"text",!0),console.log(" Dashboard group message sent via context socket")}catch(v){console.warn("Context socket failed, trying API:",v),await et.sendGroupMessage({sender:s.id,group:g.id,message:d,timestamp:new Date().toISOString()})}}console.log(" Dashboard message sent successfully")}catch(h){console.error(" Failed to send dashboard message:",h),U.error("Failed to send message"),q(N=>N.filter(v=>!v.isOptimistic))}},Ms=(o=!1)=>{var d;(d=Vs.current)==null||d.scrollIntoView({behavior:o?"instant":"smooth"})},As=()=>{t(),U.success("Logged out successfully")},Ks=[...R.map(o=>({id:o.id,name:o.name,email:o.email,type:"personal",avatar:o.name.charAt(0).toUpperCase(),profileImage:o.profileImage,lastMessage:ne[o.id]||null,isActive:o.isActive})),...f.map(o=>{var d;return{id:o.id,name:o.name,email:`${((d=o.members)==null?void 0:d.length)||0} members`,type:"group",avatar:o.avatar?`${we}${o.avatar}`:"G",profileImage:o.avatar,lastMessage:ne[o.id]||null}})].sort((o,d)=>{var v,y;const h=(v=o.lastMessage)!=null&&v.timestamp?new Date(o.lastMessage.timestamp).getTime():0;return((y=d.lastMessage)!=null&&y.timestamp?new Date(d.lastMessage.timestamp).getTime():0)-h}),l=(()=>{let o=Ks;switch(G){case"unread":o=Ks.filter(d=>le[d.id]>0);break;case"groups":o=Ks.filter(d=>d.type==="group");break;case"all":default:o=Ks;break}return o.filter(d=>d.name.toLowerCase().includes(pe.toLowerCase())||d.email.toLowerCase().includes(pe.toLowerCase()))})();return be?e.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"})}):e.jsxs("div",{className:"h-screen bg-gray-50 flex",children:[e.jsxs("div",{className:"w-full h-screen flex bg-white shadow-lg",children:[e.jsxs("div",{className:"w-1/3 min-w-[300px] max-w-[400px] bg-white border-r border-gray-200 flex flex-col",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"User Dashboard"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>Ee(!re),className:"text-gray-500 hover:text-gray-700",title:"Settings",children:e.jsx(Bn,{className:"w-5 h-5"})}),re&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>Ee(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-20",children:[e.jsxs("button",{onClick:()=>{r("/daily-update"),Ee(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-2",children:[e.jsx($t,{className:"w-4 h-4"}),"Daily Update"]}),e.jsxs("button",{onClick:()=>{r("/tasks"),Ee(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-2",children:[e.jsx(fs,{className:"w-4 h-4"}),"Task"]}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsxs(Cr,{to:"/profile",onClick:()=>Ee(!1),className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 transition-colors flex items-center gap-2",children:[e.jsx(_t,{className:"w-4 h-4"}),"Profile"]})]})]})]}),e.jsx("button",{onClick:As,className:"p-1 text-gray-500 hover:text-gray-700",title:"Logout",children:e.jsx(wi,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"flex items-center space-x-3 mb-3",children:e.jsxs(Cr,{to:"/profile",className:"flex items-center space-x-3 hover:opacity-80 transition-opacity",children:[s.profileImage?e.jsx("img",{src:`${we}${s.profileImage}`,alt:"Profile",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-medium",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-xs text-green-600",children:"Online"})]})]})}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx(Gs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search or start new chat",value:pe,onChange:o=>ge(o.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-green-400"})]}),e.jsxs("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>K("all"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${G==="all"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"All"}),e.jsxs("button",{onClick:()=>K("unread"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${G==="unread"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:["Unread",Object.values(le).reduce((o,d)=>o+d,0)>0&&e.jsx("span",{className:"ml-1 bg-green-500 text-white text-xs rounded-full px-1.5 py-0.5",children:Object.values(le).reduce((o,d)=>o+d,0)})]}),e.jsx("button",{onClick:()=>K("groups"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${G==="groups"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Groups"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[l.map(o=>{var d;return e.jsx("div",{onClick:()=>{console.log("Selecting chat:",o),L({type:o.type,id:o.id,name:o.name,profileImage:o.profileImage,isActive:o.isActive!==!1}),le[o.id]&&(M(h=>{const N={...h};return delete N[o.id],N}),et.updateChatState({chatId:o.id,chatType:o.type,action:"clear_unread"}).catch(h=>{console.error("Error clearing unread count:",h)}))},className:`p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 ${(g==null?void 0:g.id)===o.id&&(g==null?void 0:g.type)===o.type?"bg-green-50":""} ${o.type==="personal"&&o.isActive===!1?"opacity-60 bg-red-50 border-l-4 border-red-300":""}`,title:o.type==="personal"&&o.isActive===!1?"Disabled User":"",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-12 h-12 rounded-full overflow-hidden cursor-pointer hover:ring-2 hover:ring-green-400 transition-all ${o.type==="personal"&&o.isActive===!1?"bg-gray-300":"bg-gray-200"}`,onClick:h=>{h.stopPropagation(),o.profileImage&&Ge({image:o.type==="personal"?`${we}${o.profileImage}`:o.avatar,name:o.name})},children:o.type==="personal"?o.profileImage?e.jsx("img",{src:`${we}${o.profileImage}`,alt:o.name,className:`w-full h-full object-cover ${o.isActive===!1?"grayscale opacity-70":""}`}):e.jsx("div",{className:`w-full h-full ${o.isActive===!1?"bg-gray-400":"bg-green-500"} flex items-center justify-center`,children:e.jsx("span",{className:"text-white font-semibold text-lg",children:o.avatar})}):o.profileImage?e.jsx("img",{src:o.avatar,alt:o.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:e.jsx(lt,{className:"w-6 h-6 text-white"})})}),o.type==="personal"&&o.isActive===!1&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-red-500 rounded-full border-2 border-white flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:""})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("h3",{className:`truncate ${o.type==="personal"&&o.isActive===!1?"font-medium text-red-700 line-through":"font-medium text-gray-900"}`,children:[o.name,o.type==="personal"&&o.isActive===!1&&e.jsx("span",{className:"ml-2 text-xs text-red-500",children:"(Disabled)"})]}),o.type==="group"&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Group"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:(d=o.lastMessage)!=null&&d.timestamp?ce(o.lastMessage.timestamp):""}),le[o.id]&&le[o.id]>0&&e.jsx("div",{className:"bg-green-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center",children:le[o.id]>99?"99+":le[o.id]})]})]}),e.jsx("p",{className:`text-sm truncate ${o.type==="personal"&&o.isActive===!1?"text-red-400":"text-gray-500"}`,children:o.type==="personal"&&o.isActive===!1?"User is disabled - cannot send new messages":o.lastMessage&&o.lastMessage.message?`${o.lastMessage.senderName||"You"}: ${o.lastMessage.message}`:"No messages yet"})]})]})},`${o.type}-${o.id}`)}),l.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fs,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:pe?"No chats found.":"No chats available."})]})]})]}),Ce&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:()=>Ge(null),children:e.jsxs("div",{className:"relative max-w-2xl max-h-[90vh] p-4",children:[e.jsx("button",{onClick:()=>Ge(null),className:"absolute top-6 right-6 z-10 bg-white/10 hover:bg-white/20 text-white rounded-full p-2 transition-colors",title:"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-4",children:e.jsx("h3",{className:"text-white text-xl font-semibold text-center",children:Ce.name})}),e.jsx("img",{src:Ce.image,alt:Ce.name,className:"w-full h-auto max-h-[70vh] object-contain",onClick:o=>o.stopPropagation()})]})]})}),qe&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>Qe(null),onMouseMove:Cs,onMouseUp:ls,onMouseLeave:ls,children:e.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center overflow-hidden",children:[e.jsx("button",{onClick:()=>Qe(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{onClick:o=>{o.stopPropagation();const d=document.createElement("a");d.href=qe.src,d.download=qe.alt,document.body.appendChild(d),d.click(),document.body.removeChild(d)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:e.jsx(vt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),Pe()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Zoom In",children:e.jsx(Ii,{className:"w-5 h-5"})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),dt()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Zoom Out",children:e.jsx(Ti,{className:"w-5 h-5"})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),xt()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Reset Zoom",children:e.jsx(zn,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"absolute bottom-4 left-4 z-10 bg-black/50 text-white px-3 py-2 rounded-lg text-sm",children:[Math.round(Ye*100),"%"]}),e.jsx("img",{src:qe.src,alt:qe.alt,className:`object-contain transition-transform duration-200 ${oe?"cursor-grabbing":"cursor-grab"}`,style:{transform:`translate(${ae.x}px, ${ae.y}px) scale(${Ye})`,maxWidth:"none",maxHeight:"none",width:"auto",height:"auto"},onMouseDown:Rt,onClick:o=>o.stopPropagation(),draggable:!1})]})}),Xe&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>Fe(null),children:e.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center",children:[e.jsx("button",{onClick:()=>Fe(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{onClick:o=>{o.stopPropagation();const d=document.createElement("a");d.href=Xe.src,d.download=Xe.alt,document.body.appendChild(d),d.click(),document.body.removeChild(d)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:e.jsx(vt,{className:"w-5 h-5"})}),e.jsx("video",{src:Xe.src,controls:!0,autoPlay:!0,className:"max-w-full max-h-full object-contain",onClick:o=>o.stopPropagation()})]})}),Ie&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>We(null),children:e.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center",children:[e.jsx("button",{onClick:()=>We(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{onClick:o=>{o.stopPropagation();const d=document.createElement("a");d.href=Ie.src,d.download=Ie.fileName,document.body.appendChild(d),d.click(),document.body.removeChild(d)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:e.jsx(vt,{className:"w-5 h-5"})}),e.jsx("div",{className:"bg-white rounded-lg shadow-2xl w-full h-full max-w-4xl max-h-[90vh] overflow-hidden",children:Ie.fileType==="application/pdf"?e.jsx("iframe",{src:Ie.src,className:"w-full h-full border-0",title:Ie.fileName,onClick:o=>o.stopPropagation()}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-8",children:[e.jsx(ms,{className:"w-24 h-24 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:Ie.fileName}),e.jsxs("p",{className:"text-gray-600 mb-4",children:[(Ie.fileSize/1024/1024).toFixed(2)," MB"]}),e.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["This file type cannot be previewed in the browser.",e.jsx("br",{}),"Click the download button to save and view the file."]}),e.jsx("button",{onClick:o=>{o.stopPropagation();const d=document.createElement("a");d.href=Ie.src,d.download=Ie.fileName,document.body.appendChild(d),d.click(),document.body.removeChild(d)},className:"mt-4 bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors",children:"Download File"})]})})]})}),e.jsx("div",{className:"flex-1 flex flex-col",children:g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:g.type==="personal"?g.profileImage?e.jsx("img",{src:`${we}${g.profileImage}`,alt:g.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold",children:g.name.charAt(0).toUpperCase()})}):g.profileImage?e.jsx("img",{src:`${we}${g.profileImage}`,alt:g.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:e.jsx(lt,{className:"w-5 h-5 text-white"})})}),e.jsxs("div",{className:`${g.type==="group"?"cursor-pointer hover:bg-gray-50 p-2 rounded-lg transition-colors":""}`,onClick:()=>{g.type==="group"&&(window.location.href=`/group/${g.id}`)},title:g.type==="group"?"Click to view group info":"",children:[e.jsxs("h3",{className:`font-semibold ${g.type==="personal"&&g.isActive===!1?"text-red-700":"text-gray-900"}`,children:[g.name,g.type==="personal"&&g.isActive===!1&&e.jsx("span",{className:"ml-2 text-xs text-red-500",children:"(Disabled)"})]}),e.jsx("p",{className:`text-xs ${g.type==="personal"&&g.isActive===!1?"text-red-400":"text-gray-500"}`,children:g.type==="personal"?g.isActive===!1?"User is disabled - viewing mode only":_(g.id)?e.jsx("span",{className:"text-green-600 font-medium",children:"Online"}):Me(z(g.id).lastSeen):`${g.email}`})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[g.type==="personal"?e.jsxs(e.Fragment,{children:[e.jsx(vo,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var o,d;if(!(!g||g.type!=="personal"))try{const N=(d=(o=(await nr.initiate(g.id,"voice")).data)==null?void 0:o.data)==null?void 0:d.call;N&&N._id&&(de(!1),ze({callId:N._id,callType:"voice",otherUser:N.otherUser}),st(!0),n.emit("call-initiate",{receiverId:g.id,callType:"voice",callId:N._id}))}catch(h){console.error("Failed to initiate call",h)}}}),e.jsx(ht,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var o,d;if(!(!g||g.type!=="personal"))try{const N=(d=(o=(await nr.initiate(g.id,"video")).data)==null?void 0:o.data)==null?void 0:d.call;N&&N._id&&(de(!1),ze({callId:N._id,callType:"video",otherUser:N.otherUser}),st(!0),n.emit("call-initiate",{receiverId:g.id,callType:"video",callId:N._id}))}catch(h){console.error("Failed to initiate video call",h)}}})]}):e.jsxs(e.Fragment,{children:[e.jsx(vo,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var o,d,h,N,v;if(!(!g||g.type!=="group")){console.log(" Initiating group VOICE call for:",g.id,g.name);try{const P=(d=(o=(await is.initiate(g.id,"voice")).data)==null?void 0:o.data)==null?void 0:d.call;console.log(" ========================================"),console.log(" VOICE CALL INITIATED!"),console.log(" Call ID:",P._id),console.log(" Room Name:",P.roomName),console.log(" Group:",g.name),console.log(" ========================================"),P&&P._id&&(B(!1),p({callId:P._id,callType:"voice",groupId:g.id,roomName:P.roomName,group:{name:g.name,avatar:g.profileImage}}),rt(!0),n.emit("group-call-initiate",{groupId:g.id,callType:"voice",callId:P._id}))}catch(y){console.error("Failed to initiate group call",y),console.error("Error response:",(h=y.response)==null?void 0:h.data);const P=((v=(N=y.response)==null?void 0:N.data)==null?void 0:v.message)||"Failed to initiate group call";U.error(P)}}}}),e.jsx(ht,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var o,d,h,N,v;if(!(!g||g.type!=="group")){console.log(" Initiating group VIDEO call for:",g.id,g.name);try{const P=(d=(o=(await is.initiate(g.id,"video")).data)==null?void 0:o.data)==null?void 0:d.call;console.log(" ========================================"),console.log(" VIDEO CALL INITIATED!"),console.log(" Call ID:",P._id),console.log(" Room Name:",P.roomName),console.log(" Group:",g.name),console.log(" ========================================"),P&&P._id&&(B(!1),p({callId:P._id,callType:"video",groupId:g.id,roomName:P.roomName,group:{name:g.name,avatar:g.profileImage}}),rt(!0),n.emit("group-call-initiate",{groupId:g.id,callType:"video",callId:P._id}))}catch(y){console.error("Failed to initiate group video call",y),console.error("Error response:",(h=y.response)==null?void 0:h.data);const P=((v=(N=y.response)==null?void 0:N.data)==null?void 0:v.message)||"Failed to initiate group video call";U.error(P)}}}})]}),e.jsx(Cn,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800"})]})]}),e.jsx("div",{ref:Nt,className:"flex-1 overflow-y-auto p-4 bg-gray-50 relative",children:e.jsxs("div",{className:"max-w-8xl mx-auto",children:[w&&e.jsx("div",{className:"flex justify-center py-2",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})}),!w&&Y&&J.length>0&&e.jsx("div",{className:"flex justify-center py-2",children:e.jsx("button",{onClick:()=>{var d,h,N;const o=((d=J[0])==null?void 0:d._id)||((h=J[0])==null?void 0:h.id);o&&(wt.current=((N=Nt.current)==null?void 0:N.scrollHeight)||0,ys(o))},className:"px-5 py-2.5 text-sm bg-gradient-to-br from-blue-400 to-blue-600 text-white rounded-full shadow-[3px_3px_10px_rgba(59,130,246,0.4),inset_-1px_-1px_6px_rgba(0,0,0,0.1),inset_1px_1px_6px_rgba(255,255,255,0.2)] hover:shadow-[4px_4px_14px_rgba(59,130,246,0.5),inset_-1px_-1px_6px_rgba(0,0,0,0.15),inset_1px_1px_6px_rgba(255,255,255,0.25)] hover:-translate-y-0.5 transition-all duration-200 font-medium",children:"Load Previous Messages"})}),Array.isArray(J)&&J.map((o,d)=>{var P,he,ye,ke,Ue,Le,se;const h=d===0||(()=>{const ie=new Date(o.createdAt||o.timestamp),Ae=new Date(J[d-1].createdAt||J[d-1].timestamp),_e=new Date(ie.getFullYear(),ie.getMonth(),ie.getDate()),Ve=new Date(Ae.getFullYear(),Ae.getMonth(),Ae.getDate());return _e.getTime()!==Ve.getTime()})();let N=!1;if(typeof o.sender=="object"&&o.sender!==null){const ie=o.sender._id||o.sender.id;N=ie===s.id||ie===s._id||ie===((P=s.id)==null?void 0:P.toString())||ie===((he=s._id)==null?void 0:he.toString())}else N=o.sender===s.id||o.sender===s._id||o.sender===((ye=s.id)==null?void 0:ye.toString())||o.sender===((ke=s._id)==null?void 0:ke.toString());const v=typeof o.sender=="object"?(Ue=o.sender)==null?void 0:Ue.name:"User",y=typeof o.sender=="object"?(Le=o.sender)==null?void 0:Le.profileImage:null;return e.jsxs(In.Fragment,{children:[h&&e.jsx("div",{className:"flex justify-center my-4",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-200 to-gray-300 text-gray-700 text-xs px-4 py-2 rounded-full font-medium",children:Se(o.createdAt||o.timestamp)})}),e.jsx("div",{className:`flex ${N?"justify-end":"justify-start"} mb-4`,children:e.jsxs("div",{className:`flex items-start gap-2 max-w-sm lg:max-w-md ${N?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-300 flex-shrink-0",children:N?s.profileImage?e.jsx("img",{src:`${we}${s.profileImage}`,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-medium",children:s.name.charAt(0).toUpperCase()})}):y?e.jsx("img",{src:`${we}${y}`,alt:v,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-400 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-medium",children:String(v).charAt(0).toUpperCase()})})}),e.jsxs("div",{className:`relative group flex flex-col px-4 py-3 rounded-2xl transition-all duration-200 ${N?"bg-gradient-to-br from-green-400 to-green-600 text-white rounded-br-md hover:-translate-y-0.5":"bg-gradient-to-br from-gray-100 to-gray-300 text-gray-900 rounded-bl-md hover:-translate-y-0.5"} ${ut&&bs&&at(bs)===at(o)?"ring-2 ring-blue-400":""}`,onMouseDown:()=>Je(o),onMouseUp:tt,onMouseLeave:tt,onTouchStart:()=>Je(o),onTouchEnd:tt,onContextMenu:ie=>{ie.preventDefault(),Ts(o),bt(!0)},children:[o.messageType==="text"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ie=>yt(at(o),ie),className:`absolute top-1 right-1 z-10 p-1 rounded-full transition-all duration-200 ${N?"bg-green-600/80 hover:bg-green-700/80 text-white":"bg-gray-300/80 hover:bg-gray-400/80 text-gray-700"} ${Tt===at(o)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:e.jsx(_s,{className:"w-3 h-3"})}),Tt===at(o)&&e.jsxs("div",{className:"message-dropdown-container absolute top-8 right-1 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[e.jsxs("button",{onClick:()=>Lt("copy",o),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Rs,{className:"w-4 h-4"}),"Copy"]}),(()=>{var _e,Ve,Be,Ke;const ie=((_e=o.sender)==null?void 0:_e.id)||((Ve=o.sender)==null?void 0:Ve._id)||o.sender;return ie===s.id||ie===s._id||ie===((Be=s.id)==null?void 0:Be.toString())||ie===((Ke=s._id)==null?void 0:Ke.toString())?e.jsxs("button",{onClick:()=>Lt("edit",o),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4"}),"Edit"]}):null})(),e.jsxs("button",{onClick:()=>Lt("forward",o),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Us,{className:"w-4 h-4"}),"Forward"]})]})]}),o.fileUrl&&e.jsx("div",{className:"mb-2",children:o.messageType==="image"?e.jsxs("div",{className:"relative group",onMouseDown:()=>Je(o),onMouseUp:tt,onMouseLeave:tt,onTouchStart:()=>Je(o),onTouchEnd:tt,children:[e.jsx("button",{onClick:ie=>yt(at(o),ie),className:`absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 ${N?"bg-green-500/80 hover:bg-green-600/80 text-white":"bg-gray-500/80 hover:bg-gray-600/80 text-white"} ${Tt===at(o)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:e.jsx(_s,{className:"w-3 h-3"})}),Tt===at(o)&&e.jsxs("div",{className:"message-dropdown-container absolute top-10 right-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[e.jsxs("button",{onClick:()=>Lt("copy",o),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Rs,{className:"w-4 h-4"}),"Copy"]}),o.messageType==="text"&&(()=>{var _e,Ve,Be,Ke;const ie=((_e=o.sender)==null?void 0:_e.id)||((Ve=o.sender)==null?void 0:Ve._id)||o.sender;return ie===s.id||ie===s._id||ie===((Be=s.id)==null?void 0:Be.toString())||ie===((Ke=s._id)==null?void 0:Ke.toString())?e.jsxs("button",{onClick:()=>Lt("edit",o),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4"}),"Edit"]}):null})(),e.jsxs("button",{onClick:()=>Lt("forward",o),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Us,{className:"w-4 h-4"}),"Forward"]})]}),e.jsx("img",{src:$(o.fileUrl),alt:o.fileName,className:`max-w-xs rounded-lg ${!N&&!$e[o.id||o._id]?"blur-sm cursor-pointer":"cursor-pointer"} hover:opacity-90`,onClick:()=>{var ie;!N&&!$e[o.id||o._id]?rs(o.fileUrl,o.fileName,o.id||o._id):Is({src:$(o.fileUrl),alt:o.fileName,sender:((ie=o.sender)==null?void 0:ie.name)||"User",timestamp:o.createdAt||o.timestamp})}}),!N&&!$e[o.id||o._id]&&e.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-black/60 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1",children:[e.jsx(vt,{className:"w-3 h-3"}),((o.fileSize||0)/1024/1024).toFixed(1)," MB"]}),je[o.id||o._id]&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"bg-black/60 rounded-lg px-3 py-2 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-2"}),e.jsxs("p",{className:"text-sm text-white",children:[je[o.id||o._id].progress,"%"]})]})})]}):o.messageType==="video"?e.jsxs("div",{className:"relative group",onMouseDown:()=>Je(o),onMouseUp:tt,onMouseLeave:tt,onTouchStart:()=>Je(o),onTouchEnd:tt,children:[e.jsx("button",{onClick:ie=>yt(at(o),ie),className:`absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 ${N?"bg-green-500/80 hover:bg-green-600/80 text-white":"bg-gray-500/80 hover:bg-gray-600/80 text-white"} ${Tt===at(o)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:e.jsx(_s,{className:"w-3 h-3"})}),Tt===at(o)&&e.jsxs("div",{className:"message-dropdown-container absolute top-10 right-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[e.jsxs("button",{onClick:()=>Lt("copy",o),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Rs,{className:"w-4 h-4"}),"Copy"]}),o.messageType==="text"&&(()=>{var _e,Ve,Be,Ke;const ie=((_e=o.sender)==null?void 0:_e.id)||((Ve=o.sender)==null?void 0:Ve._id)||o.sender;return ie===s.id||ie===s._id||ie===((Be=s.id)==null?void 0:Be.toString())||ie===((Ke=s._id)==null?void 0:Ke.toString())?e.jsxs("button",{onClick:()=>Lt("edit",o),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4"}),"Edit"]}):null})(),e.jsxs("button",{onClick:()=>Lt("forward",o),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Us,{className:"w-4 h-4"}),"Forward"]})]}),e.jsx("video",{src:$(o.fileUrl),controls:!0,className:`max-w-xs rounded-lg ${!N&&!$e[o.id||o._id]?"blur-sm":""} cursor-pointer`,onClick:()=>{var ie;!N&&!$e[o.id||o._id]?rs(o.fileUrl,o.fileName,o.id||o._id):Fe({src:$(o.fileUrl),alt:o.fileName,sender:((ie=o.sender)==null?void 0:ie.name)||"User",timestamp:o.createdAt||o.timestamp})}}),!N&&!$e[o.id||o._id]&&e.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-black/60 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1",children:[e.jsx(vt,{className:"w-3 h-3"}),((o.fileSize||0)/1024/1024).toFixed(1)," MB"]}),je[o.id||o._id]&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"bg-black/60 rounded-lg px-3 py-2 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-2"}),e.jsxs("p",{className:"text-sm text-white",children:[je[o.id||o._id].progress,"%"]})]})})]}):e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-white bg-opacity-20 rounded-lg relative cursor-pointer",onMouseDown:()=>Je(o),onMouseUp:tt,onMouseLeave:tt,onTouchStart:()=>Je(o),onTouchEnd:tt,onClick:()=>{var ie;!N&&!$e[o.id||o._id]?rs(o.fileUrl,o.fileName,o.id||o._id):We({src:$(o.fileUrl),fileName:o.fileName,fileSize:o.fileSize,fileType:o.fileType,sender:((ie=o.sender)==null?void 0:ie.name)||"User",timestamp:o.createdAt||o.timestamp})},children:[e.jsx(ms,{className:"w-5 h-5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:o.fileName}),e.jsxs("p",{className:"text-xs opacity-75",children:[(o.fileSize/1024/1024).toFixed(2)," MB"]})]}),!N&&!$e[o.id||o._id]&&e.jsx("button",{onClick:ie=>{ie.stopPropagation(),rs(o.fileUrl,o.fileName,o.id||o._id)},className:"p-1 hover:bg-white hover:bg-opacity-20 rounded",disabled:(se=je[o.id||o._id])==null?void 0:se.downloading,children:e.jsx(vt,{className:"w-4 h-4"})}),je[o.id||o._id]&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg p-2 text-center",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mx-auto mb-1"}),e.jsxs("p",{className:"text-xs text-white",children:[je[o.id||o._id].progress,"%"]})]})})]})}),o.message&&(Ht&&at(Ht)===at(o)?e.jsxs("div",{className:"mb-2",children:[e.jsx("input",{type:"text",value:ds,onChange:ie=>ts(ie.target.value),className:"w-full px-2 py-1 text-sm bg-white bg-opacity-20 rounded border-none focus:outline-none focus:ring-1 focus:ring-white",autoFocus:!0,onKeyDown:ie=>{ie.key==="Enter"&&mr(),ie.key==="Escape"&&qs()}}),e.jsxs("div",{className:"flex gap-1 mt-1",children:[e.jsx("button",{onClick:mr,className:"text-xs px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700",children:"Save"}),e.jsx("button",{onClick:qs,className:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Cancel"})]})]}):e.jsxs("p",{className:"text-sm mb-1 break-words",children:[o.message,(o.isEdited||o.editedAt)&&e.jsx("span",{className:"text-xs opacity-75 ml-1",children:"(edited)"})]})),e.jsxs("div",{className:`flex items-center gap-1 text-xs self-end ${N?"text-green-100":"text-gray-500"}`,children:[e.jsx("span",{children:new Date(o.createdAt||o.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),N&&e.jsx("span",{className:"ml-1 relative inline-flex items-center",title:o.isRead||o.readBy&&o.readBy.length>0?"Seen":"Delivered",children:o.isRead||o.readBy&&o.readBy.length>0?e.jsx("svg",{className:"w-4 h-4 text-blue-500",viewBox:"0 0 16 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z",fill:"currentColor"})}):e.jsx("svg",{className:"w-4 h-4 opacity-70",viewBox:"0 0 16 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z",fill:"currentColor"})})})]})]})]})})]},o.id||o._id||d)}),e.jsx("div",{ref:Vs})]})}),e.jsx("div",{className:"bg-white border-t border-gray-200 p-4",children:g.type==="personal"&&g.isActive===!1?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg px-4 py-3 w-full text-center",children:e.jsx("p",{className:"text-red-600 text-sm font-medium",children:"This user is disabled. You can view previous messages but cannot send new ones."})})}):e.jsxs("div",{className:"relative",children:[V&&e.jsx("div",{className:"file-options-container absolute bottom-16 left-4 bg-white rounded-lg shadow-lg border border-gray-200 p-2 z-50",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>ws("image"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(Ot,{className:"w-8 h-8 text-green-600 mb-1"}),e.jsx("span",{className:"text-xs text-gray-700",children:"Image"})]}),e.jsxs("button",{onClick:()=>ws("video"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(ht,{className:"w-8 h-8 text-blue-600 mb-1"}),e.jsx("span",{className:"text-xs text-gray-700",children:"Video"})]}),e.jsxs("button",{onClick:()=>ws("document"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(ms,{className:"w-8 h-8 text-purple-600 mb-1"}),e.jsx("span",{className:"text-xs text-gray-700",children:"Document"})]})]})}),S&&e.jsx("div",{className:"mb-3 p-3 bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[H?e.jsx("img",{src:H,alt:"Preview",className:"w-12 h-12 object-cover rounded"}):e.jsx(ms,{className:"w-8 h-8 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:S.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(S.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsx("button",{onClick:Js,className:"text-gray-500 hover:text-gray-700",children:""})]})}),e.jsxs("form",{onSubmit:Jr,className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>ue(!V),className:"p-2 text-gray-500 hover:text-gray-700",title:"Attach file",children:e.jsx(ji,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex-1 relative",children:e.jsx("input",{type:"text",value:Q,onChange:o=>W(o.target.value),placeholder:"Type a message",className:"w-full py-2 px-4 bg-gray-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-green-400"})}),e.jsx("button",{type:"submit",disabled:!Q.trim()&&!S,className:"bg-green-500 text-white p-2 rounded-full hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(qr,{className:"w-5 h-5"})})]})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(fs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Welcome to WhatsApp Chat"}),e.jsx("p",{className:"text-gray-500 max-w-md",children:"Select a conversation from the sidebar to start messaging. Your conversations will appear on the left side."})]})})})]}),Ze&&ft&&e.jsx(e.Fragment,{children:ft.callType==="voice"?e.jsx(qn,{user:s,callData:ft,isIncoming:it,onCallEnd:()=>{st(!1),ze(null),de(!1)},onCallAnswer:()=>{de(!1)},onCallDecline:()=>{st(!1),ze(null),de(!1)}}):e.jsx(Vn,{user:s,callData:ft,isIncoming:it,onCallEnd:()=>{st(!1),ze(null),de(!1)},onCallAnswer:()=>{de(!1)},onCallDecline:()=>{st(!1),ze(null),de(!1)}})}),cs&&Oe&&X&&Oe.callType==="video"&&e.jsx(Yn,{callData:Oe,onAccept:()=>{console.log(" ========================================"),console.log(" ACCEPTING INCOMING VIDEO CALL"),console.log(" Call ID:",Oe.callId),console.log(" Room Name:",Oe.roomName),console.log(" ========================================"),B(!1),n&&(Oe!=null&&Oe.callId)&&(n.emit("group-call-join",{callId:Oe.callId,groupId:Oe.groupId}),console.log(" Socket notified - Jitsi will handle participants")),console.log(" Using Jitsi internal participant sync (no backend API needed)")},onDecline:()=>{rt(!1),p(null),B(!1),n&&(Oe!=null&&Oe.callId)&&n.emit("group-call-decline",{callId:Oe.callId,groupId:Oe.groupId})}}),cs&&Oe&&!X&&(Oe.callType==="video"?e.jsx(Wn,{user:s,callData:Oe,onCallEnd:()=>{rt(!1),p(null),B(!1)}}):e.jsx(Hn,{user:s,callData:Oe,isIncoming:X,onCallEnd:()=>{rt(!1),p(null),B(!1)},onCallAnswer:()=>{B(!1)},onCallDecline:()=>{rt(!1),p(null),B(!1)}}))]})},Ud=()=>{const{user:s}=It(),{socket:t,isConnected:r,sendMessage:n,joinGroup:i,leaveGroup:c,onReceiveMessage:a,onReceiveGroupMessage:m,onMessageSent:C,getConnectionStatus:b,isUserOnline:j,getUserStatus:T}=Bs(),[_,z]=u.useState([]),[R,F]=u.useState([]),[f,O]=u.useState(null),[g,L]=u.useState([]),[J,q]=u.useState(""),[Q,W]=u.useState(""),[pe,ge]=u.useState(!0),[be,te]=u.useState({}),[le,M]=u.useState({}),[ne,I]=u.useState("all"),[G,K]=u.useState(!1),[Y,k]=u.useState(!1),w=50,[A,Z]=u.useState(null),[S,E]=u.useState(null),[H,ee]=u.useState(!1),[V,ue]=u.useState({}),[je,Te]=u.useState(0),[$e,ct]=u.useState(!1),[Ze,st]=u.useState(()=>{try{const l=sessionStorage.getItem("downloadedMessages");return l?JSON.parse(l):{}}catch{return{}}}),[ft,ze]=u.useState(!1),[it,de]=u.useState(null),[Ce,Ge]=u.useState(!1),[qe,Qe]=u.useState(null),[Xe,Fe]=u.useState(null),[Ie,We]=u.useState(null),[Ye,pt]=u.useState(null),[ae,x]=u.useState(1),[oe,xe]=u.useState({x:0,y:0}),[re,Ee]=u.useState(!1),Pe=()=>{x(l=>Math.min(l*1.25,4))},dt=()=>{x(l=>Math.max(l/1.25,.5))},xt=()=>{x(1),xe({x:0,y:0})},Rt=l=>{l.preventDefault(),Ee(!0),xe({x:l.clientX-oe.x,y:l.clientY-oe.y})},Cs=l=>{re&&(l.preventDefault(),xe({x:l.clientX-oe.x,y:l.clientY-oe.y}))},ls=()=>{Ee(!1)},Is=l=>{Fe(l),x(1),xe({x:0,y:0})},[cs,rt]=u.useState(!1),[Oe,p]=u.useState(null),[X,B]=u.useState(!1),$=l=>l&&(/^https?:\/\//i.test(l)?l:`${we}${l}`),ce=l=>l?l.includes("drive.google.com")||l.includes("googleapis.com"):!1,Se=l=>{if(!l)return"";const o=new Date(l),d=new Date,h=new Date(d.getFullYear(),d.getMonth(),d.getDate()),N=new Date(h);N.setDate(N.getDate()-1);const v=new Date(o.getFullYear(),o.getMonth(),o.getDate());return v.getTime()===h.getTime()?o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):v.getTime()===N.getTime()?"Yesterday":Math.floor((h-v)/(1e3*60*60*24))<7?o.toLocaleDateString([],{weekday:"short"}):o.toLocaleDateString([],{day:"numeric",month:"numeric",year:o.getFullYear()!==d.getFullYear()?"numeric":void 0})},Me=l=>{if(!l)return"";const o=new Date(l),d=new Date,h=new Date(d.getFullYear(),d.getMonth(),d.getDate()),N=new Date(h);N.setDate(N.getDate()-1);const v=new Date(o.getFullYear(),o.getMonth(),o.getDate());return v.getTime()===h.getTime()?"Today":v.getTime()===N.getTime()?"Yesterday":Math.floor((h-v)/(1e3*60*60*24))<7?o.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric"}):o.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric",year:o.getFullYear()!==d.getFullYear()?"numeric":void 0})},me=l=>{if(!l)return"Last seen recently";const o=new Date,d=new Date(l),h=o-d,N=Math.floor(h/(1e3*60)),v=Math.floor(h/(1e3*60*60)),y=Math.floor(h/(1e3*60*60*24));return N<1?"Online":N<60?`Last seen ${N} minute${N===1?"":"s"} ago`:v<24?`Last seen ${v} hour${v===1?"":"s"} ago`:y===1?"Last seen yesterday":y<7?`Last seen ${y} day${y===1?"":"s"} ago`:`Last seen ${d.toLocaleDateString([],{month:"short",day:"numeric"})}`},[Ne,ut]=u.useState(null),[bt,bs]=u.useState(!1),[Ts,Ht]=u.useState(null),[Wt,ds]=u.useState(null),[ts,Tt]=u.useState(""),[Ut,at]=u.useState(null),Je=l=>((l==null?void 0:l.id)||(l==null?void 0:l._id)||(l==null?void 0:l.messageId)||"").toString(),tt=l=>{Ne&&clearTimeout(Ne);const o=setTimeout(()=>{Ht(l),bs(!0)},700);ut(o)},yt=()=>{Ne&&(clearTimeout(Ne),ut(null))},Lt=(l,o)=>{o.stopPropagation(),at(Ut===l?null:l)},zt=(l,o)=>{switch(Ht(o),at(null),l){case"copy":Vr(o);break;case"edit":mr(o);break;case"forward":Hr(o);break}},Vr=async l=>{try{const o=(l==null?void 0:l.messageType)==="text"?(l==null?void 0:l.message)||"":$(l==null?void 0:l.fileUrl)||(l==null?void 0:l.fileName)||"";o&&(await navigator.clipboard.writeText(o),U.success("Copied to clipboard"))}catch(o){console.error("Copy failed:",o),U.error("Failed to copy")}},Hr=l=>{try{sessionStorage.setItem("forwardMessage",JSON.stringify({id:l.id||l._id,message:l.message,messageType:l.messageType,fileUrl:l.fileUrl,fileName:l.fileName,fileSize:l.fileSize,fileType:l.fileType})),U.success("Message ready to forward"),window.location.href="/forward"}catch(o){console.error("Forward setup failed:",o),U.error("Failed to prepare message for forwarding")}},mr=l=>{var o,d,h,N;if(l&&l.messageType==="text"){const v=((o=l.sender)==null?void 0:o.id)||((d=l.sender)==null?void 0:d._id)||l.sender;v===s.id||v===s._id||v===((h=s.id)==null?void 0:h.toString())||v===((N=s._id)==null?void 0:N.toString())?(ds(l),Tt(l.message||"")):U.error("You can only edit your own messages")}},qs=async()=>{if(!(!Wt||!ts.trim()))try{L(l=>l.map(o=>Je(o)===Je(Wt)?{...o,message:ts.trim(),isEdited:!0,editedAt:new Date().toISOString()}:o)),await et.editMessage(Wt.id||Wt._id,ts.trim()),ds(null),Tt("")}catch(l){console.error("Failed to edit message:",l),U.error("Failed to edit message")}},Vs=()=>{ds(null),Tt("")},Es=u.useRef(null),Nt=u.useRef(!0),wt=u.useRef(null),Yt=u.useRef(0),Jt=u.useRef(null);u.useEffect(()=>((async()=>{try{console.log(" Loading chat state from database...");const o=await et.getChatState(),{personalChats:d,groupChats:h}=o.data,N={},v={};d.forEach(y=>{var P,he,ye;y.unreadCount>0?N[y.chatId]=y.unreadCount:delete N[y.chatId],y.lastMessage&&y.lastMessage.message&&(v[y.chatId]={id:y.lastMessage._id||y.lastMessage.id,message:y.lastMessage.message,senderName:y.lastMessage.senderName||((P=y.lastMessage.sender)==null?void 0:P.name)||"User",senderId:y.lastMessage.senderId||((he=y.lastMessage.sender)==null?void 0:he._id)||((ye=y.lastMessage.sender)==null?void 0:ye.id),timestamp:y.lastMessage.createdAt||y.lastMessage.timestamp})}),h.forEach(y=>{var P,he,ye;y.unreadCount>0?N[y.chatId]=y.unreadCount:delete N[y.chatId],y.lastMessage&&y.lastMessage.message&&(v[y.chatId]={id:y.lastMessage._id||y.lastMessage.id,message:y.lastMessage.message,senderName:y.lastMessage.senderName||((P=y.lastMessage.sender)==null?void 0:P.name)||"User",senderId:y.lastMessage.senderId||((he=y.lastMessage.sender)==null?void 0:he._id)||((ye=y.lastMessage.sender)==null?void 0:ye.id),timestamp:y.lastMessage.createdAt||y.lastMessage.timestamp})}),te(N),M(v),console.log(" Chat state loaded from database:",{unreadCounts:N,lastMessages:Object.keys(v).length})}catch(o){console.error("Error loading chat state from database:",o)}})(),Wr(),()=>{mt.removeAllListeners(),mt.healthCheckInterval&&(clearInterval(mt.healthCheckInterval),delete mt.healthCheckInterval)}),[]),u.useEffect(()=>{if(t)return console.log(" Setting up PERSISTENT call listeners for Chat Page..."),t.off("incoming-call"),t.on("incoming-call",l=>{var o;console.log(" Chat Page - Incoming call received:",l),U.success(`Incoming ${l.callType} call from ${((o=l.caller)==null?void 0:o.name)||"Unknown"}`,{duration:5e3,icon:""}),Ge(!0),de({callId:l.callId,callType:l.callType,caller:l.caller}),ze(!0)}),t.off("call-initiated"),t.on("call-initiated",l=>{console.log(" Chat Page - Call initiated:",l),Ge(!1),de({callId:l.callId,callType:l.callType,otherUser:l.receiver}),ze(!0)}),t.off("call-error"),t.on("call-error",l=>{console.error(" Chat Page - Call error:",l),U.error(l.error||"Call failed",{duration:4e3})}),t.off("incoming-group-call"),t.on("incoming-group-call",l=>{var o,d;console.log(" ========================================"),console.log(" Chat Page - INCOMING GROUP CALL RECEIVED!"),console.log(" Call ID:",l.callId),console.log(" Call Type:",l.callType),console.log(" Room Name:",l.roomName),console.log(" Group:",l.groupName),console.log(" Initiator:",(o=l.initiator)==null?void 0:o.name),console.log(" ========================================"),U.success(`Incoming group ${l.callType} call from ${((d=l.initiator)==null?void 0:d.name)||"Unknown"} in ${l.groupName}`,{duration:5e3,icon:""}),B(!0),p({callId:l.callId,callType:l.callType,groupId:l.groupId,roomName:l.roomName,group:l.group||{name:l.groupName},initiator:l.initiator}),rt(!0)}),t.off("group-call-initiated"),t.on("group-call-initiated",l=>{console.log(" ========================================"),console.log(" Chat Page - GROUP CALL INITIATED!"),console.log(" Call ID:",l.callId),console.log(" Room Name:",l.roomName),console.log(" Call Type:",l.callType),console.log(" ========================================"),B(!1),p({callId:l.callId,callType:l.callType,groupId:l.groupId,roomName:l.roomName,group:l.group}),rt(!0)}),t.off("group-call-error"),t.on("group-call-error",l=>{console.error(" Chat Page - Group call error:",l),U.error(l.error||"Group call failed",{duration:4e3})}),()=>{console.log(" Cleaning up PERSISTENT call listeners..."),t.off("incoming-call"),t.off("call-initiated"),t.off("call-error"),t.off("incoming-group-call"),t.off("group-call-initiated"),t.off("group-call-error")}},[t]),u.useEffect(()=>(f&&(L([]),K(!1),k(!1),Nt.current=!0,ys(),Ws(),f.type==="group"&&(i(f.id),console.log(" Joined group room for:",f.name))),()=>{mt.removeAllListeners(),f&&f.type==="group"&&(c(f.id),console.log(" Left group room for:",f.name)),mt.healthCheckInterval&&(clearInterval(mt.healthCheckInterval),delete mt.healthCheckInterval)}),[f]),u.useEffect(()=>{if(g.length>0){if(Nt.current)setTimeout(()=>{Ms(!0),Nt.current=!1},100);else if(wt.current){const l=wt.current,o=l.scrollHeight,d=l.scrollTop,h=l.clientHeight;o-d-h<200&&Ms(!1)}}},[g]);const Hs=()=>{!wt.current||Y||!G||!f||(Jt.current&&clearTimeout(Jt.current),Jt.current=setTimeout(()=>{var d,h;if(!wt.current||Y||!G)return;const l=wt.current;if(l.scrollTop<50&&g.length>0){Yt.current=l.scrollHeight;const N=((d=g[0])==null?void 0:d._id)||((h=g[0])==null?void 0:h.id);N&&ys(N)}},150))};u.useEffect(()=>{const l=wt.current;if(!(!l||!f))return l.addEventListener("scroll",Hs),()=>{l.removeEventListener("scroll",Hs),Jt.current&&clearTimeout(Jt.current)}},[g,Y,G,f]);const ss=async()=>{try{console.log(" Refreshing chat state from database...");const l=await et.getChatState(),{personalChats:o,groupChats:d}=l.data,h={},N={};o.forEach(v=>{var y,P,he;v.unreadCount>0&&(h[v.chatId]=v.unreadCount),v.lastMessage&&v.lastMessage.message&&(N[v.chatId]={id:v.lastMessage._id||v.lastMessage.id,message:v.lastMessage.message,senderName:v.lastMessage.senderName||((y=v.lastMessage.sender)==null?void 0:y.name)||"User",senderId:v.lastMessage.senderId||((P=v.lastMessage.sender)==null?void 0:P._id)||((he=v.lastMessage.sender)==null?void 0:he.id),timestamp:v.lastMessage.createdAt||v.lastMessage.timestamp})}),d.forEach(v=>{var y,P,he;v.unreadCount>0&&(h[v.chatId]=v.unreadCount),v.lastMessage&&v.lastMessage.message&&(N[v.chatId]={id:v.lastMessage._id||v.lastMessage.id,message:v.lastMessage.message,senderName:v.lastMessage.senderName||((y=v.lastMessage.sender)==null?void 0:y.name)||"User",senderId:v.lastMessage.senderId||((P=v.lastMessage.sender)==null?void 0:P._id)||((he=v.lastMessage.sender)==null?void 0:he.id),timestamp:v.lastMessage.createdAt||v.lastMessage.timestamp})}),te(h),M(N),console.log(" Chat state refreshed from database")}catch(l){console.error("Error refreshing chat state:",l)}};u.useEffect(()=>{window.testSocket=()=>{mt.testConnection()},window.checkSocket=()=>{mt.logConnectionStatus()},window.forceSocketConnect=()=>{mt.forceConnectionTest()},console.log(" Socket debugging methods available:"),console.log(" - testSocket() - Test socket connection status"),console.log(" - checkSocket() - Show current socket status"),console.log(" - forceSocketConnect() - Force reconnection")},[]);const Wr=async()=>{try{ge(!0);const[l,o]=await Promise.all([St.getActiveUsers(),Gt.getMyGroups()]);console.log(" Chat Data Loaded:"),console.log(" Users:",l.data.length),console.log(" Groups:",o.data.length),console.log(" Group Details:",o.data.map(d=>{var h;return{id:d.id,name:d.name,members:((h=d.members)==null?void 0:h.length)||0,avatar:d.avatar?"Has Avatar":"No Avatar"}})),z(l.data.filter(d=>d.id!==s.id)),F(o.data),Ws()}catch(l){console.error("Error fetching initial data:",l),U.error("Failed to load chat data")}finally{ge(!1)}},Ws=()=>{console.log(" Setting up enhanced socket listeners with Context API...");const l=b();console.log(" Current socket status:",l),a(o=>{var he,ye;console.log(" CHATROOM CONTEXT - received message:",o);const d=typeof o.sender=="object"?o.sender.id||o.sender._id:o.sender,h=typeof o.receiver=="object"?o.receiver.id||o.receiver._id:o.receiver,N=o.id||o._id||o.messageId,v=o.message||o.content,y=d===s.id||d===s._id||d===((he=s.id)==null?void 0:he.toString())||d===((ye=s._id)==null?void 0:ye.toString());if(o._isConfirmation||o.isConfirmMessage||o.isMessageSentConfirmation){console.log(" Skipping confirmation message");return}const P=Yr(o,f,s);if(console.log(" ENHANCED MESSAGE FILTERING:",{senderId:d,receiverId:h,messageId:N,messageText:v,selectedChatId:f==null?void 0:f.id,selectedChatType:f==null?void 0:f.type,currentUserId:s.id,isCurrentUserSender:y,isForCurrentChat:P,messageData:o}),P&&f)console.log(" Processing message for current active chat"),y?console.log(" Message from current user - handled by optimistic updates"):(console.log(" Adding external message to current chat immediately"),L(ke=>{if(ke.some(se=>{var Ke,kt;const ie=se.id||se._id||se.messageId,Ae=se.message||se.content,_e=((Ke=se.sender)==null?void 0:Ke.id)||((kt=se.sender)==null?void 0:kt._id)||se.sender,Ve=se.createdAt||se.timestamp,Be=o.createdAt||o.timestamp;return!!(ie===N&&N||Ae===v&&String(_e)===String(d)&&Be&&Ve&&Math.abs(new Date(Be)-new Date(Ve))<5e3||se.isOptimistic&&Ae===v&&String(_e)===String(d)&&Be&&Ve&&Math.abs(new Date(Be)-new Date(Ve))<1e4)}))return console.log(" Enhanced detection: Message already exists - confirmed duplicate",{messageId:N,messageText:v==null?void 0:v.substring(0,20),senderId:d,isDuplicate:!0}),ke;console.log(" REAL-TIME: NEW message confirmed - Adding to active chat",{messageId:N,messageText:v==null?void 0:v.substring(0,20),senderId:d,isDuplicate:!1});const Le=Ys(o,d);return Et(f.id,o,d),setTimeout(()=>{ss()},100),[...ke,Le]}));else if(v&&!y){const ke=d||o.sender;ke&&ke!==s.id&&(console.log(" Incrementing unread count for chat:",ke),te(Ue=>({...Ue,[ke]:(Ue[ke]||0)+1})),Et(ke,o,d),setTimeout(()=>{ss()},100))}}),C(o=>{console.log(" Message sent confirmation received:",o),o&&o.id&&L(d=>{const h=d.filter(v=>!v.isOptimistic),N={id:o.id,message:o.message,messageType:o.messageType||"text",fileUrl:o.fileUrl,fileName:o.fileName,fileSize:o.fileSize,fileType:o.fileType,sender:o.sender,createdAt:o.createdAt||o.timestamp,timestamp:o.timestamp,isOptimistic:!1};return[...h,N]})}),m(o=>{var he,ye,ke,Ue;console.log(" GROUP MESSAGE CONTEXT - received message:",o);const d=typeof o.sender=="object"?o.sender.id||o.sender._id:o.sender,h=o.groupId||((he=o.group)==null?void 0:he.id)||((ye=o.group)==null?void 0:ye._id),N=o.id||o._id||o.messageId,v=o.message||o.content,y=d===s.id||d===s._id||d===((ke=s.id)==null?void 0:ke.toString())||d===((Ue=s._id)==null?void 0:Ue.toString());if(o._isConfirmation||o.isConfirmMessage||o.isMessageSentConfirmation){console.log(" Skipping confirmation message");return}const P=f&&f.type==="group"&&(h===f.id||String(h)===String(f.id));if(console.log(" GROUP MESSAGE FILTERING:",{senderId:d,groupId:h,messageId:N,messageText:v,selectedChatId:f==null?void 0:f.id,selectedChatType:f==null?void 0:f.type,currentUserId:s.id,isCurrentUserSender:y,isForCurrentGroup:P,messageData:o}),P&&f)console.log(" Processing group message for current group"),y?console.log(" Group message from current user - handled by optimistic updates"):(console.log(" Adding external group message to current chat immediately"),L(Le=>{if(Le.some(Ae=>{var Ft,vs;const _e=Ae.id||Ae._id||Ae.messageId,Ve=Ae.message||Ae.content,Be=((Ft=Ae.sender)==null?void 0:Ft.id)||((vs=Ae.sender)==null?void 0:vs._id)||Ae.sender,Ke=Ae.createdAt||Ae.timestamp,kt=o.createdAt||o.timestamp;return!!(_e===N&&N||Ve===v&&String(Be)===String(d)&&kt&&Ke&&Math.abs(new Date(kt)-new Date(Ke))<5e3||Ae.isOptimistic&&Ve===v&&String(Be)===String(d)&&kt&&Ke&&Math.abs(new Date(kt)-new Date(Ke))<1e4)}))return console.log(" GROUP duplicate detection: Message already exists",{messageId:N,messageText:v==null?void 0:v.substring(0,20),senderId:d==null?void 0:d.toString(),isDuplicate:!0}),Le;console.log(" GROUP REAL-TIME: NEW message confirmed - Adding to active group",{messageId:N,messageText:v==null?void 0:v.substring(0,20),senderId:d,groupId:h});const ie=Ys(o,d);return Et(f.id,o,d),setTimeout(()=>{ss()},100),[...Le,ie]}));else if(v&&!y){const Le=h||o.groupId;Le&&(!f||f.type!=="group"||String(Le)!==String(f.id))&&(console.log(" Incrementing unread count for group:",Le),te(ie=>({...ie,[Le]:(ie[Le]||0)+1})),Et(Le,o,d),setTimeout(()=>{ss()},100))}}),t&&(t.off("avatar-updated"),t.on("avatar-updated",o=>{var h,N;console.log(" Profile updated received:",o);const d=((h=o.userId)==null?void 0:h.toString())||o.userId;z(v=>v.map(y=>{var P;return((P=y.id||y._id)==null?void 0:P.toString())===d?{...y,profileImage:o.profileImage,name:o.name}:y})),f&&f.type==="personal"&&((N=f.id||f._id)==null?void 0:N.toString())===d&&O(v=>({...v,profileImage:o.profileImage,name:o.name})),L(v=>v.map(y=>{var he,ye,ke;return((ke=((he=y.sender)==null?void 0:he.id)||((ye=y.sender)==null?void 0:ye._id)||y.sender)==null?void 0:ke.toString())===d?{...y,sender:{...typeof y.sender=="object"?y.sender:{id:y.sender},profileImage:o.profileImage,name:o.name}}:y}))}),t.off("messages-seen"),t.on("messages-seen",o=>{console.log(" Messages seen by user:",o.readBy),f&&f.type==="personal"&&o.chatId===f.id&&L(d=>d.map(h=>{var v,y;return(((v=h.sender)==null?void 0:v.id)||((y=h.sender)==null?void 0:y._id)||h.sender)===s.id?{...h,isRead:!0,readBy:[{user:o.readBy,readAt:o.timestamp}]}:h}))}))},Yr=(l,o,d)=>{var y,P,he,ye;if(!o)return!1;const h=((y=l.sender)==null?void 0:y.id)||((P=l.sender)==null?void 0:P._id)||l.sender,N=((he=l.receiver)==null?void 0:he.id)||((ye=l.receiver)==null?void 0:ye._id)||l.receiver,v=l.chatId||l.chatRoom;return o.type==="personal"&&o.id&&(h===o.id&&N===d.id||h===d.id&&N===o.id||String(h)===String(o.id)||String(N)===String(o.id))?!0:o.type==="group"?v===o.id||l.groupId===o.id:!1},Ys=(l,o)=>{var d,h;return{id:l.id||l._id||l.messageId,message:l.message||l.content,messageType:l.messageType||"text",fileUrl:l.fileUrl,fileName:l.fileName,fileSize:l.fileSize,fileType:l.fileType,sender:typeof l.sender=="object"?l.sender:{id:o,name:l.senderName||((d=l.sender)==null?void 0:d.name)||"User",profileImage:l.senderProfileImage||((h=l.sender)==null?void 0:h.profileImage)},createdAt:l.createdAt||l.timestamp||new Date().toISOString(),timestamp:l.timestamp||l.createdAt,isFromOtherUser:!(o===s.id||o===s._id)}},Et=(l,o,d)=>{var v;const h=d===s.id||d===s._id,N={id:o.id||o._id||o.messageId,message:o.message||o.content,senderName:h?"You":o.senderName||((v=o.sender)==null?void 0:v.name)||"User",senderId:d,timestamp:o.createdAt||o.timestamp||new Date().toISOString()};M(y=>({...y,[l]:N}))},ys=async(l=null)=>{var o;try{l&&k(!0);let d;const h={limit:w};if(l&&(h.before=l),f.type==="personal"){if(!f.id){console.error("User ID is undefined for personal chat");return}d=await et.getPersonalMessages(f.id,h)}else{if(!f.id){console.error("Group ID is undefined for group chat");return}d=await et.getGroupMessages(f.id,h)}let N,v;if(d.data&&typeof d.data=="object"?Array.isArray(d.data.messages)?(N=d.data.messages,v=d.data.hasMore||!1):Array.isArray(d.data)?(N=d.data,v=d.data.length>=w):(N=[],v=!1):(N=[],v=!1),l)L(y=>{const P=new Set(y.map(ye=>ye._id||ye.id));return[...N.filter(ye=>{const ke=ye._id||ye.id;return!P.has(ke)}),...y]}),K(v),k(!1),setTimeout(()=>{if(wt.current&&Yt.current>0){const P=wt.current.scrollHeight-Yt.current;wt.current.scrollTop=P+100}},0);else if(L(N||[]),K(v),N&&N.length>0){const y=N[N.length-1];Et(f.id,y,((o=y.sender)==null?void 0:o.id)||y.sender)}}catch(d){console.error("Error fetching messages:",d),U.error("Failed to load messages"),L([]),l&&k(!1)}},ws=l=>{const o=document.createElement("input");o.type="file",o.style.display="none",l==="image"?o.accept="image/*":l==="video"?o.accept="video/*":l==="document"&&(o.accept=".pdf,.doc,.docx,.txt,.csv,.xls,.xlsx,.ppt,.pptx,.xlsm,.xlsx,.zip,.rar,.7z,.tar,.gz,.bz2,.xz,.iso,.dmg,.img,.bin,.exe,.msi,.dmg,.iso,.tar,.gz,.bz2,.xz,.img,.bin,.exe,.msi"),o.onchange=d=>{const h=d.target.files[0];if(h){if(Z(h),h.type.startsWith("image/")){const N=new FileReader;N.onload=v=>E(v.target.result),N.readAsDataURL(h)}else E(null);ee(!1)}},document.body.appendChild(o),o.click(),document.body.removeChild(o)},Js=()=>{Z(null),E(null)},rs=async(l,o,d)=>{try{ue(Le=>({...Le,[d]:{progress:0,downloading:!0}}));const h=await fetch($(l)),N=h.headers.get("content-length"),v=parseInt(N,10);if(!h.ok)throw new Error("Download failed");const y=h.body.getReader(),P=[];let he=0;for(;;){const{done:Le,value:se}=await y.read();if(Le)break;P.push(se),he+=se.length;const ie=v?Math.round(he/v*100):0;ue(Ae=>({...Ae,[d]:{progress:ie,downloading:!0}}))}const ye=new Blob(P),ke=window.URL.createObjectURL(ye),Ue=document.createElement("a");Ue.href=ke,Ue.download=o,document.body.appendChild(Ue),Ue.click(),document.body.removeChild(Ue),window.URL.revokeObjectURL(ke),ue(Le=>({...Le,[d]:{progress:100,downloading:!1}})),st(Le=>{const se={...Le,[d]:!0};try{sessionStorage.setItem("downloadedMessages",JSON.stringify(se))}catch{}return se}),setTimeout(()=>{ue(Le=>{const se={...Le};return delete se[d],se})},2e3)}catch(h){console.error("Download failed:",h),ue(N=>({...N,[d]:{progress:0,downloading:!1,error:!0}}))}};u.useEffect(()=>{const l=o=>{H&&!o.target.closest(".file-options-container")&&ee(!1),Ut&&!o.target.closest(".message-dropdown-container")&&at(null)};return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[H,Ut]);const Jr=async l=>{if(l.preventDefault(),!J.trim()&&!A||!f)return;const o=J.trim();q("");try{let d,h="text";A&&(A.type.startsWith("image/")?h="image":A.type.startsWith("video/")?h="video":h="file");const N={id:Date.now(),message:o||(A?A.name:""),messageType:h,fileUrl:A?URL.createObjectURL(A):null,fileName:A?A.name:null,fileSize:A?A.size:null,fileType:A?A.type:null,sender:{id:s.id,name:s.name,profileImage:s.profileImage},createdAt:new Date().toISOString(),timestamp:new Date().toISOString(),isOptimistic:!0};if(L(v=>[...v,N]),Et(f.id,{id:N.id,message:N.message,createdAt:N.createdAt},s.id),A){ct(!0),Te(0);const v=new FormData;v.append("file",A),v.append("message",o);const y=P=>{const he=Math.round(P.loaded*100/P.total);Te(he),console.log(` Upload progress: ${he}%`)};try{f.type==="personal"?(v.append("receiver",f.id),d=await et.sendPersonalMessage(v,y)):(v.append("group",f.id),d=await et.sendGroupMessage(v,y)),U.success(`File uploaded successfully! (${(A.size/(1024*1024)).toFixed(2)}MB)`)}finally{ct(!1),Te(0),Js()}}else if(f.type==="personal")try{await n(f.id,o,"text",!1),console.log(" Message sent via context socket")}catch(v){console.warn("Context socket failed, trying API:",v),await et.sendPersonalMessage({sender:s.id,receiver:f.id,message:o,timestamp:new Date().toISOString()})}else try{await n(f.id,o,"text",!0),console.log(" Group message sent via context socket")}catch(v){console.warn("Context group socket failed, trying API:",v),await et.sendGroupMessage({sender:s.id,group:f.id,message:o,timestamp:new Date().toISOString()})}console.log(" Message sent successfully")}catch(d){console.error(" Failed to send message:",d),U.error("Failed to send message"),L(h=>h.filter(N=>!N.isOptimistic))}},Ms=(l=!1)=>{var o;(o=Es.current)==null||o.scrollIntoView({behavior:l?"instant":"smooth"})},As=[..._.map(l=>({id:l.id,name:l.name,email:l.email,type:"personal",avatar:l.name.charAt(0).toUpperCase(),profileImage:l.profileImage,lastMessage:le[l.id]||null})),...R.map(l=>{var o;return{id:l.id,name:l.name,email:`${((o=l.members)==null?void 0:o.length)||0} members`,type:"group",avatar:l.avatar?`${we}${l.avatar}`:"G",profileImage:l.avatar,lastMessage:le[l.id]||null}})].sort((l,o)=>{var N,v;const d=(N=l.lastMessage)!=null&&N.timestamp?new Date(l.lastMessage.timestamp).getTime():0;return((v=o.lastMessage)!=null&&v.timestamp?new Date(o.lastMessage.timestamp).getTime():0)-d}),Kr=(()=>{let l=As;switch(ne){case"unread":l=As.filter(o=>be[o.id]>0);break;case"groups":l=As.filter(o=>o.type==="group");break;case"all":default:l=As;break}return l.filter(o=>o.name.toLowerCase().includes(Q.toLowerCase())||o.email.toLowerCase().includes(Q.toLowerCase()))})();return pe?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"})}):e.jsxs("div",{className:"h-screen bg-gray-50 flex",children:[e.jsxs("div",{className:"w-full h-screen flex bg-white shadow-lg",children:[e.jsxs("div",{className:"w-1/3 min-w-[300px] max-w-[400px] bg-white border-r border-gray-200 flex flex-col",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",title:"Go back",children:e.jsx(es,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg text-start font-semibold text-gray-800",children:"Admin Chat"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>window.location.href="/profile",className:"text-gray-500 hover:text-gray-700",title:"Profile",children:e.jsx(_t,{className:"w-5 h-5"})}),e.jsx(Cn,{className:"w-5 h-5 text-gray-500 cursor-pointer hover:text-gray-700"})]})]}),e.jsx("div",{className:"flex items-center space-x-3 mb-3",children:e.jsxs("button",{onClick:()=>window.location.href="/profile",className:"flex items-center space-x-3 hover:opacity-80 transition-opacity",children:[s.profileImage?e.jsx("img",{src:`${we}${s.profileImage}`,alt:"Profile",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-medium",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-xs text-start text-green-600",children:"Online"})]})]})})]}),e.jsxs("div",{className:"p-3 bg-white border-b border-gray-200",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx(Gs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search or start new chat",value:Q,onChange:l=>W(l.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-green-400"})]}),e.jsxs("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>I("all"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${ne==="all"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"All"}),e.jsxs("button",{onClick:()=>I("unread"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${ne==="unread"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:["Unread",Object.values(be).reduce((l,o)=>l+o,0)>0&&e.jsx("span",{className:"ml-1 bg-green-500 text-white text-xs rounded-full px-1.5 py-0.5",children:Object.values(be).reduce((l,o)=>l+o,0)})]}),e.jsx("button",{onClick:()=>I("groups"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${ne==="groups"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Groups"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[Kr.map(l=>{var o;return e.jsx("div",{onClick:()=>{console.log("Selecting chat:",l),O({type:l.type,id:l.id,name:l.name,profileImage:l.profileImage}),be[l.id]&&(te(d=>{const h={...d};return delete h[l.id],h}),et.updateChatState({chatId:l.id,chatType:l.type,action:"clear_unread"}).catch(d=>{console.error("Error clearing unread count:",d)}))},className:`p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 ${(f==null?void 0:f.id)===l.id&&(f==null?void 0:f.type)===l.type?"bg-green-50":""}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-200 cursor-pointer hover:ring-2 hover:ring-green-400 transition-all",onClick:d=>{d.stopPropagation(),l.profileImage&&Qe({image:l.type==="personal"?`${we}${l.profileImage}`:l.avatar,name:l.name})},children:l.type==="personal"?l.profileImage?e.jsx("img",{src:`${we}${l.profileImage}`,alt:l.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-lg",children:l.avatar})}):l.profileImage?e.jsx("img",{src:l.avatar,alt:l.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:e.jsx(lt,{className:"w-6 h-6 text-white"})})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 truncate",children:l.name}),l.type==="group"&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Group"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:(o=l.lastMessage)!=null&&o.timestamp?Se(l.lastMessage.timestamp):""}),be[l.id]&&be[l.id]>0&&e.jsx("div",{className:"bg-green-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center",children:be[l.id]>99?"99+":be[l.id]})]})]}),e.jsx("p",{className:"text-sm text-gray-500 truncate",children:l.lastMessage&&l.lastMessage.message?`${l.lastMessage.senderName||"You"}: ${l.lastMessage.message}`:"No messages yet"})]})]})},`${l.type}-${l.id}`)}),Kr.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fs,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:Q?"No chats found.":"No chats available."})]})]})]}),qe&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:()=>Qe(null),children:e.jsxs("div",{className:"relative max-w-2xl max-h-[90vh] p-4",children:[e.jsx("button",{onClick:()=>Qe(null),className:"absolute top-6 right-6 z-10 bg-white/10 hover:bg-white/20 text-white rounded-full p-2 transition-colors",title:"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-4",children:e.jsx("h3",{className:"text-white text-xl font-semibold text-center",children:qe.name})}),e.jsx("img",{src:qe.image,alt:qe.name,className:"w-full h-auto max-h-[70vh] object-contain",onClick:l=>l.stopPropagation()})]})]})}),Xe&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>Fe(null),onMouseMove:Cs,onMouseUp:ls,onMouseLeave:ls,children:e.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center overflow-hidden",children:[e.jsx("button",{onClick:()=>Fe(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{onClick:l=>{l.stopPropagation();const o=document.createElement("a");o.href=Xe.src,o.download=Xe.alt,document.body.appendChild(o),o.click(),document.body.removeChild(o)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:e.jsx(vt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),Pe()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Zoom In",children:e.jsx(Ii,{className:"w-5 h-5"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),dt()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Zoom Out",children:e.jsx(Ti,{className:"w-5 h-5"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),xt()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Reset Zoom",children:e.jsx(zn,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"absolute bottom-4 left-4 z-10 bg-black/50 text-white px-3 py-2 rounded-lg text-sm",children:[Math.round(ae*100),"%"]}),e.jsx("img",{src:Xe.src,alt:Xe.alt,className:`object-contain transition-transform duration-200 ${re?"cursor-grabbing":"cursor-grab"}`,style:{transform:`translate(${oe.x}px, ${oe.y}px) scale(${ae})`,maxWidth:"none",maxHeight:"none",width:"auto",height:"auto"},onMouseDown:Rt,onClick:l=>l.stopPropagation(),draggable:!1})]})}),Ie&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>We(null),children:e.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center",children:[e.jsx("button",{onClick:()=>We(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{onClick:l=>{l.stopPropagation();const o=document.createElement("a");o.href=Ie.src,o.download=Ie.alt,document.body.appendChild(o),o.click(),document.body.removeChild(o)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:e.jsx(vt,{className:"w-5 h-5"})}),e.jsx("video",{src:Ie.src,controls:!0,autoPlay:!0,className:"max-w-full max-h-full object-contain",onClick:l=>l.stopPropagation()})]})}),Ye&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>pt(null),children:e.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center",children:[e.jsx("button",{onClick:()=>pt(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{onClick:l=>{l.stopPropagation();const o=document.createElement("a");o.href=Ye.src,o.download=Ye.fileName,document.body.appendChild(o),o.click(),document.body.removeChild(o)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:e.jsx(vt,{className:"w-5 h-5"})}),e.jsx("div",{className:"bg-white rounded-lg shadow-2xl w-full h-full max-w-4xl max-h-[90vh] overflow-hidden",children:Ye.fileType==="application/pdf"?e.jsx("iframe",{src:Ye.src,className:"w-full h-full border-0",title:Ye.fileName,onClick:l=>l.stopPropagation()}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-8",children:[e.jsx(ms,{className:"w-24 h-24 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:Ye.fileName}),e.jsxs("p",{className:"text-gray-600 mb-4",children:[(Ye.fileSize/1024/1024).toFixed(2)," MB"]}),e.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["This file type cannot be previewed in the browser.",e.jsx("br",{}),"Click the download button to save and view the file."]}),e.jsx("button",{onClick:l=>{l.stopPropagation();const o=document.createElement("a");o.href=Ye.src,o.download=Ye.fileName,document.body.appendChild(o),o.click(),document.body.removeChild(o)},className:"mt-4 bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors",children:"Download File"})]})})]})}),e.jsx("div",{className:"flex-1 flex flex-col",children:f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:f.type==="personal"?f.profileImage?e.jsx("img",{src:`${we}${f.profileImage}`,alt:f.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold",children:f.name.charAt(0).toUpperCase()})}):f.profileImage?e.jsx("img",{src:`${we}${f.profileImage}`,alt:f.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:e.jsx(lt,{className:"w-5 h-5 text-white"})})}),e.jsxs("div",{className:`cursor-pointer ${f.type==="group"?"hover:bg-gray-50 p-2 rounded-lg transition-colors":""}`,onClick:()=>{f.type==="group"&&(window.location.href=`/group/${f.id}`)},title:f.type==="group"?"Click to view group info":"",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:f.name}),e.jsx("p",{className:"text-xs text-gray-500",children:f.type==="personal"?j(f.id)?e.jsx("span",{className:"text-green-600 font-medium",children:"Online"}):me(T(f.id).lastSeen):`${f.email}`})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[f.type==="personal"?e.jsxs(e.Fragment,{children:[e.jsx(or,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var l,o;if(!(!f||f.type!=="personal"))try{const h=(o=(l=(await nr.initiate(f.id,"voice")).data)==null?void 0:l.data)==null?void 0:o.call;h&&h._id&&(Ge(!1),de({callId:h._id,callType:"voice",otherUser:h.otherUser}),ze(!0),t.emit("call-initiate",{receiverId:f.id,callType:"voice",callId:h._id}))}catch(d){console.error("Failed to initiate call",d)}}}),e.jsx(ht,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var l,o;if(!(!f||f.type!=="personal"))try{const h=(o=(l=(await nr.initiate(f.id,"video")).data)==null?void 0:l.data)==null?void 0:o.call;h&&h._id&&(Ge(!1),de({callId:h._id,callType:"video",otherUser:h.otherUser}),ze(!0),t.emit("call-initiate",{receiverId:f.id,callType:"video",callId:h._id}))}catch(d){console.error("Failed to initiate video call",d)}}})]}):e.jsxs(e.Fragment,{children:[e.jsx(or,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var l,o,d,h,N;if(!(!f||f.type!=="group")){console.log("Initiating group call for:",f.id,f.name);try{const y=(o=(l=(await is.initiate(f.id,"voice")).data)==null?void 0:l.data)==null?void 0:o.call;y&&y._id&&(B(!1),p({callId:y._id,callType:"voice",groupId:f.id,group:{name:f.name,avatar:f.profileImage}}),rt(!0),t.emit("group-call-initiate",{groupId:f.id,callType:"voice",callId:y._id}))}catch(v){console.error("Failed to initiate group call",v),console.error("Error response:",(d=v.response)==null?void 0:d.data);const y=((N=(h=v.response)==null?void 0:h.data)==null?void 0:N.message)||"Failed to initiate group call";U.error(y)}}}}),e.jsx(ht,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var l,o,d,h,N;if(!(!f||f.type!=="group")){console.log("Initiating group video call for:",f.id,f.name);try{const y=(o=(l=(await is.initiate(f.id,"video")).data)==null?void 0:l.data)==null?void 0:o.call;y&&y._id&&(B(!1),p({callId:y._id,callType:"video",groupId:f.id,group:{name:f.name,avatar:f.profileImage}}),rt(!0),t.emit("group-call-initiate",{groupId:f.id,callType:"video",callId:y._id}))}catch(v){console.error("Failed to initiate group video call",v),console.error("Error response:",(d=v.response)==null?void 0:d.data);const y=((N=(h=v.response)==null?void 0:h.data)==null?void 0:N.message)||"Failed to initiate group video call";U.error(y)}}}})]}),e.jsx(Cn,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800"})]})]}),e.jsx("div",{ref:wt,className:"flex-1 overflow-y-auto p-4 bg-gray-50 relative",children:e.jsxs("div",{className:"max-w-8xl mx-auto",children:[Y&&e.jsx("div",{className:"flex justify-center py-2",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})}),!Y&&G&&g.length>0&&e.jsx("div",{className:"flex justify-center py-2",children:e.jsx("button",{onClick:()=>{var o,d,h;const l=((o=g[0])==null?void 0:o._id)||((d=g[0])==null?void 0:d.id);l&&(Yt.current=((h=wt.current)==null?void 0:h.scrollHeight)||0,ys(l))},className:"px-4 py-2 text-sm bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors",children:"Load Previous Messages"})}),Array.isArray(g)&&g.map((l,o)=>{var y,P,he,ye,ke,Ue,Le;const d=o===0||(()=>{const se=new Date(l.createdAt||l.timestamp),ie=new Date(g[o-1].createdAt||g[o-1].timestamp),Ae=new Date(se.getFullYear(),se.getMonth(),se.getDate()),_e=new Date(ie.getFullYear(),ie.getMonth(),ie.getDate());return Ae.getTime()!==_e.getTime()})();let h=!1;if(typeof l.sender=="object"&&l.sender!==null){const se=l.sender._id||l.sender.id;h=se===s.id||se===s._id||se===((y=s.id)==null?void 0:y.toString())||se===((P=s._id)==null?void 0:P.toString())}else h=l.sender===s.id||l.sender===s._id||l.sender===((he=s.id)==null?void 0:he.toString())||l.sender===((ye=s._id)==null?void 0:ye.toString());const N=typeof l.sender=="object"?(ke=l.sender)==null?void 0:ke.name:"User",v=typeof l.sender=="object"?(Ue=l.sender)==null?void 0:Ue.profileImage:null;return e.jsxs(In.Fragment,{children:[d&&e.jsx("div",{className:"flex justify-center my-4",children:e.jsx("div",{className:"bg-gray-200 text-gray-600 text-xs px-3 py-1 rounded-full",children:Me(l.createdAt||l.timestamp)})}),e.jsx("div",{className:`flex ${h?"justify-end":"justify-start"} mb-4`,children:e.jsxs("div",{className:`flex items-start gap-2 max-w-sm lg:max-w-md ${h?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-300 flex-shrink-0",children:h?s.profileImage?e.jsx("img",{src:`${we}${s.profileImage}`,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-medium",children:s.name.charAt(0).toUpperCase()})}):v?e.jsx("img",{src:`${we}${v}`,alt:N,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-400 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-medium",children:String(N).charAt(0).toUpperCase()})})}),e.jsxs("div",{className:`relative group flex flex-col px-3 py-2 rounded-lg ${h?"bg-green-500 text-white rounded-br-none":"bg-gray-200 text-gray-900 rounded-bl-none"} ${bt&&Ts&&Je(Ts)===Je(l)?"ring-2 ring-blue-400":""}`,onMouseDown:()=>tt(l),onMouseUp:yt,onMouseLeave:yt,onTouchStart:()=>tt(l),onTouchEnd:yt,onContextMenu:se=>{se.preventDefault(),Ht(l),bs(!0)},children:[l.messageType==="text"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:se=>Lt(Je(l),se),className:`absolute top-1 right-1 z-10 p-1 rounded-full transition-all duration-200 ${h?"bg-green-600/80 hover:bg-green-700/80 text-white":"bg-gray-300/80 hover:bg-gray-400/80 text-gray-700"} ${Ut===Je(l)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:e.jsx(_s,{className:"w-3 h-3"})}),Ut===Je(l)&&e.jsxs("div",{className:"message-dropdown-container absolute top-8 right-1 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[e.jsxs("button",{onClick:()=>zt("copy",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Rs,{className:"w-4 h-4"}),"Copy"]}),(()=>{var Ae,_e,Ve,Be;const se=((Ae=l.sender)==null?void 0:Ae.id)||((_e=l.sender)==null?void 0:_e._id)||l.sender;return se===s.id||se===s._id||se===((Ve=s.id)==null?void 0:Ve.toString())||se===((Be=s._id)==null?void 0:Be.toString())?e.jsxs("button",{onClick:()=>zt("edit",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4"}),"Edit"]}):null})(),e.jsxs("button",{onClick:()=>zt("forward",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Us,{className:"w-4 h-4"}),"Forward"]})]})]}),l.fileUrl&&e.jsx("div",{className:"mb-2",children:l.messageType==="image"?e.jsxs("div",{className:"relative group",onMouseDown:()=>tt(l),onMouseUp:yt,onMouseLeave:yt,onTouchStart:()=>tt(l),onTouchEnd:yt,children:[e.jsx("button",{onClick:se=>Lt(Je(l),se),className:`absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 ${h?"bg-green-500/80 hover:bg-green-600/80 text-white":"bg-gray-500/80 hover:bg-gray-600/80 text-white"} ${Ut===Je(l)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:e.jsx(_s,{className:"w-3 h-3"})}),Ut===Je(l)&&e.jsxs("div",{className:"message-dropdown-container absolute top-10 right-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[e.jsxs("button",{onClick:()=>zt("copy",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Rs,{className:"w-4 h-4"}),"Copy"]}),l.messageType==="text"&&(()=>{var Ae,_e,Ve,Be;const se=((Ae=l.sender)==null?void 0:Ae.id)||((_e=l.sender)==null?void 0:_e._id)||l.sender;return se===s.id||se===s._id||se===((Ve=s.id)==null?void 0:Ve.toString())||se===((Be=s._id)==null?void 0:Be.toString())?e.jsxs("button",{onClick:()=>zt("edit",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4"}),"Edit"]}):null})(),e.jsxs("button",{onClick:()=>zt("forward",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Us,{className:"w-4 h-4"}),"Forward"]})]}),e.jsx("img",{src:$(l.fileUrl),alt:l.fileName,className:`max-w-xs rounded-lg ${!h&&!Ze[l.id||l._id]?"blur-sm cursor-pointer":"cursor-pointer"} hover:opacity-90`,onClick:()=>{var se;!h&&!Ze[l.id||l._id]?rs(l.fileUrl,l.fileName,l.id||l._id):Is({src:$(l.fileUrl),alt:l.fileName,sender:((se=l.sender)==null?void 0:se.name)||"User",timestamp:l.createdAt||l.timestamp})}}),!h&&!Ze[l.id||l._id]&&e.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-black/60 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1",children:[e.jsx(vt,{className:"w-3 h-3"}),((l.fileSize||0)/1024/1024).toFixed(1)," MB"]}),V[l.id||l._id]&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"bg-black/60 rounded-lg px-3 py-2 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-2"}),e.jsxs("p",{className:"text-sm text-white",children:[V[l.id||l._id].progress,"%"]})]})})]}):l.messageType==="video"?e.jsxs("div",{className:"relative group",onMouseDown:()=>tt(l),onMouseUp:yt,onMouseLeave:yt,onTouchStart:()=>tt(l),onTouchEnd:yt,children:[e.jsx("button",{onClick:se=>Lt(Je(l),se),className:`absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 ${h?"bg-green-500/80 hover:bg-green-600/80 text-white":"bg-gray-500/80 hover:bg-gray-600/80 text-white"} ${Ut===Je(l)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:e.jsx(_s,{className:"w-3 h-3"})}),Ut===Je(l)&&e.jsxs("div",{className:"message-dropdown-container absolute top-10 right-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[e.jsxs("button",{onClick:()=>zt("copy",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Rs,{className:"w-4 h-4"}),"Copy"]}),l.messageType==="text"&&(()=>{var Ae,_e,Ve,Be;const se=((Ae=l.sender)==null?void 0:Ae.id)||((_e=l.sender)==null?void 0:_e._id)||l.sender;return se===s.id||se===s._id||se===((Ve=s.id)==null?void 0:Ve.toString())||se===((Be=s._id)==null?void 0:Be.toString())?e.jsxs("button",{onClick:()=>zt("edit",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4"}),"Edit"]}):null})(),e.jsxs("button",{onClick:()=>zt("forward",l),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Us,{className:"w-4 h-4"}),"Forward"]})]}),e.jsx("video",{src:$(l.fileUrl),controls:!0,className:`max-w-xs rounded-lg ${!h&&!Ze[l.id||l._id]?"blur-sm":""} cursor-pointer`,onClick:()=>{var se;!h&&!Ze[l.id||l._id]?rs(l.fileUrl,l.fileName,l.id||l._id):We({src:$(l.fileUrl),alt:l.fileName,sender:((se=l.sender)==null?void 0:se.name)||"User",timestamp:l.createdAt||l.timestamp})}}),!h&&!Ze[l.id||l._id]&&e.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-black/60 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1",children:[e.jsx(vt,{className:"w-3 h-3"}),((l.fileSize||0)/1024/1024).toFixed(1)," MB"]}),V[l.id||l._id]&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"bg-black/60 rounded-lg px-3 py-2 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-2"}),e.jsxs("p",{className:"text-sm text-white",children:[V[l.id||l._id].progress,"%"]})]})})]}):e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-white bg-opacity-20 rounded-lg relative cursor-pointer",onMouseDown:()=>tt(l),onMouseUp:yt,onMouseLeave:yt,onTouchStart:()=>tt(l),onTouchEnd:yt,onClick:()=>{var se;!h&&!Ze[l.id||l._id]?rs(l.fileUrl,l.fileName,l.id||l._id):pt({src:$(l.fileUrl),fileName:l.fileName,fileSize:l.fileSize,fileType:l.fileType,sender:((se=l.sender)==null?void 0:se.name)||"User",timestamp:l.createdAt||l.timestamp})},children:[e.jsx(ms,{className:"w-5 h-5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:l.fileName}),e.jsxs("p",{className:"text-xs opacity-75",children:[(l.fileSize/1024/1024).toFixed(2)," MB",ce(l.fileUrl)&&e.jsx("span",{className:"ml-2 text-blue-400",children:" Google Drive"})]})]}),!h&&!Ze[l.id||l._id]&&e.jsx("button",{onClick:se=>{se.stopPropagation(),ce(l.fileUrl)?(window.open(l.fileUrl,"_blank"),U.success("Opening file in Google Drive...")):rs(l.fileUrl,l.fileName,l.id||l._id)},className:"p-1 hover:bg-white hover:bg-opacity-20 rounded",disabled:(Le=V[l.id||l._id])==null?void 0:Le.downloading,children:e.jsx(vt,{className:"w-4 h-4"})}),V[l.id||l._id]&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"bg-black/60 rounded-lg px-2 py-1 text-center",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-1"}),e.jsxs("p",{className:"text-xs text-white",children:[V[l.id||l._id].progress,"%"]})]})})]})}),l.message&&(Wt&&Je(Wt)===Je(l)?e.jsxs("div",{className:"mb-2",children:[e.jsx("input",{type:"text",value:ts,onChange:se=>Tt(se.target.value),className:"w-full px-2 py-1 text-sm bg-white bg-opacity-20 rounded border-none focus:outline-none focus:ring-1 focus:ring-white",autoFocus:!0,onKeyDown:se=>{se.key==="Enter"&&qs(),se.key==="Escape"&&Vs()}}),e.jsxs("div",{className:"flex gap-1 mt-1",children:[e.jsx("button",{onClick:qs,className:"text-xs px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700",children:"Save"}),e.jsx("button",{onClick:Vs,className:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Cancel"})]})]}):e.jsxs("p",{className:"text-sm mb-1 break-words",children:[l.message,(l.isEdited||l.editedAt)&&e.jsx("span",{className:"text-xs opacity-75 ml-1",children:"(edited)"})]})),e.jsxs("div",{className:`flex items-center gap-1 text-xs self-end ${h?"text-green-100":"text-gray-500"}`,children:[e.jsx("span",{children:new Date(l.createdAt||l.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),h&&e.jsx("span",{className:"ml-1 relative inline-flex items-center",title:l.isRead||l.readBy&&l.readBy.length>0?"Seen":"Delivered",children:l.isRead||l.readBy&&l.readBy.length>0?e.jsx("svg",{className:"w-4 h-4 text-blue-500",viewBox:"0 0 16 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z",fill:"currentColor"})}):e.jsx("svg",{className:"w-4 h-4 opacity-70",viewBox:"0 0 16 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z",fill:"currentColor"})})})]})]})]})})]},l.id||l._id||o)}),e.jsx("div",{ref:Es})]})}),A&&e.jsx("div",{className:"bg-gray-50 border-t border-gray-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[S?e.jsx("img",{src:S,alt:"Preview",className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(ms,{className:"w-6 h-6 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:A.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(A.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsx("button",{onClick:Js,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),$e&&e.jsx("div",{className:"bg-blue-50 border-t border-blue-200 p-4",children:e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Uploading file..."}),e.jsxs("p",{className:"text-sm font-medium text-blue-900",children:[je,"%"]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${je}%`}})})]})})}),e.jsxs("div",{className:"bg-white border-t border-gray-200 p-4 relative",children:[e.jsxs("form",{onSubmit:Jr,className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>ee(!H),className:"p-2 text-gray-500 hover:text-gray-700",title:"Attach file",children:e.jsx(ji,{className:"w-6 h-6"})}),e.jsx("div",{className:"flex-1 relative",children:e.jsx("input",{type:"text",value:J,onChange:l=>q(l.target.value),placeholder:"Type a message",className:"w-full py-2 px-4 bg-gray-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-green-400"})}),e.jsx("button",{type:"submit",disabled:!J.trim()&&!A||$e,className:"bg-green-500 text-white p-2 rounded-full hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:$e?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsx(qr,{className:"w-5 h-5"})})]}),H&&e.jsx("div",{className:"file-options-container absolute bottom-16 left-4 bg-white rounded-lg shadow-lg border border-gray-200 p-2 z-50",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>ws("image"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(Ot,{className:"w-8 h-8 text-green-600 mb-1"}),e.jsx("span",{className:"text-xs text-gray-700",children:"Image"})]}),e.jsxs("button",{onClick:()=>ws("video"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(ht,{className:"w-8 h-8 text-blue-600 mb-1"}),e.jsx("span",{className:"text-xs text-gray-700",children:"Video"})]}),e.jsxs("button",{onClick:()=>ws("document"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(ms,{className:"w-8 h-8 text-purple-600 mb-1"}),e.jsx("span",{className:"text-xs text-gray-700",children:"Document"})]})]})})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(fs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Welcome to WhatsApp"}),e.jsx("p",{className:"text-gray-500 max-w-md",children:"Select a conversation from the sidebar to start messaging. Your conversations will appear on the left side."})]})})})]}),ft&&it&&e.jsx(e.Fragment,{children:it.callType==="video"?e.jsx(Vn,{user:s,callData:it,isIncoming:Ce,onCallEnd:()=>{ze(!1),de(null)},onCallAnswer:()=>{},onCallDecline:()=>{ze(!1),de(null)}}):e.jsx(qn,{user:s,callData:it,isIncoming:Ce,onCallEnd:()=>{ze(!1),de(null)},onCallAnswer:()=>{},onCallDecline:()=>{ze(!1),de(null)}})}),cs&&Oe&&X&&Oe.callType==="video"&&e.jsx(Yn,{callData:Oe,onAccept:()=>{console.log(" Chat Page - Accepting incoming video call"),B(!1),t&&(Oe!=null&&Oe.callId)&&t.emit("group-call-join",{callId:Oe.callId,groupId:Oe.groupId})},onDecline:()=>{rt(!1),p(null),B(!1),t&&(Oe!=null&&Oe.callId)&&t.emit("group-call-decline",{callId:Oe.callId,groupId:Oe.groupId})}}),cs&&Oe&&!X&&(Oe.callType==="video"?e.jsx(Wn,{user:s,callData:Oe,onCallEnd:()=>{rt(!1),p(null),B(!1)}}):e.jsx(Hn,{user:s,callData:Oe,isIncoming:X,onCallEnd:()=>{rt(!1),p(null),B(!1)},onCallAnswer:()=>{B(!1)},onCallDecline:()=>{rt(!1),p(null),B(!1)}}))]})},Ld=()=>{const{user:s}=It(),t=ps(),[r,n]=u.useState([]),[i,c]=u.useState(!0),[a,m]=u.useState(""),[C,b]=u.useState(!1),[j,T]=u.useState(null),[_,z]=u.useState({name:"",email:"",password:"",role:"user",phone:"",designation:"",bio:"",isActive:!0}),[R,F]=u.useState(""),[f,O]=u.useState(!1),[g,L]=u.useState("list"),[J,q]=u.useState(new Set),Q=w=>J.has(w),W=w=>{q(A=>{const Z=new Set(A);return Z.has(w)?Z.delete(w):Z.add(w),Z})},pe=()=>q(new Set),ge=()=>q(new Set(k.map(w=>w.id))),be=async w=>{if(J.size===0)return;const A=w?"enable":"disable";if(window.confirm(`Are you sure you want to ${A} ${J.size} selected user(s)?`))try{const Z=new Map(r.map(H=>[H.id,H]));let S=0,E=0;for(const H of J){const ee=Z.get(H);if(ee){if(H===(s==null?void 0:s.id)){E++;continue}if(s.role==="admin"&&ee.role==="admin"){E++;continue}if((ee.isActive??!0)===w){E++;continue}try{await St.toggleUserStatus(H),S++}catch(V){console.error(`Failed to toggle user ${H}:`,V),E++}}}S>0&&U.success(`${S} user(s) ${A}d successfully`),E>0&&U.info(`${E} user(s) skipped (already in desired state or cannot be modified)`),pe(),te()}catch(Z){console.error("Bulk toggle error",Z),window.location.reload()}};u.useEffect(()=>{te()},[]);const te=async()=>{try{c(!0);const w=await St.getUsers();let A=w.data;s.role==="admin"&&(A=w.data.filter(Z=>Z.role!=="superadmin")),n(A)}catch(w){console.error("Error fetching users:",w),U.error("Failed to load users")}finally{c(!1)}},le=async w=>{var A,Z;if(w.preventDefault(),!_.name.trim()){U.error("Name is required");return}if(!_.email.trim()){U.error("Email is required");return}if(!j&&!_.password.trim()){U.error("Password is required");return}try{const S={name:_.name.trim(),email:_.email.trim(),role:_.role,phone:_.phone.trim(),designation:_.designation.trim(),bio:_.bio.trim(),isActive:_.isActive};j?(_.password.trim()&&(S.password=_.password),await St.updateUser(j.id,S),U.success("User updated successfully")):(S.password=_.password,await St.createUser(S),U.success("User created successfully")),b(!1),T(null),z({name:"",email:"",password:"",role:"user",phone:"",designation:"",bio:"",isActive:!0}),te()}catch(S){console.error("User operation error:",S),U.error(((Z=(A=S.response)==null?void 0:A.data)==null?void 0:Z.message)||"Operation failed")}},M=async w=>{if(window.confirm("Are you sure you want to delete this user?"))try{await St.deleteUser(w),U.success("User deleted successfully"),te()}catch{U.error("Failed to delete user")}},ne=async(w,A)=>{const Z=A?"disable":"enable";if(window.confirm(`Are you sure you want to ${Z} this user?`))try{await St.toggleUserStatus(w),U.success(`User ${Z}d successfully`),te()}catch{U.error(`Failed to ${Z} user`)}},I=w=>{T(w),z({name:w.name||"",email:w.email||"",password:"",role:w.role||"user",phone:w.phone||"",designation:w.designation||"",bio:w.bio||"",isActive:w.isActive!==!1}),F(w.password||""),O(!1),b(!0)},G=()=>{T(null),z({name:"",email:"",password:"",role:"user",phone:"",designation:"",bio:"",isActive:!0}),F(""),b(!0)},K=w=>{switch(w){case"superadmin":return e.jsx(Ar,{className:"w-4 h-4 text-yellow-600"});case"admin":return e.jsx(ar,{className:"w-4 h-4 text-blue-600"});default:return e.jsx(_t,{className:"w-4 h-4 text-gray-600"})}},Y=w=>{switch(w){case"superadmin":return"bg-yellow-100 text-yellow-800";case"admin":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},k=r.filter(w=>{var A,Z;return w.name.toLowerCase().includes(a.toLowerCase())||w.email.toLowerCase().includes(a.toLowerCase())||((A=w.designation)==null?void 0:A.toLowerCase().includes(a.toLowerCase()))||((Z=w.phone)==null?void 0:Z.includes(a))});return i?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",title:"Go back",children:e.jsx(es,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"text-gray-600",children:s.role==="superadmin"?"Manage admins and users in the system":"Manage users in your organization"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center rounded-md border border-gray-300 overflow-hidden",children:[e.jsx("button",{className:`px-3 py-2 text-sm ${g==="grid"?"bg-gray-200 text-gray-900":"bg-white text-gray-600"}`,onClick:()=>L("grid"),title:"Grid view",children:e.jsx(kd,{className:"w-4 h-4"})}),e.jsx("button",{className:`px-3 py-2 text-sm ${g==="list"?"bg-gray-200 text-gray-900":"bg-white text-gray-600"}`,onClick:()=>L("list"),title:"List view",children:e.jsx(Gr,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:()=>t("/time-management"),className:"btn-secondary inline-flex items-center",title:"Time Management Settings",children:[e.jsx(gs,{className:"w-4 h-4 mr-2"}),"Time Settings"]}),e.jsxs("button",{onClick:G,className:"btn-primary inline-flex items-center",children:[e.jsx(Gn,{className:"w-4 h-4 mr-2"}),"Add New User"]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"card p-6 mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Gs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search users by name, email, designation, or phone...",value:a,onChange:w=>m(w.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),J.size>0&&e.jsxs("div",{className:"card p-4 mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Selected ",J.size," user(s)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:ge,className:"btn-secondary",children:"Select all"}),e.jsx("button",{onClick:pe,className:"btn-secondary",children:"Clear"}),e.jsx("button",{onClick:()=>be(!0),className:"btn-primary",children:"Enable selected"}),e.jsx("button",{onClick:()=>be(!1),className:"btn-secondary text-red-700",children:"Disable selected"})]})]}),g==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:k.map(w=>e.jsxs("div",{className:`relative card p-6 transition-all ${w.isActive?"hover:shadow-lg":"bg-gray-50 border-gray-300 opacity-75"}`,children:[e.jsx("label",{className:"absolute top-3 left-3 inline-flex items-center gap-2 bg-white/80 px-2 py-1 rounded shadow",children:e.jsx("input",{type:"checkbox",checked:Q(w.id),onChange:()=>W(w.id)})}),e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-12 h-12 ${w.isActive?"bg-primary-100":"bg-gray-100"} rounded-lg flex items-center justify-center overflow-hidden`,children:w.profileImage?e.jsx("img",{src:`${we}${w.profileImage}`,alt:"Profile",className:`w-12 h-12 rounded-lg object-cover ${w.isActive?"":"grayscale"}`}):e.jsx(_t,{className:`w-6 h-6 ${w.isActive?"text-primary-600":"text-gray-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-medium ${w.isActive?"text-gray-900":"text-gray-600"}`,children:w.name}),e.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[K(w.role),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Y(w.role)}`,children:w.role})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[w.id!==(s==null?void 0:s.id)&&(w.role!=="superadmin"||(s==null?void 0:s.role)==="superadmin")&&e.jsxs("div",{className:"relative inline-flex bg-gray-200 rounded-full p-1 cursor-pointer",onClick:()=>ne(w.id,w.isActive),children:[e.jsx("div",{className:"absolute top-1 bg-white rounded-full shadow-sm transition-transform duration-300",style:{width:"50%",height:"calc(100% - 8px)",left:w.isActive?"4px":"calc(50% + 2px)",transform:"none"}}),e.jsxs("div",{className:`relative z-10 px-4 py-2 text-xs font-medium rounded-full flex items-center space-x-1 transition-colors duration-200 ${w.isActive?"text-primary-600":"text-gray-500"}`,children:[e.jsx(jn,{className:"w-3 h-3"}),e.jsx("span",{children:"Active"})]}),e.jsxs("div",{className:`relative z-10 px-4 py-2 text-xs font-medium rounded-full flex items-center space-x-1 transition-colors duration-200 ${w.isActive?"text-gray-500":"text-primary-600"}`,children:[e.jsx(Ed,{className:"w-3 h-3"}),e.jsx("span",{children:"Disabled"})]})]}),e.jsx("button",{onClick:()=>I(w),className:"text-primary-600 hover:text-primary-900",title:"Edit user",children:e.jsx(At,{className:"w-4 h-4"})}),w.role!=="superadmin"&&w.id!==(s==null?void 0:s.id)&&e.jsx("button",{onClick:()=>M(w.id),className:"text-red-600 hover:text-red-900",title:"Delete user",children:e.jsx(Ss,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(vi,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:w.email})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(or,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:w.phone||"Not provided"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Bn,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:w.designation||"Not provided"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:w.bio||"No bio provided"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[w.isActive?e.jsx(jn,{className:"w-4 h-4 text-green-600"}):e.jsx(Md,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:`text-sm font-medium px-2 py-1 rounded-full ${w.isActive?"text-green-700 bg-green-100":"text-red-700 bg-red-100"}`,children:w.isActive?"Active":"Disabled"})]}),w.lastSeen&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Last seen: ",new Date(w.lastSeen).toLocaleDateString()]})]}),!w.isActive&&w.disabledAt&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-2",children:[e.jsxs("div",{className:"flex items-center text-xs text-red-700",children:[e.jsx($t,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"font-medium",children:"Disabled:"}),e.jsx("span",{className:"ml-1",children:new Date(w.disabledAt).toLocaleString()})]}),w.disableReason&&e.jsxs("div",{className:"flex items-center text-xs text-red-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Reason:"}),e.jsx("span",{className:"ml-1 capitalize",children:w.disableReason==="auto"?"Auto-disabled":"Manually disabled"})]})]})]})]},w.id))}):e.jsx("div",{className:"card p-0 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsx("input",{type:"checkbox",onChange:w=>w.target.checked?ge():pe(),checked:J.size>0&&J.size===k.length})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.map(w=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:Q(w.id),onChange:()=>W(w.id)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded bg-gray-100 overflow-hidden flex items-center justify-center",children:w.profileImage?e.jsx("img",{src:`${we}${w.profileImage}`,alt:"Profile",className:"w-10 h-10 object-cover"}):e.jsx(_t,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:`font-medium ${w.isActive?"text-gray-900":"text-gray-600"}`,children:w.name}),e.jsx("div",{className:"text-xs text-gray-500",children:w.designation||""})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Y(w.role)}`,children:w.role})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:w.email}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:w.phone||""}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-full ${w.isActive?"text-green-700 bg-green-100":"text-red-700 bg-red-100"}`,children:w.isActive?"Active":"Disabled"}),!w.isActive&&w.disabledAt&&e.jsx("div",{className:"text-xs text-red-600",title:`Disabled at: ${new Date(w.disabledAt).toLocaleString()}`,children:w.disableReason==="auto"?" Auto":" Manual"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[w.id!==(s==null?void 0:s.id)&&(w.role!=="superadmin"||(s==null?void 0:s.role)==="superadmin")&&e.jsx("button",{className:"text-gray-600 hover:text-gray-900",title:"Toggle status",onClick:()=>ne(w.id,w.isActive),children:w.isActive?e.jsx(Si,{className:"w-5 h-5 text-green-600"}):e.jsx(ki,{className:"w-5 h-5 text-gray-400"})}),e.jsx("button",{className:"text-primary-600 hover:text-primary-900",title:"Edit",onClick:()=>I(w),children:e.jsx(At,{className:"w-4 h-4"})}),w.role!=="superadmin"&&w.id!==(s==null?void 0:s.id)&&e.jsx("button",{className:"text-red-600 hover:text-red-900",title:"Delete",onClick:()=>M(w.id),children:e.jsx(Ss,{className:"w-4 h-4"})})]})})]},w.id))})]})})}),k.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(lt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No users found"}),e.jsx("p",{className:"text-gray-500",children:a?"Try adjusting your search terms.":"No users have been created yet."})]})]}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:j?"Edit User":"Create New User"}),e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,value:_.name,onChange:w=>z({..._,name:w.target.value}),className:"input-field",placeholder:"Enter full name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",required:!0,value:_.email,onChange:w=>z({..._,email:w.target.value}),className:"input-field",placeholder:"Enter email address"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[j?"New Password":"Password",j&&e.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(leave blank to keep current)"})]}),e.jsx("input",{type:"password",required:!j,value:_.password,onChange:w=>z({..._,password:w.target.value}),className:"input-field",placeholder:j?"Enter new password (optional)":"Enter password"}),j&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600",children:"Current Password"}),e.jsxs("button",{type:"button",className:"text-xs text-primary-600 hover:text-primary-800 inline-flex items-center gap-1",onClick:()=>O(w=>!w),children:[f?e.jsx(kn,{className:"w-3 h-3"}):e.jsx(Sn,{className:"w-3 h-3"}),f?"Hide":"Show"]})]}),e.jsx("input",{type:f?"text":"password",readOnly:!0,value:R||"[Password not available - please set new password]",className:"w-full input-field font-mono"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),e.jsxs("select",{value:_.role,onChange:w=>z({..._,role:w.target.value}),className:"input-field",children:[e.jsx("option",{value:"user",children:"User"}),s.role==="superadmin"&&e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:_.phone,onChange:w=>z({..._,phone:w.target.value}),className:"input-field",placeholder:"Enter phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Designation"}),e.jsx("input",{type:"text",value:_.designation,onChange:w=>z({..._,designation:w.target.value}),className:"input-field",placeholder:"Enter designation"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bio"}),e.jsx("textarea",{value:_.bio,onChange:w=>z({..._,bio:w.target.value}),className:"input-field",rows:"3",placeholder:"Enter bio (optional)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:_.isActive,onChange:w=>z({..._,isActive:w.target.checked}),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"isActive",className:"ml-2 block text-sm text-gray-900",children:"User is active"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:j?"Update User":"Create User"})]})]})]})})]})},Pd=()=>{It();const[s,t]=u.useState(!0),[r,n]=u.useState(new Date),[i,c]=u.useState(0),[a,m]=u.useState({offset:0,synced:!1}),[C,b]=u.useState([]),[j,T]=u.useState([]),[_,z]=u.useState(!1),[R,F]=u.useState(null),[f,O]=u.useState({name:"",enableTime:"",disableTime:"",users:[],applyToAllUsers:!1,days:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]}),g=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];u.useEffect(()=>{L(),J(),q();const k=setInterval(()=>{n(new Date(Date.now()+i))},1e3),w=setInterval(()=>{L()},5*60*1e3);return()=>{clearInterval(k),clearInterval(w)}},[i]);const L=async()=>{try{const k=await si.getCurrentTime(),w=new Date(k.data.timestamp),A=new Date,Z=w.getTime()-A.getTime();c(Z),n(w),k.data.usingGlobalTime?(m({offset:k.data.ntpOffset||0,synced:!0,systemTime:k.data.systemTime,diff:k.data.globalTimeDiff}),console.log(" Time synced with Global NTP Server (NOT system time)"),console.log(" NTP Offset:",k.data.globalTimeDiff),console.log(" IST Time:",k.data.formatted)):console.log(" Time synced with backend IST:",k.data.formatted)}catch(k){console.error("Failed to sync time with backend:",k),c(0),m({offset:0,synced:!1}),n(new Date)}},J=async()=>{try{const k=await js.getSchedules();b(k.data),t(!1)}catch(k){console.error("Error fetching schedules:",k),t(!1)}},q=async()=>{try{const w=(await St.getUsers()).data.filter(A=>A.role==="user");T(w)}catch(k){console.error("Error fetching users:",k)}},Q=async k=>{var w,A;if(k.preventDefault(),!f.name.trim()){U.error("Please enter schedule name");return}if(!f.enableTime&&!f.disableTime){U.error("Please set at least one time (Enable or Disable)");return}if(!f.applyToAllUsers&&f.users.length===0){U.error('Please select at least one user or enable "Apply to all users"');return}try{R?(await js.updateSchedule(R._id,f),U.success("Schedule updated successfully")):(await js.createSchedule(f),U.success("Schedule created successfully")),z(!1),F(null),le(),J()}catch(Z){console.error("Schedule operation error:",Z),U.error(((A=(w=Z.response)==null?void 0:w.data)==null?void 0:A.message)||"Operation failed")}},W=async k=>{if(window.confirm("Are you sure you want to delete this schedule?"))try{await js.deleteSchedule(k),U.success("Schedule deleted successfully"),J()}catch{U.error("Failed to delete schedule")}},pe=async k=>{try{await js.toggleSchedule(k),J()}catch{U.error("Failed to toggle schedule")}},ge=async(k,w)=>{if(window.confirm(`Reset "${w}"? This will allow it to trigger again today.`))try{await js.resetTrigger(k),U.success("Schedule reset - can trigger again today"),J()}catch{U.error("Failed to reset schedule")}},be=k=>{F(k),O({name:k.name,enableTime:k.enableTime||"",disableTime:k.disableTime||"",users:k.users.map(w=>w._id),applyToAllUsers:k.applyToAllUsers,days:k.days}),z(!0)},te=()=>{F(null),le(),z(!0)},le=()=>{O({name:"",enableTime:"",disableTime:"",users:[],applyToAllUsers:!1,days:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]})},M=k=>{O(w=>({...w,days:w.days.includes(k)?w.days.filter(A=>A!==k):[...w.days,k]}))},ne=k=>{O(w=>({...w,users:w.users.includes(k)?w.users.filter(A=>A!==k):[...w.users,k]}))},I=()=>{O(k=>({...k,users:j.map(w=>w.id)}))},G=()=>{O(k=>({...k,users:[]}))},K=k=>k.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}),Y=k=>k.toLocaleDateString("en-IN",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return s?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading schedules..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-between items-center py-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",title:"Go back",children:e.jsx(es,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx($t,{className:"w-7 h-7 mr-3 text-primary-600"}),"User Scheduler"]}),e.jsx("p",{className:"text-gray-600",children:"Automatically enable or disable selected users at scheduled times"})]})]})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"card p-8 mb-6 bg-gradient-to-r from-primary-50 to-blue-50 border-primary-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx($t,{className:"w-5 h-5 text-primary-600"}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:Y(r)})]}),e.jsx("h2",{className:"text-4xl font-bold text-gray-900",children:K(r)}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Current IST Time (India)"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium",children:" Global NTP Time"}),a.synced&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-medium",children:[" Offset: ",a.diff]})]})]}),e.jsx("div",{className:"bg-white rounded-full p-6 shadow-lg",children:e.jsx(gs,{className:"w-16 h-16 text-primary-600"})})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Scheduled Actions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Create schedules to automatically enable or disable selected users"})]}),e.jsxs("button",{onClick:te,className:"btn-primary inline-flex items-center",children:[e.jsx(ir,{className:"w-4 h-4 mr-2"}),"Create Schedule"]})]}),C.length===0?e.jsxs("div",{className:"card p-12 text-center",children:[e.jsx($t,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No schedules yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Create schedules to automatically enable or disable users at specific times"}),e.jsxs("button",{onClick:te,className:"btn-primary inline-flex items-center",children:[e.jsx(ir,{className:"w-4 h-4 mr-2"}),"Create Schedule"]})]}):e.jsx("div",{className:"grid gap-6",children:C.map(k=>e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:k.name}),k.isActive?e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700",children:"Active"}):e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700",children:"Inactive"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-600 mb-3",children:[k.enableTime&&e.jsxs("div",{className:"flex items-center bg-green-50 px-3 py-1.5 rounded-lg border border-green-200",children:[e.jsx("span",{className:"text-green-700 font-medium mr-1",children:""}),e.jsx(gs,{className:"w-4 h-4 mr-1 text-green-600"}),e.jsx("span",{className:"font-medium text-green-700",children:k.enableTime}),e.jsx("span",{className:"ml-1 text-green-600 text-xs",children:"Enable"})]}),k.disableTime&&e.jsxs("div",{className:"flex items-center bg-red-50 px-3 py-1.5 rounded-lg border border-red-200",children:[e.jsx("span",{className:"text-red-700 font-medium mr-1",children:""}),e.jsx(gs,{className:"w-4 h-4 mr-1 text-red-600"}),e.jsx("span",{className:"font-medium text-red-700",children:k.disableTime}),e.jsx("span",{className:"ml-1 text-red-600 text-xs",children:"Disable"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(lt,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:k.applyToAllUsers?"All Users":`${k.users.length} Selected`})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx($t,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:k.days.length===7?"Every day":`${k.days.length} days`})]})]}),!k.applyToAllUsers&&k.users.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[k.users.slice(0,5).map(w=>e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 rounded-full px-3 py-1",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-100 flex items-center justify-center overflow-hidden",children:w.profileImage?e.jsx("img",{src:`${we}${w.profileImage}`,alt:w.name,className:"w-6 h-6 object-cover"}):e.jsx(_t,{className:"w-3 h-3 text-primary-600"})}),e.jsx("span",{className:"text-xs text-gray-700",children:w.name})]},w._id)),k.users.length>5&&e.jsxs("span",{className:"text-xs text-gray-500 px-3 py-1",children:["+",k.users.length-5," more"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:g.map(w=>e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${k.days.includes(w)?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-400"}`,children:w.slice(0,3)},w))}),(k.lastTriggeredEnable||k.lastTriggeredDisable)&&e.jsxs("div",{className:"mt-4 pt-4 border-t text-xs text-gray-500 space-y-1",children:[k.lastTriggeredEnable&&e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx("span",{className:"font-medium mr-1",children:" Enable triggered:"}),new Date(k.lastTriggeredEnable).toLocaleString()]}),k.lastTriggeredDisable&&e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx("span",{className:"font-medium mr-1",children:" Disable triggered:"}),new Date(k.lastTriggeredDisable).toLocaleString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[(k.lastTriggeredEnable||k.lastTriggeredDisable)&&e.jsx("button",{onClick:()=>ge(k._id,k.name),className:"text-orange-600 hover:text-orange-900",title:"Reset & allow re-trigger today",children:e.jsx(zn,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>pe(k._id),className:"text-gray-600 hover:text-gray-900",title:k.isActive?"Disable":"Enable",children:k.isActive?e.jsx(Si,{className:"w-6 h-6 text-green-600"}):e.jsx(ki,{className:"w-6 h-6 text-gray-400"})}),e.jsx("button",{onClick:()=>be(k),className:"text-primary-600 hover:text-primary-900",children:e.jsx(At,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>W(k._id),className:"text-red-600 hover:text-red-900",children:e.jsx(Ss,{className:"w-5 h-5"})})]})]})},k._id))}),e.jsxs("div",{className:"card p-6 mt-8 bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(Nd,{className:"w-5 h-5 mr-2 text-purple-600"}),"How it works"]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[e.jsx("p",{children:" System uses Global NTP Time Server (time.google.com or pool.ntp.org)"}),e.jsx("p",{children:" Computer/System time is IGNORED - only global internet time is used"}),e.jsx("p",{children:" Global time is converted to IST (Indian Standard Time)"}),e.jsx("p",{children:" The system runs a scheduled job every minute to check time"}),e.jsx("p",{children:" NTP sync happens automatically every hour for accuracy"}),e.jsx("p",{children:" Create schedules to automatically DISABLE selected users at specific times"}),e.jsx("p",{children:" Create schedules to automatically ENABLE selected users at specific times"}),e.jsx("p",{children:" Only selected users in schedules will be affected (not all users)"}),e.jsx("p",{children:" Disabled users are immediately logged out from all devices"})]})]})]}),_&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:R?"Edit Schedule":"Create New Schedule"}),e.jsxs("form",{onSubmit:Q,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Schedule Name"}),e.jsx("input",{type:"text",required:!0,value:f.name,onChange:k=>O({...f,name:k.target.value}),className:"input-field",placeholder:"e.g., Morning Auto-Enable"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsxs("label",{className:"block text-sm font-medium text-green-800 mb-1 flex items-center",children:[e.jsx("span",{className:"mr-2",children:""}),"Enable Time (IST)"]}),e.jsx("input",{type:"time",value:f.enableTime,onChange:k=>O({...f,enableTime:k.target.value}),className:"input-field text-lg font-mono",placeholder:"Optional"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"Users will be enabled at this time"})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsxs("label",{className:"block text-sm font-medium text-red-800 mb-1 flex items-center",children:[e.jsx("span",{className:"mr-2",children:""}),"Disable Time (IST)"]}),e.jsx("input",{type:"time",value:f.disableTime,onChange:k=>O({...f,disableTime:k.target.value}),className:"input-field text-lg font-mono",placeholder:"Optional"}),e.jsx("p",{className:"text-xs text-red-700 mt-1",children:"Users will be disabled at this time"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[" ",e.jsx("strong",{children:"Tip:"})," Set both times to create a complete on/off schedule. Example: Enable at 09:00, Disable at 18:00"]})}),e.jsxs("div",{className:"flex items-center p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("input",{type:"checkbox",id:"applyToAll",checked:f.applyToAllUsers,onChange:k=>O({...f,applyToAllUsers:k.target.checked,users:[]}),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsxs("label",{htmlFor:"applyToAll",className:"ml-3 block text-sm",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Apply to all users"}),e.jsx("p",{className:"text-gray-600",children:"This schedule will apply to all regular users at the specified times"})]})]}),!f.applyToAllUsers&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Select Users (",f.users.length," selected)"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{type:"button",onClick:I,className:"text-xs text-primary-600 hover:text-primary-800",children:"Select All"}),e.jsx("button",{type:"button",onClick:G,className:"text-xs text-gray-600 hover:text-gray-800",children:"Deselect All"})]})]}),e.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 max-h-64 overflow-y-auto",children:[e.jsxs("div",{className:"mb-3 pb-3 border-b flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:["Showing all users (Active: ",j.filter(k=>k.isActive!==!1).length,", Disabled: ",j.filter(k=>k.isActive===!1).length,")"]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("span",{className:"px-2 py-1 bg-green-50 text-green-700 rounded",children:" Active"}),e.jsx("span",{className:"px-2 py-1 bg-gray-50 text-gray-700 rounded",children:" Disabled"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:j.map(k=>e.jsxs("label",{className:`flex items-center space-x-3 p-3 rounded cursor-pointer transition-colors ${f.users.includes(k.id)?"bg-primary-50 border border-primary-200":k.isActive===!1?"hover:bg-gray-50 opacity-75":"hover:bg-gray-50"}`,children:[e.jsx("input",{type:"checkbox",checked:f.users.includes(k.id),onChange:()=>ne(k.id),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center overflow-hidden ${k.isActive===!1?"bg-gray-100":"bg-primary-100"}`,children:k.profileImage?e.jsx("img",{src:`${we}${k.profileImage}`,alt:k.name,className:`w-8 h-8 object-cover ${k.isActive===!1?"grayscale":""}`}):e.jsx(_t,{className:`w-4 h-4 ${k.isActive===!1?"text-gray-400":"text-primary-600"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`text-sm font-medium ${k.isActive===!1?"text-gray-600":"text-gray-900"}`,children:k.name}),k.isActive===!1?e.jsx("span",{className:"px-1.5 py-0.5 bg-gray-100 text-gray-600 rounded text-xs",children:"Disabled"}):e.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-600 rounded text-xs",children:"Active"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:k.email})]})]})]},k.id))})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Active Days (",f.days.length," selected)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(k=>e.jsx("button",{type:"button",onClick:()=>M(k),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${f.days.includes(k)?"bg-primary-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:k},k))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{z(!1),F(null),le()},className:"btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:R?"Update Schedule":"Create Schedule"})]})]})]})})]})},Od=()=>{const{user:s}=It(),[t,r]=u.useState([]),[n,i]=u.useState([]),[c,a]=u.useState(!0),[m,C]=u.useState(""),[b,j]=u.useState(!1),[T,_]=u.useState(null),[z,R]=u.useState({name:"",description:"",members:[]}),[F,f]=u.useState(null),[O,g]=u.useState(null);u.useEffect(()=>{L()},[]);const L=async()=>{var M,ne;try{a(!0);const[I,G]=await Promise.all([Gt.getGroups(),St.getActiveUsers()]);console.log("Groups response:",I.data),console.log("First group:",I.data[0]),console.log("First group ID:",(M=I.data[0])==null?void 0:M.id),console.log("First group _ID:",(ne=I.data[0])==null?void 0:ne._id);const K=I.data.map(Y=>({...Y,id:Y.id||Y._id}));console.log("Transformed groups:",K),r(K),i(G.data.filter(Y=>Y.id!==s.id))}catch(I){console.error("Error fetching data:",I),U.error("Failed to load data")}finally{a(!1)}},J=async M=>{var ne,I;if(M.preventDefault(),!z.name.trim()){U.error("Group name is required");return}if(z.members.length===0){U.error("Please add at least one member to the group");return}try{console.log("Submitting group data:",z),console.log("Editing group:",T),console.log("Editing group ID:",T==null?void 0:T.id);let G;if(T){if(!T.id){console.error("No group ID found for editing:",T),U.error("Invalid group ID for editing");return}await Gt.updateGroup(T.id,z),G=T.id,U.success("Group updated successfully")}else{const K=await Gt.createGroup(z);console.log("Group creation result:",K.data),G=K.data.group._id||K.data.group.id,U.success("Group created successfully")}if(F&&G)try{const K=new FormData;K.append("avatar",F),await Gt.uploadGroupAvatar(G,K),U.success("Group avatar uploaded successfully")}catch(K){console.error("Avatar upload error:",K),U.error("Group created but avatar upload failed")}j(!1),_(null),R({name:"",description:"",members:[]}),f(null),g(null),L()}catch(G){console.error("Group operation error:",G),U.error(((I=(ne=G.response)==null?void 0:ne.data)==null?void 0:I.message)||"Operation failed")}},q=async M=>{if(window.confirm("Are you sure you want to delete this group?"))try{await Gt.deleteGroup(M),U.success("Group deleted successfully"),L()}catch{U.error("Failed to delete group")}},Q=M=>{var K;console.log("Editing group:",M),console.log("Group ID:",M.id),console.log("Group _id:",M._id),console.log("Group members:",M.members),console.log("Group avatar:",M.avatar);const ne=M.id||M._id;if(!ne){console.error("No valid group ID found:",M),U.error("Invalid group selected");return}const I={...M,id:ne};console.log("Group with ID:",I);const G=((K=M.members)==null?void 0:K.map(Y=>{var w,A;let k;return typeof Y.user=="string"?k=Y.user:(w=Y.user)!=null&&w.id?k=Y.user.id:(A=Y.user)!=null&&A._id?k=Y.user._id:k=Y.user,console.log("Extracted member userId:",k,"from:",Y.user),{user:k,role:Y.role}}))||[];console.log("Extracted members for formData:",G),_(I),R({name:M.name,description:M.description||"",members:G}),f(null),M.avatar?g(`${we}${M.avatar}`):g(null),j(!0)},W=()=>{_(null),R({name:"",description:"",members:[]}),f(null),g(null),j(!0)},pe=M=>{const ne=M.target.files[0];if(ne){f(ne);const I=new FileReader;I.onload=G=>g(G.target.result),I.readAsDataURL(ne)}},ge=M=>{if(console.log("Adding member:",M),console.log("Current members:",z.members),z.members.find(I=>{var K,Y;return(typeof I.user=="string"?I.user:((K=I.user)==null?void 0:K.id)||((Y=I.user)==null?void 0:Y._id))===M}))console.log("Member already exists"),U.info("Member already added");else{const I={user:M,role:"member"},G=[...z.members,I];console.log("Updated members after add:",G),R(K=>({name:K.name,description:K.description,members:G})),console.log("Member added successfully"),U.success("Member added successfully")}},be=M=>{console.log("Removing member:",M),console.log("Current members before removal:",z.members);const ne=z.members.filter(I=>{var Y,k;const G=typeof I.user=="string"?I.user:((Y=I.user)==null?void 0:Y.id)||((k=I.user)==null?void 0:k._id),K=G!==M;return console.log("Member ID:",G,"Remove ID:",M,"Should keep:",K),K});console.log("Updated members after removal:",ne),console.log("Length before:",z.members.length,"Length after:",ne.length),ne.length<z.members.length?(R(I=>({name:I.name,description:I.description,members:ne})),console.log("Member removed successfully"),U.success("Member removed successfully")):(console.log("Member not found for removal"),U.error("Failed to remove member"))},te=t.filter(M=>{var ne;return M.name.toLowerCase().includes(m.toLowerCase())||((ne=M.description)==null?void 0:ne.toLowerCase().includes(m.toLowerCase()))}),le=n.filter(M=>{const ne=z.members.find(I=>{var Y,k;const G=typeof I.user=="string"?I.user:((Y=I.user)==null?void 0:Y.id)||((k=I.user)==null?void 0:k._id),K=M.id||M._id;return G===K});return b&&ne&&console.log("Filtering out user (already member):",M.name,"ID:",M.id),!ne});return c?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",title:"Go back",children:e.jsx(es,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Group Management"}),e.jsx("p",{className:"text-gray-600",children:"Create and manage groups for team communication"})]})]}),e.jsxs("button",{onClick:W,className:"btn-primary inline-flex items-center",children:[e.jsx(ir,{className:"w-4 h-4 mr-2"}),"Create Group"]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"card p-6 mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Gs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search groups...",value:m,onChange:M=>C(M.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:te.map(M=>{var ne,I,G;return e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center overflow-hidden",children:M.avatar?e.jsx("img",{src:`${we}${M.avatar}`,alt:"Group avatar",className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(lt,{className:"w-6 h-6 text-green-600"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:M.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[((ne=M.members)==null?void 0:ne.length)||0," members"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>Q(M),className:"text-primary-600 hover:text-primary-900",children:e.jsx(At,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>q(M.id),className:"text-red-600 hover:text-red-900",children:e.jsx(Ss,{className:"w-4 h-4"})})]})]}),M.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:M.description}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Members:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(I=M.members)==null?void 0:I.slice(0,3).map((K,Y)=>{var k,w,A;return e.jsxs("div",{className:"flex items-center space-x-1 bg-gray-100 rounded-full px-2 py-1",children:[e.jsx("div",{className:"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-primary-600",children:((w=(k=K.user)==null?void 0:k.name)==null?void 0:w.charAt(0))||"U"})}),e.jsx("span",{className:"text-xs text-gray-700",children:((A=K.user)==null?void 0:A.name)||"Unknown"})]},Y)}),((G=M.members)==null?void 0:G.length)>3&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",M.members.length-3," more"]})]})]})]},M.id)})}),te.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(lt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No groups found"}),e.jsx("p",{className:"text-gray-500",children:m?"Try adjusting your search terms.":"Get started by creating your first group."})]})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:T?"Edit Group":"Create Group"}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Group Name"}),e.jsx("input",{type:"text",required:!0,value:z.name,onChange:M=>R({...z,name:M.target.value}),className:"input-field",placeholder:"Enter group name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:z.description,onChange:M=>R({...z,description:M.target.value}),className:"input-field",rows:"3",placeholder:"Enter group description (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Group Avatar"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:O?e.jsx("img",{src:O,alt:"Avatar preview",className:"w-16 h-16 rounded-lg object-cover border-2 border-gray-200"}):e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gray-100 border-2 border-gray-200 flex items-center justify-center",children:e.jsx(Ot,{className:"w-6 h-6 text-gray-400"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:pe,className:"hidden",id:"avatar-upload"}),e.jsxs("label",{htmlFor:"avatar-upload",className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 cursor-pointer transition-colors",children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),F?"Change Avatar":"Upload Avatar"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PNG, JPG, GIF up to 5MB"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Members"}),z.members.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-xs text-gray-600 mb-2",children:["Selected Members: (",z.members.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:z.members.map(M=>{var K,Y;const ne=typeof M.user=="string"?M.user:((K=M.user)==null?void 0:K.id)||((Y=M.user)==null?void 0:Y._id),I=n.find(k=>k.id===ne||k._id===ne),G=(I==null?void 0:I.name)||(I==null?void 0:I.username)||"Unknown User";return console.log("Rendering member:",{userId:ne,userData:I==null?void 0:I.name,memberName:G}),e.jsxs("div",{className:"flex items-center space-x-2 bg-primary-100 rounded-full px-3 py-1.5",children:[e.jsx("div",{className:"w-5 h-5 bg-primary-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-white",children:G.charAt(0).toUpperCase()})}),e.jsx("span",{className:"text-sm font-medium text-primary-700",children:G}),e.jsx("button",{type:"button",onClick:()=>{console.log("Remove button clicked for userId:",ne),be(ne)},className:"text-primary-600 hover:text-primary-900 transition-colors",children:e.jsx(Ct,{className:"w-3.5 h-3.5"})})]},ne)})})]}),e.jsxs("div",{className:"border border-gray-300 rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Add Members: (No Limit)"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:le.length>0?le.map(M=>{var ne;return e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-primary-600",children:((ne=M.name)==null?void 0:ne.charAt(0).toUpperCase())||"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:M.name||M.username||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-500",children:M.email})]})]}),e.jsx("button",{type:"button",onClick:()=>{console.log("Add button clicked for userId:",M.id),ge(M.id)},className:"text-primary-600 hover:text-primary-800 transition-colors",title:`Add ${M.name||M.username}`,children:e.jsx(Gn,{className:"w-4 h-4"})})]},M.id)}):e.jsx("div",{className:"text-center py-4 text-sm text-gray-500",children:z.members.length>0?e.jsx("p",{children:"All available users have been added to this group."}):e.jsx("p",{children:"No users available to add."})})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>j(!1),className:"btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",children:T?"Update":"Create"})]})]})]})})]})},$d=()=>{var _,z,R,F,f,O;const{groupId:s}=_i(),t=ps();It();const[r,n]=u.useState(null),[i,c]=u.useState(!0),[a,m]=u.useState(!1);u.useEffect(()=>{C()},[s]);const C=async()=>{try{c(!0);const L=(await Gt.getGroups()).data.find(J=>J.id===s);if(!L){U.error("Group not found"),t("/chat");return}n(L)}catch(g){console.error("Error fetching group details:",g),U.error("Failed to load group details"),t("/chat")}finally{c(!1)}},b=g=>{switch(g){case"admin":return e.jsx(ar,{className:"w-4 h-4 text-blue-600"});default:return e.jsx(_t,{className:"w-4 h-4 text-gray-600"})}},j=g=>{switch(g){case"admin":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},T=g=>new Date(g).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return i?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):r?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center py-4",children:[e.jsx("button",{onClick:()=>t("/chat"),className:"mr-4 p-2 text-gray-600 hover:text-gray-900 transition-colors",title:"Back to chat",children:e.jsx(es,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Group Info"})]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"card p-8 text-center mb-6",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"w-32 h-32 rounded-full overflow-hidden bg-gray-100 border-4 border-white shadow-lg",children:r.avatar?e.jsx("img",{src:`${we}${r.avatar}`,alt:"Group avatar",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:e.jsx(lt,{className:"w-16 h-16 text-white"})})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:r.name}),r.description&&e.jsx("p",{className:"text-gray-600 mb-4 max-w-md mx-auto",children:r.description}),e.jsxs("div",{className:"flex items-center justify-center space-x-6 text-sm text-gray-500 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(lt,{className:"w-4 h-4"}),e.jsxs("span",{children:[((_=r.members)==null?void 0:_.length)||0," members"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx($t,{className:"w-4 h-4"}),e.jsxs("span",{children:["Created ",T(r.createdAt)]})]})]})]}),e.jsxs("div",{className:"card p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Members"}),e.jsxs("button",{onClick:()=>m(!a),className:"text-primary-600 hover:text-primary-800 transition-colors",children:[a?"Hide":"Show"," (",((z=r.members)==null?void 0:z.length)||0,")"]})]}),a&&e.jsx("div",{className:"space-y-3",children:(R=r.members)==null?void 0:R.map((g,L)=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:g.user.profileImage?e.jsx("img",{src:`${we}${g.user.profileImage}`,alt:g.user.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-primary-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:g.user.name.charAt(0).toUpperCase()})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:g.user.name}),e.jsxs("div",{className:"flex items-center space-x-1",children:[b(g.role),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${j(g.role)}`,children:g.role})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:g.user.email})]}),e.jsx("div",{className:"text-xs text-gray-400",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(gs,{className:"w-3 h-3"}),e.jsxs("span",{children:["Joined ",T(g.joinedAt)]})]})})]},L))})]}),e.jsxs("div",{className:"card p-6 mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Group Statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600",children:((F=r.members)==null?void 0:F.length)||0}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Members"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((f=r.members)==null?void 0:f.filter(g=>g.role==="admin").length)||0}),e.jsx("div",{className:"text-sm text-gray-500",children:"Admins"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Math.ceil((((O=r.members)==null?void 0:O.length)||0)/2)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Active Conversations"})]})]})]})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Group not found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The group you're looking for doesn't exist."}),e.jsx("button",{onClick:()=>t("/chat"),className:"btn-primary",children:"Back to Chat"})]})})},Fd=()=>{const{user:s,setUser:t}=It(),[r,n]=u.useState({name:"",email:"",phone:"",designation:"",profileImage:"",bio:""}),[i,c]=u.useState(!1),[a,m]=u.useState(!1),[C,b]=u.useState(null),[j,T]=u.useState(null);u.useEffect(()=>{s&&(n({name:s.name||"",email:s.email||"",phone:s.phone||"",designation:s.designation||"",profileImage:s.profileImage||"",bio:s.bio||""}),b(s.profileImage||null))},[s]);const _=O=>{const{name:g,value:L}=O.target;n(J=>({...J,[g]:L}))},z=O=>{const g=O.target.files[0];if(g){T(g);const L=new FileReader;L.onload=J=>{b(J.target.result)},L.readAsDataURL(g)}},R=()=>{T(null),b(null),n(O=>({...O,profileImage:""}))},F=async O=>{var g,L,J,q,Q;O.preventDefault(),m(!0);try{const W=new FormData;W.append("name",r.name),r.phone&&r.phone.trim()&&W.append("phone",r.phone.trim()),r.designation&&r.designation.trim()&&W.append("designation",r.designation.trim()),r.bio&&r.bio.trim()&&W.append("bio",r.bio.trim()),j&&W.append("profileImage",j);const ge=((g=(await St.updateProfile(W)).data)==null?void 0:g.user)||{};n(be=>({...be,name:ge.name??be.name,phone:ge.phone??be.phone,designation:ge.designation??be.designation,bio:ge.bio??be.bio,profileImage:ge.profileImage??be.profileImage})),ge.profileImage&&b(ge.profileImage),t(be=>be?{...be,...ge}:ge),U.success("Profile updated successfully"),c(!1),T(null),setTimeout(()=>{window.location.reload()},1e3)}catch(W){console.error("Profile update error:",W);const pe=((J=(L=W.response)==null?void 0:L.data)==null?void 0:J.message)||((Q=(q=W.response)==null?void 0:q.data)==null?void 0:Q.error)||"Failed to update profile";U.error(pe)}finally{m(!1)}},f=()=>{c(!1),n({name:s.name||"",email:s.email||"",phone:s.phone||"",designation:s.designation||"",profileImage:s.profileImage||"",bio:s.bio||""}),b(s.profileImage||null),T(null)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between py-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Cr,{to:"/dashboard",className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(es,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile"}),e.jsx("p",{className:"text-gray-600",children:"Manage your profile information"})]})]}),!i&&e.jsxs("button",{onClick:()=>c(!0),className:"btn-primary inline-flex items-center",children:[e.jsx(At,{className:"w-4 h-4 mr-2"}),"Edit Profile"]})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative inline-block",children:[C?e.jsx("img",{src:C.startsWith("http")||C.startsWith("data:")?C:`${we}${C}`,alt:"Profile",className:"w-32 h-32 rounded-full object-cover mx-auto"}):e.jsx("div",{className:"w-32 h-32 bg-primary-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(_t,{className:"w-16 h-16 text-primary-600"})}),i&&e.jsx("div",{className:"absolute bottom-0 right-0",children:e.jsxs("label",{className:"bg-primary-600 text-white p-2.5 rounded-full cursor-pointer hover:bg-primary-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center border-2 border-white",children:[e.jsx(jd,{className:"w-4 h-4"}),e.jsx("input",{type:"file",accept:"image/*",onChange:z,className:"hidden"})]})})]}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mt-4",children:r.name}),e.jsx("p",{className:"text-gray-600",children:r.designation||"No designation"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:r.email}),i&&C&&e.jsxs("button",{onClick:R,className:"mt-2 text-red-600 hover:text-red-700 text-sm inline-flex items-center",children:[e.jsx(Ct,{className:"w-4 h-4 mr-1"}),"Remove Image"]})]})})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:i?"Edit Profile Information":"Profile Information"}),i?e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),e.jsx("input",{type:"text",name:"name",value:r.name,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),e.jsx("input",{type:"tel",name:"phone",value:r.phone,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"+1 (555) 123-4567"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designation"}),e.jsx("input",{type:"text",name:"designation",value:r.designation,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Software Developer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:r.email,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),e.jsx("textarea",{name:"bio",value:r.bio,onChange:_,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Tell us about yourself..."})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:f,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:a,className:"btn-primary inline-flex items-center",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ni,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_t,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Name"}),e.jsx("p",{className:"text-sm text-gray-600",children:r.name||"Not provided"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(or,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Phone"}),e.jsx("p",{className:"text-sm text-gray-600",children:r.phone||"Not provided"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(vd,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Designation"}),e.jsx("p",{className:"text-sm text-gray-600",children:r.designation||"Not provided"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(vi,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Email"}),e.jsx("p",{className:"text-sm text-gray-600",children:r.email})]})]})]}),r.bio&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-2",children:"Bio"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-4 rounded-lg",children:r.bio})]})]})]})})]})})]})};function Dd(){const s=ps(),[t,r]=u.useState(!0),[n,i]=u.useState([]),[c,a]=u.useState([]),[m,C]=u.useState(new Set),[b,j]=u.useState(new Set),[T,_]=u.useState(null),[z,R]=u.useState(!1),[F,f]=u.useState("users"),[O,g]=u.useState(""),L=te=>te&&(/^https?:\/\//i.test(te)?te:`${we}${te}`),J=te=>{if(!te&&te!==0)return"";const le=te/1024/1024;return`${le.toFixed(le<.1?2:1)} MB`};u.useEffect(()=>{try{const te=sessionStorage.getItem("forwardMessage");te&&_(JSON.parse(te))}catch{}},[]),u.useEffect(()=>{(async()=>{try{r(!0);const[le,M]=await Promise.all([St.getActiveUsers(),Gt.getGroups()]);i(le.data||[]),a((M.data||[]).filter(ne=>ne.isActive!==!1))}catch{}finally{r(!1)}})()},[]);const q=te=>{C(le=>{const M=new Set(le);return M.has(te)?M.delete(te):M.add(te),M})},Q=te=>{j(le=>{const M=new Set(le);return M.has(te)?M.delete(te):M.add(te),M})},W=async()=>{if(!(!(T!=null&&T.id)&&!(T!=null&&T._id))&&!(m.size===0&&b.size===0))try{R(!0),await et.forwardMessage({messageId:T.id||T._id,targets:{users:Array.from(m),groups:Array.from(b)}}),sessionStorage.removeItem("forwardMessage"),s(-1)}catch{R(!1)}};if(t)return e.jsx("div",{className:"p-6",children:"Loading..."});const pe=n.filter(te=>te.name.toLowerCase().includes(O.toLowerCase())||(te.email||"").toLowerCase().includes(O.toLowerCase())),ge=c.filter(te=>te.name.toLowerCase().includes(O.toLowerCase())),be=m.size+b.size;return e.jsxs("div",{className:"h-screen bg-white",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-gray-100 text-white",children:[e.jsx("div",{className:"max-w-3xl mx-auto px-4 pt-3",children:e.jsx("input",{value:O,onChange:te=>g(te.target.value),placeholder:"Search name or group",className:"w-full bg-white text-gray-800 rounded-full px-4 py-2 text-sm focus:outline-none",type:"text"})}),e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-2 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"inline-flex bg-white rounded-full p-1",children:[e.jsx("button",{className:`px-4 py-1 text-sm rounded-full ${F==="users"?"bg-gray-200 text-gray-800":"text-gray-800"}`,onClick:()=>f("users"),children:"Chats"}),e.jsx("button",{className:`px-4 py-1 text-sm rounded-full ${F==="groups"?"bg-gray-200 text-gray-800":"text-gray-800"}`,onClick:()=>f("groups"),children:"Groups"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"font-semibold -ml-4 whitespace-nowrap text-gray-800",children:"Forward"})}),e.jsxs("div",{className:"text-sm opacity-90 whitespace-nowrap text-gray-800",children:[be," selected"]})]})]}),e.jsxs("div",{className:"max-w-3xl mx-auto px-4 pt-3 pb-24",children:[T&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"bg-gray-100 rounded-2xl p-3 inline-block max-w-full",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Preview"})}),T.messageType==="image"?e.jsxs("div",{className:"max-w-[200px]",children:[e.jsx("img",{src:L(T.fileUrl),alt:T.fileName||"image",className:"rounded-lg w-full h-auto max-h-[150px] object-cover"}),T.message&&e.jsx("div",{className:"mt-2 text-sm text-gray-800 break-words",children:T.message}),e.jsxs("div",{className:"mt-2",children:[m.size>0&&b.size===0&&e.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700",children:"Personal"}),b.size>0&&m.size===0&&e.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700",children:"Group"})]})]}):T.messageType==="video"?e.jsxs("div",{className:"max-w-[200px]",children:[e.jsx("video",{src:L(T.fileUrl),controls:!0,className:"rounded-lg w-full h-auto max-h-[150px] object-cover"}),T.message&&e.jsx("div",{className:"mt-2 text-sm text-gray-800 break-words",children:T.message}),e.jsxs("div",{className:"mt-2",children:[m.size>0&&b.size===0&&e.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700",children:"Personal"}),b.size>0&&m.size===0&&e.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700",children:"Group"})]})]}):T.messageType&&T.messageType!=="text"?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white rounded-lg shadow-sm",children:[e.jsx("svg",{className:"w-6 h-6 text-gray-600",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM8 18h8v2H8v-2zm0-4h8v2H8v-2zm6-7.5V9h3.5L14 6.5z"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:T.fileName||"Attachment"}),e.jsx("div",{className:"text-xs text-gray-500",children:J(T.fileSize)}),T.message&&e.jsx("div",{className:"text-sm text-gray-800 break-words mt-1",children:T.message})]})]}),e.jsxs("div",{className:"mt-2",children:[m.size>0&&b.size===0&&e.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700",children:"Personal"}),b.size>0&&m.size===0&&e.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700",children:"Group"})]})]}):e.jsx("div",{className:"text-sm text-gray-800 break-words max-w-[200px]",children:T.message})]})}),F==="users"?e.jsxs("div",{className:"divide-y border rounded-xl overflow-hidden",children:[pe.map(te=>{var le,M;return e.jsxs("button",{onClick:()=>q(te.id),className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-green-500 text-white flex items-center justify-center",children:te.profileImage?e.jsx("img",{src:`${we}${te.profileImage}`,alt:te.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"font-semibold",children:(M=(le=te.name)==null?void 0:le[0])==null?void 0:M.toUpperCase()})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:te.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:te.email})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${m.has(te.id)?"bg-green-500 border-green-500":"border-gray-300"}`,children:m.has(te.id)&&e.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.414l2.293 2.293 6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},te.id)}),pe.length===0&&e.jsx("div",{className:"p-6 text-center text-sm text-gray-500",children:"No chats found"})]}):e.jsxs("div",{className:"divide-y border rounded-xl overflow-hidden",children:[ge.map(te=>{var M;const le=te.id||te._id;return e.jsxs("button",{onClick:()=>Q(le),className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-green-500 text-white flex items-center justify-center",children:te.avatar?e.jsx("img",{src:`${we}${te.avatar}`,alt:te.name,className:"w-full h-full object-cover"}):e.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V20h14v-3.5C15 14.17 10.33 13 8 13zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V20h6v-3.5c0-2.33-4.67-3.5-7-3.5z"})})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:te.name}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[((M=te.members)==null?void 0:M.length)||0," members"]})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${b.has(le)?"bg-green-500 border-green-500":"border-gray-300"}`,children:b.has(le)&&e.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.414l2.293 2.293 6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},le)}),ge.length===0&&e.jsx("div",{className:"p-6 text-center text-sm text-gray-500",children:"No groups found"})]})]}),e.jsx("div",{className:"fixed bottom-0 inset-x-0 bg-white border-t",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[be," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>s(-1),children:"Cancel"}),e.jsx("button",{className:"btn-primary",disabled:z||be===0,onClick:W,children:"Send"})]})]})})]})}const zd=()=>{It();const s=ps(),[t,r]=u.useState([]),[n,i]=u.useState(new Date),[c,a]=u.useState(new Date),[m,C]=u.useState(""),[b,j]=u.useState(null),[T,_]=u.useState(!0),[z,R]=u.useState({}),[F,f]=u.useState("grid"),[O,g]=u.useState([]),[L,J]=u.useState(!1),[q,Q]=u.useState(null),[W,pe]=u.useState(0);u.useEffect(()=>{ge()},[]),u.useEffect(()=>{const S=n.toISOString().split("T")[0],E=z[S];E?(C(E.content),j(E._id),g(E.media||[])):(C(""),j(null),g([]))},[n,z]);const ge=async()=>{var S;try{_(!0);const E=localStorage.getItem("token");console.log(" Fetching daily updates from:",`${we}/api/daily-updates`);const H=await He.get(`${we}/api/daily-updates`,{headers:{Authorization:`Bearer ${E}`}});console.log(" Daily updates fetched:",H.data),console.log(" Total updates:",H.data.length),r(H.data);const ee={};H.data.forEach(V=>{const ue=new Date(V.date).toISOString().split("T")[0];ee[ue]=V}),R(ee)}catch(E){console.error(" Error fetching updates:",E),console.error("Error details:",(S=E.response)==null?void 0:S.data),U.error("Failed to load updates")}finally{_(!1)}},be=async S=>{const E=Array.from(S.target.files);if(E.length===0)return;J(!0);const H=localStorage.getItem("token");try{const ee=[];for(const V of E){const ue=new FormData;ue.append("file",V);const je=await He.post(`${we}/api/daily-updates/upload-media`,ue,{headers:{Authorization:`Bearer ${H}`,"Content-Type":"multipart/form-data"}});ee.push(je.data)}g([...O,...ee]),U.success(`${ee.length} file(s) uploaded successfully`)}catch(ee){console.error("Error uploading media:",ee),U.error("Failed to upload media")}finally{J(!1)}},te=S=>{g(O.filter((E,H)=>H!==S))},le=(S,E)=>{Q(S),pe(E)},M=()=>{Q(null),pe(0)},ne=()=>{q&&W<q.length-1&&pe(W+1)},I=()=>{W>0&&pe(W-1)},G=S=>{q&&(S.key==="Escape"&&M(),S.key==="ArrowRight"&&ne(),S.key==="ArrowLeft"&&I())};u.useEffect(()=>{if(q)return window.addEventListener("keydown",G),()=>window.removeEventListener("keydown",G)},[q,W]);const K=async(S,E)=>{try{const ee=await(await fetch(S)).blob(),V=window.URL.createObjectURL(ee),ue=document.createElement("a");ue.href=V,ue.download=E||"download",document.body.appendChild(ue),ue.click(),window.URL.revokeObjectURL(V),document.body.removeChild(ue),U.success("Download started!")}catch(H){console.error("Download error:",H),U.error("Failed to download file")}},Y=async()=>{var S,E;if(!m.trim()){U.error("Please enter an update");return}try{const H=localStorage.getItem("token"),ee=n.toISOString().split("T")[0];b?(await He.put(`${we}/api/daily-updates/${b}`,{content:m,media:O},{headers:{Authorization:`Bearer ${H}`}}),U.success("Update saved successfully")):(await He.post(`${we}/api/daily-updates`,{date:ee,content:m,media:O},{headers:{Authorization:`Bearer ${H}`}}),U.success("Update added successfully")),ge()}catch(H){console.error("Error saving update:",H);const ee=((E=(S=H.response)==null?void 0:S.data)==null?void 0:E.error)||"Failed to save update";U.error(ee)}},k=async S=>{if(confirm("Are you sure you want to delete this update?"))try{const E=localStorage.getItem("token");await He.delete(`${we}/api/daily-updates/${S}`,{headers:{Authorization:`Bearer ${E}`}}),U.success("Update deleted successfully"),C(""),j(null),g([]),ge()}catch(E){console.error("Error deleting update:",E),U.error("Failed to delete update")}},w=S=>{const E=S.getFullYear(),H=S.getMonth(),ee=new Date(E,H,1),ue=new Date(E,H+1,0).getDate(),je=ee.getDay();return{daysInMonth:ue,startingDayOfWeek:je}},A=S=>{if(z[S]){const E=z[S].content.length;return E>500?"bg-gradient-to-br from-green-400 to-green-600":E>200?"bg-gradient-to-br from-blue-400 to-blue-600":"bg-gradient-to-br from-purple-400 to-purple-600"}return""},Z=()=>{const{daysInMonth:S,startingDayOfWeek:E}=w(c),H=[],ee=c.toLocaleDateString("en-US",{month:"long",year:"numeric"});for(let V=0;V<E;V++)H.push(e.jsx("div",{className:"p-2"},`empty-${V}`));for(let V=1;V<=S;V++){const ue=new Date(c.getFullYear(),c.getMonth(),V),je=ue.toISOString().split("T")[0],Te=ue.toDateString()===n.toDateString(),$e=ue.toDateString()===new Date().toDateString(),ct=z[je],Ze=A(je);H.push(e.jsxs("button",{onClick:()=>i(ue),className:`
            relative p-3 rounded-xl text-center transition-all transform hover:scale-105
            ${Te?"ring-4 ring-blue-500 ring-offset-2 scale-105":""}
            ${ct?`${Ze} text-white font-bold shadow-lg`:$e?"bg-gray-100 text-gray-900 font-semibold border-2 border-blue-500":"bg-gray-50 hover:bg-gray-100 text-gray-700"}
          `,children:[e.jsx("span",{className:"text-sm",children:V}),ct&&e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx(rr,{className:"w-3 h-3 text-white"})})]},V))}return e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:()=>a(new Date(c.getFullYear(),c.getMonth()-1)),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Os,{className:"w-6 h-6 text-gray-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:ee}),e.jsx("button",{onClick:()=>a(new Date(c.getFullYear(),c.getMonth()+1)),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx($s,{className:"w-6 h-6 text-gray-600"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2 text-center mb-3",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(V=>e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:V},V))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:H}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"Update Length:"}),e.jsxs("div",{className:"flex gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-purple-400 to-purple-600"}),e.jsx("span",{className:"text-gray-600",children:"Short"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-blue-400 to-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Medium"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-green-400 to-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Long"})]})]})]})]})};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6 border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s("/dashboard"),className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(es,{className:"w-6 h-6 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Daily Updates"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track your daily progress and achievements"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-blue-100 to-purple-100 px-4 py-3 rounded-xl",children:[e.jsx(Ci,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Total Updates"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:t.length})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1",children:[Z(),e.jsxs("div",{className:"mt-6 bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(gs,{className:"w-5 h-5 text-blue-600"}),"This Month"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Updates Created"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:t.filter(S=>{const E=new Date(S.date);return E.getMonth()===c.getMonth()&&E.getFullYear()===c.getFullYear()}).length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Current Streak"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[" ",t.length>0?"1":"0"," days"]})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-gray-800",children:[e.jsx(At,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:n.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),T?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-4 border-blue-600"})}):e.jsxs(e.Fragment,{children:[e.jsx("textarea",{value:m,onChange:S=>C(S.target.value),placeholder:" What amazing things did you accomplish today? Share your progress, learnings, and wins...",className:"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none transition-all",rows:"8"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl cursor-pointer transition-colors w-fit",children:[e.jsx(Ls,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Upload Images/Videos"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:be,className:"hidden",disabled:L})]}),L&&e.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"Uploading..."})]}),O.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-3 gap-3",children:O.map((S,E)=>e.jsxs("div",{className:"relative group rounded-xl overflow-hidden border-2 border-gray-200 cursor-pointer",onClick:()=>S.type==="image"&&le(O,E),children:[S.type==="image"?e.jsx("img",{src:S.url,alt:S.filename,className:"w-full h-32 object-cover hover:scale-105 transition-transform"}):e.jsx("video",{src:S.url,className:"w-full h-32 object-cover",controls:!0}),e.jsx("button",{onClick:H=>{H.stopPropagation(),te(E)},className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx(Ct,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2",children:e.jsxs("span",{className:"text-white text-xs flex items-center gap-1",children:[S.type==="image"?e.jsx(Ot,{className:"w-3 h-3"}):e.jsx(ht,{className:"w-3 h-3"}),S.filename]})})]},E))}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsxs("button",{onClick:Y,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all flex items-center justify-center gap-2 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105",children:[e.jsx(Ni,{className:"w-5 h-5"}),b?"Update":"Save"," Daily Update"]}),b&&e.jsxs("button",{onClick:()=>k(b),className:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl hover:from-red-600 hover:to-red-700 transition-all flex items-center gap-2 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105",children:[e.jsx(Ss,{className:"w-5 h-5"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2 text-gray-800",children:[e.jsx($t,{className:"w-6 h-6 text-purple-600"}),"All Updates"]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-xl p-1",children:[e.jsx("button",{onClick:()=>f("grid"),className:`p-2 rounded-lg transition-all ${F==="grid"?"bg-white text-blue-600 shadow-md":"text-gray-500 hover:text-gray-700"}`,title:"Grid View",children:e.jsx(Dn,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>f("list"),className:`p-2 rounded-lg transition-all ${F==="list"?"bg-white text-blue-600 shadow-md":"text-gray-500 hover:text-gray-700"}`,title:"List View",children:e.jsx(Gr,{className:"w-5 h-5"})})]})]}),t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-gray-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:e.jsx($t,{className:"w-10 h-10 text-gray-400"})}),e.jsx("p",{className:"text-gray-500 text-lg",children:"No updates yet"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Start tracking your daily progress!"})]}):F==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar",children:t.map(S=>{const E=new Date(S.date).toISOString().split("T")[0],H=A(E),ee=E===n.toISOString().split("T")[0];return e.jsxs("div",{onClick:()=>i(new Date(S.date)),className:`${H} p-5 rounded-xl cursor-pointer transition-all transform hover:scale-105 hover:shadow-xl ${ee?"ring-4 ring-blue-500 ring-offset-2 scale-105":"shadow-lg"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-bold text-lg",children:new Date(S.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("span",{className:"text-white/80 text-xs",children:new Date(S.updatedAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})})]}),e.jsx(rr,{className:"w-6 h-6 text-white"})]}),e.jsx("p",{className:"text-white line-clamp-4 text-sm leading-relaxed",children:S.content}),S.media&&S.media.length>0&&e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 relative",children:[S.media.slice(0,2).map((V,ue)=>e.jsx("div",{className:"relative rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:je=>{je.stopPropagation(),le(S.media,ue)},children:V.type==="image"?e.jsx("img",{src:V.url,alt:V.filename,className:"w-full h-20 object-cover"}):e.jsx("div",{className:"w-full h-20 bg-black/20 flex items-center justify-center",children:e.jsx(ht,{className:"w-6 h-6 text-white"})})},ue)),S.media.length>2&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded",children:["+",S.media.length-2," more"]})]}),S.content.length>150&&e.jsx("button",{className:"text-white/90 text-xs font-semibold mt-2 hover:text-white transition-colors",children:"Read more "})]},S._id)})}):e.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar",children:t.map(S=>{const E=new Date(S.date).toISOString().split("T")[0],H=A(E),ee=E===n.toISOString().split("T")[0];return e.jsx("div",{onClick:()=>i(new Date(S.date)),className:`${H} p-4 rounded-xl cursor-pointer transition-all hover:shadow-xl ${ee?"ring-4 ring-blue-500 ring-offset-2":"shadow-md"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-lg p-3 text-center min-w-[80px]",children:[e.jsx("div",{className:"text-white font-bold text-2xl",children:new Date(S.date).getDate()}),e.jsx("div",{className:"text-white/90 text-xs font-semibold uppercase",children:new Date(S.date).toLocaleDateString("en-US",{month:"short"})}),e.jsx("div",{className:"text-white/80 text-xs",children:new Date(S.date).getFullYear()})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white font-bold text-base",children:new Date(S.date).toLocaleDateString("en-US",{weekday:"long"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white/80 text-xs",children:new Date(S.updatedAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}),e.jsx(rr,{className:"w-5 h-5 text-white"})]})]}),e.jsx("p",{className:"text-white/95 text-sm leading-relaxed line-clamp-2",children:S.content}),S.media&&S.media.length>0&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[S.media.slice(0,3).map((V,ue)=>e.jsx("div",{className:"relative rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:je=>{je.stopPropagation(),le(S.media,ue)},children:V.type==="image"?e.jsx("img",{src:V.url,alt:V.filename,className:"w-16 h-16 object-cover"}):e.jsx("div",{className:"w-16 h-16 bg-black/20 flex items-center justify-center",children:e.jsx(ht,{className:"w-4 h-4 text-white"})})},ue)),S.media.length>3&&e.jsx("div",{className:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center",children:e.jsxs("span",{className:"text-white font-bold text-xs",children:["+",S.media.length-3]})})]}),e.jsx("div",{className:"flex items-center justify-between mt-2",children:S.content.length>100&&e.jsx("button",{className:"text-white/90 text-xs font-semibold hover:text-white transition-colors",children:"Read more "})})]})]})},S._id)})})]})]})]})]}),q&&e.jsxs("div",{className:"fixed inset-0 bg-black/95 z-50 flex items-center justify-center",children:[e.jsx("button",{onClick:M,className:"absolute top-4 right-4 bg-white/10 hover:bg-white/20 text-white p-3 rounded-full transition-colors z-10",children:e.jsx(Ct,{className:"w-6 h-6"})}),e.jsxs("button",{onClick:()=>K(q[W].url,q[W].filename),className:"absolute top-4 right-20 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-full transition-colors flex items-center gap-2 shadow-lg z-10",children:[e.jsx(vt,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-semibold",children:"Download"})]}),q.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:I,className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Previous",children:e.jsx(Os,{className:"w-8 h-8 text-white stroke-[3]"})}),e.jsx("button",{onClick:ne,className:"absolute right-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Next",children:e.jsx($s,{className:"w-8 h-8 text-white stroke-[3]"})})]}),q.length>1&&e.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-black/50 text-white px-4 py-2 rounded-full text-sm",children:[W+1," / ",q.length]}),e.jsx("div",{className:"max-w-7xl max-h-[90vh] w-full h-full flex items-center justify-center p-4",children:q[W].type==="image"?e.jsx("img",{src:q[W].url,alt:q[W].filename,className:"max-w-full max-h-full object-contain rounded-lg"}):e.jsx("video",{src:q[W].url,controls:!0,autoPlay:!0,className:"max-w-full max-h-full rounded-lg"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"bg-black/50 text-white px-4 py-2 rounded-full text-sm max-w-md truncate",children:q[W].filename}),e.jsx("div",{className:"text-white/60 text-xs",children:"Press ESC to close  Arrow keys to navigate  Click Download to save"})]})]}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: linear-gradient(to bottom, #2563eb, #7c3aed);
        }
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        .line-clamp-3 {
          display: -webkit-box;
          -webkit-line-clamp: 3;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        .line-clamp-4 {
          display: -webkit-box;
          -webkit-line-clamp: 4;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `}})]})},Bd=()=>{It();const s=ps(),[t,r]=u.useState([]);u.useState(""),u.useState(""),u.useState("medium"),u.useState("pending"),u.useState(""),u.useState(null);const[n,i]=u.useState(!0),[c,a]=u.useState("all");u.useState(!1);const[m,C]=u.useState(null),[b,j]=u.useState(!1),[T,_]=u.useState(""),[z,R]=u.useState(!1),[F,f]=u.useState(null),[O,g]=u.useState(0);u.useEffect(()=>{L()},[c]);const L=async()=>{try{i(!0);const I=localStorage.getItem("token"),G=c!=="all"?`?status=${c}`:"",K=await He.get(`${we}/api/tasks${G}`,{headers:{Authorization:`Bearer ${I}`}});r(K.data)}catch(I){console.error("Error fetching tasks:",I),U.error("Failed to load tasks")}finally{i(!1)}},J=async(I,G)=>{const K=Array.from(I.target.files);if(K.length!==0){R(!0);try{const Y=localStorage.getItem("token"),k=[];for(const A of K){const Z=new FormData;Z.append("file",A);const S=await He.post(`${we}/api/tasks/upload-media`,Z,{headers:{Authorization:`Bearer ${Y}`,"Content-Type":"multipart/form-data"}});k.push(S.data)}const w=await He.post(`${we}/api/tasks/${G}/comment`,{text:"",media:k},{headers:{Authorization:`Bearer ${Y}`}});r(t.map(A=>A._id===G?w.data:A)),m&&m._id===G&&C(w.data),U.success(`${k.length} file(s) uploaded as comment!`)}catch(Y){console.error("Error uploading media:",Y),U.error("Failed to upload media")}finally{R(!1)}}},q=async I=>{if(T.trim())try{const G=localStorage.getItem("token"),K=await He.post(`${we}/api/tasks/${I}/comment`,{text:T},{headers:{Authorization:`Bearer ${G}`}});r(t.map(Y=>Y._id===I?K.data:Y)),m&&m._id===I&&C(K.data),_(""),U.success("Comment added!")}catch(G){console.error("Error adding comment:",G),U.error("Failed to add comment")}},Q=(I,G=0)=>{I.media&&I.media.length>0&&(f(I.media),g(G))},W=()=>{f(null),g(0)},pe=()=>{g(I=>(I+1)%F.length)},ge=()=>{g(I=>(I-1+F.length)%F.length)},be=async(I,G)=>{try{const Y=await(await fetch(I)).blob(),k=window.URL.createObjectURL(Y),w=document.createElement("a");w.href=k,w.download=G||"download",document.body.appendChild(w),w.click(),document.body.removeChild(w),window.URL.revokeObjectURL(k),U.success("Download started!")}catch(K){console.error("Error downloading media:",K),U.error("Failed to download")}},te=async(I,G)=>{try{let K="pending",Y=0;G==="pending"?(K="in-progress",Y=50):G==="in-progress"?(K="completed",Y=100):(K="pending",Y=0),r(w=>w.map(A=>A._id===I?{...A,status:K,progress:Y}:A)),U.success(`Status: ${K==="in-progress"?"In Progress":K}`);const k=localStorage.getItem("token");await He.put(`${we}/api/tasks/${I}`,{status:K,progress:Y},{headers:{Authorization:`Bearer ${k}`}})}catch(K){console.error("Error updating task status:",K),U.error("Failed to update task status"),L()}},le=async(I,G)=>{try{let K="pending";G>0&&G<100?K="in-progress":G===100&&(K="completed"),r(k=>k.map(w=>w._id===I?{...w,progress:G,status:K}:w));const Y=localStorage.getItem("token");await He.put(`${we}/api/tasks/${I}`,{progress:G,status:K},{headers:{Authorization:`Bearer ${Y}`}})}catch(K){console.error("Error updating progress:",K),U.error("Failed to update progress"),L()}},M=I=>{switch(I){case"high":return"bg-red-100 text-red-800 border border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border border-yellow-200";case"low":return"bg-green-100 text-green-800 border border-green-200";default:return"bg-gray-100 text-gray-800 border border-gray-200"}},ne=I=>{switch(I){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-blue-100 text-blue-800";case"pending":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 mb-6 border border-white/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s("/dashboard"),className:"p-2 hover:bg-gray-100 rounded-xl transition-all hover:scale-110",children:e.jsx(es,{className:"w-6 h-6 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"My Tasks"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track and manage your assigned tasks"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-100 to-blue-200 px-4 py-3 rounded-xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-blue-700 font-medium",children:"Total Tasks"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:t.length})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-100 to-green-200 px-4 py-3 rounded-xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-green-700 font-medium",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:t.filter(I=>I.status==="completed").length})]})})]})]})}),e.jsx("div",{className:"flex gap-3 mb-6",children:["all","pending","in-progress","completed"].map(I=>{const G=I==="all"?t.length:t.filter(K=>K.status===I).length;return e.jsxs("button",{onClick:()=>a(I),className:`flex-1 py-4 px-6 rounded-xl font-semibold capitalize transition-all transform ${c===I?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg scale-105":"bg-white text-gray-700 hover:bg-gray-50 shadow"}`,children:[e.jsx("div",{className:"text-sm opacity-90",children:I==="in-progress"?"In Progress":I}),e.jsx("div",{className:"text-2xl font-bold mt-1",children:G})]},I)})}),n?e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-4",children:"Loading your tasks..."})]}):t.length===0?e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-12 text-center",children:[e.jsx(rr,{className:"w-20 h-20 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg font-semibold",children:"No tasks found"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Your admin will assign tasks to you"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(I=>{const G=I.progress||0,K=I.status==="completed",Y=I.status==="in-progress";return e.jsxs("div",{className:`bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1 border-2 ${K?"border-green-200":Y?"border-blue-200":"border-gray-200"}`,children:[e.jsx("div",{className:`p-4 rounded-t-2xl ${K?"bg-gradient-to-r from-green-50 to-emerald-50":Y?"bg-gradient-to-r from-blue-50 to-indigo-50":"bg-gradient-to-r from-gray-50 to-slate-50"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("button",{onClick:()=>te(I._id,I.status),className:"flex-shrink-0 group mt-0.5",title:"Click to cycle status",children:K?e.jsxs("div",{className:"relative",children:[e.jsx(rr,{className:"w-8 h-8 text-green-600 group-hover:scale-110 transition-transform drop-shadow"}),e.jsx("div",{className:"absolute inset-0 bg-green-400 rounded-full blur-xl opacity-30 group-hover:opacity-50"})]}):Y?e.jsxs("div",{className:"relative",children:[e.jsx(Nn,{className:"w-8 h-8 text-blue-600 group-hover:scale-110 transition-transform"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-3.5 h-3.5 bg-blue-600 rounded-full animate-pulse"})})]}):e.jsx(Nn,{className:"w-8 h-8 text-gray-400 group-hover:text-blue-600 group-hover:scale-110 transition-all"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`text-base font-bold mb-1 ${K?"line-through text-gray-500":"text-gray-800"}`,children:I.title}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wider ${M(I.priority)}`,children:I.priority}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wider ${ne(I.status)}`,children:I.status==="in-progress"?"In Progress":I.status})]})]})]})})}),e.jsxs("div",{className:"p-4",children:[I.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2 leading-relaxed",children:I.description}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-bold text-gray-700",children:"Progress (Click to edit)"}),e.jsxs("span",{className:`text-lg font-bold ${G===100?"text-green-600":"text-blue-600"}`,children:[G,"%"]})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"h-8 bg-gray-100 rounded-full overflow-hidden shadow-inner cursor-pointer",children:[e.jsx("div",{className:`h-full transition-all duration-500 ease-out relative ${G===100?"bg-gradient-to-r from-green-400 via-green-500 to-green-600":G>0?"bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600":"bg-gray-200"}`,style:{width:`${G}%`},children:G>0&&e.jsx("div",{className:"absolute inset-0 bg-white/20 animate-pulse"})}),e.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:G,onChange:k=>le(I._id,parseInt(k.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]}),e.jsx("div",{className:"flex justify-between mt-1 px-1",children:[0,25,50,75,100].map(k=>e.jsxs("button",{onClick:()=>le(I._id,k),className:"text-[10px] text-gray-400 hover:text-blue-600 font-medium transition-colors",children:[k,"%"]},k))})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[I.startDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx($t,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-gray-600 font-medium",children:"Start:"}),e.jsx("span",{className:"bg-blue-50 text-blue-800 px-2 py-1 rounded text-xs font-semibold",children:new Date(I.startDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),I.dueDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx($t,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"text-gray-600 font-medium",children:"Due:"}),e.jsx("span",{className:"bg-yellow-50 text-yellow-800 px-2 py-1 rounded text-xs font-semibold",children:new Date(I.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),I.endDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx($t,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-gray-600 font-medium",children:"End:"}),e.jsx("span",{className:"bg-green-50 text-green-800 px-2 py-1 rounded text-xs font-semibold",children:new Date(I.endDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),I.media&&I.media.length>0&&e.jsxs("button",{onClick:()=>Q(I,0),className:"flex flex-col items-center gap-1 p-3 bg-purple-50 hover:bg-purple-100 rounded-lg transition-all group",title:`${I.media.length} attachment(s) from task creation`,children:[e.jsx(Ot,{className:"w-6 h-6 text-purple-600 group-hover:scale-110 transition-transform"}),e.jsx("span",{className:"text-xs font-bold text-purple-600",children:I.media.length})]})]})}),I.comments&&I.comments.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(os,{className:"w-4 h-4 text-blue-600"}),e.jsxs("h4",{className:"text-xs font-bold text-gray-700",children:["Comments (",I.comments.length,")"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:I.comments[I.comments.length-1].userName}),e.jsx("span",{className:"text-[10px] text-gray-500",children:new Date(I.comments[I.comments.length-1].createdAt).toLocaleDateString()})]}),I.comments[I.comments.length-1].text&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:I.comments[I.comments.length-1].text}),I.comments[I.comments.length-1].media&&I.comments[I.comments.length-1].media.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 text-purple-600",children:[e.jsx(Ot,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"text-xs font-medium",children:[I.comments[I.comments.length-1].media.length," attachment",I.comments[I.comments.length-1].media.length>1?"s":""]})]}),I.comments.length>1&&e.jsxs("button",{onClick:()=>{C(I),j(!0)},className:"text-[10px] text-blue-600 hover:underline mt-1",children:["+",I.comments.length-1," more comment",I.comments.length-1>1?"s":""]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-3 border-t border-gray-100",children:[e.jsxs("button",{onClick:()=>{C(I),j(!0)},className:"flex-1 flex items-center justify-center gap-2 py-2 px-3 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium",children:[e.jsx(os,{className:"w-4 h-4"}),"Add Comment"]}),e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 py-2 px-3 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition-colors text-sm font-medium",children:[e.jsx(Ls,{className:"w-4 h-4"}),z&&(m==null?void 0:m._id)===I._id?"Uploading...":"Upload"]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:k=>J(k,I._id),className:"hidden",disabled:z})]})]})]})]},I._id)})})]}),b&&m&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:m.title}),e.jsx("p",{className:"text-sm opacity-90",children:"Add your comments"})]}),e.jsx("button",{onClick:()=>{j(!1),_("")},className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(Ct,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4 max-h-96 overflow-y-auto custom-scrollbar",children:m.comments&&m.comments.length>0?e.jsx("div",{className:"space-y-3",children:m.comments.map((I,G)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-800",children:I.userName}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(I.createdAt).toLocaleString()})]}),I.text&&e.jsx("p",{className:"text-gray-700 mb-2",children:I.text}),I.media&&I.media.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:I.media.map((K,Y)=>e.jsxs("div",{onClick:()=>Q(I,Y),className:"relative aspect-square rounded-lg overflow-hidden cursor-pointer hover:scale-105 transition-transform group",children:[K.type==="image"?e.jsx("img",{src:K.url,alt:K.filename,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:e.jsx(ht,{className:"w-8 h-8 text-gray-400"})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all"})]},Y))})]},G))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(os,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No comments yet. Be the first to comment!"})]})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:T,onChange:I=>_(I.target.value),onKeyPress:I=>{I.key==="Enter"&&!I.shiftKey&&(I.preventDefault(),q(m._id))},placeholder:"Write your comment...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsxs("div",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2",children:[e.jsx(Ot,{className:"w-4 h-4"}),e.jsx("span",{children:z?"Uploading...":"Media"})]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:I=>m&&J(I,m._id),className:"hidden",disabled:z})]}),e.jsxs("button",{onClick:()=>q(m._id),disabled:!T.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[e.jsx(qr,{className:"w-4 h-4"}),"Send"]})]})})]})}),F&&F.length>0&&e.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:W,children:e.jsxs("div",{className:"relative max-w-5xl w-full",onClick:I=>I.stopPropagation(),children:[e.jsx("button",{onClick:W,className:"absolute top-4 right-4 z-10 p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors",children:e.jsx(Ct,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:()=>be(F[O].url,F[O].filename),className:"absolute top-4 right-16 z-10 p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors",title:"Download",children:e.jsx(vt,{className:"w-6 h-6 text-white"})}),F.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ge,className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Previous",children:e.jsx(Os,{className:"w-8 h-8 text-white stroke-[3]"})}),e.jsx("button",{onClick:pe,className:"absolute right-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Next",children:e.jsx($s,{className:"w-8 h-8 text-white stroke-[3]"})})]}),e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden max-h-[80vh]",children:[F[O].type==="image"?e.jsx("img",{src:F[O].url,alt:F[O].filename,className:"w-full h-full object-contain max-h-[70vh]"}):e.jsx("video",{src:F[O].url,controls:!0,className:"w-full h-full object-contain max-h-[70vh]"}),e.jsxs("div",{className:"p-4 bg-gray-50",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:F[O].filename}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[O+1," of ",F.length]})]})]})]})}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
        input[type="range"]::-webkit-slider-thumb {
          appearance: none;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          background: white;
          cursor: pointer;
          border: 3px solid currentColor;
          box-shadow: 0 2px 8px rgba(0,0,0,0.2);
          transition: all 0.2s;
        }
        input[type="range"]::-webkit-slider-thumb:hover {
          transform: scale(1.2);
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #888;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #555;
        }
      `}})]})},Gd=()=>{var w;It();const s=ps(),[t,r]=u.useState([]),[n,i]=u.useState([]),[c,a]=u.useState(!0),[m,C]=u.useState(""),[b,j]=u.useState(null),[T,_]=u.useState(null),[z,R]=u.useState(0),[F,f]=u.useState(new Date),[O,g]=u.useState("grid"),[L,J]=u.useState(null);u.useEffect(()=>{q()},[]);const q=async()=>{try{a(!0);const A=localStorage.getItem("token");console.log(" Fetching all users from:",`${we}/api/users`);const Z=await He.get(`${we}/api/users`,{headers:{Authorization:`Bearer ${A}`}});console.log(" Raw users response:",Z.data),console.log(" Total users received:",Z.data.length);const S={};Z.data.forEach(ee=>{S[ee.role]=(S[ee.role]||0)+1}),console.log(" Users by role:",S);const E=Z.data.filter(ee=>{const V=ee._id||ee.id;return console.log(`Checking user: ${ee.name}, role: ${ee.role}, _id: ${ee._id}, id: ${ee.id}`),ee.role==="user"&&V});console.log(" Regular users found:",E.length),console.log(" Filtered Users:",E.map(ee=>({_id:ee._id,id:ee.id,name:ee.name,role:ee.role}))),i(E);const H=[];for(const ee of E){const V=ee._id||ee.id;if(!V){console.warn(" User without id:",ee);continue}try{console.log(` Fetching updates for: ${ee.name} (${V})`);const ue=await He.get(`${we}/api/daily-updates/user/${V}`,{headers:{Authorization:`Bearer ${A}`}});console.log(` ${ee.name}: ${ue.data.length} updates`),ue.data.forEach(je=>{H.push({...je,userName:ee.name,userEmail:ee.email,userImage:ee.profileImage})})}catch(ue){console.error(` Failed to fetch updates for ${ee.name}:`,ue.message)}}console.log(" Total updates from all users:",H.length),r(H.sort((ee,V)=>new Date(V.date)-new Date(ee.date)))}catch(A){console.error(" Error fetching data:",A),U.error("Failed to load data")}finally{a(!1)}},Q=(A,Z)=>{_(A),R(Z)},W=()=>{_(null),R(0)},pe=()=>{T&&z<T.length-1&&R(z+1)},ge=()=>{z>0&&R(z-1)},be=A=>A>500?"from-green-400 to-green-600":A>200?"from-blue-400 to-blue-600":"from-purple-400 to-purple-600",te=b?t.filter(A=>{var E;const Z=((E=A.user)==null?void 0:E._id)||A.user,S=b._id||b.id;return Z===S}):[],le=n.filter(A=>{var Z,S;return!m||((Z=A.name)==null?void 0:Z.toLowerCase().includes(m.toLowerCase()))||((S=A.email)==null?void 0:S.toLowerCase().includes(m.toLowerCase()))}),M=A=>t.filter(Z=>{var E;return(((E=Z.user)==null?void 0:E._id)||Z.user)===A}).length,ne=A=>{const Z=A.getFullYear(),S=A.getMonth(),E=new Date(Z,S,1),ee=new Date(Z,S+1,0).getDate(),V=E.getDay();return{daysInMonth:ee,startingDayOfWeek:V}},I=A=>{if(!b)return{color:"",update:null};const Z=b._id||b.id,S=t.find(E=>{var V;const H=((V=E.user)==null?void 0:V._id)||E.user,ee=new Date(E.date).toISOString().split("T")[0];return H===Z&&ee===A});if(S){const E=S.content.length;let H="";return E>500?H="bg-gradient-to-br from-green-400 to-green-600":E>200?H="bg-gradient-to-br from-blue-400 to-blue-600":H="bg-gradient-to-br from-purple-400 to-purple-600",{color:H,update:S}}return{color:"",update:null}},G=A=>{const Z=I(A);Z.update&&J(Z.update)},K=()=>{J(null)},Y=async(A,Z)=>{try{const E=await(await fetch(A)).blob(),H=window.URL.createObjectURL(E),ee=document.createElement("a");ee.href=H,ee.download=Z||"download",document.body.appendChild(ee),ee.click(),window.URL.revokeObjectURL(H),document.body.removeChild(ee),U.success("Download started!")}catch(S){console.error("Download error:",S),U.error("Failed to download file")}},k=()=>{if(!b)return null;const{daysInMonth:A,startingDayOfWeek:Z}=ne(F),S=[],E=F.toLocaleDateString("en-US",{month:"long",year:"numeric"});for(let H=0;H<Z;H++)S.push(e.jsx("div",{className:"p-2"},`empty-${H}`));for(let H=1;H<=A;H++){const ee=new Date(F.getFullYear(),F.getMonth(),H),V=ee.toISOString().split("T")[0],ue=ee.toDateString()===new Date().toDateString(),je=I(V),Te=je.color!=="";S.push(e.jsxs("button",{onClick:()=>G(V),disabled:!Te,className:`
            relative p-1.5 rounded-lg text-center transition-all text-xs
            ${Te?`${je.color} text-white font-bold shadow cursor-pointer hover:scale-105`:ue?"bg-gray-100 text-gray-900 font-semibold border border-blue-500 cursor-default":"bg-gray-50 text-gray-600 cursor-default"}
          `,children:[e.jsx("span",{children:H}),Te&&e.jsx("div",{className:"absolute top-0.5 right-0.5",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})})]},H))}return e.jsxs("div",{className:"bg-white rounded-lg shadow p-3 border border-gray-200 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("button",{onClick:()=>f(new Date(F.getFullYear(),F.getMonth()-1)),className:"p-1 hover:bg-gray-100 rounded transition-colors",children:e.jsx(Os,{className:"w-4 h-4 text-gray-600"})}),e.jsx("h3",{className:"text-sm font-bold text-gray-800",children:E}),e.jsx("button",{onClick:()=>f(new Date(F.getFullYear(),F.getMonth()+1)),className:"p-1 hover:bg-gray-100 rounded transition-colors",children:e.jsx($s,{className:"w-4 h-4 text-gray-600"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["S","M","T","W","T","F","S"].map((H,ee)=>e.jsx("div",{className:"text-[10px] font-bold text-gray-500",children:H},ee))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:S}),e.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-2 text-[10px]",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-gradient-to-br from-purple-400 to-purple-600"}),e.jsx("span",{className:"text-gray-600",children:"Short"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-gradient-to-br from-blue-400 to-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Med"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-gradient-to-br from-green-400 to-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Long"})]})]})})]})};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-3 py-3",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-3 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>s("/dashboard"),className:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(es,{className:"w-5 h-5 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Manage Daily Updates"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Monitor user daily updates"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-blue-50 px-3 py-2 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ci,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] text-gray-600",children:"Updates"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:t.length})]})]})}),e.jsx("div",{className:"bg-purple-50 px-3 py-2 rounded-lg border border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] text-gray-600",children:"Users"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:n.filter(A=>M(A._id||A.id)>0).length})]})]})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 sticky top-3",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200",children:[e.jsxs("h2",{className:"text-sm font-bold text-gray-800 mb-2",children:["Users (",n.length,")"]}),e.jsxs("div",{className:"relative",children:[e.jsx(Gs,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search...",value:m,onChange:A=>C(A.target.value),className:"w-full pl-8 pr-2 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsx("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto p-2 space-y-1.5 custom-scrollbar",children:c?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})}):le.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(lt,{className:"w-8 h-8 text-gray-300 mx-auto mb-1"}),e.jsx("p",{className:"text-xs",children:"No users"})]}):le.map(A=>{var H;const Z=A._id||A.id,S=b&&(b._id===Z||b.id===Z),E=M(Z);return e.jsx("div",{onClick:()=>j(A),className:`p-2.5 rounded-lg cursor-pointer transition-all ${S?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-md":"bg-gray-50 hover:bg-gray-100"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[A.profileImage?e.jsx("img",{src:`${we}${A.profileImage}`,alt:A.name,className:"w-9 h-9 rounded-full object-cover"}):e.jsx("div",{className:`w-9 h-9 rounded-full flex items-center justify-center ${S?"bg-white/20":"bg-blue-500"}`,children:e.jsx("span",{className:"text-white font-bold text-sm",children:(H=A.name)==null?void 0:H.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-semibold truncate ${S?"text-white":"text-gray-800"}`,children:A.name}),E>0&&e.jsxs("div",{className:`text-[10px] font-semibold ${S?"text-white/90":"text-blue-600"}`,children:[E," update",E!==1?"s":""]})]})]})},Z)})})]})}),e.jsx("div",{className:"lg:col-span-3",children:c?e.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center border border-gray-200",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 text-sm mt-3",children:"Loading..."})]}):b?te.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center border border-gray-200",children:[e.jsx($t,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-1",children:[b.name," - No updates"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"User hasn't created any updates yet"})]}):e.jsxs("div",{className:"space-y-3",children:[k(),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[b.profileImage?e.jsx("img",{src:`${we}${b.profileImage}`,alt:b.name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-lg",children:(w=b.name)==null?void 0:w.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:b.name}),e.jsx("p",{className:"text-xs text-gray-500",children:b.email}),e.jsxs("p",{className:"text-xs text-blue-600 font-semibold",children:[te.length," update",te.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-100 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>g("grid"),className:`p-1.5 rounded transition-all ${O==="grid"?"bg-white text-blue-600 shadow":"text-gray-500 hover:text-gray-700"}`,title:"Grid View",children:e.jsx(Dn,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>g("list"),className:`p-1.5 rounded transition-all ${O==="list"?"bg-white text-blue-600 shadow":"text-gray-500 hover:text-gray-700"}`,title:"List View",children:e.jsx(Gr,{className:"w-4 h-4"})})]})]})}),O==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3",children:te.map(A=>{const Z=be(A.content.length);return e.jsxs("div",{className:`bg-gradient-to-br ${Z} p-3 rounded-xl shadow hover:shadow-lg transition-all`,children:[e.jsx("div",{className:"bg-white/20 backdrop-blur-sm rounded-lg p-2 mb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-bold text-xs",children:new Date(A.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsxs("span",{className:"text-white/80 text-[10px] flex items-center gap-1",children:[e.jsx(gs,{className:"w-2.5 h-2.5"}),new Date(A.updatedAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]})}),e.jsx("p",{className:"text-white text-xs leading-relaxed mb-2 line-clamp-3",children:A.content}),A.media&&A.media.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-1 mt-2",children:A.media.slice(0,3).map((S,E)=>e.jsx("div",{className:"relative rounded overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>Q(A.media,E),children:S.type==="image"?e.jsx("img",{src:S.url,alt:S.filename,className:"w-full h-14 object-cover"}):e.jsx("div",{className:"w-full h-14 bg-black/20 flex items-center justify-center",children:e.jsx(ht,{className:"w-4 h-4 text-white"})})},`${A._id}-media-${E}`))}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-white/20 text-white/70 text-[10px]",children:[A.content.length," chars"]})]},A._id)})}):e.jsx("div",{className:"space-y-2",children:te.map(A=>{const Z=be(A.content.length);return e.jsx("div",{className:`bg-gradient-to-r ${Z} p-3 rounded-lg shadow hover:shadow-md transition-all`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-lg p-2 text-center min-w-[60px]",children:[e.jsx("div",{className:"text-white font-bold text-lg",children:new Date(A.date).getDate()}),e.jsx("div",{className:"text-white/90 text-[10px] font-semibold uppercase",children:new Date(A.date).toLocaleDateString("en-US",{month:"short"})})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-white font-bold text-sm",children:new Date(A.date).toLocaleDateString("en-US",{weekday:"long"})}),e.jsxs("span",{className:"text-white/80 text-[10px] flex items-center gap-1",children:[e.jsx(gs,{className:"w-2.5 h-2.5"}),new Date(A.updatedAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]}),e.jsx("p",{className:"text-white/95 text-xs leading-relaxed mb-2 line-clamp-2",children:A.content}),A.media&&A.media.length>0&&e.jsxs("div",{className:"flex gap-1.5 mb-2",children:[A.media.slice(0,4).map((S,E)=>e.jsx("div",{className:"relative rounded overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>Q(A.media,E),children:S.type==="image"?e.jsx("img",{src:S.url,alt:S.filename,className:"w-12 h-12 object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-black/20 flex items-center justify-center",children:e.jsx(ht,{className:"w-3 h-3 text-white"})})},`${A._id}-media-${E}`)),A.media.length>4&&e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded flex items-center justify-center",children:e.jsxs("span",{className:"text-white font-bold text-[10px]",children:["+",A.media.length-4]})})]}),e.jsxs("span",{className:"text-white/70 text-[10px]",children:[A.content.length," chars"]})]})]})},A._id)})})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center border border-gray-200",children:[e.jsx(lt,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-1",children:"Select a User"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose from left panel"})]})})]})]}),L&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-blue-500 to-purple-500 p-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-white",children:[e.jsx("h3",{className:"text-2xl font-bold mb-1",children:new Date(L.date).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}),e.jsxs("p",{className:"text-white/80 text-sm",children:["Last updated: ",new Date(L.updatedAt).toLocaleString()]})]}),e.jsx("button",{onClick:K,className:"bg-white/20 hover:bg-white/30 text-white p-2 rounded-full transition-colors",children:e.jsx(Ct,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Update Content"}),e.jsx("div",{className:"mt-2 bg-gray-50 rounded-xl p-4 border-2 border-gray-200",children:e.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:L.content})})]}),L.media&&L.media.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:["Media (",L.media.length,")"]}),e.jsx("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-3 gap-3",children:L.media.map((A,Z)=>e.jsxs("div",{className:"relative rounded-xl overflow-hidden cursor-pointer hover:opacity-90 transition-opacity border-2 border-gray-200",onClick:()=>Q(L.media,Z),children:[A.type==="image"?e.jsx("img",{src:A.url,alt:A.filename,className:"w-full h-32 object-cover"}):e.jsx("video",{src:A.url,className:"w-full h-32 object-cover"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2",children:e.jsxs("span",{className:"text-white text-xs flex items-center gap-1",children:[A.type==="image"?e.jsx(Ot,{className:"w-3 h-3"}):e.jsx(ht,{className:"w-3 h-3"}),A.filename]})})]},`popup-media-${Z}`))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-200",children:[e.jsx("p",{className:"text-xs font-semibold text-blue-600 mb-1",children:"Character Count"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:L.content.length})]}),L.media&&e.jsxs("div",{className:"bg-purple-50 rounded-xl p-4 border border-purple-200",children:[e.jsx("p",{className:"text-xs font-semibold text-purple-600 mb-1",children:"Media Files"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700",children:L.media.length})]})]})]})]})}),T&&e.jsxs("div",{className:"fixed inset-0 bg-black/95 z-50 flex items-center justify-center",children:[e.jsx("button",{onClick:W,className:"absolute top-4 right-4 bg-white/10 hover:bg-white/20 text-white p-3 rounded-full transition-colors",children:e.jsx(Ct,{className:"w-6 h-6"})}),e.jsxs("button",{onClick:()=>Y(T[z].url,T[z].filename),className:"absolute top-4 right-20 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-full transition-colors flex items-center gap-2 shadow-lg",children:[e.jsx(vt,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-semibold",children:"Download"})]}),T.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ge,className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Previous",children:e.jsx(Os,{className:"w-8 h-8 text-white stroke-[3]"})}),e.jsx("button",{onClick:pe,className:"absolute right-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Next",children:e.jsx($s,{className:"w-8 h-8 text-white stroke-[3]"})})]}),T.length>1&&e.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-black/50 text-white px-4 py-2 rounded-full text-sm",children:[z+1," / ",T.length]}),e.jsx("div",{className:"max-w-7xl max-h-[90vh] w-full h-full flex items-center justify-center p-4",children:T[z].type==="image"?e.jsx("img",{src:T[z].url,alt:T[z].filename,className:"max-w-full max-h-full object-contain rounded-lg"}):e.jsx("video",{src:T[z].url,controls:!0,autoPlay:!0,className:"max-w-full max-h-full rounded-lg"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"bg-black/50 text-white px-4 py-2 rounded-full text-sm max-w-md truncate",children:T[z].filename}),e.jsx("div",{className:"text-white/60 text-xs",children:"Press ESC to close  Arrow keys to navigate  Click Download to save"})]})]}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        .line-clamp-3 {
          display: -webkit-box;
          -webkit-line-clamp: 3;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        .line-clamp-4 {
          display: -webkit-box;
          -webkit-line-clamp: 4;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #f3f4f6;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
          border-radius: 10px;
        }
      `}})]})},qd=()=>{It();const s=ps(),[t,r]=u.useState([]),[n,i]=u.useState(null),[c,a]=u.useState([]),[m,C]=u.useState(!0),[b,j]=u.useState(""),[T,_]=u.useState(!1),[z,R]=u.useState(""),[F,f]=u.useState(""),[O,g]=u.useState("medium"),[L,J]=u.useState("pending"),[q,Q]=u.useState(new Date().toISOString().split("T")[0]),[W,pe]=u.useState(""),[ge,be]=u.useState(""),[te,le]=u.useState(null),[M,ne]=u.useState("grid"),[I,G]=u.useState([]),[K,Y]=u.useState([]),[k,w]=u.useState(null),[A,Z]=u.useState(!1),[S,E]=u.useState(""),[H,ee]=u.useState(!1),[V,ue]=u.useState(null),[je,Te]=u.useState(0);u.useEffect(()=>{$e()},[]),u.useEffect(()=>{if(n){const x=n._id||n.id;x&&ct(x)}},[n]);const $e=async()=>{try{C(!0);const x=localStorage.getItem("token"),oe=await He.get(`${we}/api/users`,{headers:{Authorization:`Bearer ${x}`}});console.log("Users fetched:",oe.data.length);const xe=oe.data.filter(re=>re.role==="user"&&(re._id||re.id));console.log("Regular users with id:",xe.length),r(xe)}catch(x){console.error("Error fetching users:",x),U.error("Failed to load users")}finally{C(!1)}},ct=async x=>{var oe;try{C(!0);const xe=localStorage.getItem("token");console.log("Fetching tasks for user:",x);const re=await He.get(`${we}/api/tasks/user/${x}`,{headers:{Authorization:`Bearer ${xe}`}});console.log("Tasks fetched:",re.data.length),a(re.data)}catch(xe){console.error("Error fetching tasks:",xe),console.error("Error response:",(oe=xe.response)==null?void 0:oe.data),U.error("Failed to load tasks")}finally{C(!1)}},Ze=x=>{const oe=Array.from(x.target.files);oe.length!==0&&(G(xe=>[...xe,...oe]),oe.forEach(xe=>{const re=new FileReader;re.onloadend=()=>{Y(Ee=>[...Ee,{url:re.result,type:xe.type.startsWith("video/")?"video":"image",name:xe.name}])},re.readAsDataURL(xe)}))},st=x=>{G(oe=>oe.filter((xe,re)=>re!==x)),Y(oe=>oe.filter((xe,re)=>re!==x))},ft=async()=>{if(I.length===0)return[];const x=localStorage.getItem("token"),oe=[];for(const xe of I){const re=new FormData;re.append("file",xe);const Ee=await He.post(`${we}/api/tasks/upload-media`,re,{headers:{Authorization:`Bearer ${x}`,"Content-Type":"multipart/form-data"}});oe.push(Ee.data)}return oe},ze=async(x,oe)=>{const xe=Array.from(x.target.files);if(xe.length!==0){ee(!0);try{const re=localStorage.getItem("token"),Ee=[];for(const dt of xe){const xt=new FormData;xt.append("file",dt);const Rt=await He.post(`${we}/api/tasks/upload-media`,xt,{headers:{Authorization:`Bearer ${re}`,"Content-Type":"multipart/form-data"}});Ee.push(Rt.data)}const Pe=await He.post(`${we}/api/tasks/${oe}/comment`,{text:"",media:Ee},{headers:{Authorization:`Bearer ${re}`}});a(c.map(dt=>dt._id===oe?Pe.data:dt)),k&&k._id===oe&&w(Pe.data),U.success(`${Ee.length} file(s) uploaded as comment!`)}catch(re){console.error("Error uploading media:",re),U.error("Failed to upload media")}finally{ee(!1)}}},it=async x=>{if(S.trim())try{const oe=localStorage.getItem("token"),xe=await He.post(`${we}/api/tasks/${x}/comment`,{text:S},{headers:{Authorization:`Bearer ${oe}`}});a(c.map(re=>re._id===x?xe.data:re)),k&&k._id===x&&w(xe.data),E(""),U.success("Comment added!")}catch(oe){console.error("Error adding comment:",oe),U.error("Failed to add comment")}},de=(x,oe=0)=>{x.media&&x.media.length>0&&(ue(x.media),Te(oe))},Ce=()=>{ue(null),Te(0)},Ge=()=>{Te(x=>(x+1)%V.length)},qe=()=>{Te(x=>(x-1+V.length)%V.length)},Qe=async(x,oe)=>{try{const re=await(await fetch(x)).blob(),Ee=window.URL.createObjectURL(re),Pe=document.createElement("a");Pe.href=Ee,Pe.download=oe||"download",document.body.appendChild(Pe),Pe.click(),document.body.removeChild(Pe),window.URL.revokeObjectURL(Ee),U.success("Download started!")}catch(xe){console.error("Error downloading media:",xe),U.error("Failed to download")}},Xe=async()=>{var x,oe,xe;if(!z.trim()){U.error("Please enter task title");return}if(!n){U.error("Please select a user");return}try{ee(!0);const re=localStorage.getItem("token"),Ee=n._id||n.id;console.log("Creating task for user:",Ee,n.name);let Pe=[];I.length>0&&(U.loading("Uploading attachments...",{id:"upload"}),Pe=await ft(),U.dismiss("upload"));const dt={userId:Ee,title:z,description:F,priority:O,status:L,startDate:q||new Date().toISOString().split("T")[0],dueDate:W||null,endDate:ge||null,media:Pe};console.log("Task data:",dt);let xt;te?(xt=(await He.put(`${we}/api/tasks/${te}`,dt,{headers:{Authorization:`Bearer ${re}`}})).data,U.success("Task updated successfully")):(xt=(await He.post(`${we}/api/tasks/assign`,dt,{headers:{Authorization:`Bearer ${re}`}})).data,console.log("Created task with media:",xt),U.success("Task created successfully!")),We(),ct(Ee)}catch(re){console.error("Error creating task:",re),console.error("Error response:",(x=re.response)==null?void 0:x.data);const Ee=((xe=(oe=re.response)==null?void 0:oe.data)==null?void 0:xe.error)||"Failed to create task";U.error(Ee)}finally{ee(!1)}},Fe=async x=>{if(confirm("Are you sure you want to delete this task?"))try{const oe=localStorage.getItem("token");await He.delete(`${we}/api/tasks/${x}`,{headers:{Authorization:`Bearer ${oe}`}}),U.success("Task deleted successfully");const xe=n._id||n.id;ct(xe)}catch(oe){console.error("Error deleting task:",oe),U.error("Failed to delete task")}},Ie=x=>{R(x.title),f(x.description),g(x.priority),J(x.status),Q(x.startDate?x.startDate.split("T")[0]:new Date().toISOString().split("T")[0]),pe(x.dueDate?x.dueDate.split("T")[0]:""),be(x.endDate?x.endDate.split("T")[0]:""),le(x._id),_(!0)},We=()=>{R(""),f(""),g("medium"),J("pending"),Q(new Date().toISOString().split("T")[0]),pe(""),be(""),le(null),_(!1),G([]),Y([])},Ye=x=>{switch(x){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},pt=x=>{switch(x){case"completed":return"bg-green-100 text-green-800";case"in-progress":return"bg-blue-100 text-blue-800";case"pending":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},ae=t.filter(x=>x.name.toLowerCase().includes(b.toLowerCase())||x.email.toLowerCase().includes(b.toLowerCase()));return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6 border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s("/dashboard"),className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(es,{className:"w-6 h-6 text-gray-700"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Manage User Tasks"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and assign tasks to users"})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-blue-100 to-purple-100 px-4 py-3 rounded-xl",children:[e.jsx(lt,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:t.length})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Select User"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Gs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:b,onChange:x=>j(x.target.value),className:"w-full pl-10 pr-4 py-2 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto custom-scrollbar",children:ae.map(x=>e.jsx("div",{onClick:()=>i(x),className:`p-4 rounded-xl cursor-pointer transition-all ${(n==null?void 0:n._id)===x._id?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg":"bg-gray-50 hover:bg-gray-100"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[x.profileImage?e.jsx("img",{src:`${we}${x.profileImage}`,alt:x.name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${(n==null?void 0:n._id)===x._id?"bg-white/20":"bg-blue-500"}`,children:e.jsx("span",{className:"text-white font-bold",children:x.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-semibold ${(n==null?void 0:n._id)===x._id?"text-white":"text-gray-800"}`,children:x.name}),e.jsx("p",{className:`text-sm ${(n==null?void 0:n._id)===x._id?"text-white/80":"text-gray-500"}`,children:x.email})]})]})},x._id))})]})}),e.jsx("div",{className:"lg:col-span-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100 mb-6",children:e.jsxs("button",{onClick:()=>_(!T),className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all flex items-center justify-center gap-2 font-semibold shadow-lg",children:[e.jsx(ir,{className:"w-5 h-5"}),"Create New Task for ",n.name]})}),T&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:te?"Edit Task":"Create New Task"}),e.jsx("button",{onClick:We,className:"text-gray-500 hover:text-gray-700",children:e.jsx(Ct,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Task Title *"}),e.jsx("input",{type:"text",value:z,onChange:x=>R(x.target.value),placeholder:"Enter task title",className:"w-full px-4 py-2 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:F,onChange:x=>f(x.target.value),placeholder:"Enter task description",className:"w-full px-4 py-2 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",rows:"4"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e.jsxs("select",{value:O,onChange:x=>g(x.target.value),className:"w-full px-4 py-2 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:L,onChange:x=>J(x.target.value),className:"w-full px-4 py-2 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date (Auto-filled)"}),e.jsx("input",{type:"date",value:q,onChange:x=>Q(x.target.value),className:"w-full px-4 py-2 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-blue-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date (Optional)"}),e.jsx("input",{type:"date",value:W,onChange:x=>pe(x.target.value),className:"w-full px-4 py-2 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date (Optional)"}),e.jsx("input",{type:"date",value:ge,onChange:x=>be(x.target.value),className:"w-full px-4 py-2 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Attachments (Images/Videos)"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-gray-300 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all",children:[e.jsx(Ls,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-gray-600 font-medium",children:H?"Uploading...":"Click to upload files"})]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:Ze,className:"hidden",disabled:H})]}),K.length>0&&e.jsx("div",{className:"mt-3 grid grid-cols-4 gap-3",children:K.map((x,oe)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-100",children:x.type==="image"?e.jsx("img",{src:x.url,alt:x.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(ht,{className:"w-8 h-8 text-gray-400"})})}),e.jsx("button",{onClick:()=>st(oe),className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg",title:"Remove",children:e.jsx(Ct,{className:"w-4 h-4"})}),e.jsx("p",{className:"text-xs text-gray-600 mt-1 truncate",title:x.name,children:x.name})]},oe))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Xe,disabled:H,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:H?"Uploading...":te?"Update Task":"Create Task"}),e.jsx("button",{onClick:We,disabled:H,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:[n.name,"'s Tasks (",c.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-xl p-1",children:[e.jsx("button",{onClick:()=>ne("grid"),className:`p-2 rounded-lg transition-all ${M==="grid"?"bg-white text-blue-600 shadow-md":"text-gray-500 hover:text-gray-700"}`,title:"Grid View",children:e.jsx(Dn,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>ne("list"),className:`p-2 rounded-lg transition-all ${M==="list"?"bg-white text-blue-600 shadow-md":"text-gray-500 hover:text-gray-700"}`,title:"List View",children:e.jsx(Gr,{className:"w-5 h-5"})})]})]}),m?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-4 border-blue-600"})}):c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Nn,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"No tasks assigned yet"})]}):M==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[600px] overflow-y-auto custom-scrollbar",children:c.map(x=>{const oe=x.progress||0,xe=x.status==="completed",re=x.status==="in-progress";return e.jsxs("div",{className:`bg-white rounded-xl shadow-md hover:shadow-lg transition-all border-2 ${xe?"border-green-300":re?"border-blue-300":"border-gray-200"}`,children:[e.jsx("div",{className:`p-4 rounded-t-xl border-b ${xe?"bg-green-50 border-green-200":re?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`text-base font-bold mb-1 ${xe?"line-through text-gray-500":"text-gray-800"}`,children:x.title}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-[10px] font-bold uppercase ${Ye(x.priority)}`,children:x.priority}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-[10px] font-bold uppercase ${pt(x.status)}`,children:x.status==="in-progress"?"In Progress":x.status})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>Ie(x),className:"p-1.5 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors",title:"Edit Task",children:e.jsx(At,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Fe(x._id),className:"p-1.5 text-red-600 hover:bg-red-100 rounded-lg transition-colors",title:"Delete Task",children:e.jsx(Ss,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"p-4",children:[x.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:x.description}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700",children:"Progress"}),e.jsxs("span",{className:`text-sm font-bold ${oe===100?"text-green-600":"text-blue-600"}`,children:[oe,"%"]})]}),e.jsx("div",{className:"h-3 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${oe===100?"bg-gradient-to-r from-green-400 to-green-600":oe>0?"bg-gradient-to-r from-blue-400 to-blue-600":"bg-gray-300"}`,style:{width:`${oe}%`}})})]}),e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsxs("div",{className:"flex-1 space-y-2 text-xs",children:[x.startDate&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{className:"font-semibold w-16",children:"Start:"}),e.jsx("span",{className:"bg-blue-50 px-2 py-1 rounded",children:new Date(x.startDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),x.dueDate&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{className:"font-semibold w-16",children:"Due:"}),e.jsx("span",{className:"bg-yellow-50 px-2 py-1 rounded",children:new Date(x.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),x.endDate&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{className:"font-semibold w-16",children:"End:"}),e.jsx("span",{className:"bg-green-50 px-2 py-1 rounded",children:new Date(x.endDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),x.media&&x.media.length>0&&e.jsxs("button",{onClick:()=>de(x,0),className:"flex flex-col items-center gap-1 p-2 bg-purple-50 hover:bg-purple-100 rounded-lg transition-all group",title:`${x.media.length} attachment(s) from task creation`,children:[e.jsx(Ot,{className:"w-5 h-5 text-purple-600 group-hover:scale-110 transition-transform"}),e.jsx("span",{className:"text-[10px] font-bold text-purple-600",children:x.media.length})]})]}),x.comments&&x.comments.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(os,{className:"w-3.5 h-3.5 text-blue-600"}),e.jsxs("h4",{className:"text-xs font-bold text-gray-700",children:["Comments (",x.comments.length,")"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[x.comments[x.comments.length-1].text&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:x.comments[x.comments.length-1].text}),x.comments[x.comments.length-1].media&&x.comments[x.comments.length-1].media.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 text-purple-600",children:[e.jsx(Ot,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"text-xs font-medium",children:[x.comments[x.comments.length-1].media.length," attachment",x.comments[x.comments.length-1].media.length>1?"s":""]})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-3 border-t border-gray-100",children:[e.jsxs("button",{onClick:()=>{w(x),Z(!0)},className:"flex-1 flex items-center justify-center gap-1.5 py-2 px-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors text-xs font-medium",children:[e.jsx(os,{className:"w-3.5 h-3.5"}),"Comment"]}),e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1.5 py-2 px-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition-colors text-xs font-medium",children:[e.jsx(Ls,{className:"w-3.5 h-3.5"}),H&&(k==null?void 0:k._id)===x._id?"Uploading...":"Upload"]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:Ee=>ze(Ee,x._id),className:"hidden",disabled:H})]})]})]})]},x._id)})}):e.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto custom-scrollbar",children:c.map(x=>{const oe=x.progress||0,xe=x.status==="completed",re=x.status==="in-progress";return e.jsx("div",{className:`bg-white rounded-xl shadow-md hover:shadow-lg transition-all border-l-4 ${xe?"border-l-green-500":re?"border-l-blue-500":"border-l-gray-300"}`,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`text-lg font-bold mb-1 ${xe?"line-through text-gray-500":"text-gray-800"}`,children:x.title}),x.description&&e.jsx("p",{className:"text-gray-600 text-sm line-clamp-2",children:x.description})]}),e.jsxs("div",{className:"flex gap-1 ml-3",children:[e.jsx("button",{onClick:()=>Ie(x),className:"p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors",title:"Edit Task",children:e.jsx(At,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Fe(x._id),className:"p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors",title:"Delete Task",children:e.jsx(Ss,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-bold uppercase ${Ye(x.priority)}`,children:x.priority}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-bold uppercase ${pt(x.status)}`,children:x.status==="in-progress"?"In Progress":x.status})]})]}),e.jsxs("div",{className:"w-64 flex-shrink-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700",children:"Progress"}),e.jsxs("span",{className:`text-sm font-bold ${oe===100?"text-green-600":"text-blue-600"}`,children:[oe,"%"]})]}),e.jsx("div",{className:"h-3 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${oe===100?"bg-gradient-to-r from-green-400 to-green-600":oe>0?"bg-gradient-to-r from-blue-400 to-blue-600":"bg-gray-300"}`,style:{width:`${oe}%`}})})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-1.5 text-xs",children:[x.startDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 font-medium",children:"Start:"}),e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded font-semibold",children:new Date(x.startDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),x.dueDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 font-medium",children:"Due:"}),e.jsx("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded font-semibold",children:new Date(x.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),x.endDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 font-medium",children:"End:"}),e.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded font-semibold",children:new Date(x.endDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]})]}),x.media&&x.media.length>0&&e.jsxs("button",{onClick:()=>de(x,0),className:"flex flex-col items-center justify-center gap-0.5 px-2 py-1 bg-purple-50 hover:bg-purple-100 rounded-lg transition-all group min-w-[50px]",title:`${x.media.length} attachment(s) from task creation`,children:[e.jsx(Ot,{className:"w-4 h-4 text-purple-600 group-hover:scale-110 transition-transform"}),e.jsxs("span",{className:"text-[9px] font-bold text-purple-600",children:[x.media.length," files"]})]})]}),x.comments&&x.comments.length>0&&e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(os,{className:"w-3.5 h-3.5 text-blue-600"}),e.jsxs("span",{className:"text-xs font-bold text-gray-700",children:[x.comments.length," comment(s)"]})]}),x.comments[x.comments.length-1].text&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:x.comments[x.comments.length-1].text}),x.comments[x.comments.length-1].media&&x.comments[x.comments.length-1].media.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 text-purple-600",children:[e.jsx(Ot,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"text-xs font-medium",children:[x.comments[x.comments.length-1].media.length," attachment",x.comments[x.comments.length-1].media.length>1?"s":""]})]})]})}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>{w(x),Z(!0)},className:"flex-1 flex items-center justify-center gap-1.5 py-1.5 px-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors text-xs font-medium",children:[e.jsx(os,{className:"w-3.5 h-3.5"}),"Comment"]}),e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1.5 py-1.5 px-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition-colors text-xs font-medium",children:[e.jsx(Ls,{className:"w-3.5 h-3.5"}),"Upload"]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:Ee=>ze(Ee,x._id),className:"hidden",disabled:H})]})]})]})]})})},x._id)})})]})]}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-12 border border-gray-100 text-center",children:[e.jsx(lt,{className:"w-20 h-20 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Select a user to manage their tasks"})]})})]})]}),A&&k&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:k.title}),e.jsx("p",{className:"text-sm opacity-90",children:"Comments & Discussion"})]}),e.jsx("button",{onClick:()=>{Z(!1),E("")},className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(Ct,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4 max-h-96 overflow-y-auto custom-scrollbar",children:k.comments&&k.comments.length>0?e.jsx("div",{className:"space-y-3",children:k.comments.map((x,oe)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-800",children:x.userName}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(x.createdAt).toLocaleString()})]}),x.text&&e.jsx("p",{className:"text-gray-700 mb-2",children:x.text}),x.media&&x.media.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:x.media.map((xe,re)=>e.jsxs("div",{onClick:()=>de(x,re),className:"relative aspect-square rounded-lg overflow-hidden cursor-pointer hover:scale-105 transition-transform group",children:[xe.type==="image"?e.jsx("img",{src:xe.url,alt:xe.filename,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:e.jsx(ht,{className:"w-8 h-8 text-gray-400"})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all"})]},re))})]},oe))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(os,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No comments yet. Be the first to comment!"})]})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:S,onChange:x=>E(x.target.value),onKeyPress:x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),it(k._id))},placeholder:"Write your comment...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsxs("div",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2",children:[e.jsx(Ot,{className:"w-4 h-4"}),e.jsx("span",{children:H?"Uploading...":"Media"})]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:x=>k&&ze(x,k._id),className:"hidden",disabled:H})]}),e.jsxs("button",{onClick:()=>it(k._id),disabled:!S.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[e.jsx(qr,{className:"w-4 h-4"}),"Send"]})]})})]})}),V&&V.length>0&&e.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:Ce,children:e.jsxs("div",{className:"relative max-w-5xl w-full",onClick:x=>x.stopPropagation(),children:[e.jsx("button",{onClick:Ce,className:"absolute top-4 right-4 z-10 p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors",children:e.jsx(Ct,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:()=>Qe(V[je].url,V[je].filename),className:"absolute top-4 right-16 z-10 p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors",title:"Download",children:e.jsx(vt,{className:"w-6 h-6 text-white"})}),V.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:qe,className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Previous",children:e.jsx(Os,{className:"w-8 h-8 text-white stroke-[3]"})}),e.jsx("button",{onClick:Ge,className:"absolute right-4 top-1/2 -translate-y-1/2 z-20 p-4 bg-black/50 hover:bg-black/70 rounded-full transition-all shadow-lg hover:scale-110",title:"Next",children:e.jsx($s,{className:"w-8 h-8 text-white stroke-[3]"})})]}),e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden max-h-[80vh]",children:[V[je].type==="image"?e.jsx("img",{src:V[je].url,alt:V[je].filename,className:"w-full h-full object-contain max-h-[70vh]"}):e.jsx("video",{src:V[je].url,controls:!0,className:"w-full h-full object-contain max-h-[70vh]"}),e.jsxs("div",{className:"p-4 bg-gray-50",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:V[je].filename}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[je+1," of ",V.length]})]})]})]})}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
          border-radius: 10px;
        }
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `}})]})},Ei=({size:s="md"})=>{const t={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12",xl:"w-16 h-16"};return e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:`${t[s]} animate-spin rounded-full border-4 border-gray-200 border-t-primary-600`})})};function Pt({children:s,allowedRoles:t}){const{user:r,loading:n}=It();return n?e.jsx(Ei,{}):r?t&&!t.includes(r.role)?e.jsx(er,{to:"/dashboard",replace:!0}):s:e.jsx(er,{to:"/login",replace:!0})}function Vd(){return e.jsx(vc,{children:e.jsx(Ri,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Aa,{position:"top-right"}),e.jsx(Hd,{})]})})})}function Hd(){const{user:s,loading:t}=It();return t?e.jsx(Ei,{}):e.jsx(e.Fragment,{children:s?e.jsx(bd,{user:s,children:e.jsxs(Jn,{children:[e.jsx(gt,{path:"/login",element:e.jsx(er,{to:"/dashboard",replace:!0})}),e.jsx(gt,{path:"/dashboard",element:e.jsx(Pt,{children:s&&s.role==="user"?e.jsx(jo,{}):e.jsx(_d,{})})}),e.jsx(gt,{path:"/user-dashboard",element:e.jsx(Pt,{allowedRoles:["user"],children:e.jsx(jo,{})})}),e.jsx(gt,{path:"/chat",element:e.jsx(Pt,{children:e.jsx(Ud,{})})}),e.jsx(gt,{path:"/users",element:e.jsx(Pt,{allowedRoles:["superadmin","admin"],children:e.jsx(Ld,{})})}),e.jsx(gt,{path:"/time-management",element:e.jsx(Pt,{allowedRoles:["superadmin","admin"],children:e.jsx(Pd,{})})}),e.jsx(gt,{path:"/groups",element:e.jsx(Pt,{allowedRoles:["admin"],children:e.jsx(Od,{})})}),e.jsx(gt,{path:"/group/:groupId",element:e.jsx(Pt,{children:e.jsx($d,{})})}),e.jsx(gt,{path:"/profile",element:e.jsx(Pt,{children:e.jsx(Fd,{})})}),e.jsx(gt,{path:"/forward",element:e.jsx(Pt,{children:e.jsx(Dd,{})})}),e.jsx(gt,{path:"/daily-update",element:e.jsx(Pt,{children:e.jsx(zd,{})})}),e.jsx(gt,{path:"/tasks",element:e.jsx(Pt,{children:e.jsx(Bd,{})})}),e.jsx(gt,{path:"/manage-daily-updates",element:e.jsx(Pt,{allowedRoles:["superadmin","admin"],children:e.jsx(Gd,{})})}),e.jsx(gt,{path:"/manage-tasks",element:e.jsx(Pt,{allowedRoles:["superadmin","admin"],children:e.jsx(qd,{})})}),e.jsx(gt,{path:"/",element:e.jsx(er,{to:"/dashboard",replace:!0})})]})}):e.jsxs(Jn,{children:[e.jsx(gt,{path:"/login",element:e.jsx(Ad,{})}),e.jsx(gt,{path:"*",element:e.jsx(er,{to:"/login",replace:!0})})]})})}on.createRoot(document.getElementById("root")).render(e.jsx(In.StrictMode,{children:e.jsx(Vd,{})}));
