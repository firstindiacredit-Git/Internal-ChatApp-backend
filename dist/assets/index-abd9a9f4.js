function o0(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in e)){const i=Object.getOwnPropertyDescriptor(r,o);i&&Object.defineProperty(e,o,i.get?i:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function i0(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Pm={exports:{}},Jl={},Lm={exports:{}},Ae={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xi=Symbol.for("react.element"),l0=Symbol.for("react.portal"),a0=Symbol.for("react.fragment"),c0=Symbol.for("react.strict_mode"),d0=Symbol.for("react.profiler"),u0=Symbol.for("react.provider"),f0=Symbol.for("react.context"),m0=Symbol.for("react.forward_ref"),p0=Symbol.for("react.suspense"),h0=Symbol.for("react.memo"),g0=Symbol.for("react.lazy"),Du=Symbol.iterator;function x0(e){return e===null||typeof e!="object"?null:(e=Du&&e[Du]||e["@@iterator"],typeof e=="function"?e:null)}var Um={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Om=Object.assign,$m={};function oo(e,t,n){this.props=e,this.context=t,this.refs=$m,this.updater=n||Um}oo.prototype.isReactComponent={};oo.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};oo.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Fm(){}Fm.prototype=oo.prototype;function bd(e,t,n){this.props=e,this.context=t,this.refs=$m,this.updater=n||Um}var jd=bd.prototype=new Fm;jd.constructor=bd;Om(jd,oo.prototype);jd.isPureReactComponent=!0;var Vu=Array.isArray,zm=Object.prototype.hasOwnProperty,Nd={current:null},Bm={key:!0,ref:!0,__self:!0,__source:!0};function Dm(e,t,n){var r,o={},i=null,l=null;if(t!=null)for(r in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(i=""+t.key),t)zm.call(t,r)&&!Bm.hasOwnProperty(r)&&(o[r]=t[r]);var a=arguments.length-2;if(a===1)o.children=n;else if(1<a){for(var d=Array(a),f=0;f<a;f++)d[f]=arguments[f+2];o.children=d}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)o[r]===void 0&&(o[r]=a[r]);return{$$typeof:xi,type:e,key:i,ref:l,props:o,_owner:Nd.current}}function y0(e,t){return{$$typeof:xi,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function kd(e){return typeof e=="object"&&e!==null&&e.$$typeof===xi}function v0(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Gu=/\/+/g;function Ia(e,t){return typeof e=="object"&&e!==null&&e.key!=null?v0(""+e.key):t.toString(36)}function Xi(e,t,n,r,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var l=!1;if(e===null)l=!0;else switch(i){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case xi:case l0:l=!0}}if(l)return l=e,o=o(l),e=r===""?"."+Ia(l,0):r,Vu(o)?(n="",e!=null&&(n=e.replace(Gu,"$&/")+"/"),Xi(o,t,n,"",function(f){return f})):o!=null&&(kd(o)&&(o=y0(o,n+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(Gu,"$&/")+"/")+e)),t.push(o)),1;if(l=0,r=r===""?".":r+":",Vu(e))for(var a=0;a<e.length;a++){i=e[a];var d=r+Ia(i,a);l+=Xi(i,t,n,d,o)}else if(d=x0(e),typeof d=="function")for(e=d.call(e),a=0;!(i=e.next()).done;)i=i.value,d=r+Ia(i,a++),l+=Xi(i,t,n,d,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function Mi(e,t,n){if(e==null)return e;var r=[],o=0;return Xi(e,r,"","",function(i){return t.call(n,i,o++)}),r}function w0(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ht={current:null},Zi={transition:null},b0={ReactCurrentDispatcher:Ht,ReactCurrentBatchConfig:Zi,ReactCurrentOwner:Nd};function Vm(){throw Error("act(...) is not supported in production builds of React.")}Ae.Children={map:Mi,forEach:function(e,t,n){Mi(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Mi(e,function(){t++}),t},toArray:function(e){return Mi(e,function(t){return t})||[]},only:function(e){if(!kd(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ae.Component=oo;Ae.Fragment=a0;Ae.Profiler=d0;Ae.PureComponent=bd;Ae.StrictMode=c0;Ae.Suspense=p0;Ae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=b0;Ae.act=Vm;Ae.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Om({},e.props),o=e.key,i=e.ref,l=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,l=Nd.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(d in t)zm.call(t,d)&&!Bm.hasOwnProperty(d)&&(r[d]=t[d]===void 0&&a!==void 0?a[d]:t[d])}var d=arguments.length-2;if(d===1)r.children=n;else if(1<d){a=Array(d);for(var f=0;f<d;f++)a[f]=arguments[f+2];r.children=a}return{$$typeof:xi,type:e.type,key:o,ref:i,props:r,_owner:l}};Ae.createContext=function(e){return e={$$typeof:f0,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:u0,_context:e},e.Consumer=e};Ae.createElement=Dm;Ae.createFactory=function(e){var t=Dm.bind(null,e);return t.type=e,t};Ae.createRef=function(){return{current:null}};Ae.forwardRef=function(e){return{$$typeof:m0,render:e}};Ae.isValidElement=kd;Ae.lazy=function(e){return{$$typeof:g0,_payload:{_status:-1,_result:e},_init:w0}};Ae.memo=function(e,t){return{$$typeof:h0,type:e,compare:t===void 0?null:t}};Ae.startTransition=function(e){var t=Zi.transition;Zi.transition={};try{e()}finally{Zi.transition=t}};Ae.unstable_act=Vm;Ae.useCallback=function(e,t){return Ht.current.useCallback(e,t)};Ae.useContext=function(e){return Ht.current.useContext(e)};Ae.useDebugValue=function(){};Ae.useDeferredValue=function(e){return Ht.current.useDeferredValue(e)};Ae.useEffect=function(e,t){return Ht.current.useEffect(e,t)};Ae.useId=function(){return Ht.current.useId()};Ae.useImperativeHandle=function(e,t,n){return Ht.current.useImperativeHandle(e,t,n)};Ae.useInsertionEffect=function(e,t){return Ht.current.useInsertionEffect(e,t)};Ae.useLayoutEffect=function(e,t){return Ht.current.useLayoutEffect(e,t)};Ae.useMemo=function(e,t){return Ht.current.useMemo(e,t)};Ae.useReducer=function(e,t,n){return Ht.current.useReducer(e,t,n)};Ae.useRef=function(e){return Ht.current.useRef(e)};Ae.useState=function(e){return Ht.current.useState(e)};Ae.useSyncExternalStore=function(e,t,n){return Ht.current.useSyncExternalStore(e,t,n)};Ae.useTransition=function(){return Ht.current.useTransition()};Ae.version="18.3.1";Lm.exports=Ae;var h=Lm.exports;const Xl=i0(h),j0=o0({__proto__:null,default:Xl},[h]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N0=h,k0=Symbol.for("react.element"),S0=Symbol.for("react.fragment"),C0=Object.prototype.hasOwnProperty,E0=N0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,I0={key:!0,ref:!0,__self:!0,__source:!0};function Gm(e,t,n){var r,o={},i=null,l=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(l=t.ref);for(r in t)C0.call(t,r)&&!I0.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)o[r]===void 0&&(o[r]=t[r]);return{$$typeof:k0,type:e,key:i,ref:l,props:o,_owner:E0.current}}Jl.Fragment=S0;Jl.jsx=Gm;Jl.jsxs=Gm;Pm.exports=Jl;var s=Pm.exports,ac={},Hm={exports:{}},pn={},Wm={exports:{}},qm={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t($,I){var C=$.length;$.push(I);e:for(;0<C;){var q=C-1>>>1,F=$[q];if(0<o(F,I))$[q]=I,$[C]=F,C=q;else break e}}function n($){return $.length===0?null:$[0]}function r($){if($.length===0)return null;var I=$[0],C=$.pop();if(C!==I){$[0]=C;e:for(var q=0,F=$.length,G=F>>>1;q<G;){var he=2*(q+1)-1,Ie=$[he],me=he+1,Ce=$[me];if(0>o(Ie,C))me<F&&0>o(Ce,Ie)?($[q]=Ce,$[me]=C,q=me):($[q]=Ie,$[he]=C,q=he);else if(me<F&&0>o(Ce,C))$[q]=Ce,$[me]=C,q=me;else break e}}return I}function o($,I){var C=$.sortIndex-I.sortIndex;return C!==0?C:$.id-I.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var l=Date,a=l.now();e.unstable_now=function(){return l.now()-a}}var d=[],f=[],g=1,x=null,b=3,T=!1,k=!1,_=!1,w=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y($){for(var I=n(f);I!==null;){if(I.callback===null)r(f);else if(I.startTime<=$)r(f),I.sortIndex=I.expirationTime,t(d,I);else break;I=n(f)}}function M($){if(_=!1,y($),!k)if(n(d)!==null)k=!0,Z(L);else{var I=n(f);I!==null&&ie(M,I.startTime-$)}}function L($,I){k=!1,_&&(_=!1,m(K),K=-1),T=!0;var C=b;try{for(y(I),x=n(d);x!==null&&(!(x.expirationTime>I)||$&&!Y());){var q=x.callback;if(typeof q=="function"){x.callback=null,b=x.priorityLevel;var F=q(x.expirationTime<=I);I=e.unstable_now(),typeof F=="function"?x.callback=F:x===n(d)&&r(d),y(I)}else r(d);x=n(d)}if(x!==null)var G=!0;else{var he=n(f);he!==null&&ie(M,he.startTime-I),G=!1}return G}finally{x=null,b=C,T=!1}}var O=!1,U=null,K=-1,oe=5,ne=-1;function Y(){return!(e.unstable_now()-ne<oe)}function ae(){if(U!==null){var $=e.unstable_now();ne=$;var I=!0;try{I=U(!0,$)}finally{I?A():(O=!1,U=null)}}else O=!1}var A;if(typeof v=="function")A=function(){v(ae)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,X=ee.port2;ee.port1.onmessage=ae,A=function(){X.postMessage(null)}}else A=function(){w(ae,0)};function Z($){U=$,O||(O=!0,A())}function ie($,I){K=w(function(){$(e.unstable_now())},I)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function($){$.callback=null},e.unstable_continueExecution=function(){k||T||(k=!0,Z(L))},e.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):oe=0<$?Math.floor(1e3/$):5},e.unstable_getCurrentPriorityLevel=function(){return b},e.unstable_getFirstCallbackNode=function(){return n(d)},e.unstable_next=function($){switch(b){case 1:case 2:case 3:var I=3;break;default:I=b}var C=b;b=I;try{return $()}finally{b=C}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function($,I){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var C=b;b=$;try{return I()}finally{b=C}},e.unstable_scheduleCallback=function($,I,C){var q=e.unstable_now();switch(typeof C=="object"&&C!==null?(C=C.delay,C=typeof C=="number"&&0<C?q+C:q):C=q,$){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=C+F,$={id:g++,callback:I,priorityLevel:$,startTime:C,expirationTime:F,sortIndex:-1},C>q?($.sortIndex=C,t(f,$),n(d)===null&&$===n(f)&&(_?(m(K),K=-1):_=!0,ie(M,C-q))):($.sortIndex=F,t(d,$),k||T||(k=!0,Z(L))),$},e.unstable_shouldYield=Y,e.unstable_wrapCallback=function($){var I=b;return function(){var C=b;b=I;try{return $.apply(this,arguments)}finally{b=C}}}})(qm);Wm.exports=qm;var T0=Wm.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _0=h,mn=T0;function J(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ym=new Set,Ko={};function ws(e,t){Js(e,t),Js(e+"Capture",t)}function Js(e,t){for(Ko[e]=t,e=0;e<t.length;e++)Ym.add(t[e])}var fr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cc=Object.prototype.hasOwnProperty,M0=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Hu={},Wu={};function R0(e){return cc.call(Wu,e)?!0:cc.call(Hu,e)?!1:M0.test(e)?Wu[e]=!0:(Hu[e]=!0,!1)}function A0(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function P0(e,t,n,r){if(t===null||typeof t>"u"||A0(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Wt(e,t,n,r,o,i,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=l}var Rt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Rt[e]=new Wt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Rt[t]=new Wt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Rt[e]=new Wt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Rt[e]=new Wt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Rt[e]=new Wt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Rt[e]=new Wt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Rt[e]=new Wt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Rt[e]=new Wt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Rt[e]=new Wt(e,5,!1,e.toLowerCase(),null,!1,!1)});var Sd=/[\-:]([a-z])/g;function Cd(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Sd,Cd);Rt[t]=new Wt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Sd,Cd);Rt[t]=new Wt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Sd,Cd);Rt[t]=new Wt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Rt[e]=new Wt(e,1,!1,e.toLowerCase(),null,!1,!1)});Rt.xlinkHref=new Wt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Rt[e]=new Wt(e,1,!1,e.toLowerCase(),null,!0,!0)});function Ed(e,t,n,r){var o=Rt.hasOwnProperty(t)?Rt[t]:null;(o!==null?o.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(P0(t,n,o,r)&&(n=null),r||o===null?R0(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=n===null?o.type===3?!1:"":n:(t=o.attributeName,r=o.attributeNamespace,n===null?e.removeAttribute(t):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var xr=_0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ri=Symbol.for("react.element"),Ts=Symbol.for("react.portal"),_s=Symbol.for("react.fragment"),Id=Symbol.for("react.strict_mode"),dc=Symbol.for("react.profiler"),Km=Symbol.for("react.provider"),Qm=Symbol.for("react.context"),Td=Symbol.for("react.forward_ref"),uc=Symbol.for("react.suspense"),fc=Symbol.for("react.suspense_list"),_d=Symbol.for("react.memo"),Sr=Symbol.for("react.lazy"),Jm=Symbol.for("react.offscreen"),qu=Symbol.iterator;function bo(e){return e===null||typeof e!="object"?null:(e=qu&&e[qu]||e["@@iterator"],typeof e=="function"?e:null)}var it=Object.assign,Ta;function Mo(e){if(Ta===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ta=t&&t[1]||""}return`
`+Ta+e}var _a=!1;function Ma(e,t){if(!e||_a)return"";_a=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(f){var r=f}Reflect.construct(e,[],t)}else{try{t.call()}catch(f){r=f}e.call(t.prototype)}else{try{throw Error()}catch(f){r=f}e()}}catch(f){if(f&&r&&typeof f.stack=="string"){for(var o=f.stack.split(`
`),i=r.stack.split(`
`),l=o.length-1,a=i.length-1;1<=l&&0<=a&&o[l]!==i[a];)a--;for(;1<=l&&0<=a;l--,a--)if(o[l]!==i[a]){if(l!==1||a!==1)do if(l--,a--,0>a||o[l]!==i[a]){var d=`
`+o[l].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}while(1<=l&&0<=a);break}}}finally{_a=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Mo(e):""}function L0(e){switch(e.tag){case 5:return Mo(e.type);case 16:return Mo("Lazy");case 13:return Mo("Suspense");case 19:return Mo("SuspenseList");case 0:case 2:case 15:return e=Ma(e.type,!1),e;case 11:return e=Ma(e.type.render,!1),e;case 1:return e=Ma(e.type,!0),e;default:return""}}function mc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case _s:return"Fragment";case Ts:return"Portal";case dc:return"Profiler";case Id:return"StrictMode";case uc:return"Suspense";case fc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Qm:return(e.displayName||"Context")+".Consumer";case Km:return(e._context.displayName||"Context")+".Provider";case Td:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case _d:return t=e.displayName||null,t!==null?t:mc(e.type)||"Memo";case Sr:t=e._payload,e=e._init;try{return mc(e(t))}catch{}}return null}function U0(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return mc(t);case 8:return t===Id?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Gr(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Xm(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function O0(e){var t=Xm(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(l){r=""+l,i.call(this,l)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ai(e){e._valueTracker||(e._valueTracker=O0(e))}function Zm(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Xm(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function yl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function pc(e,t){var n=t.checked;return it({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Yu(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=Gr(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function ep(e,t){t=t.checked,t!=null&&Ed(e,"checked",t,!1)}function hc(e,t){ep(e,t);var n=Gr(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?gc(e,t.type,n):t.hasOwnProperty("defaultValue")&&gc(e,t.type,Gr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Ku(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function gc(e,t,n){(t!=="number"||yl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Ro=Array.isArray;function Ds(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Gr(n),t=null,o=0;o<e.length;o++){if(e[o].value===n){e[o].selected=!0,r&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function xc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(J(91));return it({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Qu(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(J(92));if(Ro(n)){if(1<n.length)throw Error(J(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Gr(n)}}function tp(e,t){var n=Gr(t.value),r=Gr(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function Ju(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function np(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function yc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?np(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Pi,rp=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Pi=Pi||document.createElement("div"),Pi.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Pi.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Qo(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Uo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$0=["Webkit","ms","Moz","O"];Object.keys(Uo).forEach(function(e){$0.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Uo[t]=Uo[e]})});function sp(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Uo.hasOwnProperty(e)&&Uo[e]?(""+t).trim():t+"px"}function op(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,o=sp(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}var F0=it({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vc(e,t){if(t){if(F0[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(J(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(J(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(J(61))}if(t.style!=null&&typeof t.style!="object")throw Error(J(62))}}function wc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bc=null;function Md(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var jc=null,Vs=null,Gs=null;function Xu(e){if(e=wi(e)){if(typeof jc!="function")throw Error(J(280));var t=e.stateNode;t&&(t=ra(t),jc(e.stateNode,e.type,t))}}function ip(e){Vs?Gs?Gs.push(e):Gs=[e]:Vs=e}function lp(){if(Vs){var e=Vs,t=Gs;if(Gs=Vs=null,Xu(e),t)for(e=0;e<t.length;e++)Xu(t[e])}}function ap(e,t){return e(t)}function cp(){}var Ra=!1;function dp(e,t,n){if(Ra)return e(t,n);Ra=!0;try{return ap(e,t,n)}finally{Ra=!1,(Vs!==null||Gs!==null)&&(cp(),lp())}}function Jo(e,t){var n=e.stateNode;if(n===null)return null;var r=ra(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(J(231,t,typeof n));return n}var Nc=!1;if(fr)try{var jo={};Object.defineProperty(jo,"passive",{get:function(){Nc=!0}}),window.addEventListener("test",jo,jo),window.removeEventListener("test",jo,jo)}catch{Nc=!1}function z0(e,t,n,r,o,i,l,a,d){var f=Array.prototype.slice.call(arguments,3);try{t.apply(n,f)}catch(g){this.onError(g)}}var Oo=!1,vl=null,wl=!1,kc=null,B0={onError:function(e){Oo=!0,vl=e}};function D0(e,t,n,r,o,i,l,a,d){Oo=!1,vl=null,z0.apply(B0,arguments)}function V0(e,t,n,r,o,i,l,a,d){if(D0.apply(this,arguments),Oo){if(Oo){var f=vl;Oo=!1,vl=null}else throw Error(J(198));wl||(wl=!0,kc=f)}}function bs(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function up(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Zu(e){if(bs(e)!==e)throw Error(J(188))}function G0(e){var t=e.alternate;if(!t){if(t=bs(e),t===null)throw Error(J(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(o===null)break;var i=o.alternate;if(i===null){if(r=o.return,r!==null){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return Zu(o),e;if(i===r)return Zu(o),t;i=i.sibling}throw Error(J(188))}if(n.return!==r.return)n=o,r=i;else{for(var l=!1,a=o.child;a;){if(a===n){l=!0,n=o,r=i;break}if(a===r){l=!0,r=o,n=i;break}a=a.sibling}if(!l){for(a=i.child;a;){if(a===n){l=!0,n=i,r=o;break}if(a===r){l=!0,r=i,n=o;break}a=a.sibling}if(!l)throw Error(J(189))}}if(n.alternate!==r)throw Error(J(190))}if(n.tag!==3)throw Error(J(188));return n.stateNode.current===n?e:t}function fp(e){return e=G0(e),e!==null?mp(e):null}function mp(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=mp(e);if(t!==null)return t;e=e.sibling}return null}var pp=mn.unstable_scheduleCallback,ef=mn.unstable_cancelCallback,H0=mn.unstable_shouldYield,W0=mn.unstable_requestPaint,ut=mn.unstable_now,q0=mn.unstable_getCurrentPriorityLevel,Rd=mn.unstable_ImmediatePriority,hp=mn.unstable_UserBlockingPriority,bl=mn.unstable_NormalPriority,Y0=mn.unstable_LowPriority,gp=mn.unstable_IdlePriority,Zl=null,Kn=null;function K0(e){if(Kn&&typeof Kn.onCommitFiberRoot=="function")try{Kn.onCommitFiberRoot(Zl,e,void 0,(e.current.flags&128)===128)}catch{}}var An=Math.clz32?Math.clz32:X0,Q0=Math.log,J0=Math.LN2;function X0(e){return e>>>=0,e===0?32:31-(Q0(e)/J0|0)|0}var Li=64,Ui=4194304;function Ao(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function jl(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,o=e.suspendedLanes,i=e.pingedLanes,l=n&268435455;if(l!==0){var a=l&~o;a!==0?r=Ao(a):(i&=l,i!==0&&(r=Ao(i)))}else l=n&~o,l!==0?r=Ao(l):i!==0&&(r=Ao(i));if(r===0)return 0;if(t!==0&&t!==r&&!(t&o)&&(o=r&-r,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-An(t),o=1<<n,r|=e[n],t&=~o;return r}function Z0(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ex(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var l=31-An(i),a=1<<l,d=o[l];d===-1?(!(a&n)||a&r)&&(o[l]=Z0(a,t)):d<=t&&(e.expiredLanes|=a),i&=~a}}function Sc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function xp(){var e=Li;return Li<<=1,!(Li&4194240)&&(Li=64),e}function Aa(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yi(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-An(t),e[t]=n}function tx(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-An(n),i=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~i}}function Ad(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-An(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var Ve=0;function yp(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var vp,Pd,wp,bp,jp,Cc=!1,Oi=[],Pr=null,Lr=null,Ur=null,Xo=new Map,Zo=new Map,Er=[],nx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function tf(e,t){switch(e){case"focusin":case"focusout":Pr=null;break;case"dragenter":case"dragleave":Lr=null;break;case"mouseover":case"mouseout":Ur=null;break;case"pointerover":case"pointerout":Xo.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zo.delete(t.pointerId)}}function No(e,t,n,r,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[o]},t!==null&&(t=wi(t),t!==null&&Pd(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function rx(e,t,n,r,o){switch(t){case"focusin":return Pr=No(Pr,e,t,n,r,o),!0;case"dragenter":return Lr=No(Lr,e,t,n,r,o),!0;case"mouseover":return Ur=No(Ur,e,t,n,r,o),!0;case"pointerover":var i=o.pointerId;return Xo.set(i,No(Xo.get(i)||null,e,t,n,r,o)),!0;case"gotpointercapture":return i=o.pointerId,Zo.set(i,No(Zo.get(i)||null,e,t,n,r,o)),!0}return!1}function Np(e){var t=ls(e.target);if(t!==null){var n=bs(t);if(n!==null){if(t=n.tag,t===13){if(t=up(n),t!==null){e.blockedOn=t,jp(e.priority,function(){wp(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function el(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Ec(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);bc=r,n.target.dispatchEvent(r),bc=null}else return t=wi(n),t!==null&&Pd(t),e.blockedOn=n,!1;t.shift()}return!0}function nf(e,t,n){el(e)&&n.delete(t)}function sx(){Cc=!1,Pr!==null&&el(Pr)&&(Pr=null),Lr!==null&&el(Lr)&&(Lr=null),Ur!==null&&el(Ur)&&(Ur=null),Xo.forEach(nf),Zo.forEach(nf)}function ko(e,t){e.blockedOn===t&&(e.blockedOn=null,Cc||(Cc=!0,mn.unstable_scheduleCallback(mn.unstable_NormalPriority,sx)))}function ei(e){function t(o){return ko(o,e)}if(0<Oi.length){ko(Oi[0],e);for(var n=1;n<Oi.length;n++){var r=Oi[n];r.blockedOn===e&&(r.blockedOn=null)}}for(Pr!==null&&ko(Pr,e),Lr!==null&&ko(Lr,e),Ur!==null&&ko(Ur,e),Xo.forEach(t),Zo.forEach(t),n=0;n<Er.length;n++)r=Er[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<Er.length&&(n=Er[0],n.blockedOn===null);)Np(n),n.blockedOn===null&&Er.shift()}var Hs=xr.ReactCurrentBatchConfig,Nl=!0;function ox(e,t,n,r){var o=Ve,i=Hs.transition;Hs.transition=null;try{Ve=1,Ld(e,t,n,r)}finally{Ve=o,Hs.transition=i}}function ix(e,t,n,r){var o=Ve,i=Hs.transition;Hs.transition=null;try{Ve=4,Ld(e,t,n,r)}finally{Ve=o,Hs.transition=i}}function Ld(e,t,n,r){if(Nl){var o=Ec(e,t,n,r);if(o===null)Va(e,t,r,kl,n),tf(e,r);else if(rx(o,e,t,n,r))r.stopPropagation();else if(tf(e,r),t&4&&-1<nx.indexOf(e)){for(;o!==null;){var i=wi(o);if(i!==null&&vp(i),i=Ec(e,t,n,r),i===null&&Va(e,t,r,kl,n),i===o)break;o=i}o!==null&&r.stopPropagation()}else Va(e,t,r,null,n)}}var kl=null;function Ec(e,t,n,r){if(kl=null,e=Md(r),e=ls(e),e!==null)if(t=bs(e),t===null)e=null;else if(n=t.tag,n===13){if(e=up(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return kl=e,null}function kp(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(q0()){case Rd:return 1;case hp:return 4;case bl:case Y0:return 16;case gp:return 536870912;default:return 16}default:return 16}}var _r=null,Ud=null,tl=null;function Sp(){if(tl)return tl;var e,t=Ud,n=t.length,r,o="value"in _r?_r.value:_r.textContent,i=o.length;for(e=0;e<n&&t[e]===o[e];e++);var l=n-e;for(r=1;r<=l&&t[n-r]===o[i-r];r++);return tl=o.slice(e,1<r?1-r:void 0)}function nl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function $i(){return!0}function rf(){return!1}function hn(e){function t(n,r,o,i,l){this._reactName=n,this._targetInst=o,this.type=r,this.nativeEvent=i,this.target=l,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(n=e[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?$i:rf,this.isPropagationStopped=rf,this}return it(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=$i)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=$i)},persist:function(){},isPersistent:$i}),t}var io={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Od=hn(io),vi=it({},io,{view:0,detail:0}),lx=hn(vi),Pa,La,So,ea=it({},vi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$d,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==So&&(So&&e.type==="mousemove"?(Pa=e.screenX-So.screenX,La=e.screenY-So.screenY):La=Pa=0,So=e),Pa)},movementY:function(e){return"movementY"in e?e.movementY:La}}),sf=hn(ea),ax=it({},ea,{dataTransfer:0}),cx=hn(ax),dx=it({},vi,{relatedTarget:0}),Ua=hn(dx),ux=it({},io,{animationName:0,elapsedTime:0,pseudoElement:0}),fx=hn(ux),mx=it({},io,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),px=hn(mx),hx=it({},io,{data:0}),of=hn(hx),gx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vx(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=yx[e])?!!t[e]:!1}function $d(){return vx}var wx=it({},vi,{key:function(e){if(e.key){var t=gx[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=nl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?xx[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$d,charCode:function(e){return e.type==="keypress"?nl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?nl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),bx=hn(wx),jx=it({},ea,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lf=hn(jx),Nx=it({},vi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$d}),kx=hn(Nx),Sx=it({},io,{propertyName:0,elapsedTime:0,pseudoElement:0}),Cx=hn(Sx),Ex=it({},ea,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ix=hn(Ex),Tx=[9,13,27,32],Fd=fr&&"CompositionEvent"in window,$o=null;fr&&"documentMode"in document&&($o=document.documentMode);var _x=fr&&"TextEvent"in window&&!$o,Cp=fr&&(!Fd||$o&&8<$o&&11>=$o),af=String.fromCharCode(32),cf=!1;function Ep(e,t){switch(e){case"keyup":return Tx.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ip(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ms=!1;function Mx(e,t){switch(e){case"compositionend":return Ip(t);case"keypress":return t.which!==32?null:(cf=!0,af);case"textInput":return e=t.data,e===af&&cf?null:e;default:return null}}function Rx(e,t){if(Ms)return e==="compositionend"||!Fd&&Ep(e,t)?(e=Sp(),tl=Ud=_r=null,Ms=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Cp&&t.locale!=="ko"?null:t.data;default:return null}}var Ax={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function df(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Ax[e.type]:t==="textarea"}function Tp(e,t,n,r){ip(r),t=Sl(t,"onChange"),0<t.length&&(n=new Od("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Fo=null,ti=null;function Px(e){zp(e,0)}function ta(e){var t=Ps(e);if(Zm(t))return e}function Lx(e,t){if(e==="change")return t}var _p=!1;if(fr){var Oa;if(fr){var $a="oninput"in document;if(!$a){var uf=document.createElement("div");uf.setAttribute("oninput","return;"),$a=typeof uf.oninput=="function"}Oa=$a}else Oa=!1;_p=Oa&&(!document.documentMode||9<document.documentMode)}function ff(){Fo&&(Fo.detachEvent("onpropertychange",Mp),ti=Fo=null)}function Mp(e){if(e.propertyName==="value"&&ta(ti)){var t=[];Tp(t,ti,e,Md(e)),dp(Px,t)}}function Ux(e,t,n){e==="focusin"?(ff(),Fo=t,ti=n,Fo.attachEvent("onpropertychange",Mp)):e==="focusout"&&ff()}function Ox(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ta(ti)}function $x(e,t){if(e==="click")return ta(t)}function Fx(e,t){if(e==="input"||e==="change")return ta(t)}function zx(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var On=typeof Object.is=="function"?Object.is:zx;function ni(e,t){if(On(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!cc.call(t,o)||!On(e[o],t[o]))return!1}return!0}function mf(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function pf(e,t){var n=mf(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=mf(n)}}function Rp(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Rp(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Ap(){for(var e=window,t=yl();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=yl(e.document)}return t}function zd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Bx(e){var t=Ap(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Rp(n.ownerDocument.documentElement,n)){if(r!==null&&zd(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=n.textContent.length,i=Math.min(r.start,o);r=r.end===void 0?i:Math.min(r.end,o),!e.extend&&i>r&&(o=r,r=i,i=o),o=pf(n,i);var l=pf(n,r);o&&l&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Dx=fr&&"documentMode"in document&&11>=document.documentMode,Rs=null,Ic=null,zo=null,Tc=!1;function hf(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Tc||Rs==null||Rs!==yl(r)||(r=Rs,"selectionStart"in r&&zd(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),zo&&ni(zo,r)||(zo=r,r=Sl(Ic,"onSelect"),0<r.length&&(t=new Od("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=Rs)))}function Fi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var As={animationend:Fi("Animation","AnimationEnd"),animationiteration:Fi("Animation","AnimationIteration"),animationstart:Fi("Animation","AnimationStart"),transitionend:Fi("Transition","TransitionEnd")},Fa={},Pp={};fr&&(Pp=document.createElement("div").style,"AnimationEvent"in window||(delete As.animationend.animation,delete As.animationiteration.animation,delete As.animationstart.animation),"TransitionEvent"in window||delete As.transitionend.transition);function na(e){if(Fa[e])return Fa[e];if(!As[e])return e;var t=As[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Pp)return Fa[e]=t[n];return e}var Lp=na("animationend"),Up=na("animationiteration"),Op=na("animationstart"),$p=na("transitionend"),Fp=new Map,gf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Wr(e,t){Fp.set(e,t),ws(t,[e])}for(var za=0;za<gf.length;za++){var Ba=gf[za],Vx=Ba.toLowerCase(),Gx=Ba[0].toUpperCase()+Ba.slice(1);Wr(Vx,"on"+Gx)}Wr(Lp,"onAnimationEnd");Wr(Up,"onAnimationIteration");Wr(Op,"onAnimationStart");Wr("dblclick","onDoubleClick");Wr("focusin","onFocus");Wr("focusout","onBlur");Wr($p,"onTransitionEnd");Js("onMouseEnter",["mouseout","mouseover"]);Js("onMouseLeave",["mouseout","mouseover"]);Js("onPointerEnter",["pointerout","pointerover"]);Js("onPointerLeave",["pointerout","pointerover"]);ws("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ws("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ws("onBeforeInput",["compositionend","keypress","textInput","paste"]);ws("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ws("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ws("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Po="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Hx=new Set("cancel close invalid load scroll toggle".split(" ").concat(Po));function xf(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,V0(r,t,void 0,e),e.currentTarget=null}function zp(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var l=r.length-1;0<=l;l--){var a=r[l],d=a.instance,f=a.currentTarget;if(a=a.listener,d!==i&&o.isPropagationStopped())break e;xf(o,a,f),i=d}else for(l=0;l<r.length;l++){if(a=r[l],d=a.instance,f=a.currentTarget,a=a.listener,d!==i&&o.isPropagationStopped())break e;xf(o,a,f),i=d}}}if(wl)throw e=kc,wl=!1,kc=null,e}function Ke(e,t){var n=t[Pc];n===void 0&&(n=t[Pc]=new Set);var r=e+"__bubble";n.has(r)||(Bp(t,e,2,!1),n.add(r))}function Da(e,t,n){var r=0;t&&(r|=4),Bp(n,e,r,t)}var zi="_reactListening"+Math.random().toString(36).slice(2);function ri(e){if(!e[zi]){e[zi]=!0,Ym.forEach(function(n){n!=="selectionchange"&&(Hx.has(n)||Da(n,!1,e),Da(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[zi]||(t[zi]=!0,Da("selectionchange",!1,t))}}function Bp(e,t,n,r){switch(kp(t)){case 1:var o=ox;break;case 4:o=ix;break;default:o=Ld}n=o.bind(null,t,n,e),o=void 0,!Nc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),r?o!==void 0?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):o!==void 0?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Va(e,t,n,r,o){var i=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var a=r.stateNode.containerInfo;if(a===o||a.nodeType===8&&a.parentNode===o)break;if(l===4)for(l=r.return;l!==null;){var d=l.tag;if((d===3||d===4)&&(d=l.stateNode.containerInfo,d===o||d.nodeType===8&&d.parentNode===o))return;l=l.return}for(;a!==null;){if(l=ls(a),l===null)return;if(d=l.tag,d===5||d===6){r=i=l;continue e}a=a.parentNode}}r=r.return}dp(function(){var f=i,g=Md(n),x=[];e:{var b=Fp.get(e);if(b!==void 0){var T=Od,k=e;switch(e){case"keypress":if(nl(n)===0)break e;case"keydown":case"keyup":T=bx;break;case"focusin":k="focus",T=Ua;break;case"focusout":k="blur",T=Ua;break;case"beforeblur":case"afterblur":T=Ua;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":T=sf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":T=cx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":T=kx;break;case Lp:case Up:case Op:T=fx;break;case $p:T=Cx;break;case"scroll":T=lx;break;case"wheel":T=Ix;break;case"copy":case"cut":case"paste":T=px;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":T=lf}var _=(t&4)!==0,w=!_&&e==="scroll",m=_?b!==null?b+"Capture":null:b;_=[];for(var v=f,y;v!==null;){y=v;var M=y.stateNode;if(y.tag===5&&M!==null&&(y=M,m!==null&&(M=Jo(v,m),M!=null&&_.push(si(v,M,y)))),w)break;v=v.return}0<_.length&&(b=new T(b,k,null,n,g),x.push({event:b,listeners:_}))}}if(!(t&7)){e:{if(b=e==="mouseover"||e==="pointerover",T=e==="mouseout"||e==="pointerout",b&&n!==bc&&(k=n.relatedTarget||n.fromElement)&&(ls(k)||k[mr]))break e;if((T||b)&&(b=g.window===g?g:(b=g.ownerDocument)?b.defaultView||b.parentWindow:window,T?(k=n.relatedTarget||n.toElement,T=f,k=k?ls(k):null,k!==null&&(w=bs(k),k!==w||k.tag!==5&&k.tag!==6)&&(k=null)):(T=null,k=f),T!==k)){if(_=sf,M="onMouseLeave",m="onMouseEnter",v="mouse",(e==="pointerout"||e==="pointerover")&&(_=lf,M="onPointerLeave",m="onPointerEnter",v="pointer"),w=T==null?b:Ps(T),y=k==null?b:Ps(k),b=new _(M,v+"leave",T,n,g),b.target=w,b.relatedTarget=y,M=null,ls(g)===f&&(_=new _(m,v+"enter",k,n,g),_.target=y,_.relatedTarget=w,M=_),w=M,T&&k)t:{for(_=T,m=k,v=0,y=_;y;y=Is(y))v++;for(y=0,M=m;M;M=Is(M))y++;for(;0<v-y;)_=Is(_),v--;for(;0<y-v;)m=Is(m),y--;for(;v--;){if(_===m||m!==null&&_===m.alternate)break t;_=Is(_),m=Is(m)}_=null}else _=null;T!==null&&yf(x,b,T,_,!1),k!==null&&w!==null&&yf(x,w,k,_,!0)}}e:{if(b=f?Ps(f):window,T=b.nodeName&&b.nodeName.toLowerCase(),T==="select"||T==="input"&&b.type==="file")var L=Lx;else if(df(b))if(_p)L=Fx;else{L=Ox;var O=Ux}else(T=b.nodeName)&&T.toLowerCase()==="input"&&(b.type==="checkbox"||b.type==="radio")&&(L=$x);if(L&&(L=L(e,f))){Tp(x,L,n,g);break e}O&&O(e,b,f),e==="focusout"&&(O=b._wrapperState)&&O.controlled&&b.type==="number"&&gc(b,"number",b.value)}switch(O=f?Ps(f):window,e){case"focusin":(df(O)||O.contentEditable==="true")&&(Rs=O,Ic=f,zo=null);break;case"focusout":zo=Ic=Rs=null;break;case"mousedown":Tc=!0;break;case"contextmenu":case"mouseup":case"dragend":Tc=!1,hf(x,n,g);break;case"selectionchange":if(Dx)break;case"keydown":case"keyup":hf(x,n,g)}var U;if(Fd)e:{switch(e){case"compositionstart":var K="onCompositionStart";break e;case"compositionend":K="onCompositionEnd";break e;case"compositionupdate":K="onCompositionUpdate";break e}K=void 0}else Ms?Ep(e,n)&&(K="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(K="onCompositionStart");K&&(Cp&&n.locale!=="ko"&&(Ms||K!=="onCompositionStart"?K==="onCompositionEnd"&&Ms&&(U=Sp()):(_r=g,Ud="value"in _r?_r.value:_r.textContent,Ms=!0)),O=Sl(f,K),0<O.length&&(K=new of(K,e,null,n,g),x.push({event:K,listeners:O}),U?K.data=U:(U=Ip(n),U!==null&&(K.data=U)))),(U=_x?Mx(e,n):Rx(e,n))&&(f=Sl(f,"onBeforeInput"),0<f.length&&(g=new of("onBeforeInput","beforeinput",null,n,g),x.push({event:g,listeners:f}),g.data=U))}zp(x,t)})}function si(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Sl(e,t){for(var n=t+"Capture",r=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=Jo(e,n),i!=null&&r.unshift(si(e,i,o)),i=Jo(e,t),i!=null&&r.push(si(e,i,o))),e=e.return}return r}function Is(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function yf(e,t,n,r,o){for(var i=t._reactName,l=[];n!==null&&n!==r;){var a=n,d=a.alternate,f=a.stateNode;if(d!==null&&d===r)break;a.tag===5&&f!==null&&(a=f,o?(d=Jo(n,i),d!=null&&l.unshift(si(n,d,a))):o||(d=Jo(n,i),d!=null&&l.push(si(n,d,a)))),n=n.return}l.length!==0&&e.push({event:t,listeners:l})}var Wx=/\r\n?/g,qx=/\u0000|\uFFFD/g;function vf(e){return(typeof e=="string"?e:""+e).replace(Wx,`
`).replace(qx,"")}function Bi(e,t,n){if(t=vf(t),vf(e)!==t&&n)throw Error(J(425))}function Cl(){}var _c=null,Mc=null;function Rc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ac=typeof setTimeout=="function"?setTimeout:void 0,Yx=typeof clearTimeout=="function"?clearTimeout:void 0,wf=typeof Promise=="function"?Promise:void 0,Kx=typeof queueMicrotask=="function"?queueMicrotask:typeof wf<"u"?function(e){return wf.resolve(null).then(e).catch(Qx)}:Ac;function Qx(e){setTimeout(function(){throw e})}function Ga(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(r===0){e.removeChild(o),ei(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=o}while(n);ei(t)}function Or(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function bf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var lo=Math.random().toString(36).slice(2),qn="__reactFiber$"+lo,oi="__reactProps$"+lo,mr="__reactContainer$"+lo,Pc="__reactEvents$"+lo,Jx="__reactListeners$"+lo,Xx="__reactHandles$"+lo;function ls(e){var t=e[qn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[mr]||n[qn]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=bf(e);e!==null;){if(n=e[qn])return n;e=bf(e)}return t}e=n,n=e.parentNode}return null}function wi(e){return e=e[qn]||e[mr],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Ps(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(J(33))}function ra(e){return e[oi]||null}var Lc=[],Ls=-1;function qr(e){return{current:e}}function Qe(e){0>Ls||(e.current=Lc[Ls],Lc[Ls]=null,Ls--)}function We(e,t){Ls++,Lc[Ls]=e.current,e.current=t}var Hr={},Ft=qr(Hr),nn=qr(!1),ps=Hr;function Xs(e,t){var n=e.type.contextTypes;if(!n)return Hr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in n)o[i]=t[i];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function rn(e){return e=e.childContextTypes,e!=null}function El(){Qe(nn),Qe(Ft)}function jf(e,t,n){if(Ft.current!==Hr)throw Error(J(168));We(Ft,t),We(nn,n)}function Dp(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var o in r)if(!(o in t))throw Error(J(108,U0(e)||"Unknown",o));return it({},n,r)}function Il(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Hr,ps=Ft.current,We(Ft,e),We(nn,nn.current),!0}function Nf(e,t,n){var r=e.stateNode;if(!r)throw Error(J(169));n?(e=Dp(e,t,ps),r.__reactInternalMemoizedMergedChildContext=e,Qe(nn),Qe(Ft),We(Ft,e)):Qe(nn),We(nn,n)}var ir=null,sa=!1,Ha=!1;function Vp(e){ir===null?ir=[e]:ir.push(e)}function Zx(e){sa=!0,Vp(e)}function Yr(){if(!Ha&&ir!==null){Ha=!0;var e=0,t=Ve;try{var n=ir;for(Ve=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}ir=null,sa=!1}catch(o){throw ir!==null&&(ir=ir.slice(e+1)),pp(Rd,Yr),o}finally{Ve=t,Ha=!1}}return null}var Us=[],Os=0,Tl=null,_l=0,yn=[],vn=0,hs=null,lr=1,ar="";function ss(e,t){Us[Os++]=_l,Us[Os++]=Tl,Tl=e,_l=t}function Gp(e,t,n){yn[vn++]=lr,yn[vn++]=ar,yn[vn++]=hs,hs=e;var r=lr;e=ar;var o=32-An(r)-1;r&=~(1<<o),n+=1;var i=32-An(t)+o;if(30<i){var l=o-o%5;i=(r&(1<<l)-1).toString(32),r>>=l,o-=l,lr=1<<32-An(t)+o|n<<o|r,ar=i+e}else lr=1<<i|n<<o|r,ar=e}function Bd(e){e.return!==null&&(ss(e,1),Gp(e,1,0))}function Dd(e){for(;e===Tl;)Tl=Us[--Os],Us[Os]=null,_l=Us[--Os],Us[Os]=null;for(;e===hs;)hs=yn[--vn],yn[vn]=null,ar=yn[--vn],yn[vn]=null,lr=yn[--vn],yn[vn]=null}var un=null,dn=null,tt=!1,Mn=null;function Hp(e,t){var n=jn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function kf(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,un=e,dn=Or(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,un=e,dn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=hs!==null?{id:lr,overflow:ar}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=jn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,un=e,dn=null,!0):!1;default:return!1}}function Uc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Oc(e){if(tt){var t=dn;if(t){var n=t;if(!kf(e,t)){if(Uc(e))throw Error(J(418));t=Or(n.nextSibling);var r=un;t&&kf(e,t)?Hp(r,n):(e.flags=e.flags&-4097|2,tt=!1,un=e)}}else{if(Uc(e))throw Error(J(418));e.flags=e.flags&-4097|2,tt=!1,un=e}}}function Sf(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;un=e}function Di(e){if(e!==un)return!1;if(!tt)return Sf(e),tt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Rc(e.type,e.memoizedProps)),t&&(t=dn)){if(Uc(e))throw Wp(),Error(J(418));for(;t;)Hp(e,t),t=Or(t.nextSibling)}if(Sf(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(J(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){dn=Or(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}dn=null}}else dn=un?Or(e.stateNode.nextSibling):null;return!0}function Wp(){for(var e=dn;e;)e=Or(e.nextSibling)}function Zs(){dn=un=null,tt=!1}function Vd(e){Mn===null?Mn=[e]:Mn.push(e)}var ey=xr.ReactCurrentBatchConfig;function Co(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(J(309));var r=n.stateNode}if(!r)throw Error(J(147,e));var o=r,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(l){var a=o.refs;l===null?delete a[i]:a[i]=l},t._stringRef=i,t)}if(typeof e!="string")throw Error(J(284));if(!n._owner)throw Error(J(290,e))}return e}function Vi(e,t){throw e=Object.prototype.toString.call(t),Error(J(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Cf(e){var t=e._init;return t(e._payload)}function qp(e){function t(m,v){if(e){var y=m.deletions;y===null?(m.deletions=[v],m.flags|=16):y.push(v)}}function n(m,v){if(!e)return null;for(;v!==null;)t(m,v),v=v.sibling;return null}function r(m,v){for(m=new Map;v!==null;)v.key!==null?m.set(v.key,v):m.set(v.index,v),v=v.sibling;return m}function o(m,v){return m=Br(m,v),m.index=0,m.sibling=null,m}function i(m,v,y){return m.index=y,e?(y=m.alternate,y!==null?(y=y.index,y<v?(m.flags|=2,v):y):(m.flags|=2,v)):(m.flags|=1048576,v)}function l(m){return e&&m.alternate===null&&(m.flags|=2),m}function a(m,v,y,M){return v===null||v.tag!==6?(v=Xa(y,m.mode,M),v.return=m,v):(v=o(v,y),v.return=m,v)}function d(m,v,y,M){var L=y.type;return L===_s?g(m,v,y.props.children,M,y.key):v!==null&&(v.elementType===L||typeof L=="object"&&L!==null&&L.$$typeof===Sr&&Cf(L)===v.type)?(M=o(v,y.props),M.ref=Co(m,v,y),M.return=m,M):(M=cl(y.type,y.key,y.props,null,m.mode,M),M.ref=Co(m,v,y),M.return=m,M)}function f(m,v,y,M){return v===null||v.tag!==4||v.stateNode.containerInfo!==y.containerInfo||v.stateNode.implementation!==y.implementation?(v=Za(y,m.mode,M),v.return=m,v):(v=o(v,y.children||[]),v.return=m,v)}function g(m,v,y,M,L){return v===null||v.tag!==7?(v=fs(y,m.mode,M,L),v.return=m,v):(v=o(v,y),v.return=m,v)}function x(m,v,y){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Xa(""+v,m.mode,y),v.return=m,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ri:return y=cl(v.type,v.key,v.props,null,m.mode,y),y.ref=Co(m,null,v),y.return=m,y;case Ts:return v=Za(v,m.mode,y),v.return=m,v;case Sr:var M=v._init;return x(m,M(v._payload),y)}if(Ro(v)||bo(v))return v=fs(v,m.mode,y,null),v.return=m,v;Vi(m,v)}return null}function b(m,v,y,M){var L=v!==null?v.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return L!==null?null:a(m,v,""+y,M);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Ri:return y.key===L?d(m,v,y,M):null;case Ts:return y.key===L?f(m,v,y,M):null;case Sr:return L=y._init,b(m,v,L(y._payload),M)}if(Ro(y)||bo(y))return L!==null?null:g(m,v,y,M,null);Vi(m,y)}return null}function T(m,v,y,M,L){if(typeof M=="string"&&M!==""||typeof M=="number")return m=m.get(y)||null,a(v,m,""+M,L);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case Ri:return m=m.get(M.key===null?y:M.key)||null,d(v,m,M,L);case Ts:return m=m.get(M.key===null?y:M.key)||null,f(v,m,M,L);case Sr:var O=M._init;return T(m,v,y,O(M._payload),L)}if(Ro(M)||bo(M))return m=m.get(y)||null,g(v,m,M,L,null);Vi(v,M)}return null}function k(m,v,y,M){for(var L=null,O=null,U=v,K=v=0,oe=null;U!==null&&K<y.length;K++){U.index>K?(oe=U,U=null):oe=U.sibling;var ne=b(m,U,y[K],M);if(ne===null){U===null&&(U=oe);break}e&&U&&ne.alternate===null&&t(m,U),v=i(ne,v,K),O===null?L=ne:O.sibling=ne,O=ne,U=oe}if(K===y.length)return n(m,U),tt&&ss(m,K),L;if(U===null){for(;K<y.length;K++)U=x(m,y[K],M),U!==null&&(v=i(U,v,K),O===null?L=U:O.sibling=U,O=U);return tt&&ss(m,K),L}for(U=r(m,U);K<y.length;K++)oe=T(U,m,K,y[K],M),oe!==null&&(e&&oe.alternate!==null&&U.delete(oe.key===null?K:oe.key),v=i(oe,v,K),O===null?L=oe:O.sibling=oe,O=oe);return e&&U.forEach(function(Y){return t(m,Y)}),tt&&ss(m,K),L}function _(m,v,y,M){var L=bo(y);if(typeof L!="function")throw Error(J(150));if(y=L.call(y),y==null)throw Error(J(151));for(var O=L=null,U=v,K=v=0,oe=null,ne=y.next();U!==null&&!ne.done;K++,ne=y.next()){U.index>K?(oe=U,U=null):oe=U.sibling;var Y=b(m,U,ne.value,M);if(Y===null){U===null&&(U=oe);break}e&&U&&Y.alternate===null&&t(m,U),v=i(Y,v,K),O===null?L=Y:O.sibling=Y,O=Y,U=oe}if(ne.done)return n(m,U),tt&&ss(m,K),L;if(U===null){for(;!ne.done;K++,ne=y.next())ne=x(m,ne.value,M),ne!==null&&(v=i(ne,v,K),O===null?L=ne:O.sibling=ne,O=ne);return tt&&ss(m,K),L}for(U=r(m,U);!ne.done;K++,ne=y.next())ne=T(U,m,K,ne.value,M),ne!==null&&(e&&ne.alternate!==null&&U.delete(ne.key===null?K:ne.key),v=i(ne,v,K),O===null?L=ne:O.sibling=ne,O=ne);return e&&U.forEach(function(ae){return t(m,ae)}),tt&&ss(m,K),L}function w(m,v,y,M){if(typeof y=="object"&&y!==null&&y.type===_s&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Ri:e:{for(var L=y.key,O=v;O!==null;){if(O.key===L){if(L=y.type,L===_s){if(O.tag===7){n(m,O.sibling),v=o(O,y.props.children),v.return=m,m=v;break e}}else if(O.elementType===L||typeof L=="object"&&L!==null&&L.$$typeof===Sr&&Cf(L)===O.type){n(m,O.sibling),v=o(O,y.props),v.ref=Co(m,O,y),v.return=m,m=v;break e}n(m,O);break}else t(m,O);O=O.sibling}y.type===_s?(v=fs(y.props.children,m.mode,M,y.key),v.return=m,m=v):(M=cl(y.type,y.key,y.props,null,m.mode,M),M.ref=Co(m,v,y),M.return=m,m=M)}return l(m);case Ts:e:{for(O=y.key;v!==null;){if(v.key===O)if(v.tag===4&&v.stateNode.containerInfo===y.containerInfo&&v.stateNode.implementation===y.implementation){n(m,v.sibling),v=o(v,y.children||[]),v.return=m,m=v;break e}else{n(m,v);break}else t(m,v);v=v.sibling}v=Za(y,m.mode,M),v.return=m,m=v}return l(m);case Sr:return O=y._init,w(m,v,O(y._payload),M)}if(Ro(y))return k(m,v,y,M);if(bo(y))return _(m,v,y,M);Vi(m,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,v!==null&&v.tag===6?(n(m,v.sibling),v=o(v,y),v.return=m,m=v):(n(m,v),v=Xa(y,m.mode,M),v.return=m,m=v),l(m)):n(m,v)}return w}var eo=qp(!0),Yp=qp(!1),Ml=qr(null),Rl=null,$s=null,Gd=null;function Hd(){Gd=$s=Rl=null}function Wd(e){var t=Ml.current;Qe(Ml),e._currentValue=t}function $c(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ws(e,t){Rl=e,Gd=$s=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(tn=!0),e.firstContext=null)}function kn(e){var t=e._currentValue;if(Gd!==e)if(e={context:e,memoizedValue:t,next:null},$s===null){if(Rl===null)throw Error(J(308));$s=e,Rl.dependencies={lanes:0,firstContext:e}}else $s=$s.next=e;return t}var as=null;function qd(e){as===null?as=[e]:as.push(e)}function Kp(e,t,n,r){var o=t.interleaved;return o===null?(n.next=n,qd(t)):(n.next=o.next,o.next=n),t.interleaved=n,pr(e,r)}function pr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Cr=!1;function Yd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Qp(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function dr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function $r(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Ue&2){var o=r.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),r.pending=t,pr(e,n)}return o=r.interleaved,o===null?(t.next=t,qd(r)):(t.next=o.next,o.next=t),r.interleaved=t,pr(e,n)}function rl(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Ad(e,n)}}function Ef(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var o=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?o=i=l:i=i.next=l,n=n.next}while(n!==null);i===null?o=i=t:i=i.next=t}else o=i=t;n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Al(e,t,n,r){var o=e.updateQueue;Cr=!1;var i=o.firstBaseUpdate,l=o.lastBaseUpdate,a=o.shared.pending;if(a!==null){o.shared.pending=null;var d=a,f=d.next;d.next=null,l===null?i=f:l.next=f,l=d;var g=e.alternate;g!==null&&(g=g.updateQueue,a=g.lastBaseUpdate,a!==l&&(a===null?g.firstBaseUpdate=f:a.next=f,g.lastBaseUpdate=d))}if(i!==null){var x=o.baseState;l=0,g=f=d=null,a=i;do{var b=a.lane,T=a.eventTime;if((r&b)===b){g!==null&&(g=g.next={eventTime:T,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var k=e,_=a;switch(b=t,T=n,_.tag){case 1:if(k=_.payload,typeof k=="function"){x=k.call(T,x,b);break e}x=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=_.payload,b=typeof k=="function"?k.call(T,x,b):k,b==null)break e;x=it({},x,b);break e;case 2:Cr=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,b=o.effects,b===null?o.effects=[a]:b.push(a))}else T={eventTime:T,lane:b,tag:a.tag,payload:a.payload,callback:a.callback,next:null},g===null?(f=g=T,d=x):g=g.next=T,l|=b;if(a=a.next,a===null){if(a=o.shared.pending,a===null)break;b=a,a=b.next,b.next=null,o.lastBaseUpdate=b,o.shared.pending=null}}while(1);if(g===null&&(d=x),o.baseState=d,o.firstBaseUpdate=f,o.lastBaseUpdate=g,t=o.shared.interleaved,t!==null){o=t;do l|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);xs|=l,e.lanes=l,e.memoizedState=x}}function If(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(o!==null){if(r.callback=null,r=n,typeof o!="function")throw Error(J(191,o));o.call(r)}}}var bi={},Qn=qr(bi),ii=qr(bi),li=qr(bi);function cs(e){if(e===bi)throw Error(J(174));return e}function Kd(e,t){switch(We(li,t),We(ii,e),We(Qn,bi),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:yc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=yc(t,e)}Qe(Qn),We(Qn,t)}function to(){Qe(Qn),Qe(ii),Qe(li)}function Jp(e){cs(li.current);var t=cs(Qn.current),n=yc(t,e.type);t!==n&&(We(ii,e),We(Qn,n))}function Qd(e){ii.current===e&&(Qe(Qn),Qe(ii))}var st=qr(0);function Pl(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Wa=[];function Jd(){for(var e=0;e<Wa.length;e++)Wa[e]._workInProgressVersionPrimary=null;Wa.length=0}var sl=xr.ReactCurrentDispatcher,qa=xr.ReactCurrentBatchConfig,gs=0,ot=null,jt=null,It=null,Ll=!1,Bo=!1,ai=0,ty=0;function Lt(){throw Error(J(321))}function Xd(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!On(e[n],t[n]))return!1;return!0}function Zd(e,t,n,r,o,i){if(gs=i,ot=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,sl.current=e===null||e.memoizedState===null?oy:iy,e=n(r,o),Bo){i=0;do{if(Bo=!1,ai=0,25<=i)throw Error(J(301));i+=1,It=jt=null,t.updateQueue=null,sl.current=ly,e=n(r,o)}while(Bo)}if(sl.current=Ul,t=jt!==null&&jt.next!==null,gs=0,It=jt=ot=null,Ll=!1,t)throw Error(J(300));return e}function eu(){var e=ai!==0;return ai=0,e}function Wn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return It===null?ot.memoizedState=It=e:It=It.next=e,It}function Sn(){if(jt===null){var e=ot.alternate;e=e!==null?e.memoizedState:null}else e=jt.next;var t=It===null?ot.memoizedState:It.next;if(t!==null)It=t,jt=e;else{if(e===null)throw Error(J(310));jt=e,e={memoizedState:jt.memoizedState,baseState:jt.baseState,baseQueue:jt.baseQueue,queue:jt.queue,next:null},It===null?ot.memoizedState=It=e:It=It.next=e}return It}function ci(e,t){return typeof t=="function"?t(e):t}function Ya(e){var t=Sn(),n=t.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=e;var r=jt,o=r.baseQueue,i=n.pending;if(i!==null){if(o!==null){var l=o.next;o.next=i.next,i.next=l}r.baseQueue=o=i,n.pending=null}if(o!==null){i=o.next,r=r.baseState;var a=l=null,d=null,f=i;do{var g=f.lane;if((gs&g)===g)d!==null&&(d=d.next={lane:0,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null}),r=f.hasEagerState?f.eagerState:e(r,f.action);else{var x={lane:g,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null};d===null?(a=d=x,l=r):d=d.next=x,ot.lanes|=g,xs|=g}f=f.next}while(f!==null&&f!==i);d===null?l=r:d.next=a,On(r,t.memoizedState)||(tn=!0),t.memoizedState=r,t.baseState=l,t.baseQueue=d,n.lastRenderedState=r}if(e=n.interleaved,e!==null){o=e;do i=o.lane,ot.lanes|=i,xs|=i,o=o.next;while(o!==e)}else o===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ka(e){var t=Sn(),n=t.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,i=t.memoizedState;if(o!==null){n.pending=null;var l=o=o.next;do i=e(i,l.action),l=l.next;while(l!==o);On(i,t.memoizedState)||(tn=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function Xp(){}function Zp(e,t){var n=ot,r=Sn(),o=t(),i=!On(r.memoizedState,o);if(i&&(r.memoizedState=o,tn=!0),r=r.queue,tu(nh.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||It!==null&&It.memoizedState.tag&1){if(n.flags|=2048,di(9,th.bind(null,n,r,o,t),void 0,null),Tt===null)throw Error(J(349));gs&30||eh(n,t,o)}return o}function eh(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=ot.updateQueue,t===null?(t={lastEffect:null,stores:null},ot.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function th(e,t,n,r){t.value=n,t.getSnapshot=r,rh(t)&&sh(e)}function nh(e,t,n){return n(function(){rh(t)&&sh(e)})}function rh(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!On(e,n)}catch{return!0}}function sh(e){var t=pr(e,1);t!==null&&Pn(t,e,1,-1)}function Tf(e){var t=Wn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ci,lastRenderedState:e},t.queue=e,e=e.dispatch=sy.bind(null,ot,e),[t.memoizedState,e]}function di(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=ot.updateQueue,t===null?(t={lastEffect:null,stores:null},ot.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function oh(){return Sn().memoizedState}function ol(e,t,n,r){var o=Wn();ot.flags|=e,o.memoizedState=di(1|t,n,void 0,r===void 0?null:r)}function oa(e,t,n,r){var o=Sn();r=r===void 0?null:r;var i=void 0;if(jt!==null){var l=jt.memoizedState;if(i=l.destroy,r!==null&&Xd(r,l.deps)){o.memoizedState=di(t,n,i,r);return}}ot.flags|=e,o.memoizedState=di(1|t,n,i,r)}function _f(e,t){return ol(8390656,8,e,t)}function tu(e,t){return oa(2048,8,e,t)}function ih(e,t){return oa(4,2,e,t)}function lh(e,t){return oa(4,4,e,t)}function ah(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function ch(e,t,n){return n=n!=null?n.concat([e]):null,oa(4,4,ah.bind(null,t,e),n)}function nu(){}function dh(e,t){var n=Sn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Xd(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function uh(e,t){var n=Sn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Xd(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function fh(e,t,n){return gs&21?(On(n,t)||(n=xp(),ot.lanes|=n,xs|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,tn=!0),e.memoizedState=n)}function ny(e,t){var n=Ve;Ve=n!==0&&4>n?n:4,e(!0);var r=qa.transition;qa.transition={};try{e(!1),t()}finally{Ve=n,qa.transition=r}}function mh(){return Sn().memoizedState}function ry(e,t,n){var r=zr(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ph(e))hh(t,n);else if(n=Kp(e,t,n,r),n!==null){var o=Gt();Pn(n,e,r,o),gh(n,t,r)}}function sy(e,t,n){var r=zr(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ph(e))hh(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var l=t.lastRenderedState,a=i(l,n);if(o.hasEagerState=!0,o.eagerState=a,On(a,l)){var d=t.interleaved;d===null?(o.next=o,qd(t)):(o.next=d.next,d.next=o),t.interleaved=o;return}}catch{}finally{}n=Kp(e,t,o,r),n!==null&&(o=Gt(),Pn(n,e,r,o),gh(n,t,r))}}function ph(e){var t=e.alternate;return e===ot||t!==null&&t===ot}function hh(e,t){Bo=Ll=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function gh(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Ad(e,n)}}var Ul={readContext:kn,useCallback:Lt,useContext:Lt,useEffect:Lt,useImperativeHandle:Lt,useInsertionEffect:Lt,useLayoutEffect:Lt,useMemo:Lt,useReducer:Lt,useRef:Lt,useState:Lt,useDebugValue:Lt,useDeferredValue:Lt,useTransition:Lt,useMutableSource:Lt,useSyncExternalStore:Lt,useId:Lt,unstable_isNewReconciler:!1},oy={readContext:kn,useCallback:function(e,t){return Wn().memoizedState=[e,t===void 0?null:t],e},useContext:kn,useEffect:_f,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,ol(4194308,4,ah.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ol(4194308,4,e,t)},useInsertionEffect:function(e,t){return ol(4,2,e,t)},useMemo:function(e,t){var n=Wn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Wn();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ry.bind(null,ot,e),[r.memoizedState,e]},useRef:function(e){var t=Wn();return e={current:e},t.memoizedState=e},useState:Tf,useDebugValue:nu,useDeferredValue:function(e){return Wn().memoizedState=e},useTransition:function(){var e=Tf(!1),t=e[0];return e=ny.bind(null,e[1]),Wn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=ot,o=Wn();if(tt){if(n===void 0)throw Error(J(407));n=n()}else{if(n=t(),Tt===null)throw Error(J(349));gs&30||eh(r,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,_f(nh.bind(null,r,i,e),[e]),r.flags|=2048,di(9,th.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=Wn(),t=Tt.identifierPrefix;if(tt){var n=ar,r=lr;n=(r&~(1<<32-An(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=ai++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=ty++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},iy={readContext:kn,useCallback:dh,useContext:kn,useEffect:tu,useImperativeHandle:ch,useInsertionEffect:ih,useLayoutEffect:lh,useMemo:uh,useReducer:Ya,useRef:oh,useState:function(){return Ya(ci)},useDebugValue:nu,useDeferredValue:function(e){var t=Sn();return fh(t,jt.memoizedState,e)},useTransition:function(){var e=Ya(ci)[0],t=Sn().memoizedState;return[e,t]},useMutableSource:Xp,useSyncExternalStore:Zp,useId:mh,unstable_isNewReconciler:!1},ly={readContext:kn,useCallback:dh,useContext:kn,useEffect:tu,useImperativeHandle:ch,useInsertionEffect:ih,useLayoutEffect:lh,useMemo:uh,useReducer:Ka,useRef:oh,useState:function(){return Ka(ci)},useDebugValue:nu,useDeferredValue:function(e){var t=Sn();return jt===null?t.memoizedState=e:fh(t,jt.memoizedState,e)},useTransition:function(){var e=Ka(ci)[0],t=Sn().memoizedState;return[e,t]},useMutableSource:Xp,useSyncExternalStore:Zp,useId:mh,unstable_isNewReconciler:!1};function In(e,t){if(e&&e.defaultProps){t=it({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Fc(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:it({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var ia={isMounted:function(e){return(e=e._reactInternals)?bs(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Gt(),o=zr(e),i=dr(r,o);i.payload=t,n!=null&&(i.callback=n),t=$r(e,i,o),t!==null&&(Pn(t,e,o,r),rl(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Gt(),o=zr(e),i=dr(r,o);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=$r(e,i,o),t!==null&&(Pn(t,e,o,r),rl(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Gt(),r=zr(e),o=dr(n,r);o.tag=2,t!=null&&(o.callback=t),t=$r(e,o,r),t!==null&&(Pn(t,e,r,n),rl(t,e,r))}};function Mf(e,t,n,r,o,i,l){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,i,l):t.prototype&&t.prototype.isPureReactComponent?!ni(n,r)||!ni(o,i):!0}function xh(e,t,n){var r=!1,o=Hr,i=t.contextType;return typeof i=="object"&&i!==null?i=kn(i):(o=rn(t)?ps:Ft.current,r=t.contextTypes,i=(r=r!=null)?Xs(e,o):Hr),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=ia,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function Rf(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ia.enqueueReplaceState(t,t.state,null)}function zc(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},Yd(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=kn(i):(i=rn(t)?ps:Ft.current,o.context=Xs(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Fc(e,t,i,n),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&ia.enqueueReplaceState(o,o.state,null),Al(e,n,o,r),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function no(e,t){try{var n="",r=t;do n+=L0(r),r=r.return;while(r);var o=n}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function Qa(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Bc(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ay=typeof WeakMap=="function"?WeakMap:Map;function yh(e,t,n){n=dr(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){$l||($l=!0,Jc=r),Bc(e,t)},n}function vh(e,t,n){n=dr(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){Bc(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Bc(e,t),typeof r!="function"&&(Fr===null?Fr=new Set([this]):Fr.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),n}function Af(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new ay;var o=new Set;r.set(t,o)}else o=r.get(t),o===void 0&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=jy.bind(null,e,t,n),t.then(e,e))}function Pf(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Lf(e,t,n,r,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=dr(-1,1),t.tag=2,$r(n,t,1))),n.lanes|=1),e)}var cy=xr.ReactCurrentOwner,tn=!1;function Dt(e,t,n,r){t.child=e===null?Yp(t,null,n,r):eo(t,e.child,n,r)}function Uf(e,t,n,r,o){n=n.render;var i=t.ref;return Ws(t,o),r=Zd(e,t,n,r,i,o),n=eu(),e!==null&&!tn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,hr(e,t,o)):(tt&&n&&Bd(t),t.flags|=1,Dt(e,t,r,o),t.child)}function Of(e,t,n,r,o){if(e===null){var i=n.type;return typeof i=="function"&&!du(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,wh(e,t,i,r,o)):(e=cl(n.type,null,r,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&o)){var l=i.memoizedProps;if(n=n.compare,n=n!==null?n:ni,n(l,r)&&e.ref===t.ref)return hr(e,t,o)}return t.flags|=1,e=Br(i,r),e.ref=t.ref,e.return=t,t.child=e}function wh(e,t,n,r,o){if(e!==null){var i=e.memoizedProps;if(ni(i,r)&&e.ref===t.ref)if(tn=!1,t.pendingProps=r=i,(e.lanes&o)!==0)e.flags&131072&&(tn=!0);else return t.lanes=e.lanes,hr(e,t,o)}return Dc(e,t,n,r,o)}function bh(e,t,n){var r=t.pendingProps,o=r.children,i=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},We(zs,cn),cn|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,We(zs,cn),cn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,We(zs,cn),cn|=r}else i!==null?(r=i.baseLanes|n,t.memoizedState=null):r=n,We(zs,cn),cn|=r;return Dt(e,t,o,n),t.child}function jh(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Dc(e,t,n,r,o){var i=rn(n)?ps:Ft.current;return i=Xs(t,i),Ws(t,o),n=Zd(e,t,n,r,i,o),r=eu(),e!==null&&!tn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,hr(e,t,o)):(tt&&r&&Bd(t),t.flags|=1,Dt(e,t,n,o),t.child)}function $f(e,t,n,r,o){if(rn(n)){var i=!0;Il(t)}else i=!1;if(Ws(t,o),t.stateNode===null)il(e,t),xh(t,n,r),zc(t,n,r,o),r=!0;else if(e===null){var l=t.stateNode,a=t.memoizedProps;l.props=a;var d=l.context,f=n.contextType;typeof f=="object"&&f!==null?f=kn(f):(f=rn(n)?ps:Ft.current,f=Xs(t,f));var g=n.getDerivedStateFromProps,x=typeof g=="function"||typeof l.getSnapshotBeforeUpdate=="function";x||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(a!==r||d!==f)&&Rf(t,l,r,f),Cr=!1;var b=t.memoizedState;l.state=b,Al(t,r,l,o),d=t.memoizedState,a!==r||b!==d||nn.current||Cr?(typeof g=="function"&&(Fc(t,n,g,r),d=t.memoizedState),(a=Cr||Mf(t,n,a,r,b,d,f))?(x||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=d),l.props=r,l.state=d,l.context=f,r=a):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{l=t.stateNode,Qp(e,t),a=t.memoizedProps,f=t.type===t.elementType?a:In(t.type,a),l.props=f,x=t.pendingProps,b=l.context,d=n.contextType,typeof d=="object"&&d!==null?d=kn(d):(d=rn(n)?ps:Ft.current,d=Xs(t,d));var T=n.getDerivedStateFromProps;(g=typeof T=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(a!==x||b!==d)&&Rf(t,l,r,d),Cr=!1,b=t.memoizedState,l.state=b,Al(t,r,l,o);var k=t.memoizedState;a!==x||b!==k||nn.current||Cr?(typeof T=="function"&&(Fc(t,n,T,r),k=t.memoizedState),(f=Cr||Mf(t,n,f,r,b,k,d)||!1)?(g||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,k,d),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,k,d)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||a===e.memoizedProps&&b===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&b===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=k),l.props=r,l.state=k,l.context=d,r=f):(typeof l.componentDidUpdate!="function"||a===e.memoizedProps&&b===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&b===e.memoizedState||(t.flags|=1024),r=!1)}return Vc(e,t,n,r,i,o)}function Vc(e,t,n,r,o,i){jh(e,t);var l=(t.flags&128)!==0;if(!r&&!l)return o&&Nf(t,n,!1),hr(e,t,i);r=t.stateNode,cy.current=t;var a=l&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&l?(t.child=eo(t,e.child,null,i),t.child=eo(t,null,a,i)):Dt(e,t,a,i),t.memoizedState=r.state,o&&Nf(t,n,!0),t.child}function Nh(e){var t=e.stateNode;t.pendingContext?jf(e,t.pendingContext,t.pendingContext!==t.context):t.context&&jf(e,t.context,!1),Kd(e,t.containerInfo)}function Ff(e,t,n,r,o){return Zs(),Vd(o),t.flags|=256,Dt(e,t,n,r),t.child}var Gc={dehydrated:null,treeContext:null,retryLane:0};function Hc(e){return{baseLanes:e,cachePool:null,transitions:null}}function kh(e,t,n){var r=t.pendingProps,o=st.current,i=!1,l=(t.flags&128)!==0,a;if((a=l)||(a=e!==null&&e.memoizedState===null?!1:(o&2)!==0),a?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),We(st,o&1),e===null)return Oc(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=r.children,e=r.fallback,i?(r=t.mode,i=t.child,l={mode:"hidden",children:l},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=l):i=ca(l,r,0,null),e=fs(e,r,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=Hc(n),t.memoizedState=Gc,e):ru(t,l));if(o=e.memoizedState,o!==null&&(a=o.dehydrated,a!==null))return dy(e,t,l,r,a,o,n);if(i){i=r.fallback,l=t.mode,o=e.child,a=o.sibling;var d={mode:"hidden",children:r.children};return!(l&1)&&t.child!==o?(r=t.child,r.childLanes=0,r.pendingProps=d,t.deletions=null):(r=Br(o,d),r.subtreeFlags=o.subtreeFlags&14680064),a!==null?i=Br(a,i):(i=fs(i,l,n,null),i.flags|=2),i.return=t,r.return=t,r.sibling=i,t.child=r,r=i,i=t.child,l=e.child.memoizedState,l=l===null?Hc(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},i.memoizedState=l,i.childLanes=e.childLanes&~n,t.memoizedState=Gc,r}return i=e.child,e=i.sibling,r=Br(i,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function ru(e,t){return t=ca({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Gi(e,t,n,r){return r!==null&&Vd(r),eo(t,e.child,null,n),e=ru(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function dy(e,t,n,r,o,i,l){if(n)return t.flags&256?(t.flags&=-257,r=Qa(Error(J(422))),Gi(e,t,l,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=r.fallback,o=t.mode,r=ca({mode:"visible",children:r.children},o,0,null),i=fs(i,o,l,null),i.flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,t.mode&1&&eo(t,e.child,null,l),t.child.memoizedState=Hc(l),t.memoizedState=Gc,i);if(!(t.mode&1))return Gi(e,t,l,null);if(o.data==="$!"){if(r=o.nextSibling&&o.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(J(419)),r=Qa(i,r,void 0),Gi(e,t,l,r)}if(a=(l&e.childLanes)!==0,tn||a){if(r=Tt,r!==null){switch(l&-l){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(r.suspendedLanes|l)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,pr(e,o),Pn(r,e,o,-1))}return cu(),r=Qa(Error(J(421))),Gi(e,t,l,r)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=Ny.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,dn=Or(o.nextSibling),un=t,tt=!0,Mn=null,e!==null&&(yn[vn++]=lr,yn[vn++]=ar,yn[vn++]=hs,lr=e.id,ar=e.overflow,hs=t),t=ru(t,r.children),t.flags|=4096,t)}function zf(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),$c(e.return,t,n)}function Ja(e,t,n,r,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=o)}function Sh(e,t,n){var r=t.pendingProps,o=r.revealOrder,i=r.tail;if(Dt(e,t,r.children,n),r=st.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&zf(e,n,t);else if(e.tag===19)zf(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(We(st,r),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;n!==null;)e=n.alternate,e!==null&&Pl(e)===null&&(o=n),n=n.sibling;n=o,n===null?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),Ja(t,!1,o,n,i);break;case"backwards":for(n=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&Pl(e)===null){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}Ja(t,!0,n,null,i);break;case"together":Ja(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function il(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function hr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),xs|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(J(153));if(t.child!==null){for(e=t.child,n=Br(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Br(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function uy(e,t,n){switch(t.tag){case 3:Nh(t),Zs();break;case 5:Jp(t);break;case 1:rn(t.type)&&Il(t);break;case 4:Kd(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;We(Ml,r._currentValue),r._currentValue=o;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(We(st,st.current&1),t.flags|=128,null):n&t.child.childLanes?kh(e,t,n):(We(st,st.current&1),e=hr(e,t,n),e!==null?e.sibling:null);We(st,st.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return Sh(e,t,n);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),We(st,st.current),r)break;return null;case 22:case 23:return t.lanes=0,bh(e,t,n)}return hr(e,t,n)}var Ch,Wc,Eh,Ih;Ch=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Wc=function(){};Eh=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,cs(Qn.current);var i=null;switch(n){case"input":o=pc(e,o),r=pc(e,r),i=[];break;case"select":o=it({},o,{value:void 0}),r=it({},r,{value:void 0}),i=[];break;case"textarea":o=xc(e,o),r=xc(e,r),i=[];break;default:typeof o.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Cl)}vc(n,r);var l;n=null;for(f in o)if(!r.hasOwnProperty(f)&&o.hasOwnProperty(f)&&o[f]!=null)if(f==="style"){var a=o[f];for(l in a)a.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else f!=="dangerouslySetInnerHTML"&&f!=="children"&&f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(Ko.hasOwnProperty(f)?i||(i=[]):(i=i||[]).push(f,null));for(f in r){var d=r[f];if(a=o!=null?o[f]:void 0,r.hasOwnProperty(f)&&d!==a&&(d!=null||a!=null))if(f==="style")if(a){for(l in a)!a.hasOwnProperty(l)||d&&d.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in d)d.hasOwnProperty(l)&&a[l]!==d[l]&&(n||(n={}),n[l]=d[l])}else n||(i||(i=[]),i.push(f,n)),n=d;else f==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,a=a?a.__html:void 0,d!=null&&a!==d&&(i=i||[]).push(f,d)):f==="children"?typeof d!="string"&&typeof d!="number"||(i=i||[]).push(f,""+d):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&(Ko.hasOwnProperty(f)?(d!=null&&f==="onScroll"&&Ke("scroll",e),i||a===d||(i=[])):(i=i||[]).push(f,d))}n&&(i=i||[]).push("style",n);var f=i;(t.updateQueue=f)&&(t.flags|=4)}};Ih=function(e,t,n,r){n!==r&&(t.flags|=4)};function Eo(e,t){if(!tt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ut(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags&14680064,r|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function fy(e,t,n){var r=t.pendingProps;switch(Dd(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ut(t),null;case 1:return rn(t.type)&&El(),Ut(t),null;case 3:return r=t.stateNode,to(),Qe(nn),Qe(Ft),Jd(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Di(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Mn!==null&&(ed(Mn),Mn=null))),Wc(e,t),Ut(t),null;case 5:Qd(t);var o=cs(li.current);if(n=t.type,e!==null&&t.stateNode!=null)Eh(e,t,n,r,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(J(166));return Ut(t),null}if(e=cs(Qn.current),Di(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[qn]=t,r[oi]=i,e=(t.mode&1)!==0,n){case"dialog":Ke("cancel",r),Ke("close",r);break;case"iframe":case"object":case"embed":Ke("load",r);break;case"video":case"audio":for(o=0;o<Po.length;o++)Ke(Po[o],r);break;case"source":Ke("error",r);break;case"img":case"image":case"link":Ke("error",r),Ke("load",r);break;case"details":Ke("toggle",r);break;case"input":Yu(r,i),Ke("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Ke("invalid",r);break;case"textarea":Qu(r,i),Ke("invalid",r)}vc(n,i),o=null;for(var l in i)if(i.hasOwnProperty(l)){var a=i[l];l==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&Bi(r.textContent,a,e),o=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Bi(r.textContent,a,e),o=["children",""+a]):Ko.hasOwnProperty(l)&&a!=null&&l==="onScroll"&&Ke("scroll",r)}switch(n){case"input":Ai(r),Ku(r,i,!0);break;case"textarea":Ai(r),Ju(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Cl)}r=o,t.updateQueue=r,r!==null&&(t.flags|=4)}else{l=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=np(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=l.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),n==="select"&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[qn]=t,e[oi]=r,Ch(e,t,!1,!1),t.stateNode=e;e:{switch(l=wc(n,r),n){case"dialog":Ke("cancel",e),Ke("close",e),o=r;break;case"iframe":case"object":case"embed":Ke("load",e),o=r;break;case"video":case"audio":for(o=0;o<Po.length;o++)Ke(Po[o],e);o=r;break;case"source":Ke("error",e),o=r;break;case"img":case"image":case"link":Ke("error",e),Ke("load",e),o=r;break;case"details":Ke("toggle",e),o=r;break;case"input":Yu(e,r),o=pc(e,r),Ke("invalid",e);break;case"option":o=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=it({},r,{value:void 0}),Ke("invalid",e);break;case"textarea":Qu(e,r),o=xc(e,r),Ke("invalid",e);break;default:o=r}vc(n,o),a=o;for(i in a)if(a.hasOwnProperty(i)){var d=a[i];i==="style"?op(e,d):i==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&rp(e,d)):i==="children"?typeof d=="string"?(n!=="textarea"||d!=="")&&Qo(e,d):typeof d=="number"&&Qo(e,""+d):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ko.hasOwnProperty(i)?d!=null&&i==="onScroll"&&Ke("scroll",e):d!=null&&Ed(e,i,d,l))}switch(n){case"input":Ai(e),Ku(e,r,!1);break;case"textarea":Ai(e),Ju(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Gr(r.value));break;case"select":e.multiple=!!r.multiple,i=r.value,i!=null?Ds(e,!!r.multiple,i,!1):r.defaultValue!=null&&Ds(e,!!r.multiple,r.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=Cl)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ut(t),null;case 6:if(e&&t.stateNode!=null)Ih(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(J(166));if(n=cs(li.current),cs(Qn.current),Di(t)){if(r=t.stateNode,n=t.memoizedProps,r[qn]=t,(i=r.nodeValue!==n)&&(e=un,e!==null))switch(e.tag){case 3:Bi(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Bi(r.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[qn]=t,t.stateNode=r}return Ut(t),null;case 13:if(Qe(st),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(tt&&dn!==null&&t.mode&1&&!(t.flags&128))Wp(),Zs(),t.flags|=98560,i=!1;else if(i=Di(t),r!==null&&r.dehydrated!==null){if(e===null){if(!i)throw Error(J(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(J(317));i[qn]=t}else Zs(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Ut(t),i=!1}else Mn!==null&&(ed(Mn),Mn=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||st.current&1?Nt===0&&(Nt=3):cu())),t.updateQueue!==null&&(t.flags|=4),Ut(t),null);case 4:return to(),Wc(e,t),e===null&&ri(t.stateNode.containerInfo),Ut(t),null;case 10:return Wd(t.type._context),Ut(t),null;case 17:return rn(t.type)&&El(),Ut(t),null;case 19:if(Qe(st),i=t.memoizedState,i===null)return Ut(t),null;if(r=(t.flags&128)!==0,l=i.rendering,l===null)if(r)Eo(i,!1);else{if(Nt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(l=Pl(e),l!==null){for(t.flags|=128,Eo(i,!1),r=l.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)i=n,e=r,i.flags&=14680066,l=i.alternate,l===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,e=l.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return We(st,st.current&1|2),t.child}e=e.sibling}i.tail!==null&&ut()>ro&&(t.flags|=128,r=!0,Eo(i,!1),t.lanes=4194304)}else{if(!r)if(e=Pl(l),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Eo(i,!0),i.tail===null&&i.tailMode==="hidden"&&!l.alternate&&!tt)return Ut(t),null}else 2*ut()-i.renderingStartTime>ro&&n!==1073741824&&(t.flags|=128,r=!0,Eo(i,!1),t.lanes=4194304);i.isBackwards?(l.sibling=t.child,t.child=l):(n=i.last,n!==null?n.sibling=l:t.child=l,i.last=l)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=ut(),t.sibling=null,n=st.current,We(st,r?n&1|2:n&1),t):(Ut(t),null);case 22:case 23:return au(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?cn&1073741824&&(Ut(t),t.subtreeFlags&6&&(t.flags|=8192)):Ut(t),null;case 24:return null;case 25:return null}throw Error(J(156,t.tag))}function my(e,t){switch(Dd(t),t.tag){case 1:return rn(t.type)&&El(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return to(),Qe(nn),Qe(Ft),Jd(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Qd(t),null;case 13:if(Qe(st),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(J(340));Zs()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Qe(st),null;case 4:return to(),null;case 10:return Wd(t.type._context),null;case 22:case 23:return au(),null;case 24:return null;default:return null}}var Hi=!1,Ot=!1,py=typeof WeakSet=="function"?WeakSet:Set,de=null;function Fs(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ct(e,t,r)}else n.current=null}function qc(e,t,n){try{n()}catch(r){ct(e,t,r)}}var Bf=!1;function hy(e,t){if(_c=Nl,e=Ap(),zd(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var o=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var l=0,a=-1,d=-1,f=0,g=0,x=e,b=null;t:for(;;){for(var T;x!==n||o!==0&&x.nodeType!==3||(a=l+o),x!==i||r!==0&&x.nodeType!==3||(d=l+r),x.nodeType===3&&(l+=x.nodeValue.length),(T=x.firstChild)!==null;)b=x,x=T;for(;;){if(x===e)break t;if(b===n&&++f===o&&(a=l),b===i&&++g===r&&(d=l),(T=x.nextSibling)!==null)break;x=b,b=x.parentNode}x=T}n=a===-1||d===-1?null:{start:a,end:d}}else n=null}n=n||{start:0,end:0}}else n=null;for(Mc={focusedElem:e,selectionRange:n},Nl=!1,de=t;de!==null;)if(t=de,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,de=e;else for(;de!==null;){t=de;try{var k=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var _=k.memoizedProps,w=k.memoizedState,m=t.stateNode,v=m.getSnapshotBeforeUpdate(t.elementType===t.type?_:In(t.type,_),w);m.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=t.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(M){ct(t,t.return,M)}if(e=t.sibling,e!==null){e.return=t.return,de=e;break}de=t.return}return k=Bf,Bf=!1,k}function Do(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&qc(t,n,i)}o=o.next}while(o!==r)}}function la(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Yc(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function Th(e){var t=e.alternate;t!==null&&(e.alternate=null,Th(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[qn],delete t[oi],delete t[Pc],delete t[Jx],delete t[Xx])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function _h(e){return e.tag===5||e.tag===3||e.tag===4}function Df(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||_h(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Kc(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Cl));else if(r!==4&&(e=e.child,e!==null))for(Kc(e,t,n),e=e.sibling;e!==null;)Kc(e,t,n),e=e.sibling}function Qc(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Qc(e,t,n),e=e.sibling;e!==null;)Qc(e,t,n),e=e.sibling}var _t=null,Tn=!1;function kr(e,t,n){for(n=n.child;n!==null;)Mh(e,t,n),n=n.sibling}function Mh(e,t,n){if(Kn&&typeof Kn.onCommitFiberUnmount=="function")try{Kn.onCommitFiberUnmount(Zl,n)}catch{}switch(n.tag){case 5:Ot||Fs(n,t);case 6:var r=_t,o=Tn;_t=null,kr(e,t,n),_t=r,Tn=o,_t!==null&&(Tn?(e=_t,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):_t.removeChild(n.stateNode));break;case 18:_t!==null&&(Tn?(e=_t,n=n.stateNode,e.nodeType===8?Ga(e.parentNode,n):e.nodeType===1&&Ga(e,n),ei(e)):Ga(_t,n.stateNode));break;case 4:r=_t,o=Tn,_t=n.stateNode.containerInfo,Tn=!0,kr(e,t,n),_t=r,Tn=o;break;case 0:case 11:case 14:case 15:if(!Ot&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){o=r=r.next;do{var i=o,l=i.destroy;i=i.tag,l!==void 0&&(i&2||i&4)&&qc(n,t,l),o=o.next}while(o!==r)}kr(e,t,n);break;case 1:if(!Ot&&(Fs(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){ct(n,t,a)}kr(e,t,n);break;case 21:kr(e,t,n);break;case 22:n.mode&1?(Ot=(r=Ot)||n.memoizedState!==null,kr(e,t,n),Ot=r):kr(e,t,n);break;default:kr(e,t,n)}}function Vf(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new py),t.forEach(function(r){var o=ky.bind(null,e,r);n.has(r)||(n.add(r),r.then(o,o))})}}function En(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var o=n[r];try{var i=e,l=t,a=l;e:for(;a!==null;){switch(a.tag){case 5:_t=a.stateNode,Tn=!1;break e;case 3:_t=a.stateNode.containerInfo,Tn=!0;break e;case 4:_t=a.stateNode.containerInfo,Tn=!0;break e}a=a.return}if(_t===null)throw Error(J(160));Mh(i,l,o),_t=null,Tn=!1;var d=o.alternate;d!==null&&(d.return=null),o.return=null}catch(f){ct(o,t,f)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Rh(t,e),t=t.sibling}function Rh(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(En(t,e),Gn(e),r&4){try{Do(3,e,e.return),la(3,e)}catch(_){ct(e,e.return,_)}try{Do(5,e,e.return)}catch(_){ct(e,e.return,_)}}break;case 1:En(t,e),Gn(e),r&512&&n!==null&&Fs(n,n.return);break;case 5:if(En(t,e),Gn(e),r&512&&n!==null&&Fs(n,n.return),e.flags&32){var o=e.stateNode;try{Qo(o,"")}catch(_){ct(e,e.return,_)}}if(r&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,l=n!==null?n.memoizedProps:i,a=e.type,d=e.updateQueue;if(e.updateQueue=null,d!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&ep(o,i),wc(a,l);var f=wc(a,i);for(l=0;l<d.length;l+=2){var g=d[l],x=d[l+1];g==="style"?op(o,x):g==="dangerouslySetInnerHTML"?rp(o,x):g==="children"?Qo(o,x):Ed(o,g,x,f)}switch(a){case"input":hc(o,i);break;case"textarea":tp(o,i);break;case"select":var b=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var T=i.value;T!=null?Ds(o,!!i.multiple,T,!1):b!==!!i.multiple&&(i.defaultValue!=null?Ds(o,!!i.multiple,i.defaultValue,!0):Ds(o,!!i.multiple,i.multiple?[]:"",!1))}o[oi]=i}catch(_){ct(e,e.return,_)}}break;case 6:if(En(t,e),Gn(e),r&4){if(e.stateNode===null)throw Error(J(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(_){ct(e,e.return,_)}}break;case 3:if(En(t,e),Gn(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ei(t.containerInfo)}catch(_){ct(e,e.return,_)}break;case 4:En(t,e),Gn(e);break;case 13:En(t,e),Gn(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(iu=ut())),r&4&&Vf(e);break;case 22:if(g=n!==null&&n.memoizedState!==null,e.mode&1?(Ot=(f=Ot)||g,En(t,e),Ot=f):En(t,e),Gn(e),r&8192){if(f=e.memoizedState!==null,(e.stateNode.isHidden=f)&&!g&&e.mode&1)for(de=e,g=e.child;g!==null;){for(x=de=g;de!==null;){switch(b=de,T=b.child,b.tag){case 0:case 11:case 14:case 15:Do(4,b,b.return);break;case 1:Fs(b,b.return);var k=b.stateNode;if(typeof k.componentWillUnmount=="function"){r=b,n=b.return;try{t=r,k.props=t.memoizedProps,k.state=t.memoizedState,k.componentWillUnmount()}catch(_){ct(r,n,_)}}break;case 5:Fs(b,b.return);break;case 22:if(b.memoizedState!==null){Hf(x);continue}}T!==null?(T.return=b,de=T):Hf(x)}g=g.sibling}e:for(g=null,x=e;;){if(x.tag===5){if(g===null){g=x;try{o=x.stateNode,f?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=x.stateNode,d=x.memoizedProps.style,l=d!=null&&d.hasOwnProperty("display")?d.display:null,a.style.display=sp("display",l))}catch(_){ct(e,e.return,_)}}}else if(x.tag===6){if(g===null)try{x.stateNode.nodeValue=f?"":x.memoizedProps}catch(_){ct(e,e.return,_)}}else if((x.tag!==22&&x.tag!==23||x.memoizedState===null||x===e)&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===e)break e;for(;x.sibling===null;){if(x.return===null||x.return===e)break e;g===x&&(g=null),x=x.return}g===x&&(g=null),x.sibling.return=x.return,x=x.sibling}}break;case 19:En(t,e),Gn(e),r&4&&Vf(e);break;case 21:break;default:En(t,e),Gn(e)}}function Gn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(_h(n)){var r=n;break e}n=n.return}throw Error(J(160))}switch(r.tag){case 5:var o=r.stateNode;r.flags&32&&(Qo(o,""),r.flags&=-33);var i=Df(e);Qc(e,i,o);break;case 3:case 4:var l=r.stateNode.containerInfo,a=Df(e);Kc(e,a,l);break;default:throw Error(J(161))}}catch(d){ct(e,e.return,d)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function gy(e,t,n){de=e,Ah(e)}function Ah(e,t,n){for(var r=(e.mode&1)!==0;de!==null;){var o=de,i=o.child;if(o.tag===22&&r){var l=o.memoizedState!==null||Hi;if(!l){var a=o.alternate,d=a!==null&&a.memoizedState!==null||Ot;a=Hi;var f=Ot;if(Hi=l,(Ot=d)&&!f)for(de=o;de!==null;)l=de,d=l.child,l.tag===22&&l.memoizedState!==null?Wf(o):d!==null?(d.return=l,de=d):Wf(o);for(;i!==null;)de=i,Ah(i),i=i.sibling;de=o,Hi=a,Ot=f}Gf(e)}else o.subtreeFlags&8772&&i!==null?(i.return=o,de=i):Gf(e)}}function Gf(e){for(;de!==null;){var t=de;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ot||la(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Ot)if(n===null)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:In(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&If(t,i,r);break;case 3:var l=t.updateQueue;if(l!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}If(t,l,n)}break;case 5:var a=t.stateNode;if(n===null&&t.flags&4){n=a;var d=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&n.focus();break;case"img":d.src&&(n.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var f=t.alternate;if(f!==null){var g=f.memoizedState;if(g!==null){var x=g.dehydrated;x!==null&&ei(x)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}Ot||t.flags&512&&Yc(t)}catch(b){ct(t,t.return,b)}}if(t===e){de=null;break}if(n=t.sibling,n!==null){n.return=t.return,de=n;break}de=t.return}}function Hf(e){for(;de!==null;){var t=de;if(t===e){de=null;break}var n=t.sibling;if(n!==null){n.return=t.return,de=n;break}de=t.return}}function Wf(e){for(;de!==null;){var t=de;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{la(4,t)}catch(d){ct(t,n,d)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var o=t.return;try{r.componentDidMount()}catch(d){ct(t,o,d)}}var i=t.return;try{Yc(t)}catch(d){ct(t,i,d)}break;case 5:var l=t.return;try{Yc(t)}catch(d){ct(t,l,d)}}}catch(d){ct(t,t.return,d)}if(t===e){de=null;break}var a=t.sibling;if(a!==null){a.return=t.return,de=a;break}de=t.return}}var xy=Math.ceil,Ol=xr.ReactCurrentDispatcher,su=xr.ReactCurrentOwner,Nn=xr.ReactCurrentBatchConfig,Ue=0,Tt=null,xt=null,Mt=0,cn=0,zs=qr(0),Nt=0,ui=null,xs=0,aa=0,ou=0,Vo=null,en=null,iu=0,ro=1/0,or=null,$l=!1,Jc=null,Fr=null,Wi=!1,Mr=null,Fl=0,Go=0,Xc=null,ll=-1,al=0;function Gt(){return Ue&6?ut():ll!==-1?ll:ll=ut()}function zr(e){return e.mode&1?Ue&2&&Mt!==0?Mt&-Mt:ey.transition!==null?(al===0&&(al=xp()),al):(e=Ve,e!==0||(e=window.event,e=e===void 0?16:kp(e.type)),e):1}function Pn(e,t,n,r){if(50<Go)throw Go=0,Xc=null,Error(J(185));yi(e,n,r),(!(Ue&2)||e!==Tt)&&(e===Tt&&(!(Ue&2)&&(aa|=n),Nt===4&&Ir(e,Mt)),sn(e,r),n===1&&Ue===0&&!(t.mode&1)&&(ro=ut()+500,sa&&Yr()))}function sn(e,t){var n=e.callbackNode;ex(e,t);var r=jl(e,e===Tt?Mt:0);if(r===0)n!==null&&ef(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&ef(n),t===1)e.tag===0?Zx(qf.bind(null,e)):Vp(qf.bind(null,e)),Kx(function(){!(Ue&6)&&Yr()}),n=null;else{switch(yp(r)){case 1:n=Rd;break;case 4:n=hp;break;case 16:n=bl;break;case 536870912:n=gp;break;default:n=bl}n=Bh(n,Ph.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Ph(e,t){if(ll=-1,al=0,Ue&6)throw Error(J(327));var n=e.callbackNode;if(qs()&&e.callbackNode!==n)return null;var r=jl(e,e===Tt?Mt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=zl(e,r);else{t=r;var o=Ue;Ue|=2;var i=Uh();(Tt!==e||Mt!==t)&&(or=null,ro=ut()+500,us(e,t));do try{wy();break}catch(a){Lh(e,a)}while(1);Hd(),Ol.current=i,Ue=o,xt!==null?t=0:(Tt=null,Mt=0,t=Nt)}if(t!==0){if(t===2&&(o=Sc(e),o!==0&&(r=o,t=Zc(e,o))),t===1)throw n=ui,us(e,0),Ir(e,r),sn(e,ut()),n;if(t===6)Ir(e,r);else{if(o=e.current.alternate,!(r&30)&&!yy(o)&&(t=zl(e,r),t===2&&(i=Sc(e),i!==0&&(r=i,t=Zc(e,i))),t===1))throw n=ui,us(e,0),Ir(e,r),sn(e,ut()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(J(345));case 2:os(e,en,or);break;case 3:if(Ir(e,r),(r&130023424)===r&&(t=iu+500-ut(),10<t)){if(jl(e,0)!==0)break;if(o=e.suspendedLanes,(o&r)!==r){Gt(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=Ac(os.bind(null,e,en,or),t);break}os(e,en,or);break;case 4:if(Ir(e,r),(r&4194240)===r)break;for(t=e.eventTimes,o=-1;0<r;){var l=31-An(r);i=1<<l,l=t[l],l>o&&(o=l),r&=~i}if(r=o,r=ut()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*xy(r/1960))-r,10<r){e.timeoutHandle=Ac(os.bind(null,e,en,or),r);break}os(e,en,or);break;case 5:os(e,en,or);break;default:throw Error(J(329))}}}return sn(e,ut()),e.callbackNode===n?Ph.bind(null,e):null}function Zc(e,t){var n=Vo;return e.current.memoizedState.isDehydrated&&(us(e,t).flags|=256),e=zl(e,t),e!==2&&(t=en,en=n,t!==null&&ed(t)),e}function ed(e){en===null?en=e:en.push.apply(en,e)}function yy(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var o=n[r],i=o.getSnapshot;o=o.value;try{if(!On(i(),o))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Ir(e,t){for(t&=~ou,t&=~aa,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-An(t),r=1<<n;e[n]=-1,t&=~r}}function qf(e){if(Ue&6)throw Error(J(327));qs();var t=jl(e,0);if(!(t&1))return sn(e,ut()),null;var n=zl(e,t);if(e.tag!==0&&n===2){var r=Sc(e);r!==0&&(t=r,n=Zc(e,r))}if(n===1)throw n=ui,us(e,0),Ir(e,t),sn(e,ut()),n;if(n===6)throw Error(J(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,os(e,en,or),sn(e,ut()),null}function lu(e,t){var n=Ue;Ue|=1;try{return e(t)}finally{Ue=n,Ue===0&&(ro=ut()+500,sa&&Yr())}}function ys(e){Mr!==null&&Mr.tag===0&&!(Ue&6)&&qs();var t=Ue;Ue|=1;var n=Nn.transition,r=Ve;try{if(Nn.transition=null,Ve=1,e)return e()}finally{Ve=r,Nn.transition=n,Ue=t,!(Ue&6)&&Yr()}}function au(){cn=zs.current,Qe(zs)}function us(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Yx(n)),xt!==null)for(n=xt.return;n!==null;){var r=n;switch(Dd(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&El();break;case 3:to(),Qe(nn),Qe(Ft),Jd();break;case 5:Qd(r);break;case 4:to();break;case 13:Qe(st);break;case 19:Qe(st);break;case 10:Wd(r.type._context);break;case 22:case 23:au()}n=n.return}if(Tt=e,xt=e=Br(e.current,null),Mt=cn=t,Nt=0,ui=null,ou=aa=xs=0,en=Vo=null,as!==null){for(t=0;t<as.length;t++)if(n=as[t],r=n.interleaved,r!==null){n.interleaved=null;var o=r.next,i=n.pending;if(i!==null){var l=i.next;i.next=o,r.next=l}n.pending=r}as=null}return e}function Lh(e,t){do{var n=xt;try{if(Hd(),sl.current=Ul,Ll){for(var r=ot.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}Ll=!1}if(gs=0,It=jt=ot=null,Bo=!1,ai=0,su.current=null,n===null||n.return===null){Nt=1,ui=t,xt=null;break}e:{var i=e,l=n.return,a=n,d=t;if(t=Mt,a.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var f=d,g=a,x=g.tag;if(!(g.mode&1)&&(x===0||x===11||x===15)){var b=g.alternate;b?(g.updateQueue=b.updateQueue,g.memoizedState=b.memoizedState,g.lanes=b.lanes):(g.updateQueue=null,g.memoizedState=null)}var T=Pf(l);if(T!==null){T.flags&=-257,Lf(T,l,a,i,t),T.mode&1&&Af(i,f,t),t=T,d=f;var k=t.updateQueue;if(k===null){var _=new Set;_.add(d),t.updateQueue=_}else k.add(d);break e}else{if(!(t&1)){Af(i,f,t),cu();break e}d=Error(J(426))}}else if(tt&&a.mode&1){var w=Pf(l);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Lf(w,l,a,i,t),Vd(no(d,a));break e}}i=d=no(d,a),Nt!==4&&(Nt=2),Vo===null?Vo=[i]:Vo.push(i),i=l;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var m=yh(i,d,t);Ef(i,m);break e;case 1:a=d;var v=i.type,y=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Fr===null||!Fr.has(y)))){i.flags|=65536,t&=-t,i.lanes|=t;var M=vh(i,a,t);Ef(i,M);break e}}i=i.return}while(i!==null)}$h(n)}catch(L){t=L,xt===n&&n!==null&&(xt=n=n.return);continue}break}while(1)}function Uh(){var e=Ol.current;return Ol.current=Ul,e===null?Ul:e}function cu(){(Nt===0||Nt===3||Nt===2)&&(Nt=4),Tt===null||!(xs&268435455)&&!(aa&268435455)||Ir(Tt,Mt)}function zl(e,t){var n=Ue;Ue|=2;var r=Uh();(Tt!==e||Mt!==t)&&(or=null,us(e,t));do try{vy();break}catch(o){Lh(e,o)}while(1);if(Hd(),Ue=n,Ol.current=r,xt!==null)throw Error(J(261));return Tt=null,Mt=0,Nt}function vy(){for(;xt!==null;)Oh(xt)}function wy(){for(;xt!==null&&!H0();)Oh(xt)}function Oh(e){var t=zh(e.alternate,e,cn);e.memoizedProps=e.pendingProps,t===null?$h(e):xt=t,su.current=null}function $h(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=my(n,t),n!==null){n.flags&=32767,xt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Nt=6,xt=null;return}}else if(n=fy(n,t,cn),n!==null){xt=n;return}if(t=t.sibling,t!==null){xt=t;return}xt=t=e}while(t!==null);Nt===0&&(Nt=5)}function os(e,t,n){var r=Ve,o=Nn.transition;try{Nn.transition=null,Ve=1,by(e,t,n,r)}finally{Nn.transition=o,Ve=r}return null}function by(e,t,n,r){do qs();while(Mr!==null);if(Ue&6)throw Error(J(327));n=e.finishedWork;var o=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(J(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(tx(e,i),e===Tt&&(xt=Tt=null,Mt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Wi||(Wi=!0,Bh(bl,function(){return qs(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Nn.transition,Nn.transition=null;var l=Ve;Ve=1;var a=Ue;Ue|=4,su.current=null,hy(e,n),Rh(n,e),Bx(Mc),Nl=!!_c,Mc=_c=null,e.current=n,gy(n),W0(),Ue=a,Ve=l,Nn.transition=i}else e.current=n;if(Wi&&(Wi=!1,Mr=e,Fl=o),i=e.pendingLanes,i===0&&(Fr=null),K0(n.stateNode),sn(e,ut()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],r(o.value,{componentStack:o.stack,digest:o.digest});if($l)throw $l=!1,e=Jc,Jc=null,e;return Fl&1&&e.tag!==0&&qs(),i=e.pendingLanes,i&1?e===Xc?Go++:(Go=0,Xc=e):Go=0,Yr(),null}function qs(){if(Mr!==null){var e=yp(Fl),t=Nn.transition,n=Ve;try{if(Nn.transition=null,Ve=16>e?16:e,Mr===null)var r=!1;else{if(e=Mr,Mr=null,Fl=0,Ue&6)throw Error(J(331));var o=Ue;for(Ue|=4,de=e.current;de!==null;){var i=de,l=i.child;if(de.flags&16){var a=i.deletions;if(a!==null){for(var d=0;d<a.length;d++){var f=a[d];for(de=f;de!==null;){var g=de;switch(g.tag){case 0:case 11:case 15:Do(8,g,i)}var x=g.child;if(x!==null)x.return=g,de=x;else for(;de!==null;){g=de;var b=g.sibling,T=g.return;if(Th(g),g===f){de=null;break}if(b!==null){b.return=T,de=b;break}de=T}}}var k=i.alternate;if(k!==null){var _=k.child;if(_!==null){k.child=null;do{var w=_.sibling;_.sibling=null,_=w}while(_!==null)}}de=i}}if(i.subtreeFlags&2064&&l!==null)l.return=i,de=l;else e:for(;de!==null;){if(i=de,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Do(9,i,i.return)}var m=i.sibling;if(m!==null){m.return=i.return,de=m;break e}de=i.return}}var v=e.current;for(de=v;de!==null;){l=de;var y=l.child;if(l.subtreeFlags&2064&&y!==null)y.return=l,de=y;else e:for(l=v;de!==null;){if(a=de,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:la(9,a)}}catch(L){ct(a,a.return,L)}if(a===l){de=null;break e}var M=a.sibling;if(M!==null){M.return=a.return,de=M;break e}de=a.return}}if(Ue=o,Yr(),Kn&&typeof Kn.onPostCommitFiberRoot=="function")try{Kn.onPostCommitFiberRoot(Zl,e)}catch{}r=!0}return r}finally{Ve=n,Nn.transition=t}}return!1}function Yf(e,t,n){t=no(n,t),t=yh(e,t,1),e=$r(e,t,1),t=Gt(),e!==null&&(yi(e,1,t),sn(e,t))}function ct(e,t,n){if(e.tag===3)Yf(e,e,n);else for(;t!==null;){if(t.tag===3){Yf(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Fr===null||!Fr.has(r))){e=no(n,e),e=vh(t,e,1),t=$r(t,e,1),e=Gt(),t!==null&&(yi(t,1,e),sn(t,e));break}}t=t.return}}function jy(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Gt(),e.pingedLanes|=e.suspendedLanes&n,Tt===e&&(Mt&n)===n&&(Nt===4||Nt===3&&(Mt&130023424)===Mt&&500>ut()-iu?us(e,0):ou|=n),sn(e,t)}function Fh(e,t){t===0&&(e.mode&1?(t=Ui,Ui<<=1,!(Ui&130023424)&&(Ui=4194304)):t=1);var n=Gt();e=pr(e,t),e!==null&&(yi(e,t,n),sn(e,n))}function Ny(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),Fh(e,n)}function ky(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;o!==null&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(J(314))}r!==null&&r.delete(t),Fh(e,n)}var zh;zh=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||nn.current)tn=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return tn=!1,uy(e,t,n);tn=!!(e.flags&131072)}else tn=!1,tt&&t.flags&1048576&&Gp(t,_l,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;il(e,t),e=t.pendingProps;var o=Xs(t,Ft.current);Ws(t,n),o=Zd(null,t,r,e,o,n);var i=eu();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,rn(r)?(i=!0,Il(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,Yd(t),o.updater=ia,t.stateNode=o,o._reactInternals=t,zc(t,r,e,n),t=Vc(null,t,r,!0,i,n)):(t.tag=0,tt&&i&&Bd(t),Dt(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch(il(e,t),e=t.pendingProps,o=r._init,r=o(r._payload),t.type=r,o=t.tag=Cy(r),e=In(r,e),o){case 0:t=Dc(null,t,r,e,n);break e;case 1:t=$f(null,t,r,e,n);break e;case 11:t=Uf(null,t,r,e,n);break e;case 14:t=Of(null,t,r,In(r.type,e),n);break e}throw Error(J(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:In(r,o),Dc(e,t,r,o,n);case 1:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:In(r,o),$f(e,t,r,o,n);case 3:e:{if(Nh(t),e===null)throw Error(J(387));r=t.pendingProps,i=t.memoizedState,o=i.element,Qp(e,t),Al(t,r,null,n);var l=t.memoizedState;if(r=l.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=no(Error(J(423)),t),t=Ff(e,t,r,n,o);break e}else if(r!==o){o=no(Error(J(424)),t),t=Ff(e,t,r,n,o);break e}else for(dn=Or(t.stateNode.containerInfo.firstChild),un=t,tt=!0,Mn=null,n=Yp(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Zs(),r===o){t=hr(e,t,n);break e}Dt(e,t,r,n)}t=t.child}return t;case 5:return Jp(t),e===null&&Oc(t),r=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,l=o.children,Rc(r,o)?l=null:i!==null&&Rc(r,i)&&(t.flags|=32),jh(e,t),Dt(e,t,l,n),t.child;case 6:return e===null&&Oc(t),null;case 13:return kh(e,t,n);case 4:return Kd(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=eo(t,null,r,n):Dt(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:In(r,o),Uf(e,t,r,o,n);case 7:return Dt(e,t,t.pendingProps,n),t.child;case 8:return Dt(e,t,t.pendingProps.children,n),t.child;case 12:return Dt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,i=t.memoizedProps,l=o.value,We(Ml,r._currentValue),r._currentValue=l,i!==null)if(On(i.value,l)){if(i.children===o.children&&!nn.current){t=hr(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var a=i.dependencies;if(a!==null){l=i.child;for(var d=a.firstContext;d!==null;){if(d.context===r){if(i.tag===1){d=dr(-1,n&-n),d.tag=2;var f=i.updateQueue;if(f!==null){f=f.shared;var g=f.pending;g===null?d.next=d:(d.next=g.next,g.next=d),f.pending=d}}i.lanes|=n,d=i.alternate,d!==null&&(d.lanes|=n),$c(i.return,n,t),a.lanes|=n;break}d=d.next}}else if(i.tag===10)l=i.type===t.type?null:i.child;else if(i.tag===18){if(l=i.return,l===null)throw Error(J(341));l.lanes|=n,a=l.alternate,a!==null&&(a.lanes|=n),$c(l,n,t),l=i.sibling}else l=i.child;if(l!==null)l.return=i;else for(l=i;l!==null;){if(l===t){l=null;break}if(i=l.sibling,i!==null){i.return=l.return,l=i;break}l=l.return}i=l}Dt(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,Ws(t,n),o=kn(o),r=r(o),t.flags|=1,Dt(e,t,r,n),t.child;case 14:return r=t.type,o=In(r,t.pendingProps),o=In(r.type,o),Of(e,t,r,o,n);case 15:return wh(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:In(r,o),il(e,t),t.tag=1,rn(r)?(e=!0,Il(t)):e=!1,Ws(t,n),xh(t,r,o),zc(t,r,o,n),Vc(null,t,r,!0,e,n);case 19:return Sh(e,t,n);case 22:return bh(e,t,n)}throw Error(J(156,t.tag))};function Bh(e,t){return pp(e,t)}function Sy(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jn(e,t,n,r){return new Sy(e,t,n,r)}function du(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Cy(e){if(typeof e=="function")return du(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Td)return 11;if(e===_d)return 14}return 2}function Br(e,t){var n=e.alternate;return n===null?(n=jn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function cl(e,t,n,r,o,i){var l=2;if(r=e,typeof e=="function")du(e)&&(l=1);else if(typeof e=="string")l=5;else e:switch(e){case _s:return fs(n.children,o,i,t);case Id:l=8,o|=8;break;case dc:return e=jn(12,n,t,o|2),e.elementType=dc,e.lanes=i,e;case uc:return e=jn(13,n,t,o),e.elementType=uc,e.lanes=i,e;case fc:return e=jn(19,n,t,o),e.elementType=fc,e.lanes=i,e;case Jm:return ca(n,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Km:l=10;break e;case Qm:l=9;break e;case Td:l=11;break e;case _d:l=14;break e;case Sr:l=16,r=null;break e}throw Error(J(130,e==null?e:typeof e,""))}return t=jn(l,n,t,o),t.elementType=e,t.type=r,t.lanes=i,t}function fs(e,t,n,r){return e=jn(7,e,r,t),e.lanes=n,e}function ca(e,t,n,r){return e=jn(22,e,r,t),e.elementType=Jm,e.lanes=n,e.stateNode={isHidden:!1},e}function Xa(e,t,n){return e=jn(6,e,null,t),e.lanes=n,e}function Za(e,t,n){return t=jn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Ey(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Aa(0),this.expirationTimes=Aa(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Aa(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function uu(e,t,n,r,o,i,l,a,d){return e=new Ey(e,t,n,a,d),t===1?(t=1,i===!0&&(t|=8)):t=0,i=jn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Yd(i),e}function Iy(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ts,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function Dh(e){if(!e)return Hr;e=e._reactInternals;e:{if(bs(e)!==e||e.tag!==1)throw Error(J(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(rn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(J(171))}if(e.tag===1){var n=e.type;if(rn(n))return Dp(e,n,t)}return t}function Vh(e,t,n,r,o,i,l,a,d){return e=uu(n,r,!0,e,o,i,l,a,d),e.context=Dh(null),n=e.current,r=Gt(),o=zr(n),i=dr(r,o),i.callback=t??null,$r(n,i,o),e.current.lanes=o,yi(e,o,r),sn(e,r),e}function da(e,t,n,r){var o=t.current,i=Gt(),l=zr(o);return n=Dh(n),t.context===null?t.context=n:t.pendingContext=n,t=dr(i,l),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=$r(o,t,l),e!==null&&(Pn(e,o,l,i),rl(e,o,l)),l}function Bl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Kf(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function fu(e,t){Kf(e,t),(e=e.alternate)&&Kf(e,t)}function Ty(){return null}var Gh=typeof reportError=="function"?reportError:function(e){console.error(e)};function mu(e){this._internalRoot=e}ua.prototype.render=mu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(J(409));da(e,t,null,null)};ua.prototype.unmount=mu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;ys(function(){da(null,e,null,null)}),t[mr]=null}};function ua(e){this._internalRoot=e}ua.prototype.unstable_scheduleHydration=function(e){if(e){var t=bp();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Er.length&&t!==0&&t<Er[n].priority;n++);Er.splice(n,0,e),n===0&&Np(e)}};function pu(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function fa(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Qf(){}function _y(e,t,n,r,o){if(o){if(typeof r=="function"){var i=r;r=function(){var f=Bl(l);i.call(f)}}var l=Vh(t,r,e,0,null,!1,!1,"",Qf);return e._reactRootContainer=l,e[mr]=l.current,ri(e.nodeType===8?e.parentNode:e),ys(),l}for(;o=e.lastChild;)e.removeChild(o);if(typeof r=="function"){var a=r;r=function(){var f=Bl(d);a.call(f)}}var d=uu(e,0,!1,null,null,!1,!1,"",Qf);return e._reactRootContainer=d,e[mr]=d.current,ri(e.nodeType===8?e.parentNode:e),ys(function(){da(t,d,n,r)}),d}function ma(e,t,n,r,o){var i=n._reactRootContainer;if(i){var l=i;if(typeof o=="function"){var a=o;o=function(){var d=Bl(l);a.call(d)}}da(t,l,e,o)}else l=_y(n,t,e,o,r);return Bl(l)}vp=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Ao(t.pendingLanes);n!==0&&(Ad(t,n|1),sn(t,ut()),!(Ue&6)&&(ro=ut()+500,Yr()))}break;case 13:ys(function(){var r=pr(e,1);if(r!==null){var o=Gt();Pn(r,e,1,o)}}),fu(e,1)}};Pd=function(e){if(e.tag===13){var t=pr(e,134217728);if(t!==null){var n=Gt();Pn(t,e,134217728,n)}fu(e,134217728)}};wp=function(e){if(e.tag===13){var t=zr(e),n=pr(e,t);if(n!==null){var r=Gt();Pn(n,e,t,r)}fu(e,t)}};bp=function(){return Ve};jp=function(e,t){var n=Ve;try{return Ve=e,t()}finally{Ve=n}};jc=function(e,t,n){switch(t){case"input":if(hc(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=ra(r);if(!o)throw Error(J(90));Zm(r),hc(r,o)}}}break;case"textarea":tp(e,n);break;case"select":t=n.value,t!=null&&Ds(e,!!n.multiple,t,!1)}};ap=lu;cp=ys;var My={usingClientEntryPoint:!1,Events:[wi,Ps,ra,ip,lp,lu]},Io={findFiberByHostInstance:ls,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ry={bundleType:Io.bundleType,version:Io.version,rendererPackageName:Io.rendererPackageName,rendererConfig:Io.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:xr.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=fp(e),e===null?null:e.stateNode},findFiberByHostInstance:Io.findFiberByHostInstance||Ty,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qi.isDisabled&&qi.supportsFiber)try{Zl=qi.inject(Ry),Kn=qi}catch{}}pn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=My;pn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!pu(t))throw Error(J(200));return Iy(e,t,null,n)};pn.createRoot=function(e,t){if(!pu(e))throw Error(J(299));var n=!1,r="",o=Gh;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=uu(e,1,!1,null,null,n,!1,r,o),e[mr]=t.current,ri(e.nodeType===8?e.parentNode:e),new mu(t)};pn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(J(188)):(e=Object.keys(e).join(","),Error(J(268,e)));return e=fp(t),e=e===null?null:e.stateNode,e};pn.flushSync=function(e){return ys(e)};pn.hydrate=function(e,t,n){if(!fa(t))throw Error(J(200));return ma(null,e,t,!0,n)};pn.hydrateRoot=function(e,t,n){if(!pu(e))throw Error(J(405));var r=n!=null&&n.hydratedSources||null,o=!1,i="",l=Gh;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),t=Vh(t,null,e,1,n??null,o,!1,i,l),e[mr]=t.current,ri(e),r)for(e=0;e<r.length;e++)n=r[e],o=n._getVersion,o=o(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new ua(t)};pn.render=function(e,t,n){if(!fa(t))throw Error(J(200));return ma(null,e,t,!1,n)};pn.unmountComponentAtNode=function(e){if(!fa(e))throw Error(J(40));return e._reactRootContainer?(ys(function(){ma(null,null,e,!1,function(){e._reactRootContainer=null,e[mr]=null})}),!0):!1};pn.unstable_batchedUpdates=lu;pn.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!fa(n))throw Error(J(200));if(e==null||e._reactInternals===void 0)throw Error(J(38));return ma(e,t,n,!1,r)};pn.version="18.3.1-next-f1338f8080-20240426";function Hh(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Hh)}catch(e){console.error(e)}}Hh(),Hm.exports=pn;var Ay=Hm.exports,Jf=Ay;ac.createRoot=Jf.createRoot,ac.hydrateRoot=Jf.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function fi(){return fi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},fi.apply(this,arguments)}var Rr;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Rr||(Rr={}));const Xf="popstate";function Py(e){e===void 0&&(e={});function t(r,o){let{pathname:i,search:l,hash:a}=r.location;return td("",{pathname:i,search:l,hash:a},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(r,o){return typeof o=="string"?o:Dl(o)}return Uy(t,n,null,e)}function ft(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Wh(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Ly(){return Math.random().toString(36).substr(2,8)}function Zf(e,t){return{usr:e.state,key:e.key,idx:t}}function td(e,t,n,r){return n===void 0&&(n=null),fi({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?ao(t):t,{state:n,key:t&&t.key||r||Ly()})}function Dl(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function ao(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function Uy(e,t,n,r){r===void 0&&(r={});let{window:o=document.defaultView,v5Compat:i=!1}=r,l=o.history,a=Rr.Pop,d=null,f=g();f==null&&(f=0,l.replaceState(fi({},l.state,{idx:f}),""));function g(){return(l.state||{idx:null}).idx}function x(){a=Rr.Pop;let w=g(),m=w==null?null:w-f;f=w,d&&d({action:a,location:_.location,delta:m})}function b(w,m){a=Rr.Push;let v=td(_.location,w,m);n&&n(v,w),f=g()+1;let y=Zf(v,f),M=_.createHref(v);try{l.pushState(y,"",M)}catch(L){if(L instanceof DOMException&&L.name==="DataCloneError")throw L;o.location.assign(M)}i&&d&&d({action:a,location:_.location,delta:1})}function T(w,m){a=Rr.Replace;let v=td(_.location,w,m);n&&n(v,w),f=g();let y=Zf(v,f),M=_.createHref(v);l.replaceState(y,"",M),i&&d&&d({action:a,location:_.location,delta:0})}function k(w){let m=o.location.origin!=="null"?o.location.origin:o.location.href,v=typeof w=="string"?w:Dl(w);return v=v.replace(/ $/,"%20"),ft(m,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,m)}let _={get action(){return a},get location(){return e(o,l)},listen(w){if(d)throw new Error("A history only accepts one active listener");return o.addEventListener(Xf,x),d=w,()=>{o.removeEventListener(Xf,x),d=null}},createHref(w){return t(o,w)},createURL:k,encodeLocation(w){let m=k(w);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:b,replace:T,go(w){return l.go(w)}};return _}var em;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(em||(em={}));function Oy(e,t,n){return n===void 0&&(n="/"),$y(e,t,n,!1)}function $y(e,t,n,r){let o=typeof t=="string"?ao(t):t,i=hu(o.pathname||"/",n);if(i==null)return null;let l=qh(e);Fy(l);let a=null;for(let d=0;a==null&&d<l.length;++d){let f=Qy(i);a=Yy(l[d],f,r)}return a}function qh(e,t,n,r){t===void 0&&(t=[]),n===void 0&&(n=[]),r===void 0&&(r="");let o=(i,l,a)=>{let d={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:l,route:i};d.relativePath.startsWith("/")&&(ft(d.relativePath.startsWith(r),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(r.length));let f=Dr([r,d.relativePath]),g=n.concat(d);i.children&&i.children.length>0&&(ft(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+f+'".')),qh(i.children,t,g,f)),!(i.path==null&&!i.index)&&t.push({path:f,score:Wy(f,i.index),routesMeta:g})};return e.forEach((i,l)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))o(i,l);else for(let d of Yh(i.path))o(i,l,d)}),t}function Yh(e){let t=e.split("/");if(t.length===0)return[];let[n,...r]=t,o=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return o?[i,""]:[i];let l=Yh(r.join("/")),a=[];return a.push(...l.map(d=>d===""?i:[i,d].join("/"))),o&&a.push(...l),a.map(d=>e.startsWith("/")&&d===""?"/":d)}function Fy(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:qy(t.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const zy=/^:[\w-]+$/,By=3,Dy=2,Vy=1,Gy=10,Hy=-2,tm=e=>e==="*";function Wy(e,t){let n=e.split("/"),r=n.length;return n.some(tm)&&(r+=Hy),t&&(r+=Dy),n.filter(o=>!tm(o)).reduce((o,i)=>o+(zy.test(i)?By:i===""?Vy:Gy),r)}function qy(e,t){return e.length===t.length&&e.slice(0,-1).every((r,o)=>r===t[o])?e[e.length-1]-t[t.length-1]:0}function Yy(e,t,n){n===void 0&&(n=!1);let{routesMeta:r}=e,o={},i="/",l=[];for(let a=0;a<r.length;++a){let d=r[a],f=a===r.length-1,g=i==="/"?t:t.slice(i.length)||"/",x=nm({path:d.relativePath,caseSensitive:d.caseSensitive,end:f},g),b=d.route;if(!x&&f&&n&&!r[r.length-1].route.index&&(x=nm({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},g)),!x)return null;Object.assign(o,x.params),l.push({params:o,pathname:Dr([i,x.pathname]),pathnameBase:ev(Dr([i,x.pathnameBase])),route:b}),x.pathnameBase!=="/"&&(i=Dr([i,x.pathnameBase]))}return l}function nm(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=Ky(e.path,e.caseSensitive,e.end),o=t.match(n);if(!o)return null;let i=o[0],l=i.replace(/(.)\/+$/,"$1"),a=o.slice(1);return{params:r.reduce((f,g,x)=>{let{paramName:b,isOptional:T}=g;if(b==="*"){let _=a[x]||"";l=i.slice(0,i.length-_.length).replace(/(.)\/+$/,"$1")}const k=a[x];return T&&!k?f[b]=void 0:f[b]=(k||"").replace(/%2F/g,"/"),f},{}),pathname:i,pathnameBase:l,pattern:e}}function Ky(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),Wh(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,a,d)=>(r.push({paramName:a,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),o+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":e!==""&&e!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),r]}function Qy(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Wh(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function hu(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&r!=="/"?null:e.slice(n)||"/"}function Jy(e,t){t===void 0&&(t="/");let{pathname:n,search:r="",hash:o=""}=typeof e=="string"?ao(e):e;return{pathname:n?n.startsWith("/")?n:Xy(n,t):t,search:tv(r),hash:nv(o)}}function Xy(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(o=>{o===".."?n.length>1&&n.pop():o!=="."&&n.push(o)}),n.length>1?n.join("/"):"/"}function ec(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Zy(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function gu(e,t){let n=Zy(e);return t?n.map((r,o)=>o===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function xu(e,t,n,r){r===void 0&&(r=!1);let o;typeof e=="string"?o=ao(e):(o=fi({},e),ft(!o.pathname||!o.pathname.includes("?"),ec("?","pathname","search",o)),ft(!o.pathname||!o.pathname.includes("#"),ec("#","pathname","hash",o)),ft(!o.search||!o.search.includes("#"),ec("#","search","hash",o)));let i=e===""||o.pathname==="",l=i?"/":o.pathname,a;if(l==null)a=n;else{let x=t.length-1;if(!r&&l.startsWith("..")){let b=l.split("/");for(;b[0]==="..";)b.shift(),x-=1;o.pathname=b.join("/")}a=x>=0?t[x]:"/"}let d=Jy(o,a),f=l&&l!=="/"&&l.endsWith("/"),g=(i||l===".")&&n.endsWith("/");return!d.pathname.endsWith("/")&&(f||g)&&(d.pathname+="/"),d}const Dr=e=>e.join("/").replace(/\/\/+/g,"/"),ev=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),tv=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,nv=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function rv(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const Kh=["post","put","patch","delete"];new Set(Kh);const sv=["get",...Kh];new Set(sv);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function mi(){return mi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},mi.apply(this,arguments)}const yu=h.createContext(null),ov=h.createContext(null),Kr=h.createContext(null),pa=h.createContext(null),yr=h.createContext({outlet:null,matches:[],isDataRoute:!1}),Qh=h.createContext(null);function iv(e,t){let{relative:n}=t===void 0?{}:t;co()||ft(!1);let{basename:r,navigator:o}=h.useContext(Kr),{hash:i,pathname:l,search:a}=Xh(e,{relative:n}),d=l;return r!=="/"&&(d=l==="/"?r:Dr([r,l])),o.createHref({pathname:d,search:a,hash:i})}function co(){return h.useContext(pa)!=null}function ji(){return co()||ft(!1),h.useContext(pa).location}function Jh(e){h.useContext(Kr).static||h.useLayoutEffect(e)}function Ni(){let{isDataRoute:e}=h.useContext(yr);return e?wv():lv()}function lv(){co()||ft(!1);let e=h.useContext(yu),{basename:t,future:n,navigator:r}=h.useContext(Kr),{matches:o}=h.useContext(yr),{pathname:i}=ji(),l=JSON.stringify(gu(o,n.v7_relativeSplatPath)),a=h.useRef(!1);return Jh(()=>{a.current=!0}),h.useCallback(function(f,g){if(g===void 0&&(g={}),!a.current)return;if(typeof f=="number"){r.go(f);return}let x=xu(f,JSON.parse(l),i,g.relative==="path");e==null&&t!=="/"&&(x.pathname=x.pathname==="/"?t:Dr([t,x.pathname])),(g.replace?r.replace:r.push)(x,g.state,g)},[t,r,l,i,e])}function av(){let{matches:e}=h.useContext(yr),t=e[e.length-1];return t?t.params:{}}function Xh(e,t){let{relative:n}=t===void 0?{}:t,{future:r}=h.useContext(Kr),{matches:o}=h.useContext(yr),{pathname:i}=ji(),l=JSON.stringify(gu(o,r.v7_relativeSplatPath));return h.useMemo(()=>xu(e,JSON.parse(l),i,n==="path"),[e,l,i,n])}function cv(e,t){return dv(e,t)}function dv(e,t,n,r){co()||ft(!1);let{navigator:o}=h.useContext(Kr),{matches:i}=h.useContext(yr),l=i[i.length-1],a=l?l.params:{};l&&l.pathname;let d=l?l.pathnameBase:"/";l&&l.route;let f=ji(),g;if(t){var x;let w=typeof t=="string"?ao(t):t;d==="/"||(x=w.pathname)!=null&&x.startsWith(d)||ft(!1),g=w}else g=f;let b=g.pathname||"/",T=b;if(d!=="/"){let w=d.replace(/^\//,"").split("/");T="/"+b.replace(/^\//,"").split("/").slice(w.length).join("/")}let k=Oy(e,{pathname:T}),_=hv(k&&k.map(w=>Object.assign({},w,{params:Object.assign({},a,w.params),pathname:Dr([d,o.encodeLocation?o.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?d:Dr([d,o.encodeLocation?o.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),i,n,r);return t&&_?h.createElement(pa.Provider,{value:{location:mi({pathname:"/",search:"",hash:"",state:null,key:"default"},g),navigationType:Rr.Pop}},_):_}function uv(){let e=vv(),t=rv(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return h.createElement(h.Fragment,null,h.createElement("h2",null,"Unexpected Application Error!"),h.createElement("h3",{style:{fontStyle:"italic"}},t),n?h.createElement("pre",{style:o},n):null,i)}const fv=h.createElement(uv,null);class mv extends h.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?h.createElement(yr.Provider,{value:this.props.routeContext},h.createElement(Qh.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function pv(e){let{routeContext:t,match:n,children:r}=e,o=h.useContext(yu);return o&&o.static&&o.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=n.route.id),h.createElement(yr.Provider,{value:t},r)}function hv(e,t,n,r){var o;if(t===void 0&&(t=[]),n===void 0&&(n=null),r===void 0&&(r=null),e==null){var i;if(!n)return null;if(n.errors)e=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let l=e,a=(o=n)==null?void 0:o.errors;if(a!=null){let g=l.findIndex(x=>x.route.id&&(a==null?void 0:a[x.route.id])!==void 0);g>=0||ft(!1),l=l.slice(0,Math.min(l.length,g+1))}let d=!1,f=-1;if(n&&r&&r.v7_partialHydration)for(let g=0;g<l.length;g++){let x=l[g];if((x.route.HydrateFallback||x.route.hydrateFallbackElement)&&(f=g),x.route.id){let{loaderData:b,errors:T}=n,k=x.route.loader&&b[x.route.id]===void 0&&(!T||T[x.route.id]===void 0);if(x.route.lazy||k){d=!0,f>=0?l=l.slice(0,f+1):l=[l[0]];break}}}return l.reduceRight((g,x,b)=>{let T,k=!1,_=null,w=null;n&&(T=a&&x.route.id?a[x.route.id]:void 0,_=x.route.errorElement||fv,d&&(f<0&&b===0?(bv("route-fallback",!1),k=!0,w=null):f===b&&(k=!0,w=x.route.hydrateFallbackElement||null)));let m=t.concat(l.slice(0,b+1)),v=()=>{let y;return T?y=_:k?y=w:x.route.Component?y=h.createElement(x.route.Component,null):x.route.element?y=x.route.element:y=g,h.createElement(pv,{match:x,routeContext:{outlet:g,matches:m,isDataRoute:n!=null},children:y})};return n&&(x.route.ErrorBoundary||x.route.errorElement||b===0)?h.createElement(mv,{location:n.location,revalidation:n.revalidation,component:_,error:T,children:v(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):v()},null)}var Zh=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(Zh||{}),Vl=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Vl||{});function gv(e){let t=h.useContext(yu);return t||ft(!1),t}function xv(e){let t=h.useContext(ov);return t||ft(!1),t}function yv(e){let t=h.useContext(yr);return t||ft(!1),t}function eg(e){let t=yv(),n=t.matches[t.matches.length-1];return n.route.id||ft(!1),n.route.id}function vv(){var e;let t=h.useContext(Qh),n=xv(Vl.UseRouteError),r=eg(Vl.UseRouteError);return t!==void 0?t:(e=n.errors)==null?void 0:e[r]}function wv(){let{router:e}=gv(Zh.UseNavigateStable),t=eg(Vl.UseNavigateStable),n=h.useRef(!1);return Jh(()=>{n.current=!0}),h.useCallback(function(o,i){i===void 0&&(i={}),n.current&&(typeof o=="number"?e.navigate(o):e.navigate(o,mi({fromRouteId:t},i)))},[e,t])}const rm={};function bv(e,t,n){!t&&!rm[e]&&(rm[e]=!0)}function jv(e,t){e==null||e.v7_startTransition,(e==null?void 0:e.v7_relativeSplatPath)===void 0&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}function Ho(e){let{to:t,replace:n,state:r,relative:o}=e;co()||ft(!1);let{future:i,static:l}=h.useContext(Kr),{matches:a}=h.useContext(yr),{pathname:d}=ji(),f=Ni(),g=xu(t,gu(a,i.v7_relativeSplatPath),d,o==="path"),x=JSON.stringify(g);return h.useEffect(()=>f(JSON.parse(x),{replace:n,state:r,relative:o}),[f,x,o,n,r]),null}function Zt(e){ft(!1)}function Nv(e){let{basename:t="/",children:n=null,location:r,navigationType:o=Rr.Pop,navigator:i,static:l=!1,future:a}=e;co()&&ft(!1);let d=t.replace(/^\/*/,"/"),f=h.useMemo(()=>({basename:d,navigator:i,static:l,future:mi({v7_relativeSplatPath:!1},a)}),[d,a,i,l]);typeof r=="string"&&(r=ao(r));let{pathname:g="/",search:x="",hash:b="",state:T=null,key:k="default"}=r,_=h.useMemo(()=>{let w=hu(g,d);return w==null?null:{location:{pathname:w,search:x,hash:b,state:T,key:k},navigationType:o}},[d,g,x,b,T,k,o]);return _==null?null:h.createElement(Kr.Provider,{value:f},h.createElement(pa.Provider,{children:n,value:_}))}function sm(e){let{children:t,location:n}=e;return cv(nd(t),n)}new Promise(()=>{});function nd(e,t){t===void 0&&(t=[]);let n=[];return h.Children.forEach(e,(r,o)=>{if(!h.isValidElement(r))return;let i=[...t,o];if(r.type===h.Fragment){n.push.apply(n,nd(r.props.children,i));return}r.type!==Zt&&ft(!1),!r.props.index||!r.props.children||ft(!1);let l={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=nd(r.props.children,i)),n.push(l)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rd(){return rd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},rd.apply(this,arguments)}function kv(e,t){if(e==null)return{};var n={},r=Object.keys(e),o,i;for(i=0;i<r.length;i++)o=r[i],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}function Sv(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Cv(e,t){return e.button===0&&(!t||t==="_self")&&!Sv(e)}const Ev=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Iv="6";try{window.__reactRouterVersion=Iv}catch{}const Tv="startTransition",om=j0[Tv];function _v(e){let{basename:t,children:n,future:r,window:o}=e,i=h.useRef();i.current==null&&(i.current=Py({window:o,v5Compat:!0}));let l=i.current,[a,d]=h.useState({action:l.action,location:l.location}),{v7_startTransition:f}=r||{},g=h.useCallback(x=>{f&&om?om(()=>d(x)):d(x)},[d,f]);return h.useLayoutEffect(()=>l.listen(g),[l,g]),h.useEffect(()=>jv(r),[r]),h.createElement(Nv,{basename:t,children:n,location:a.location,navigationType:a.action,navigator:l,future:r})}const Mv=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Rv=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Gl=h.forwardRef(function(t,n){let{onClick:r,relative:o,reloadDocument:i,replace:l,state:a,target:d,to:f,preventScrollReset:g,viewTransition:x}=t,b=kv(t,Ev),{basename:T}=h.useContext(Kr),k,_=!1;if(typeof f=="string"&&Rv.test(f)&&(k=f,Mv))try{let y=new URL(window.location.href),M=f.startsWith("//")?new URL(y.protocol+f):new URL(f),L=hu(M.pathname,T);M.origin===y.origin&&L!=null?f=L+M.search+M.hash:_=!0}catch{}let w=iv(f,{relative:o}),m=Av(f,{replace:l,state:a,target:d,preventScrollReset:g,relative:o,viewTransition:x});function v(y){r&&r(y),y.defaultPrevented||m(y)}return h.createElement("a",rd({},b,{href:k||w,onClick:_||i?r:v,ref:n,target:d}))});var im;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(im||(im={}));var lm;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(lm||(lm={}));function Av(e,t){let{target:n,replace:r,state:o,preventScrollReset:i,relative:l,viewTransition:a}=t===void 0?{}:t,d=Ni(),f=ji(),g=Xh(e,{relative:l});return h.useCallback(x=>{if(Cv(x,n)){x.preventDefault();let b=r!==void 0?r:Dl(f)===Dl(g);d(e,{replace:b,state:o,preventScrollReset:i,relative:l,viewTransition:a})}},[f,d,g,r,o,n,e,i,l,a])}let Pv={data:""},Lv=e=>typeof window=="object"?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||Pv,Uv=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Ov=/\/\*[^]*?\*\/|  +/g,am=/\n+/g,Tr=(e,t)=>{let n="",r="",o="";for(let i in e){let l=e[i];i[0]=="@"?i[1]=="i"?n=i+" "+l+";":r+=i[1]=="f"?Tr(l,i):i+"{"+Tr(l,i[1]=="k"?"":t)+"}":typeof l=="object"?r+=Tr(l,t?t.replace(/([^,])+/g,a=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,d=>/&/.test(d)?d.replace(/&/g,a):a?a+" "+d:d)):i):l!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),o+=Tr.p?Tr.p(i,l):i+":"+l+";")}return n+(t&&o?t+"{"+o+"}":o)+r},rr={},tg=e=>{if(typeof e=="object"){let t="";for(let n in e)t+=n+tg(e[n]);return t}return e},$v=(e,t,n,r,o)=>{let i=tg(e),l=rr[i]||(rr[i]=(d=>{let f=0,g=11;for(;f<d.length;)g=101*g+d.charCodeAt(f++)>>>0;return"go"+g})(i));if(!rr[l]){let d=i!==e?e:(f=>{let g,x,b=[{}];for(;g=Uv.exec(f.replace(Ov,""));)g[4]?b.shift():g[3]?(x=g[3].replace(am," ").trim(),b.unshift(b[0][x]=b[0][x]||{})):b[0][g[1]]=g[2].replace(am," ").trim();return b[0]})(e);rr[l]=Tr(o?{["@keyframes "+l]:d}:d,n?"":"."+l)}let a=n&&rr.g?rr.g:null;return n&&(rr.g=rr[l]),((d,f,g,x)=>{x?f.data=f.data.replace(x,d):f.data.indexOf(d)===-1&&(f.data=g?d+f.data:f.data+d)})(rr[l],t,r,a),l},Fv=(e,t,n)=>e.reduce((r,o,i)=>{let l=t[i];if(l&&l.call){let a=l(n),d=a&&a.props&&a.props.className||/^go/.test(a)&&a;l=d?"."+d:a&&typeof a=="object"?a.props?"":Tr(a,""):a===!1?"":a}return r+o+(l??"")},"");function ha(e){let t=this||{},n=e.call?e(t.p):e;return $v(n.unshift?n.raw?Fv(n,[].slice.call(arguments,1),t.p):n.reduce((r,o)=>Object.assign(r,o&&o.call?o(t.p):o),{}):n,Lv(t.target),t.g,t.o,t.k)}let ng,sd,od;ha.bind({g:1});let gr=ha.bind({k:1});function zv(e,t,n,r){Tr.p=t,ng=e,sd=n,od=r}function Qr(e,t){let n=this||{};return function(){let r=arguments;function o(i,l){let a=Object.assign({},i),d=a.className||o.className;n.p=Object.assign({theme:sd&&sd()},a),n.o=/ *go\d+/.test(d),a.className=ha.apply(n,r)+(d?" "+d:""),t&&(a.ref=l);let f=e;return e[0]&&(f=a.as||e,delete a.as),od&&f[0]&&od(a),ng(f,a)}return t?t(o):o}}var Bv=e=>typeof e=="function",Hl=(e,t)=>Bv(e)?e(t):e,Dv=(()=>{let e=0;return()=>(++e).toString()})(),rg=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),Vv=20,vu="default",sg=(e,t)=>{let{toastLimit:n}=e.settings;switch(t.type){case 0:return{...e,toasts:[t.toast,...e.toasts].slice(0,n)};case 1:return{...e,toasts:e.toasts.map(l=>l.id===t.toast.id?{...l,...t.toast}:l)};case 2:let{toast:r}=t;return sg(e,{type:e.toasts.find(l=>l.id===r.id)?1:0,toast:r});case 3:let{toastId:o}=t;return{...e,toasts:e.toasts.map(l=>l.id===o||o===void 0?{...l,dismissed:!0,visible:!1}:l)};case 4:return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(l=>l.id!==t.toastId)};case 5:return{...e,pausedAt:t.time};case 6:let i=t.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map(l=>({...l,pauseDuration:l.pauseDuration+i}))}}},dl=[],og={toasts:[],pausedAt:void 0,settings:{toastLimit:Vv}},Yn={},ig=(e,t=vu)=>{Yn[t]=sg(Yn[t]||og,e),dl.forEach(([n,r])=>{n===t&&r(Yn[t])})},lg=e=>Object.keys(Yn).forEach(t=>ig(e,t)),Gv=e=>Object.keys(Yn).find(t=>Yn[t].toasts.some(n=>n.id===e)),ga=(e=vu)=>t=>{ig(t,e)},Hv={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Wv=(e={},t=vu)=>{let[n,r]=h.useState(Yn[t]||og),o=h.useRef(Yn[t]);h.useEffect(()=>(o.current!==Yn[t]&&r(Yn[t]),dl.push([t,r]),()=>{let l=dl.findIndex(([a])=>a===t);l>-1&&dl.splice(l,1)}),[t]);let i=n.toasts.map(l=>{var a,d,f;return{...e,...e[l.type],...l,removeDelay:l.removeDelay||((a=e[l.type])==null?void 0:a.removeDelay)||(e==null?void 0:e.removeDelay),duration:l.duration||((d=e[l.type])==null?void 0:d.duration)||(e==null?void 0:e.duration)||Hv[l.type],style:{...e.style,...(f=e[l.type])==null?void 0:f.style,...l.style}}});return{...n,toasts:i}},qv=(e,t="blank",n)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...n,id:(n==null?void 0:n.id)||Dv()}),ki=e=>(t,n)=>{let r=qv(t,e,n);return ga(r.toasterId||Gv(r.id))({type:2,toast:r}),r.id},H=(e,t)=>ki("blank")(e,t);H.error=ki("error");H.success=ki("success");H.loading=ki("loading");H.custom=ki("custom");H.dismiss=(e,t)=>{let n={type:3,toastId:e};t?ga(t)(n):lg(n)};H.dismissAll=e=>H.dismiss(void 0,e);H.remove=(e,t)=>{let n={type:4,toastId:e};t?ga(t)(n):lg(n)};H.removeAll=e=>H.remove(void 0,e);H.promise=(e,t,n)=>{let r=H.loading(t.loading,{...n,...n==null?void 0:n.loading});return typeof e=="function"&&(e=e()),e.then(o=>{let i=t.success?Hl(t.success,o):void 0;return i?H.success(i,{id:r,...n,...n==null?void 0:n.success}):H.dismiss(r),o}).catch(o=>{let i=t.error?Hl(t.error,o):void 0;i?H.error(i,{id:r,...n,...n==null?void 0:n.error}):H.dismiss(r)}),e};var Yv=1e3,Kv=(e,t="default")=>{let{toasts:n,pausedAt:r}=Wv(e,t),o=h.useRef(new Map).current,i=h.useCallback((x,b=Yv)=>{if(o.has(x))return;let T=setTimeout(()=>{o.delete(x),l({type:4,toastId:x})},b);o.set(x,T)},[]);h.useEffect(()=>{if(r)return;let x=Date.now(),b=n.map(T=>{if(T.duration===1/0)return;let k=(T.duration||0)+T.pauseDuration-(x-T.createdAt);if(k<0){T.visible&&H.dismiss(T.id);return}return setTimeout(()=>H.dismiss(T.id,t),k)});return()=>{b.forEach(T=>T&&clearTimeout(T))}},[n,r,t]);let l=h.useCallback(ga(t),[t]),a=h.useCallback(()=>{l({type:5,time:Date.now()})},[l]),d=h.useCallback((x,b)=>{l({type:1,toast:{id:x,height:b}})},[l]),f=h.useCallback(()=>{r&&l({type:6,time:Date.now()})},[r,l]),g=h.useCallback((x,b)=>{let{reverseOrder:T=!1,gutter:k=8,defaultPosition:_}=b||{},w=n.filter(y=>(y.position||_)===(x.position||_)&&y.height),m=w.findIndex(y=>y.id===x.id),v=w.filter((y,M)=>M<m&&y.visible).length;return w.filter(y=>y.visible).slice(...T?[v+1]:[0,v]).reduce((y,M)=>y+(M.height||0)+k,0)},[n]);return h.useEffect(()=>{n.forEach(x=>{if(x.dismissed)i(x.id,x.removeDelay);else{let b=o.get(x.id);b&&(clearTimeout(b),o.delete(x.id))}})},[n,i]),{toasts:n,handlers:{updateHeight:d,startPause:a,endPause:f,calculateOffset:g}}},Qv=gr`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Jv=gr`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Xv=gr`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Zv=Qr("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Qv} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Jv} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${e=>e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Xv} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,e1=gr`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,t1=Qr("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${e=>e.secondary||"#e0e0e0"};
  border-right-color: ${e=>e.primary||"#616161"};
  animation: ${e1} 1s linear infinite;
`,n1=gr`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,r1=gr`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,s1=Qr("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${n1} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${r1} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${e=>e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,o1=Qr("div")`
  position: absolute;
`,i1=Qr("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,l1=gr`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,a1=Qr("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${l1} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,c1=({toast:e})=>{let{icon:t,type:n,iconTheme:r}=e;return t!==void 0?typeof t=="string"?h.createElement(a1,null,t):t:n==="blank"?null:h.createElement(i1,null,h.createElement(t1,{...r}),n!=="loading"&&h.createElement(o1,null,n==="error"?h.createElement(Zv,{...r}):h.createElement(s1,{...r})))},d1=e=>`
0% {transform: translate3d(0,${e*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,u1=e=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${e*-150}%,-1px) scale(.6); opacity:0;}
`,f1="0%{opacity:0;} 100%{opacity:1;}",m1="0%{opacity:1;} 100%{opacity:0;}",p1=Qr("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,h1=Qr("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,g1=(e,t)=>{let n=e.includes("top")?1:-1,[r,o]=rg()?[f1,m1]:[d1(n),u1(n)];return{animation:t?`${gr(r)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${gr(o)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},x1=h.memo(({toast:e,position:t,style:n,children:r})=>{let o=e.height?g1(e.position||t||"top-center",e.visible):{opacity:0},i=h.createElement(c1,{toast:e}),l=h.createElement(h1,{...e.ariaProps},Hl(e.message,e));return h.createElement(p1,{className:e.className,style:{...o,...n,...e.style}},typeof r=="function"?r({icon:i,message:l}):h.createElement(h.Fragment,null,i,l))});zv(h.createElement);var y1=({id:e,className:t,style:n,onHeightUpdate:r,children:o})=>{let i=h.useCallback(l=>{if(l){let a=()=>{let d=l.getBoundingClientRect().height;r(e,d)};a(),new MutationObserver(a).observe(l,{subtree:!0,childList:!0,characterData:!0})}},[e,r]);return h.createElement("div",{ref:i,className:t,style:n},o)},v1=(e,t)=>{let n=e.includes("top"),r=n?{top:0}:{bottom:0},o=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:rg()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(n?1:-1)}px)`,...r,...o}},w1=ha`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Yi=16,b1=({reverseOrder:e,position:t="top-center",toastOptions:n,gutter:r,children:o,toasterId:i,containerStyle:l,containerClassName:a})=>{let{toasts:d,handlers:f}=Kv(n,i);return h.createElement("div",{"data-rht-toaster":i||"",style:{position:"fixed",zIndex:9999,top:Yi,left:Yi,right:Yi,bottom:Yi,pointerEvents:"none",...l},className:a,onMouseEnter:f.startPause,onMouseLeave:f.endPause},d.map(g=>{let x=g.position||t,b=f.calculateOffset(g,{reverseOrder:e,gutter:r,defaultPosition:t}),T=v1(x,b);return h.createElement(y1,{id:g.id,key:g.id,onHeightUpdate:f.updateHeight,className:g.visible?w1:"",style:T},g.type==="custom"?Hl(g.message,g):o?o(g):h.createElement(x1,{toast:g,position:x}))}))};function ag(e,t){return function(){return e.apply(t,arguments)}}const{toString:j1}=Object.prototype,{getPrototypeOf:wu}=Object,{iterator:xa,toStringTag:cg}=Symbol,ya=(e=>t=>{const n=j1.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),$n=e=>(e=e.toLowerCase(),t=>ya(t)===e),va=e=>t=>typeof t===e,{isArray:uo}=Array,so=va("undefined");function Si(e){return e!==null&&!so(e)&&e.constructor!==null&&!so(e.constructor)&&on(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const dg=$n("ArrayBuffer");function N1(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&dg(e.buffer),t}const k1=va("string"),on=va("function"),ug=va("number"),Ci=e=>e!==null&&typeof e=="object",S1=e=>e===!0||e===!1,ul=e=>{if(ya(e)!=="object")return!1;const t=wu(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(cg in e)&&!(xa in e)},C1=e=>{if(!Ci(e)||Si(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},E1=$n("Date"),I1=$n("File"),T1=$n("Blob"),_1=$n("FileList"),M1=e=>Ci(e)&&on(e.pipe),R1=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||on(e.append)&&((t=ya(e))==="formdata"||t==="object"&&on(e.toString)&&e.toString()==="[object FormData]"))},A1=$n("URLSearchParams"),[P1,L1,U1,O1]=["ReadableStream","Request","Response","Headers"].map($n),$1=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ei(e,t,{allOwnKeys:n=!1}={}){if(e===null||typeof e>"u")return;let r,o;if(typeof e!="object"&&(e=[e]),uo(e))for(r=0,o=e.length;r<o;r++)t.call(null,e[r],r,e);else{if(Si(e))return;const i=n?Object.getOwnPropertyNames(e):Object.keys(e),l=i.length;let a;for(r=0;r<l;r++)a=i[r],t.call(null,e[a],a,e)}}function fg(e,t){if(Si(e))return null;t=t.toLowerCase();const n=Object.keys(e);let r=n.length,o;for(;r-- >0;)if(o=n[r],t===o.toLowerCase())return o;return null}const ds=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),mg=e=>!so(e)&&e!==ds;function id(){const{caseless:e,skipUndefined:t}=mg(this)&&this||{},n={},r=(o,i)=>{const l=e&&fg(n,i)||i;ul(n[l])&&ul(o)?n[l]=id(n[l],o):ul(o)?n[l]=id({},o):uo(o)?n[l]=o.slice():(!t||!so(o))&&(n[l]=o)};for(let o=0,i=arguments.length;o<i;o++)arguments[o]&&Ei(arguments[o],r);return n}const F1=(e,t,n,{allOwnKeys:r}={})=>(Ei(t,(o,i)=>{n&&on(o)?e[i]=ag(o,n):e[i]=o},{allOwnKeys:r}),e),z1=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),B1=(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},D1=(e,t,n,r)=>{let o,i,l;const a={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),i=o.length;i-- >0;)l=o[i],(!r||r(l,e,t))&&!a[l]&&(t[l]=e[l],a[l]=!0);e=n!==!1&&wu(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},V1=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},G1=e=>{if(!e)return null;if(uo(e))return e;let t=e.length;if(!ug(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},H1=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&wu(Uint8Array)),W1=(e,t)=>{const r=(e&&e[xa]).call(e);let o;for(;(o=r.next())&&!o.done;){const i=o.value;t.call(e,i[0],i[1])}},q1=(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},Y1=$n("HTMLFormElement"),K1=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,o){return r.toUpperCase()+o}),cm=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),Q1=$n("RegExp"),pg=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};Ei(n,(o,i)=>{let l;(l=t(o,i,e))!==!1&&(r[i]=l||o)}),Object.defineProperties(e,r)},J1=e=>{pg(e,(t,n)=>{if(on(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];if(on(r)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},X1=(e,t)=>{const n={},r=o=>{o.forEach(i=>{n[i]=!0})};return uo(e)?r(e):r(String(e).split(t)),n},Z1=()=>{},ew=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function tw(e){return!!(e&&on(e.append)&&e[cg]==="FormData"&&e[xa])}const nw=e=>{const t=new Array(10),n=(r,o)=>{if(Ci(r)){if(t.indexOf(r)>=0)return;if(Si(r))return r;if(!("toJSON"in r)){t[o]=r;const i=uo(r)?[]:{};return Ei(r,(l,a)=>{const d=n(l,o+1);!so(d)&&(i[a]=d)}),t[o]=void 0,i}}return r};return n(e,0)},rw=$n("AsyncFunction"),sw=e=>e&&(Ci(e)||on(e))&&on(e.then)&&on(e.catch),hg=((e,t)=>e?setImmediate:t?((n,r)=>(ds.addEventListener("message",({source:o,data:i})=>{o===ds&&i===n&&r.length&&r.shift()()},!1),o=>{r.push(o),ds.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",on(ds.postMessage)),ow=typeof queueMicrotask<"u"?queueMicrotask.bind(ds):typeof process<"u"&&process.nextTick||hg,iw=e=>e!=null&&on(e[xa]),z={isArray:uo,isArrayBuffer:dg,isBuffer:Si,isFormData:R1,isArrayBufferView:N1,isString:k1,isNumber:ug,isBoolean:S1,isObject:Ci,isPlainObject:ul,isEmptyObject:C1,isReadableStream:P1,isRequest:L1,isResponse:U1,isHeaders:O1,isUndefined:so,isDate:E1,isFile:I1,isBlob:T1,isRegExp:Q1,isFunction:on,isStream:M1,isURLSearchParams:A1,isTypedArray:H1,isFileList:_1,forEach:Ei,merge:id,extend:F1,trim:$1,stripBOM:z1,inherits:B1,toFlatObject:D1,kindOf:ya,kindOfTest:$n,endsWith:V1,toArray:G1,forEachEntry:W1,matchAll:q1,isHTMLForm:Y1,hasOwnProperty:cm,hasOwnProp:cm,reduceDescriptors:pg,freezeMethods:J1,toObjectSet:X1,toCamelCase:K1,noop:Z1,toFiniteNumber:ew,findKey:fg,global:ds,isContextDefined:mg,isSpecCompliantForm:tw,toJSONObject:nw,isAsyncFn:rw,isThenable:sw,setImmediate:hg,asap:ow,isIterable:iw};function Te(e,t,n,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),o&&(this.response=o,this.status=o.status?o.status:null)}z.inherits(Te,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:z.toJSONObject(this.config),code:this.code,status:this.status}}});const gg=Te.prototype,xg={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{xg[e]={value:e}});Object.defineProperties(Te,xg);Object.defineProperty(gg,"isAxiosError",{value:!0});Te.from=(e,t,n,r,o,i)=>{const l=Object.create(gg);z.toFlatObject(e,l,function(g){return g!==Error.prototype},f=>f!=="isAxiosError");const a=e&&e.message?e.message:"Error",d=t==null&&e?e.code:t;return Te.call(l,a,d,n,r,o),e&&l.cause==null&&Object.defineProperty(l,"cause",{value:e,configurable:!0}),l.name=e&&e.name||"Error",i&&Object.assign(l,i),l};const lw=null;function ld(e){return z.isPlainObject(e)||z.isArray(e)}function yg(e){return z.endsWith(e,"[]")?e.slice(0,-2):e}function dm(e,t,n){return e?e.concat(t).map(function(o,i){return o=yg(o),!n&&i?"["+o+"]":o}).join(n?".":""):t}function aw(e){return z.isArray(e)&&!e.some(ld)}const cw=z.toFlatObject(z,{},null,function(t){return/^is[A-Z]/.test(t)});function wa(e,t,n){if(!z.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=z.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,w){return!z.isUndefined(w[_])});const r=n.metaTokens,o=n.visitor||g,i=n.dots,l=n.indexes,d=(n.Blob||typeof Blob<"u"&&Blob)&&z.isSpecCompliantForm(t);if(!z.isFunction(o))throw new TypeError("visitor must be a function");function f(k){if(k===null)return"";if(z.isDate(k))return k.toISOString();if(z.isBoolean(k))return k.toString();if(!d&&z.isBlob(k))throw new Te("Blob is not supported. Use a Buffer instead.");return z.isArrayBuffer(k)||z.isTypedArray(k)?d&&typeof Blob=="function"?new Blob([k]):Buffer.from(k):k}function g(k,_,w){let m=k;if(k&&!w&&typeof k=="object"){if(z.endsWith(_,"{}"))_=r?_:_.slice(0,-2),k=JSON.stringify(k);else if(z.isArray(k)&&aw(k)||(z.isFileList(k)||z.endsWith(_,"[]"))&&(m=z.toArray(k)))return _=yg(_),m.forEach(function(y,M){!(z.isUndefined(y)||y===null)&&t.append(l===!0?dm([_],M,i):l===null?_:_+"[]",f(y))}),!1}return ld(k)?!0:(t.append(dm(w,_,i),f(k)),!1)}const x=[],b=Object.assign(cw,{defaultVisitor:g,convertValue:f,isVisitable:ld});function T(k,_){if(!z.isUndefined(k)){if(x.indexOf(k)!==-1)throw Error("Circular reference detected in "+_.join("."));x.push(k),z.forEach(k,function(m,v){(!(z.isUndefined(m)||m===null)&&o.call(t,m,z.isString(v)?v.trim():v,_,b))===!0&&T(m,_?_.concat(v):[v])}),x.pop()}}if(!z.isObject(e))throw new TypeError("data must be an object");return T(e),t}function um(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function bu(e,t){this._pairs=[],e&&wa(e,this,t)}const vg=bu.prototype;vg.append=function(t,n){this._pairs.push([t,n])};vg.toString=function(t){const n=t?function(r){return t.call(this,r,um)}:um;return this._pairs.map(function(o){return n(o[0])+"="+n(o[1])},"").join("&")};function dw(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function wg(e,t,n){if(!t)return e;const r=n&&n.encode||dw;z.isFunction(n)&&(n={serialize:n});const o=n&&n.serialize;let i;if(o?i=o(t,n):i=z.isURLSearchParams(t)?t.toString():new bu(t,n).toString(r),i){const l=e.indexOf("#");l!==-1&&(e=e.slice(0,l)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e}class uw{constructor(){this.handlers=[]}use(t,n,r){return this.handlers.push({fulfilled:t,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){z.forEach(this.handlers,function(r){r!==null&&t(r)})}}const fm=uw,bg={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},fw=typeof URLSearchParams<"u"?URLSearchParams:bu,mw=typeof FormData<"u"?FormData:null,pw=typeof Blob<"u"?Blob:null,hw={isBrowser:!0,classes:{URLSearchParams:fw,FormData:mw,Blob:pw},protocols:["http","https","file","blob","url","data"]},ju=typeof window<"u"&&typeof document<"u",ad=typeof navigator=="object"&&navigator||void 0,gw=ju&&(!ad||["ReactNative","NativeScript","NS"].indexOf(ad.product)<0),xw=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),yw=ju&&window.location.href||"http://localhost",vw=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ju,hasStandardBrowserEnv:gw,hasStandardBrowserWebWorkerEnv:xw,navigator:ad,origin:yw},Symbol.toStringTag,{value:"Module"})),$t={...vw,...hw};function ww(e,t){return wa(e,new $t.classes.URLSearchParams,{visitor:function(n,r,o,i){return $t.isNode&&z.isBuffer(n)?(this.append(r,n.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...t})}function bw(e){return z.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function jw(e){const t={},n=Object.keys(e);let r;const o=n.length;let i;for(r=0;r<o;r++)i=n[r],t[i]=e[i];return t}function jg(e){function t(n,r,o,i){let l=n[i++];if(l==="__proto__")return!0;const a=Number.isFinite(+l),d=i>=n.length;return l=!l&&z.isArray(o)?o.length:l,d?(z.hasOwnProp(o,l)?o[l]=[o[l],r]:o[l]=r,!a):((!o[l]||!z.isObject(o[l]))&&(o[l]=[]),t(n,r,o[l],i)&&z.isArray(o[l])&&(o[l]=jw(o[l])),!a)}if(z.isFormData(e)&&z.isFunction(e.entries)){const n={};return z.forEachEntry(e,(r,o)=>{t(bw(r),o,n,0)}),n}return null}function Nw(e,t,n){if(z.isString(e))try{return(t||JSON.parse)(e),z.trim(e)}catch(r){if(r.name!=="SyntaxError")throw r}return(n||JSON.stringify)(e)}const Nu={transitional:bg,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const r=n.getContentType()||"",o=r.indexOf("application/json")>-1,i=z.isObject(t);if(i&&z.isHTMLForm(t)&&(t=new FormData(t)),z.isFormData(t))return o?JSON.stringify(jg(t)):t;if(z.isArrayBuffer(t)||z.isBuffer(t)||z.isStream(t)||z.isFile(t)||z.isBlob(t)||z.isReadableStream(t))return t;if(z.isArrayBufferView(t))return t.buffer;if(z.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return ww(t,this.formSerializer).toString();if((a=z.isFileList(t))||r.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return wa(a?{"files[]":t}:t,d&&new d,this.formSerializer)}}return i||o?(n.setContentType("application/json",!1),Nw(t)):t}],transformResponse:[function(t){const n=this.transitional||Nu.transitional,r=n&&n.forcedJSONParsing,o=this.responseType==="json";if(z.isResponse(t)||z.isReadableStream(t))return t;if(t&&z.isString(t)&&(r&&!this.responseType||o)){const l=!(n&&n.silentJSONParsing)&&o;try{return JSON.parse(t,this.parseReviver)}catch(a){if(l)throw a.name==="SyntaxError"?Te.from(a,Te.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:$t.classes.FormData,Blob:$t.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};z.forEach(["delete","get","head","post","put","patch"],e=>{Nu.headers[e]={}});const ku=Nu,kw=z.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Sw=e=>{const t={};let n,r,o;return e&&e.split(`
`).forEach(function(l){o=l.indexOf(":"),n=l.substring(0,o).trim().toLowerCase(),r=l.substring(o+1).trim(),!(!n||t[n]&&kw[n])&&(n==="set-cookie"?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t},mm=Symbol("internals");function To(e){return e&&String(e).trim().toLowerCase()}function fl(e){return e===!1||e==null?e:z.isArray(e)?e.map(fl):String(e)}function Cw(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}const Ew=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function tc(e,t,n,r,o){if(z.isFunction(r))return r.call(this,t,n);if(o&&(t=n),!!z.isString(t)){if(z.isString(r))return t.indexOf(r)!==-1;if(z.isRegExp(r))return r.test(t)}}function Iw(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,r)=>n.toUpperCase()+r)}function Tw(e,t){const n=z.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(o,i,l){return this[r].call(this,t,o,i,l)},configurable:!0})})}class ba{constructor(t){t&&this.set(t)}set(t,n,r){const o=this;function i(a,d,f){const g=To(d);if(!g)throw new Error("header name must be a non-empty string");const x=z.findKey(o,g);(!x||o[x]===void 0||f===!0||f===void 0&&o[x]!==!1)&&(o[x||d]=fl(a))}const l=(a,d)=>z.forEach(a,(f,g)=>i(f,g,d));if(z.isPlainObject(t)||t instanceof this.constructor)l(t,n);else if(z.isString(t)&&(t=t.trim())&&!Ew(t))l(Sw(t),n);else if(z.isObject(t)&&z.isIterable(t)){let a={},d,f;for(const g of t){if(!z.isArray(g))throw TypeError("Object iterator must return a key-value pair");a[f=g[0]]=(d=a[f])?z.isArray(d)?[...d,g[1]]:[d,g[1]]:g[1]}l(a,n)}else t!=null&&i(n,t,r);return this}get(t,n){if(t=To(t),t){const r=z.findKey(this,t);if(r){const o=this[r];if(!n)return o;if(n===!0)return Cw(o);if(z.isFunction(n))return n.call(this,o,r);if(z.isRegExp(n))return n.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=To(t),t){const r=z.findKey(this,t);return!!(r&&this[r]!==void 0&&(!n||tc(this,this[r],r,n)))}return!1}delete(t,n){const r=this;let o=!1;function i(l){if(l=To(l),l){const a=z.findKey(r,l);a&&(!n||tc(r,r[a],a,n))&&(delete r[a],o=!0)}}return z.isArray(t)?t.forEach(i):i(t),o}clear(t){const n=Object.keys(this);let r=n.length,o=!1;for(;r--;){const i=n[r];(!t||tc(this,this[i],i,t,!0))&&(delete this[i],o=!0)}return o}normalize(t){const n=this,r={};return z.forEach(this,(o,i)=>{const l=z.findKey(r,i);if(l){n[l]=fl(o),delete n[i];return}const a=t?Iw(i):String(i).trim();a!==i&&delete n[i],n[a]=fl(o),r[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return z.forEach(this,(r,o)=>{r!=null&&r!==!1&&(n[o]=t&&z.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const r=new this(t);return n.forEach(o=>r.set(o)),r}static accessor(t){const r=(this[mm]=this[mm]={accessors:{}}).accessors,o=this.prototype;function i(l){const a=To(l);r[a]||(Tw(o,l),r[a]=!0)}return z.isArray(t)?t.forEach(i):i(t),this}}ba.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);z.reduceDescriptors(ba.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(r){this[n]=r}}});z.freezeMethods(ba);const Ln=ba;function nc(e,t){const n=this||ku,r=t||n,o=Ln.from(r.headers);let i=r.data;return z.forEach(e,function(a){i=a.call(n,i,o.normalize(),t?t.status:void 0)}),o.normalize(),i}function Ng(e){return!!(e&&e.__CANCEL__)}function fo(e,t,n){Te.call(this,e??"canceled",Te.ERR_CANCELED,t,n),this.name="CanceledError"}z.inherits(fo,Te,{__CANCEL__:!0});function kg(e,t,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?e(n):t(new Te("Request failed with status code "+n.status,[Te.ERR_BAD_REQUEST,Te.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function _w(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function Mw(e,t){e=e||10;const n=new Array(e),r=new Array(e);let o=0,i=0,l;return t=t!==void 0?t:1e3,function(d){const f=Date.now(),g=r[i];l||(l=f),n[o]=d,r[o]=f;let x=i,b=0;for(;x!==o;)b+=n[x++],x=x%e;if(o=(o+1)%e,o===i&&(i=(i+1)%e),f-l<t)return;const T=g&&f-g;return T?Math.round(b*1e3/T):void 0}}function Rw(e,t){let n=0,r=1e3/t,o,i;const l=(f,g=Date.now())=>{n=g,o=null,i&&(clearTimeout(i),i=null),e(...f)};return[(...f)=>{const g=Date.now(),x=g-n;x>=r?l(f,g):(o=f,i||(i=setTimeout(()=>{i=null,l(o)},r-x)))},()=>o&&l(o)]}const Wl=(e,t,n=3)=>{let r=0;const o=Mw(50,250);return Rw(i=>{const l=i.loaded,a=i.lengthComputable?i.total:void 0,d=l-r,f=o(d),g=l<=a;r=l;const x={loaded:l,total:a,progress:a?l/a:void 0,bytes:d,rate:f||void 0,estimated:f&&a&&g?(a-l)/f:void 0,event:i,lengthComputable:a!=null,[t?"download":"upload"]:!0};e(x)},n)},pm=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},hm=e=>(...t)=>z.asap(()=>e(...t)),Aw=$t.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,$t.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL($t.origin),$t.navigator&&/(msie|trident)/i.test($t.navigator.userAgent)):()=>!0,Pw=$t.hasStandardBrowserEnv?{write(e,t,n,r,o,i){const l=[e+"="+encodeURIComponent(t)];z.isNumber(n)&&l.push("expires="+new Date(n).toGMTString()),z.isString(r)&&l.push("path="+r),z.isString(o)&&l.push("domain="+o),i===!0&&l.push("secure"),document.cookie=l.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Lw(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Uw(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function Sg(e,t,n){let r=!Lw(t);return e&&(r||n==!1)?Uw(e,t):t}const gm=e=>e instanceof Ln?{...e}:e;function vs(e,t){t=t||{};const n={};function r(f,g,x,b){return z.isPlainObject(f)&&z.isPlainObject(g)?z.merge.call({caseless:b},f,g):z.isPlainObject(g)?z.merge({},g):z.isArray(g)?g.slice():g}function o(f,g,x,b){if(z.isUndefined(g)){if(!z.isUndefined(f))return r(void 0,f,x,b)}else return r(f,g,x,b)}function i(f,g){if(!z.isUndefined(g))return r(void 0,g)}function l(f,g){if(z.isUndefined(g)){if(!z.isUndefined(f))return r(void 0,f)}else return r(void 0,g)}function a(f,g,x){if(x in t)return r(f,g);if(x in e)return r(void 0,f)}const d={url:i,method:i,data:i,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:a,headers:(f,g,x)=>o(gm(f),gm(g),x,!0)};return z.forEach(Object.keys({...e,...t}),function(g){const x=d[g]||o,b=x(e[g],t[g],g);z.isUndefined(b)&&x!==a||(n[g]=b)}),n}const Cg=e=>{const t=vs({},e);let{data:n,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:i,headers:l,auth:a}=t;if(t.headers=l=Ln.from(l),t.url=wg(Sg(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),a&&l.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),z.isFormData(n)){if($t.hasStandardBrowserEnv||$t.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(z.isFunction(n.getHeaders)){const d=n.getHeaders(),f=["content-type","content-length"];Object.entries(d).forEach(([g,x])=>{f.includes(g.toLowerCase())&&l.set(g,x)})}}if($t.hasStandardBrowserEnv&&(r&&z.isFunction(r)&&(r=r(t)),r||r!==!1&&Aw(t.url))){const d=o&&i&&Pw.read(i);d&&l.set(o,d)}return t},Ow=typeof XMLHttpRequest<"u",$w=Ow&&function(e){return new Promise(function(n,r){const o=Cg(e);let i=o.data;const l=Ln.from(o.headers).normalize();let{responseType:a,onUploadProgress:d,onDownloadProgress:f}=o,g,x,b,T,k;function _(){T&&T(),k&&k(),o.cancelToken&&o.cancelToken.unsubscribe(g),o.signal&&o.signal.removeEventListener("abort",g)}let w=new XMLHttpRequest;w.open(o.method.toUpperCase(),o.url,!0),w.timeout=o.timeout;function m(){if(!w)return;const y=Ln.from("getAllResponseHeaders"in w&&w.getAllResponseHeaders()),L={data:!a||a==="text"||a==="json"?w.responseText:w.response,status:w.status,statusText:w.statusText,headers:y,config:e,request:w};kg(function(U){n(U),_()},function(U){r(U),_()},L),w=null}"onloadend"in w?w.onloadend=m:w.onreadystatechange=function(){!w||w.readyState!==4||w.status===0&&!(w.responseURL&&w.responseURL.indexOf("file:")===0)||setTimeout(m)},w.onabort=function(){w&&(r(new Te("Request aborted",Te.ECONNABORTED,e,w)),w=null)},w.onerror=function(M){const L=M&&M.message?M.message:"Network Error",O=new Te(L,Te.ERR_NETWORK,e,w);O.event=M||null,r(O),w=null},w.ontimeout=function(){let M=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const L=o.transitional||bg;o.timeoutErrorMessage&&(M=o.timeoutErrorMessage),r(new Te(M,L.clarifyTimeoutError?Te.ETIMEDOUT:Te.ECONNABORTED,e,w)),w=null},i===void 0&&l.setContentType(null),"setRequestHeader"in w&&z.forEach(l.toJSON(),function(M,L){w.setRequestHeader(L,M)}),z.isUndefined(o.withCredentials)||(w.withCredentials=!!o.withCredentials),a&&a!=="json"&&(w.responseType=o.responseType),f&&([b,k]=Wl(f,!0),w.addEventListener("progress",b)),d&&w.upload&&([x,T]=Wl(d),w.upload.addEventListener("progress",x),w.upload.addEventListener("loadend",T)),(o.cancelToken||o.signal)&&(g=y=>{w&&(r(!y||y.type?new fo(null,e,w):y),w.abort(),w=null)},o.cancelToken&&o.cancelToken.subscribe(g),o.signal&&(o.signal.aborted?g():o.signal.addEventListener("abort",g)));const v=_w(o.url);if(v&&$t.protocols.indexOf(v)===-1){r(new Te("Unsupported protocol "+v+":",Te.ERR_BAD_REQUEST,e));return}w.send(i||null)})},Fw=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r=new AbortController,o;const i=function(f){if(!o){o=!0,a();const g=f instanceof Error?f:this.reason;r.abort(g instanceof Te?g:new fo(g instanceof Error?g.message:g))}};let l=t&&setTimeout(()=>{l=null,i(new Te(`timeout ${t} of ms exceeded`,Te.ETIMEDOUT))},t);const a=()=>{e&&(l&&clearTimeout(l),l=null,e.forEach(f=>{f.unsubscribe?f.unsubscribe(i):f.removeEventListener("abort",i)}),e=null)};e.forEach(f=>f.addEventListener("abort",i));const{signal:d}=r;return d.unsubscribe=()=>z.asap(a),d}},zw=Fw,Bw=function*(e,t){let n=e.byteLength;if(!t||n<t){yield e;return}let r=0,o;for(;r<n;)o=r+t,yield e.slice(r,o),r=o},Dw=async function*(e,t){for await(const n of Vw(e))yield*Bw(n,t)},Vw=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:n,value:r}=await t.read();if(n)break;yield r}}finally{await t.cancel()}},xm=(e,t,n,r)=>{const o=Dw(e,t);let i=0,l,a=d=>{l||(l=!0,r&&r(d))};return new ReadableStream({async pull(d){try{const{done:f,value:g}=await o.next();if(f){a(),d.close();return}let x=g.byteLength;if(n){let b=i+=x;n(b)}d.enqueue(new Uint8Array(g))}catch(f){throw a(f),f}},cancel(d){return a(d),o.return()}},{highWaterMark:2})},ym=64*1024,{isFunction:Ki}=z,Gw=(({Request:e,Response:t})=>({Request:e,Response:t}))(z.global),{ReadableStream:vm,TextEncoder:wm}=z.global,bm=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Hw=e=>{e=z.merge.call({skipUndefined:!0},Gw,e);const{fetch:t,Request:n,Response:r}=e,o=t?Ki(t):typeof fetch=="function",i=Ki(n),l=Ki(r);if(!o)return!1;const a=o&&Ki(vm),d=o&&(typeof wm=="function"?(k=>_=>k.encode(_))(new wm):async k=>new Uint8Array(await new n(k).arrayBuffer())),f=i&&a&&bm(()=>{let k=!1;const _=new n($t.origin,{body:new vm,method:"POST",get duplex(){return k=!0,"half"}}).headers.has("Content-Type");return k&&!_}),g=l&&a&&bm(()=>z.isReadableStream(new r("").body)),x={stream:g&&(k=>k.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(k=>{!x[k]&&(x[k]=(_,w)=>{let m=_&&_[k];if(m)return m.call(_);throw new Te(`Response type '${k}' is not supported`,Te.ERR_NOT_SUPPORT,w)})});const b=async k=>{if(k==null)return 0;if(z.isBlob(k))return k.size;if(z.isSpecCompliantForm(k))return(await new n($t.origin,{method:"POST",body:k}).arrayBuffer()).byteLength;if(z.isArrayBufferView(k)||z.isArrayBuffer(k))return k.byteLength;if(z.isURLSearchParams(k)&&(k=k+""),z.isString(k))return(await d(k)).byteLength},T=async(k,_)=>{const w=z.toFiniteNumber(k.getContentLength());return w??b(_)};return async k=>{let{url:_,method:w,data:m,signal:v,cancelToken:y,timeout:M,onDownloadProgress:L,onUploadProgress:O,responseType:U,headers:K,withCredentials:oe="same-origin",fetchOptions:ne}=Cg(k),Y=t||fetch;U=U?(U+"").toLowerCase():"text";let ae=zw([v,y&&y.toAbortSignal()],M),A=null;const ee=ae&&ae.unsubscribe&&(()=>{ae.unsubscribe()});let X;try{if(O&&f&&w!=="get"&&w!=="head"&&(X=await T(K,m))!==0){let q=new n(_,{method:"POST",body:m,duplex:"half"}),F;if(z.isFormData(m)&&(F=q.headers.get("content-type"))&&K.setContentType(F),q.body){const[G,he]=pm(X,Wl(hm(O)));m=xm(q.body,ym,G,he)}}z.isString(oe)||(oe=oe?"include":"omit");const Z=i&&"credentials"in n.prototype,ie={...ne,signal:ae,method:w.toUpperCase(),headers:K.normalize().toJSON(),body:m,duplex:"half",credentials:Z?oe:void 0};A=i&&new n(_,ie);let $=await(i?Y(A,ne):Y(_,ie));const I=g&&(U==="stream"||U==="response");if(g&&(L||I&&ee)){const q={};["status","statusText","headers"].forEach(Ie=>{q[Ie]=$[Ie]});const F=z.toFiniteNumber($.headers.get("content-length")),[G,he]=L&&pm(F,Wl(hm(L),!0))||[];$=new r(xm($.body,ym,G,()=>{he&&he(),ee&&ee()}),q)}U=U||"text";let C=await x[z.findKey(x,U)||"text"]($,k);return!I&&ee&&ee(),await new Promise((q,F)=>{kg(q,F,{data:C,headers:Ln.from($.headers),status:$.status,statusText:$.statusText,config:k,request:A})})}catch(Z){throw ee&&ee(),Z&&Z.name==="TypeError"&&/Load failed|fetch/i.test(Z.message)?Object.assign(new Te("Network Error",Te.ERR_NETWORK,k,A),{cause:Z.cause||Z}):Te.from(Z,Z&&Z.code,k,A)}}},Ww=new Map,Eg=e=>{let t=e?e.env:{};const{fetch:n,Request:r,Response:o}=t,i=[r,o,n];let l=i.length,a=l,d,f,g=Ww;for(;a--;)d=i[a],f=g.get(d),f===void 0&&g.set(d,f=a?new Map:Hw(t)),g=f;return f};Eg();const cd={http:lw,xhr:$w,fetch:{get:Eg}};z.forEach(cd,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const jm=e=>`- ${e}`,qw=e=>z.isFunction(e)||e===null||e===!1,Ig={getAdapter:(e,t)=>{e=z.isArray(e)?e:[e];const{length:n}=e;let r,o;const i={};for(let l=0;l<n;l++){r=e[l];let a;if(o=r,!qw(r)&&(o=cd[(a=String(r)).toLowerCase()],o===void 0))throw new Te(`Unknown adapter '${a}'`);if(o&&(z.isFunction(o)||(o=o.get(t))))break;i[a||"#"+l]=o}if(!o){const l=Object.entries(i).map(([d,f])=>`adapter ${d} `+(f===!1?"is not supported by the environment":"is not available in the build"));let a=n?l.length>1?`since :
`+l.map(jm).join(`
`):" "+jm(l[0]):"as no adapter specified";throw new Te("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return o},adapters:cd};function rc(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new fo(null,e)}function Nm(e){return rc(e),e.headers=Ln.from(e.headers),e.data=nc.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Ig.getAdapter(e.adapter||ku.adapter,e)(e).then(function(r){return rc(e),r.data=nc.call(e,e.transformResponse,r),r.headers=Ln.from(r.headers),r},function(r){return Ng(r)||(rc(e),r&&r.response&&(r.response.data=nc.call(e,e.transformResponse,r.response),r.response.headers=Ln.from(r.response.headers))),Promise.reject(r)})}const Tg="1.12.2",ja={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{ja[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const km={};ja.transitional=function(t,n,r){function o(i,l){return"[Axios v"+Tg+"] Transitional option '"+i+"'"+l+(r?". "+r:"")}return(i,l,a)=>{if(t===!1)throw new Te(o(l," has been removed"+(n?" in "+n:"")),Te.ERR_DEPRECATED);return n&&!km[l]&&(km[l]=!0,console.warn(o(l," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(i,l,a):!0}};ja.spelling=function(t){return(n,r)=>(console.warn(`${r} is likely a misspelling of ${t}`),!0)};function Yw(e,t,n){if(typeof e!="object")throw new Te("options must be an object",Te.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let o=r.length;for(;o-- >0;){const i=r[o],l=t[i];if(l){const a=e[i],d=a===void 0||l(a,i,e);if(d!==!0)throw new Te("option "+i+" must be "+d,Te.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Te("Unknown option "+i,Te.ERR_BAD_OPTION)}}const ml={assertOptions:Yw,validators:ja},Hn=ml.validators;class ql{constructor(t){this.defaults=t||{},this.interceptors={request:new fm,response:new fm}}async request(t,n){try{return await this._request(t,n)}catch(r){if(r instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const i=o.stack?o.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=vs(this.defaults,n);const{transitional:r,paramsSerializer:o,headers:i}=n;r!==void 0&&ml.assertOptions(r,{silentJSONParsing:Hn.transitional(Hn.boolean),forcedJSONParsing:Hn.transitional(Hn.boolean),clarifyTimeoutError:Hn.transitional(Hn.boolean)},!1),o!=null&&(z.isFunction(o)?n.paramsSerializer={serialize:o}:ml.assertOptions(o,{encode:Hn.function,serialize:Hn.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),ml.assertOptions(n,{baseUrl:Hn.spelling("baseURL"),withXsrfToken:Hn.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let l=i&&z.merge(i.common,i[n.method]);i&&z.forEach(["delete","get","head","post","put","patch","common"],k=>{delete i[k]}),n.headers=Ln.concat(l,i);const a=[];let d=!0;this.interceptors.request.forEach(function(_){typeof _.runWhen=="function"&&_.runWhen(n)===!1||(d=d&&_.synchronous,a.unshift(_.fulfilled,_.rejected))});const f=[];this.interceptors.response.forEach(function(_){f.push(_.fulfilled,_.rejected)});let g,x=0,b;if(!d){const k=[Nm.bind(this),void 0];for(k.unshift(...a),k.push(...f),b=k.length,g=Promise.resolve(n);x<b;)g=g.then(k[x++],k[x++]);return g}b=a.length;let T=n;for(;x<b;){const k=a[x++],_=a[x++];try{T=k(T)}catch(w){_.call(this,w);break}}try{g=Nm.call(this,T)}catch(k){return Promise.reject(k)}for(x=0,b=f.length;x<b;)g=g.then(f[x++],f[x++]);return g}getUri(t){t=vs(this.defaults,t);const n=Sg(t.baseURL,t.url,t.allowAbsoluteUrls);return wg(n,t.params,t.paramsSerializer)}}z.forEach(["delete","get","head","options"],function(t){ql.prototype[t]=function(n,r){return this.request(vs(r||{},{method:t,url:n,data:(r||{}).data}))}});z.forEach(["post","put","patch"],function(t){function n(r){return function(i,l,a){return this.request(vs(a||{},{method:t,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:l}))}}ql.prototype[t]=n(),ql.prototype[t+"Form"]=n(!0)});const pl=ql;class Su{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(i){n=i});const r=this;this.promise.then(o=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](o);r._listeners=null}),this.promise.then=o=>{let i;const l=new Promise(a=>{r.subscribe(a),i=a}).then(o);return l.cancel=function(){r.unsubscribe(i)},l},t(function(i,l,a){r.reason||(r.reason=new fo(i,l,a),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new Su(function(o){t=o}),cancel:t}}}const Kw=Su;function Qw(e){return function(n){return e.apply(null,n)}}function Jw(e){return z.isObject(e)&&e.isAxiosError===!0}const dd={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(dd).forEach(([e,t])=>{dd[t]=e});const Xw=dd;function _g(e){const t=new pl(e),n=ag(pl.prototype.request,t);return z.extend(n,pl.prototype,t,{allOwnKeys:!0}),z.extend(n,t,null,{allOwnKeys:!0}),n.create=function(o){return _g(vs(e,o))},n}const vt=_g(ku);vt.Axios=pl;vt.CanceledError=fo;vt.CancelToken=Kw;vt.isCancel=Ng;vt.VERSION=Tg;vt.toFormData=wa;vt.AxiosError=Te;vt.Cancel=vt.CanceledError;vt.all=function(t){return Promise.all(t)};vt.spread=Qw;vt.isAxiosError=Jw;vt.mergeConfig=vs;vt.AxiosHeaders=Ln;vt.formToJSON=e=>jg(z.isHTMLForm(e)?new FormData(e):e);vt.getAdapter=Ig.getAdapter;vt.HttpStatusCode=Xw;vt.default=vt;const Cu=vt,Mg="https://internalchat.pizeonfly.com/api",ze=Mg.replace(/\/?api\/?$/,""),fe=Cu.create({baseURL:Mg,headers:{"Content-Type":"application/json"},timeout:5*60*1e3});fe.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e));fe.interceptors.response.use(e=>e,e=>{var t;return((t=e.response)==null?void 0:t.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)});const Wo={login:(e,t)=>fe.post("/auth/login",{email:e,password:t}),registerSuperAdmin:(e,t,n)=>fe.post("/auth/register-superadmin",{name:e,email:t,password:n}),getCurrentUser:()=>fe.get("/auth/me"),checkSuperAdmin:()=>fe.get("/auth/check-superadmin")},Vt={getUsers:()=>fe.get("/users"),getActiveUsers:()=>fe.get("/users/active"),createUser:e=>fe.post("/users",e),updateUser:(e,t)=>fe.put(`/users/${e}`,t),deleteUser:e=>fe.delete(`/users/${e}`),toggleUserStatus:e=>fe.put(`/users/${e}/toggle-status`),updateProfile:e=>{const t=e instanceof FormData?e:(()=>{const n=new FormData;return Object.entries(e||{}).forEach(([r,o])=>{o!=null&&n.append(r,o)}),n})();return fe.put("/users/profile",t,{headers:{"Content-Type":"multipart/form-data"}})}},Rn={getGroups:()=>fe.get("/groups"),getMyGroups:()=>fe.get("/groups/my-groups"),createGroup:e=>fe.post("/groups",e),addMembers:(e,t)=>fe.post(`/groups/${e}/members`,{members:t}),removeMember:(e,t)=>fe.delete(`/groups/${e}/members/${t}`),updateGroup:(e,t)=>fe.put(`/groups/${e}`,t),deleteGroup:e=>fe.delete(`/groups/${e}`),uploadGroupAvatar:(e,t)=>fe.post(`/groups/${e}/avatar`,t,{headers:{"Content-Type":"multipart/form-data"}})},at={getPersonalMessages:(e,t={})=>fe.get(`/messages/personal/${e}`,{params:t}),getGroupMessages:(e,t={})=>fe.get(`/messages/group/${e}`,{params:t}),sendPersonalMessage:(e,t)=>e instanceof FormData?fe.post("/messages/personal",e,{headers:{"Content-Type":"multipart/form-data"},timeout:10*60*1e3,maxContentLength:100*1024*1024,maxBodyLength:100*1024*1024,onUploadProgress:t}):fe.post("/messages/personal",e),sendGroupMessage:(e,t)=>e instanceof FormData?fe.post("/messages/group",e,{headers:{"Content-Type":"multipart/form-data"},timeout:10*60*1e3,maxContentLength:100*1024*1024,maxBodyLength:100*1024*1024,onUploadProgress:t}):fe.post("/messages/group",e),markAsRead:e=>fe.put(`/messages/${e}/read`),getUnreadCount:()=>fe.get("/messages/unread/count"),getChatState:()=>fe.get("/messages/chat-state"),updateChatState:e=>fe.post("/messages/chat-state",e),forwardMessage:e=>fe.post("/messages/forward",e),editMessage:(e,t)=>fe.put(`/messages/${e}`,{message:t})},pi={getHistory:(e={})=>fe.get("/calls/history",{params:e}),initiate:(e,t="voice",n=null)=>fe.post("/calls/initiate",{receiverId:e,callType:t,offer:n}),answer:(e,t)=>fe.put(`/calls/${e}/answer`,{answer:t}),decline:e=>fe.put(`/calls/${e}/decline`),end:e=>fe.put(`/calls/${e}/end`),addIceCandidate:(e,t,n,r)=>fe.post(`/calls/${e}/ice-candidate`,{candidate:t,sdpMLineIndex:n,sdpMid:r}),getDetails:e=>fe.get(`/calls/${e}`),updateNotes:(e,t)=>fe.put(`/calls/${e}/notes`,{notes:t}),delete:e=>fe.delete(`/calls/${e}`)},cr={test:()=>fe.get("/group-calls/test"),initiate:(e,t="voice")=>fe.post("/group-calls/initiate",{groupId:e,callType:t}),join:e=>fe.post(`/group-calls/${e}/join`),leave:e=>fe.post(`/group-calls/${e}/leave`),end:e=>fe.post(`/group-calls/${e}/end`),updateMuteStatus:(e,t)=>fe.put(`/group-calls/${e}/mute`,{isMuted:t}),updateVideoStatus:(e,t)=>fe.put(`/group-calls/${e}/video`,{isVideoEnabled:t}),removeParticipant:(e,t)=>fe.delete(`/group-calls/${e}/participant/${t}`),getDetails:e=>fe.get(`/group-calls/${e}`),getActiveCalls:e=>fe.get(`/group-calls/group/${e}/active`),getHistory:(e,t={})=>fe.get(`/group-calls/group/${e}/history`,{params:t}),endAllActive:()=>fe.post("/group-calls/debug/end-all-active")},Rg={getSettings:()=>fe.get("/time-settings"),updateSettings:e=>fe.put("/time-settings",e),getCurrentTime:()=>fe.get("/time-settings/current-time")},is={getSchedules:()=>fe.get("/scheduled-disable"),getSchedule:e=>fe.get(`/scheduled-disable/${e}`),createSchedule:e=>fe.post("/scheduled-disable",e),updateSchedule:(e,t)=>fe.put(`/scheduled-disable/${e}`,t),deleteSchedule:e=>fe.delete(`/scheduled-disable/${e}`),toggleSchedule:e=>fe.put(`/scheduled-disable/${e}/toggle`),resetTrigger:e=>fe.put(`/scheduled-disable/${e}/reset-trigger`)},Zw=Object.freeze(Object.defineProperty({__proto__:null,API_ORIGIN:ze,authAPI:Wo,callsAPI:pi,default:fe,groupCallsAPI:cr,groupsAPI:Rn,messagesAPI:at,scheduledDisableAPI:is,timeSettingsAPI:Rg,usersAPI:Vt},Symbol.toStringTag,{value:"Module"})),e2={API_URL:"https://internalchat.pizeonfly.com/api",SOCKET_URL:"https://internalchat.pizeonfly.com",TURN_URL:"turn:internalchat.pizeonfly.com:3478",TURN_USERNAME:"webrtcuser",TURN_PASSWORD:{}.VITE_TURN_PASSWORD||"o4Ps!xl4"},Ag=e2.API_URL.replace(/\/?api\/?$/,"");function t2(e){const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(n);return Uint8Array.from([...r].map(o=>o.charCodeAt(0)))}const n2=()=>"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window,r2=async()=>{try{return(await Cu.get(`${Ag}/api/push-notifications/vapid-public-key`)).data}catch(e){throw console.error("Failed to get VAPID key:",e),e}},s2=async()=>"Notification"in window?Notification.permission==="granted"?"granted":Notification.permission!=="denied"?await Notification.requestPermission():Notification.permission:(console.log("This browser does not support notifications"),"denied"),o2=async()=>{if(!("serviceWorker"in navigator))throw new Error("Service Workers not supported");try{const e=await navigator.serviceWorker.register("/push-sw.js",{scope:"/"});return console.log(" Service Worker registered:",e),e}catch(e){throw console.error(" Service Worker registration failed:",e),e}},i2=async e=>{try{if(!n2())throw new Error("Push notifications are not supported");if(await s2()!=="granted")throw new Error("Notification permission denied");const{publicKey:n,configured:r}=await r2();if(!r||!n)throw new Error("Push notifications not configured on server");const o=await o2();await navigator.serviceWorker.ready;const i=await o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t2(n)});console.log(" Push subscription created:",i);const l=localStorage.getItem("token");return await Cu.post(`${Ag}/api/push-notifications/subscribe`,{...i.toJSON(),userId:e},{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}}),console.log(" Push subscription saved to server"),localStorage.setItem("pushSubscriptionEndpoint",i.endpoint),{success:!0,subscription:i}}catch(t){return console.error(" Push subscription failed:",t),{success:!1,error:t.message}}},l2=async()=>{try{if(!("serviceWorker"in navigator))return{subscribed:!1};const e=await navigator.serviceWorker.getRegistration();if(!e)return{subscribed:!1};const t=await e.pushManager.getSubscription();return{subscribed:!!t,subscription:t}}catch(e){return console.error(" Check subscription failed:",e),{subscribed:!1}}},Sm=async e=>{try{console.log(" Initializing push notifications...");const{subscribed:t}=await l2();return t?(console.log(" Already subscribed to push notifications"),{success:!0,alreadySubscribed:!0}):await i2(e)}catch(t){return console.error(" Push initialization failed:",t),{success:!1,error:t.message}}},Pg=h.createContext(),Fn=()=>{const e=h.useContext(Pg);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},a2=({children:e})=>{const[t,n]=h.useState(null),[r,o]=h.useState(!0);h.useEffect(()=>{localStorage.getItem("token")?Wo.getCurrentUser().then(g=>{var x;n(g.data.user),(x=g.data.user)!=null&&x._id&&Sm(g.data.user._id).then(b=>{b.success?console.log(" Push notifications initialized"):console.log(" Push notifications not initialized:",b.error)}).catch(b=>{console.log(" Push notifications initialization failed:",b)})}).catch(g=>{console.error("Auth check failed:",g),localStorage.removeItem("token")}).finally(()=>{o(!1)}):o(!1)},[]);const d={user:t,setUser:n,login:async(f,g)=>{var x,b,T,k;try{const _=await Wo.login(f,g),{token:w,user:m}=_.data;return localStorage.setItem("token",w),n(m),m!=null&&m._id&&Sm(m._id).then(v=>{v.success&&console.log(" Push notifications enabled")}).catch(v=>{console.log(" Push notifications not enabled:",v)}),{success:!0,data:_.data}}catch(_){return(b=(x=_.response)==null?void 0:x.data)!=null&&b.disabled?{success:!1,error:"Your account has been disabled by administrator",disabled:!0}:{success:!1,error:((k=(T=_.response)==null?void 0:T.data)==null?void 0:k.message)||"Login failed"}}},registerSuperAdmin:async(f,g,x)=>{var b,T;try{const k=await Wo.registerSuperAdmin(f,g,x),{token:_,user:w}=k.data;return localStorage.setItem("token",_),n(w),{success:!0,data:k.data}}catch(k){return{success:!1,error:((T=(b=k.response)==null?void 0:b.data)==null?void 0:T.message)||"Registration failed"}}},logout:()=>{localStorage.removeItem("token"),n(null)},loading:r};return s.jsx(Pg.Provider,{value:d,children:e})},c2="modulepreload",d2=function(e){return"/"+e},Cm={},u2=function(t,n,r){if(!n||n.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=d2(i),i in Cm)return;Cm[i]=!0;const l=i.endsWith(".css"),a=l?'[rel="stylesheet"]':"";if(!!r)for(let g=o.length-1;g>=0;g--){const x=o[g];if(x.href===i&&(!l||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const f=document.createElement("link");if(f.rel=l?"stylesheet":c2,l||(f.as="script",f.crossOrigin=""),f.href=i,document.head.appendChild(f),l)return new Promise((g,x)=>{f.addEventListener("load",g),f.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t()).catch(i=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i})},Xn=Object.create(null);Xn.open="0";Xn.close="1";Xn.ping="2";Xn.pong="3";Xn.message="4";Xn.upgrade="5";Xn.noop="6";const hl=Object.create(null);Object.keys(Xn).forEach(e=>{hl[Xn[e]]=e});const ud={type:"error",data:"parser error"},Lg=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Ug=typeof ArrayBuffer=="function",Og=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Eu=({type:e,data:t},n,r)=>Lg&&t instanceof Blob?n?r(t):Em(t,r):Ug&&(t instanceof ArrayBuffer||Og(t))?n?r(t):Em(new Blob([t]),r):r(Xn[e]+(t||"")),Em=(e,t)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];t("b"+(r||""))},n.readAsDataURL(e)};function Im(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let sc;function f2(e,t){if(Lg&&e.data instanceof Blob)return e.data.arrayBuffer().then(Im).then(t);if(Ug&&(e.data instanceof ArrayBuffer||Og(e.data)))return t(Im(e.data));Eu(e,!1,n=>{sc||(sc=new TextEncoder),t(sc.encode(n))})}const Tm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Lo=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<Tm.length;e++)Lo[Tm.charCodeAt(e)]=e;const m2=e=>{let t=e.length*.75,n=e.length,r,o=0,i,l,a,d;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const f=new ArrayBuffer(t),g=new Uint8Array(f);for(r=0;r<n;r+=4)i=Lo[e.charCodeAt(r)],l=Lo[e.charCodeAt(r+1)],a=Lo[e.charCodeAt(r+2)],d=Lo[e.charCodeAt(r+3)],g[o++]=i<<2|l>>4,g[o++]=(l&15)<<4|a>>2,g[o++]=(a&3)<<6|d&63;return f},p2=typeof ArrayBuffer=="function",Iu=(e,t)=>{if(typeof e!="string")return{type:"message",data:$g(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:h2(e.substring(1),t)}:hl[n]?e.length>1?{type:hl[n],data:e.substring(1)}:{type:hl[n]}:ud},h2=(e,t)=>{if(p2){const n=m2(e);return $g(n,t)}else return{base64:!0,data:e}},$g=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},Fg=String.fromCharCode(30),g2=(e,t)=>{const n=e.length,r=new Array(n);let o=0;e.forEach((i,l)=>{Eu(i,!1,a=>{r[l]=a,++o===n&&t(r.join(Fg))})})},x2=(e,t)=>{const n=e.split(Fg),r=[];for(let o=0;o<n.length;o++){const i=Iu(n[o],t);if(r.push(i),i.type==="error")break}return r};function y2(){return new TransformStream({transform(e,t){f2(e,n=>{const r=n.length;let o;if(r<126)o=new Uint8Array(1),new DataView(o.buffer).setUint8(0,r);else if(r<65536){o=new Uint8Array(3);const i=new DataView(o.buffer);i.setUint8(0,126),i.setUint16(1,r)}else{o=new Uint8Array(9);const i=new DataView(o.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(r))}e.data&&typeof e.data!="string"&&(o[0]|=128),t.enqueue(o),t.enqueue(n)})}})}let oc;function Qi(e){return e.reduce((t,n)=>t+n.length,0)}function Ji(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let r=0;for(let o=0;o<t;o++)n[o]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function v2(e,t){oc||(oc=new TextDecoder);const n=[];let r=0,o=-1,i=!1;return new TransformStream({transform(l,a){for(n.push(l);;){if(r===0){if(Qi(n)<1)break;const d=Ji(n,1);i=(d[0]&128)===128,o=d[0]&127,o<126?r=3:o===126?r=1:r=2}else if(r===1){if(Qi(n)<2)break;const d=Ji(n,2);o=new DataView(d.buffer,d.byteOffset,d.length).getUint16(0),r=3}else if(r===2){if(Qi(n)<8)break;const d=Ji(n,8),f=new DataView(d.buffer,d.byteOffset,d.length),g=f.getUint32(0);if(g>Math.pow(2,53-32)-1){a.enqueue(ud);break}o=g*Math.pow(2,32)+f.getUint32(4),r=3}else{if(Qi(n)<o)break;const d=Ji(n,o);a.enqueue(Iu(i?d:oc.decode(d),t)),r=0}if(o===0||o>e){a.enqueue(ud);break}}}})}const zg=4;function yt(e){if(e)return w2(e)}function w2(e){for(var t in yt.prototype)e[t]=yt.prototype[t];return e}yt.prototype.on=yt.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};yt.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};yt.prototype.off=yt.prototype.removeListener=yt.prototype.removeAllListeners=yt.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var r,o=0;o<n.length;o++)if(r=n[o],r===t||r.fn===t){n.splice(o,1);break}return n.length===0&&delete this._callbacks["$"+e],this};yt.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,o=n.length;r<o;++r)n[r].apply(this,t)}return this};yt.prototype.emitReserved=yt.prototype.emit;yt.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};yt.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Na=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0))(),wn=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),b2="arraybuffer";function Bg(e,...t){return t.reduce((n,r)=>(e.hasOwnProperty(r)&&(n[r]=e[r]),n),{})}const j2=wn.setTimeout,N2=wn.clearTimeout;function ka(e,t){t.useNativeTimers?(e.setTimeoutFn=j2.bind(wn),e.clearTimeoutFn=N2.bind(wn)):(e.setTimeoutFn=wn.setTimeout.bind(wn),e.clearTimeoutFn=wn.clearTimeout.bind(wn))}const k2=1.33;function S2(e){return typeof e=="string"?C2(e):Math.ceil((e.byteLength||e.size)*k2)}function C2(e){let t=0,n=0;for(let r=0,o=e.length;r<o;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}function Dg(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function E2(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function I2(e){let t={},n=e.split("&");for(let r=0,o=n.length;r<o;r++){let i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}class T2 extends Error{constructor(t,n,r){super(t),this.description=n,this.context=r,this.type="TransportError"}}class Tu extends yt{constructor(t){super(),this.writable=!1,ka(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,n,r){return super.emitReserved("error",new T2(t,n,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=Iu(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=E2(t);return n.length?"?"+n:""}}class _2 extends Tu{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};x2(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,g2(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=Dg()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}}let Vg=!1;try{Vg=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const M2=Vg;function R2(){}class A2 extends _2{constructor(t){if(super(t),typeof location<"u"){const n=location.protocol==="https:";let r=location.port;r||(r=n?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||r!==t.port}}doWrite(t,n){const r=this.request({method:"POST",data:t});r.on("success",n),r.on("error",(o,i)=>{this.onError("xhr post error",o,i)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=t}}class Jn extends yt{constructor(t,n,r){super(),this.createRequest=t,ka(this,r),this._opts=r,this._method=r.method||"GET",this._uri=n,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var t;const n=Bg(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(n);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let o in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(o)&&r.setRequestHeader(o,this._opts.extraHeaders[o])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var o;r.readyState===3&&((o=this._opts.cookieJar)===null||o===void 0||o.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(o){this.setTimeoutFn(()=>{this._onError(o)},0);return}typeof document<"u"&&(this._index=Jn.requestsCount++,Jn.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=R2,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Jn.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Jn.requestsCount=0;Jn.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",_m);else if(typeof addEventListener=="function"){const e="onpagehide"in wn?"pagehide":"unload";addEventListener(e,_m,!1)}}function _m(){for(let e in Jn.requests)Jn.requests.hasOwnProperty(e)&&Jn.requests[e].abort()}const P2=function(){const e=Gg({xdomain:!1});return e&&e.responseType!==null}();class L2 extends A2{constructor(t){super(t);const n=t&&t.forceBase64;this.supportsBinary=P2&&!n}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new Jn(Gg,this.uri(),t)}}function Gg(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||M2))return new XMLHttpRequest}catch{}if(!t)try{return new wn[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Hg=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class U2 extends Tu{get name(){return"websocket"}doOpen(){const t=this.uri(),n=this.opts.protocols,r=Hg?{}:Bg(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,n,r)}catch(o){return this.emitReserved("error",o)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const r=t[n],o=n===t.length-1;Eu(r,this.supportsBinary,i=>{try{this.doWrite(r,i)}catch{}o&&Na(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=Dg()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}}const ic=wn.WebSocket||wn.MozWebSocket;class O2 extends U2{createSocket(t,n,r){return Hg?new ic(t,n,r):n?new ic(t,n):new ic(t)}doWrite(t,n){this.ws.send(n)}}class $2 extends Tu{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const n=v2(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=t.readable.pipeThrough(n).getReader(),o=y2();o.readable.pipeTo(t.writable),this._writer=o.writable.getWriter();const i=()=>{r.read().then(({done:a,value:d})=>{a||(this.onPacket(d),i())}).catch(a=>{})};i();const l={type:"open"};this.query.sid&&(l.data=`{"sid":"${this.query.sid}"}`),this._writer.write(l).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const r=t[n],o=n===t.length-1;this._writer.write(r).then(()=>{o&&Na(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const F2={websocket:O2,webtransport:$2,polling:L2},z2=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,B2=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function fd(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),r=e.indexOf("]");n!=-1&&r!=-1&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let o=z2.exec(e||""),i={},l=14;for(;l--;)i[B2[l]]=o[l]||"";return n!=-1&&r!=-1&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=D2(i,i.path),i.queryKey=V2(i,i.query),i}function D2(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&r.splice(0,1),t.slice(-1)=="/"&&r.splice(r.length-1,1),r}function V2(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,o,i){o&&(n[o]=i)}),n}const md=typeof addEventListener=="function"&&typeof removeEventListener=="function",gl=[];md&&addEventListener("offline",()=>{gl.forEach(e=>e())},!1);class Vr extends yt{constructor(t,n){if(super(),this.binaryType=b2,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(n=t,t=null),t){const r=fd(t);n.hostname=r.host,n.secure=r.protocol==="https"||r.protocol==="wss",n.port=r.port,r.query&&(n.query=r.query)}else n.host&&(n.hostname=fd(n.host).host);ka(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(r=>{const o=r.prototype.name;this.transports.push(o),this._transportsByName[o]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=I2(this.opts.query)),md&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},gl.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=zg,n.transport=t,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&Vr.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",Vr.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=t.data,this._onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const o=this.writeBuffer[r].data;if(o&&(n+=S2(o)),r>0&&n>this._maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,Na(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,n,r){return this._sendPacket("message",t,n,r),this}send(t,n,r){return this._sendPacket("message",t,n,r),this}_sendPacket(t,n,r,o){if(typeof n=="function"&&(o=n,n=void 0),typeof r=="function"&&(o=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const i={type:t,data:n,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),o&&this.once("flush",o),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():t()}):this.upgrading?r():t()),this}_onError(t){if(Vr.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),md&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=gl.indexOf(this._offlineEventListener);r!==-1&&gl.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this._prevBufferLen=0}}}Vr.protocol=zg;class G2 extends Vr{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let n=this.createTransport(t),r=!1;Vr.priorWebsocketSuccess=!1;const o=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",x=>{if(!r)if(x.type==="pong"&&x.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Vr.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(g(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const b=new Error("probe error");b.transport=n.name,this.emitReserved("upgradeError",b)}}))};function i(){r||(r=!0,g(),n.close(),n=null)}const l=x=>{const b=new Error("probe error: "+x);b.transport=n.name,i(),this.emitReserved("upgradeError",b)};function a(){l("transport closed")}function d(){l("socket closed")}function f(x){n&&x.name!==n.name&&i()}const g=()=>{n.removeListener("open",o),n.removeListener("error",l),n.removeListener("close",a),this.off("close",d),this.off("upgrading",f)};n.once("open",o),n.once("error",l),n.once("close",a),this.once("close",d),this.once("upgrading",f),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{r||n.open()},200):n.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const n=[];for(let r=0;r<t.length;r++)~this.transports.indexOf(t[r])&&n.push(t[r]);return n}}let H2=class extends G2{constructor(t,n={}){const r=typeof t=="object"?t:n;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(o=>F2[o]).filter(o=>!!o)),super(t,r)}};function W2(e,t="",n){let r=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),r=fd(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+t,r.href=r.protocol+"://"+i+(n&&n.port===r.port?"":":"+r.port),r}const q2=typeof ArrayBuffer=="function",Y2=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Wg=Object.prototype.toString,K2=typeof Blob=="function"||typeof Blob<"u"&&Wg.call(Blob)==="[object BlobConstructor]",Q2=typeof File=="function"||typeof File<"u"&&Wg.call(File)==="[object FileConstructor]";function _u(e){return q2&&(e instanceof ArrayBuffer||Y2(e))||K2&&e instanceof Blob||Q2&&e instanceof File}function xl(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,r=e.length;n<r;n++)if(xl(e[n]))return!0;return!1}if(_u(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return xl(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&xl(e[n]))return!0;return!1}function J2(e){const t=[],n=e.data,r=e;return r.data=pd(n,t),r.attachments=t.length,{packet:r,buffers:t}}function pd(e,t){if(!e)return e;if(_u(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=pd(e[r],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=pd(e[r],t));return n}return e}function X2(e,t){return e.data=hd(e.data,t),delete e.attachments,e}function hd(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=hd(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=hd(e[n],t));return e}const Z2=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],eb=5;var Pe;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(Pe||(Pe={}));class tb{constructor(t){this.replacer=t}encode(t){return(t.type===Pe.EVENT||t.type===Pe.ACK)&&xl(t)?this.encodeAsBinary({type:t.type===Pe.EVENT?Pe.BINARY_EVENT:Pe.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===Pe.BINARY_EVENT||t.type===Pe.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=J2(t),r=this.encodeAsString(n.packet),o=n.buffers;return o.unshift(r),o}}function Mm(e){return Object.prototype.toString.call(e)==="[object Object]"}class Mu extends yt{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const r=n.type===Pe.BINARY_EVENT;r||n.type===Pe.BINARY_ACK?(n.type=r?Pe.EVENT:Pe.ACK,this.reconstructor=new nb(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(_u(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const r={type:Number(t.charAt(0))};if(Pe[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===Pe.BINARY_EVENT||r.type===Pe.BINARY_ACK){const i=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const l=t.substring(i,n);if(l!=Number(l)||t.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(l)}if(t.charAt(n+1)==="/"){const i=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););r.nsp=t.substring(i,n)}else r.nsp="/";const o=t.charAt(n+1);if(o!==""&&Number(o)==o){const i=n+1;for(;++n;){const l=t.charAt(n);if(l==null||Number(l)!=l){--n;break}if(n===t.length)break}r.id=Number(t.substring(i,n+1))}if(t.charAt(++n)){const i=this.tryParse(t.substr(n));if(Mu.isPayloadValid(r.type,i))r.data=i;else throw new Error("invalid payload")}return r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case Pe.CONNECT:return Mm(n);case Pe.DISCONNECT:return n===void 0;case Pe.CONNECT_ERROR:return typeof n=="string"||Mm(n);case Pe.EVENT:case Pe.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&Z2.indexOf(n[0])===-1);case Pe.ACK:case Pe.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class nb{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=X2(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const rb=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Mu,Encoder:tb,get PacketType(){return Pe},protocol:eb},Symbol.toStringTag,{value:"Module"}));function _n(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const sb=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class qg extends yt{constructor(t,n,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[_n(t,"open",this.onopen.bind(this)),_n(t,"packet",this.onpacket.bind(this)),_n(t,"error",this.onerror.bind(this)),_n(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){var r,o,i;if(sb.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const l={type:Pe.EVENT,data:n};if(l.options={},l.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const g=this.ids++,x=n.pop();this._registerAckCallback(g,x),l.id=g}const a=(o=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||o===void 0?void 0:o.writable,d=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!a||(d?(this.notifyOutgoingListeners(l),this.packet(l)):this.sendBuffer.push(l)),this.flags={},this}_registerAckCallback(t,n){var r;const o=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(o===void 0){this.acks[t]=n;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===t&&this.sendBuffer.splice(a,1);n.call(this,new Error("operation has timed out"))},o),l=(...a)=>{this.io.clearTimeoutFn(i),n.apply(this,a)};l.withError=!0,this.acks[t]=l}emitWithAck(t,...n){return new Promise((r,o)=>{const i=(l,a)=>l?o(l):r(a);i.withError=!0,n.push(i),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((o,...i)=>r!==this._queue[0]?void 0:(o!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(o)):(this._queue.shift(),n&&n(null,...i)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:Pe.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(r=>String(r.id)===t)){const r=this.acks[t];delete this.acks[t],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Pe.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Pe.EVENT:case Pe.BINARY_EVENT:this.onevent(t);break;case Pe.ACK:case Pe.BINARY_ACK:this.onack(t);break;case Pe.DISCONNECT:this.ondisconnect();break;case Pe.CONNECT_ERROR:this.destroy();const r=new Error(t.data.message);r.data=t.data.data,this.emitReserved("connect_error",r);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let r=!1;return function(...o){r||(r=!0,n.packet({type:Pe.ACK,id:t,data:o}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(delete this.acks[t.id],n.withError&&t.data.unshift(null),n.apply(this,t.data))}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Pe.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(t===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,t.data)}}}function mo(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}mo.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0};mo.prototype.reset=function(){this.attempts=0};mo.prototype.setMin=function(e){this.ms=e};mo.prototype.setMax=function(e){this.max=e};mo.prototype.setJitter=function(e){this.jitter=e};class gd extends yt{constructor(t,n){var r;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,ka(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new mo({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const o=n.parser||rb;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new H2(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const o=_n(n,"open",function(){r.onopen(),t&&t()}),i=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),t?t(a):this.maybeReconnectOnOpen()},l=_n(n,"error",i);if(this._timeout!==!1){const a=this._timeout,d=this.setTimeoutFn(()=>{o(),i(new Error("timeout")),n.close()},a);this.opts.autoUnref&&d.unref(),this.subs.push(()=>{this.clearTimeoutFn(d)})}return this.subs.push(o),this.subs.push(l),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(_n(t,"ping",this.onping.bind(this)),_n(t,"data",this.ondata.bind(this)),_n(t,"error",this.onerror.bind(this)),_n(t,"close",this.onclose.bind(this)),_n(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){Na(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let r=this.nsps[t];return r?this._autoConnect&&!r.active&&r.connect():(r=new qg(this,t,n),this.nsps[t]=r),r}_destroy(t){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let r=0;r<n.length;r++)this.engine.write(n[r],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,n){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(o=>{o?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",o)):t.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const _o={};function qo(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=W2(e,t.path||"/socket.io"),r=n.source,o=n.id,i=n.path,l=_o[o]&&i in _o[o].nsps,a=t.forceNew||t["force new connection"]||t.multiplex===!1||l;let d;return a?d=new gd(r,t):(_o[o]||(_o[o]=new gd(r,t)),d=_o[o]),n.query&&!t.query&&(t.query=n.queryKey),d.socket(n.path,t)}Object.assign(qo,{Manager:gd,Socket:qg,io:qo,connect:qo});const Yg=h.createContext(),po=()=>{const e=h.useContext(Yg);if(!e)throw new Error("useSocket must be used within a SocketProvider");return e},ob=({children:e,user:t})=>{const[n,r]=h.useState(null),[o,i]=h.useState(!1),[l,a]=h.useState([]),[d,f]=h.useState(0),[g,x]=h.useState(Date.now()),[b,T]=h.useState([]),k=F=>{if(t&&(t.role==="admin"||t.role==="superadmin")){const he=` DISABLED USER LOGIN ATTEMPT

${F.userName} (${F.userEmail}) is trying to access the system`;H.error(he,{duration:8e3,position:"top-center",style:{background:"#fef2f2",color:"#dc2626",border:"2px solid #ef4444",fontSize:"14px",fontWeight:"bold",padding:"16px",borderRadius:"8px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",whiteSpace:"pre-line"},icon:"",className:"toast-admin-alert"});const Ie=Date.now()+Math.random();T(me=>[...me,{...F,id:Ie}])}},_=async F=>{try{const{usersAPI:G}=await u2(()=>Promise.resolve().then(()=>Zw),void 0);await G.toggleUserStatus(F);const he=b.find(Ie=>Ie.userId===F);T(Ie=>Ie.filter(me=>me.userId!==F)),he&&H.success(` User ${he.userName} has been activated successfully!`,{duration:4e3,position:"top-right"})}catch(G){console.error("Error activating user:",G),H.error("Failed to activate user. Please try again.")}},w=F=>{T(G=>G.filter(he=>he.id!==F))},m={autoConnect:!0,transports:["websocket","polling"],upgrade:!0,rememberUpgrade:!0,timeout:2e4,forceNew:!0,reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:1e4,maxReconnectionAttempts:1/0};h.useEffect(()=>{if(t&&t.id){console.log(" Initializing socket connection for user:",t.name),console.log(" Socket URL:","https://internalchat.pizeonfly.com"),n&&(console.log(" Closing existing socket connection"),n.close(),r(null));const F=localStorage.getItem("token"),G=qo("https://internalchat.pizeonfly.com",{...m,auth:{token:F}});G.on("connect",()=>{f(0),x(Date.now()),i(!0),console.log(" Socket connected - ID:",G.id),console.log(" Connected as user:",t.name),console.log(" Connection URL:",G.io.uri),G.emit("join",t.id),console.log(` User ${t.id} joined personal room`),L(G),U(G)}),G.on("disconnect",me=>{i(!1),console.log(" Socket disconnected - Reason:",me),console.log(" Disconnected user:",t.name),O(),K(),v(G)}),G.on("connect_error",me=>{console.error(" Socket connection error:",me),i(!1),me.message&&me.message.includes("WebSocket")&&(console.log(" WebSocket connection failed, trying polling transport"),G.io.opts.transports=["polling"],setTimeout(()=>G.connect(),1e3)),v(G)}),G.on("reconnect",me=>{f(0),console.log(" Socket reconnected after",me,"attempts"),console.log(" New Socket ID:",G.id),i(!0),G.emit("join",t.id)}),G.on("reconnect_error",me=>{console.error(" Socket reconnection error:",me)}),G.on("reconnect_failed",()=>{console.error(" Socket reconnection failed"),i(!1)}),G.on("ping",me=>{x(Date.now()),console.log(" Ping received - Connection alive, timestamp:",new Date(Date.now()).toLocaleTimeString())}),G.on("pong",me=>{x(Date.now()),console.log(" Pong received - Connection confirmed, timestamp:",new Date(Date.now()).toLocaleTimeString())}),G.on("connect_timeout",()=>{console.log(" Socket connection timed out")}),G.on("reconnect_error",me=>{console.error(" Reconnection error:",me.message)}),G.on("reconnect_failed",()=>{console.error(" Reconnection failed permanently - forcing reconnect"),f(1/0)}),G.on("force-logout",me=>{console.log(" Force logout received:",me),localStorage.removeItem("token"),window.location.href="/login"}),G.on("admin_notification",me=>{k(me)}),G.on("user-online",me=>{var Ce;console.log(" User came online:",(Ce=me.user)==null?void 0:Ce.name),a(Oe=>Oe.find(Ne=>Ne.userId===me.userId)?Oe.map(Ne=>Ne.userId===me.userId?{...Ne,isOnline:!0,lastSeen:new Date}:Ne):[...Oe,{...me,isOnline:!0,lastSeen:new Date}])}),G.on("user-offline",me=>{var Ce;console.log(" User went offline:",(Ce=me.user)==null?void 0:Ce.name),a(Oe=>Oe.find(Ne=>Ne.userId===me.userId)?Oe.map(Ne=>Ne.userId===me.userId?{...Ne,isOnline:!1,lastSeen:new Date}:Ne):Oe)}),G.on("online-users",me=>{console.log(" Initial online users:",me.map(Ce=>{var Oe;return((Oe=Ce.user)==null?void 0:Oe.name)||Ce.name})),a(me.map(Ce=>({...Ce,isOnline:!0,lastSeen:new Date})))}),r(G);const he=()=>{document.hidden?(console.log(" User left tab - marking as away"),G&&G.connected&&G.emit("user-away",{userId:t.id})):(console.log(" User returned to tab - marking as active"),G&&G.connected&&G.emit("user-active",{userId:t.id}))},Ie=()=>{console.log(" User closing tab/window - disconnecting immediately"),G&&G.connected&&(G.emit("force-disconnect",{userId:t.id}),G.disconnect())};return document.addEventListener("visibilitychange",he),window.addEventListener("beforeunload",Ie),()=>{console.log(" Cleaning up socket connection"),document.removeEventListener("visibilitychange",he),window.removeEventListener("beforeunload",Ie),O(),K(),G&&G.connected&&G.emit("force-disconnect",{userId:t.id}),G.close(),r(null),i(!1),a([])}}else n&&(console.log(" Disconnecting socket - no user"),n.close(),r(null),i(!1),a([]))},[t==null?void 0:t.id]);const v=F=>{if(console.log(" Starting reconnection logic"),d<5){const G=1e3*Math.pow(2,d);console.log(` Reconnecting in ${G}ms...`),setTimeout(()=>{f(he=>he+1),F.connect()},G)}else console.log(" Max reconnections reached, manual reconnection forced"),F.connect()};let y,M;const L=F=>{y&&clearInterval(y),y=setInterval(()=>{const G=Date.now()-g;console.log(`Time since last ping: ${G}ms`),F&&o&&G>45e3&&(console.log(" Proactive ping sent to prevent timeout"),F.emit("ping",{timestamp:Date.now()}),x(Date.now())),G>18e4?(console.log(" Extended timeout reached - checking connection"),F&&F.connected&&o?(console.log(" Connection verified, resetting last ping"),x(Date.now())):(console.log(" Disconnection confirmed, reconnecting..."),F.connect())):console.log(` Socket maintained: ${G}ms since last ping`)},25e3)},O=()=>{y&&(clearInterval(y),y=null)},U=F=>{M&&clearInterval(M),M=setInterval(()=>{F&&F.connected&&F.emit("client-heartbeat",{t:Date.now()})},2e3)},K=()=>{M&&(clearInterval(M),M=null)},q={socket:n,isConnected:o,onlineUsers:l,notifications:b,sendMessage:(F,G,he="text",Ie=!1,me=null)=>{if(console.log(" sendMessage called with:",{receiverId:F,content:G,messageType:he,isGroupChat:Ie,attachment:me,socketStatus:{socket:!!n,isConnected:o,socketId:n==null?void 0:n.id}}),n&&o){console.log(" Emitting send-message event...");let Ce;return Ie?(Ce={sender:t.id,groupId:F,message:G,messageType:he,timestamp:new Date().toISOString()},n.emit("send-group-message",Ce)):(Ce={sender:t.id,receiver:F,message:G,messageType:he,timestamp:new Date().toISOString()},n.emit("send-message",Ce)),console.log(" Message sent successfully:",Ce),!0}else throw console.error(" Cannot send message: Socket not connected"),new Error("Socket not connected. Please check your connection.")},markMessageRead:(F,G)=>{n&&o&&(n.emit("mark-message-read",{messageId:F,senderId:G}),console.log(" Message read marked for:",{messageId:F,senderId:G}))},startTyping:F=>{n&&o&&n.emit("typing",{sender:t.id,receiver:F,isTyping:!0})},stopTyping:F=>{n&&o&&n.emit("typing",{sender:t.id,receiver:F,isTyping:!1})},isUserOnline:F=>{const G=l.find(he=>he.userId===F);return G?G.isOnline:!1},getUserStatus:F=>{const G=l.find(he=>he.userId===F);return G?{isOnline:G.isOnline,lastSeen:G.lastSeen}:{isOnline:!1,lastSeen:null}},joinGroup:F=>{n&&o&&(n.emit("join-group",F),console.log(" Joined group room:",F))},leaveGroup:F=>{n&&o&&(n.emit("leave-group",F),console.log(" Left group room:",F))},onReceiveMessage:F=>{n&&(n.off("receive-message"),n.on("receive-message",G=>{console.log(" Received message:",G),F(G)}))},onReceiveGroupMessage:F=>{n&&(n.off("receive-group-message"),n.on("receive-group-message",G=>{console.log(" Received group message:",G),F(G)}))},onMessageSent:F=>{n&&(n.off("message-sent"),n.on("message-sent",G=>{console.log(" Message sent confirmation:",G),F(G)}))},onProfileUpdated:F=>{n&&(n.off("avatar-updated"),n.on("avatar-updated",G=>{console.log(" Profile updated:",G),F(G)}))},handleActivateUser:_,handleCloseNotification:w,getConnectionStatus:()=>({isConnected:o,reconnectAttempts:d,lastPing:new Date(g).toLocaleString(),socketId:n==null?void 0:n.id})};return s.jsx(Yg.Provider,{value:q,children:e})};var ib={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const lb=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ve=(e,t)=>{const n=h.forwardRef(({color:r="currentColor",size:o=24,strokeWidth:i=2,absoluteStrokeWidth:l,children:a,...d},f)=>h.createElement("svg",{ref:f,...ib,width:o,height:o,stroke:r,strokeWidth:l?Number(i)*24/Number(o):i,className:`lucide lucide-${lb(e)}`,...d},[...t.map(([g,x])=>h.createElement(g,x)),...(Array.isArray(a)?a:[a])||[]]));return n.displayName=`${e}`,n},ho=ve("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),lc=ve("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),ab=ve("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),Bs=ve("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),cb=ve("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),xd=ve("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),Ys=ve("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Yo=ve("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Ks=ve("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Yl=ve("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),bn=ve("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),yd=ve("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),vd=ve("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ar=ve("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]),Qs=ve("Forward",[["polyline",{points:"15 17 20 12 15 7",key:"1w3sku"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]),Ru=ve("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),db=ve("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),ub=ve("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),fb=ve("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),Kg=ve("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Qg=ve("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),mb=ve("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),ms=ve("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),pb=ve("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),wd=ve("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),hb=ve("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]),Jg=ve("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),Un=ve("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),Rm=ve("PhoneCall",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]]),gb=ve("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]),hi=ve("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),Kl=ve("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),xb=ve("Power",[["path",{d:"M18.36 6.64a9 9 0 1 1-12.73 0",key:"phirl6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"12",key:"aemgbe"}]]),Au=ve("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),yb=ve("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Sa=ve("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Xg=ve("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Pu=ve("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ca=ve("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),Zg=ve("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]),e0=ve("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),Ql=ve("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),vb=ve("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Lu=ve("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),fn=ve("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),ln=ve("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),ur=ve("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),wb=ve("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),gi=ve("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),t0=ve("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),n0=ve("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),bb=()=>{const[e,t]=h.useState({name:"",email:"",password:"",confirmPassword:""}),[n,r]=h.useState("user"),[o,i]=h.useState(!1),[l,a]=h.useState(!1),[d,f]=h.useState(!1),[g,x]=h.useState(!0),[b,T]=h.useState(!1),[k,_]=h.useState(!1),{login:w,registerSuperAdmin:m}=Fn();h.useEffect(()=>{(async()=>{try{const U=await Wo.checkSuperAdmin();f(U.data.exists)}catch(U){console.error("Error checking super admin:",U)}finally{x(!1)}})()},[]);const v=[{value:"user",label:"User",icon:fn,description:"Chat with other users"},{value:"admin",label:"Admin",icon:Ca,description:"Manage users and groups"},{value:"superadmin",label:"Super Admin",icon:Yl,description:"Full system access"}],y=O=>{t({...e,[O.target.name]:O.target.value})},M=async O=>{O.preventDefault(),a(!0);try{if(o&&n==="superadmin"){if(e.password!==e.confirmPassword){H.error("Passwords do not match");return}const U=await m(e.name,e.email,e.password);U.success?H.success("Super Admin registered successfully!"):H.error(U.error)}else{const U=await w(e.email,e.password);U.success?H.success("Login successful!"):U.disabled?H.error("Your account has been disabled by administrator"):H.error(U.error)}}catch{H.error("An error occurred. Please try again.")}finally{a(!1)}},L=()=>{if(!o&&d){H.error("Super admin already exists. Please login instead.");return}i(!o),t({name:"",email:"",password:"",confirmPassword:""})};return g?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-primary-100 flex items-center justify-center p-4",children:s.jsx("div",{className:"max-w-md w-full space-y-8",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"mt-6 text-3xl font-bold text-gray-900",children:"Internal Chat App"}),s.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Checking system status..."}),s.jsx("div",{className:"flex justify-center mt-4",children:s.jsx("div",{className:"w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"})})]})})}):s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-primary-100 flex items-center justify-center p-4",children:s.jsxs("div",{className:"max-w-md w-full space-y-8",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"mt-6 text-3xl font-bold text-gray-900",children:"Internal Chat App"}),s.jsx("p",{className:"mt-2 text-sm text-gray-600",children:o?"Register as Super Admin":"Sign in to your account"})]}),s.jsxs("div",{className:"card p-8",children:[!o&&s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Role"}),s.jsx("div",{className:"grid grid-cols-1 gap-3",children:v.map(O=>{const U=O.icon;return s.jsx("button",{type:"button",onClick:()=>r(O.value),className:`p-3 rounded-lg border-2 transition-all ${n===O.value?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"}`,children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(U,{className:"w-5 h-5 text-gray-600"}),s.jsxs("div",{className:"text-left",children:[s.jsx("div",{className:"font-medium text-gray-900",children:O.label}),s.jsx("div",{className:"text-sm text-gray-500",children:O.description})]})]})},O.value)})})]}),s.jsxs("form",{onSubmit:M,className:"space-y-6",children:[o&&s.jsxs("div",{children:[s.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Full Name"}),s.jsx("input",{id:"name",name:"name",type:"text",required:!0,value:e.name,onChange:y,className:"input-field mt-1",placeholder:"Enter your full name"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),s.jsx("input",{id:"email",name:"email",type:"email",required:!0,value:e.email,onChange:y,className:"input-field mt-1",placeholder:"Enter your email"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),s.jsxs("div",{className:"relative mt-1",children:[s.jsx("input",{id:"password",name:"password",type:b?"text":"password",required:!0,value:e.password,onChange:y,className:"input-field pr-10",placeholder:"Enter your password"}),s.jsx("button",{type:"button","aria-label":b?"Hide password":"Show password",onClick:()=>T(!b),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600",children:b?s.jsx(yd,{className:"w-5 h-5"}):s.jsx(vd,{className:"w-5 h-5"})})]})]}),o&&s.jsxs("div",{children:[s.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),s.jsxs("div",{className:"relative mt-1",children:[s.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:k?"text":"password",required:!0,value:e.confirmPassword,onChange:y,className:"input-field pr-10",placeholder:"Confirm your password"}),s.jsx("button",{type:"button","aria-label":k?"Hide password":"Show password",onClick:()=>_(!k),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600",children:k?s.jsx(yd,{className:"w-5 h-5"}):s.jsx(vd,{className:"w-5 h-5"})})]})]}),s.jsx("div",{children:s.jsx("button",{type:"submit",disabled:l,className:"w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:l?s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),o?"Registering...":"Signing in..."]}):o?"Register Super Admin":"Sign In"})}),s.jsx("div",{className:"text-center",children:s.jsx("button",{type:"button",onClick:L,disabled:g,className:"text-sm text-primary-600 hover:text-primary-500 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Checking system status...":o?"Already have an account? Sign in":d?"Super admin already exists. Please login instead.":"Need to register Super Admin? Click here"})})]})]})]})})},Uu=({user:e,callData:t,isIncoming:n=!1,onCallEnd:r,onCallAnswer:o,onCallDecline:i})=>{var G,he,Ie,me,Ce,Oe,kt,Ne,At,Cn,qe,qt,St,nt,Je;const{socket:l}=po(),[a,d]=h.useState(n?"incoming":"outgoing"),[f,g]=h.useState(!1),[x,b]=h.useState(0),[T,k]=h.useState(null),[_,w]=h.useState({x:window.innerWidth-350,y:20}),[m,v]=h.useState(!1),[y,M]=h.useState({x:0,y:0}),L=h.useRef(null),O=h.useRef(null),U=h.useRef(null),K=h.useRef(null),oe=h.useRef(null),Y=(()=>{var dt,mt,Me,Re,wt,rt;const ue=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}],je=(mt=(dt=import.meta)==null?void 0:dt.env)==null?void 0:mt.VITE_TURN_URL,$e=(Re=(Me=import.meta)==null?void 0:Me.env)==null?void 0:Re.VITE_TURN_USERNAME,Ge=(rt=(wt=import.meta)==null?void 0:wt.env)==null?void 0:rt.VITE_TURN_CREDENTIAL;return je&&$e&&Ge&&ue.push({urls:je,username:$e,credential:Ge}),{iceServers:ue}})(),ae=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return console.error("WebRTC not supported in this browser or requires HTTPS"),k("Audio calls require HTTPS connection or are not supported in this browser. Please use HTTPS or try a different browser."),!1;if(typeof RTCPeerConnection>"u")return console.error("RTCPeerConnection not supported"),k("WebRTC is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari."),!1;U.current=new RTCPeerConnection(Y),U.current.onicecandidate=je=>{if(je.candidate&&l)try{l.emit("ice-candidate",{callId:t.callId,candidate:je.candidate.candidate,sdpMLineIndex:je.candidate.sdpMLineIndex,sdpMid:je.candidate.sdpMid})}catch($e){console.error("Error sending ICE candidate:",$e)}},U.current.ontrack=je=>{if(console.log(" Remote audio track received:",je),console.log(" Track details:",{kind:je.track.kind,label:je.track.label,enabled:je.track.enabled,readyState:je.track.readyState,streamsCount:je.streams.length}),je.streams&&je.streams[0]){const $e=je.streams[0];console.log(" Setting remote audio stream:",$e),console.log(" Stream tracks:",$e.getTracks()),O.current&&(O.current.srcObject=$e,$e.getAudioTracks().forEach(Ge=>{Ge.enabled=a==="connected",console.log(" Remote audio track enabled:",Ge.enabled,"callStatus:",a)}),O.current.volume!==void 0&&(O.current.volume=1),a==="connected"?(O.current.muted=!1,O.current.play().catch(Ge=>{Ge.name!=="AbortError"&&console.error(" Error playing remote audio:",Ge)}),console.log(" Remote audio playing after call connected")):(O.current.muted=!0,console.log(" Remote audio muted until call is accepted")))}},U.current.onconnectionstatechange=()=>{const je=U.current.connectionState;je==="connected"?(d("connected"),A()):(je==="disconnected"||je==="failed")&&q()};const ue=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});return K.current=ue,L.current&&(L.current.srcObject=ue),ue.getAudioTracks().forEach(je=>{U.current.addTrack(je,ue)}),!0}catch(ue){return console.error("Error initializing WebRTC:",ue),ue.name==="NotAllowedError"||ue.name==="PermissionDeniedError"?k("Microphone access denied. Please allow microphone permissions in your browser settings."):ue.name==="NotFoundError"||ue.name==="DevicesNotFoundError"?k("No microphone found. Please connect a microphone and try again."):ue.name==="NotReadableError"||ue.name==="TrackStartError"?k("Microphone is being used by another application. Please close other apps and try again."):ue.name==="OverconstrainedError"?k("Could not access microphone with the required settings."):ue.name==="SecurityError"?k("Audio calls require HTTPS connection. Please access the site via HTTPS."):k(`Failed to access microphone: ${ue.message||"Unknown error"}`),!1}},A=()=>{oe.current=setInterval(()=>{b(ue=>ue+1)},1e3)},ee=()=>{oe.current&&(clearInterval(oe.current),oe.current=null)},X=ue=>{const je=Math.floor(ue/60),$e=ue%60;return`${je.toString().padStart(2,"0")}:${$e.toString().padStart(2,"0")}`},Z=ue=>{v(!0);const je=ue.currentTarget.getBoundingClientRect();M({x:ue.clientX-je.left,y:ue.clientY-je.top})},ie=ue=>{if(!m)return;const je=ue.clientX-y.x,$e=ue.clientY-y.y,Ge=window.innerWidth-320,dt=window.innerHeight-200;w({x:Math.max(0,Math.min(je,Ge)),y:Math.max(0,Math.min($e,dt))})},$=()=>{v(!1)};h.useEffect(()=>{if(m)return document.addEventListener("mousemove",ie),document.addEventListener("mouseup",$),()=>{document.removeEventListener("mousemove",ie),document.removeEventListener("mouseup",$)}},[m,y]);const I=async()=>{await ae()&&(d("connecting"),o&&o(),l&&l.emit("call-answer",{callId:t.callId}))},C=()=>{d("declined"),i&&i(),l&&l.emit("call-decline",{callId:t.callId})},q=()=>{ee(),U.current&&(U.current.close(),U.current=null),K.current&&(K.current.getTracks().forEach(ue=>ue.stop()),K.current=null),d("ended"),r&&r(),l&&l.emit("call-end",{callId:t.callId})},F=()=>{if(K.current){const ue=K.current.getAudioTracks()[0];ue&&(ue.enabled=!ue.enabled,g(!ue.enabled))}};return h.useEffect(()=>{if(!l)return;const ue=async Me=>{if(Me.callId===t.callId){d("connecting");try{const Re=await U.current.createOffer();await U.current.setLocalDescription(Re),l.emit("call-offer",{callId:t.callId,offer:Re})}catch{k("Failed to establish connection")}}},je=async Me=>{if(Me.callId===t.callId)try{const Re=U.current.signalingState;if(console.log(" Processing offer, current state:",Re),Re==="stable"){await U.current.setRemoteDescription(Me.offer);const wt=await U.current.createAnswer();await U.current.setLocalDescription(wt),l.emit("call-answer-webrtc",{callId:t.callId,answer:wt})}else console.warn(" Cannot process offer in state:",Re),k("Call connection not ready")}catch(Re){console.error(" Failed to handle call offer:",Re),k("Failed to establish connection")}},$e=async Me=>{if(Me.callId===t.callId)try{const Re=U.current.signalingState;console.log(" Processing answer, current state:",Re),Re==="have-local-offer"||Re==="have-local-pranswer"?(await U.current.setRemoteDescription(Me.answer),console.log(" Answer processed successfully")):Re==="stable"?console.log(" Connection already established, skipping answer"):(console.warn(" Cannot process answer in state:",Re),k("Call connection not ready"))}catch(Re){console.error(" Failed to handle call answer:",Re),k("Failed to establish connection")}},Ge=async Me=>{if(Me.callId===t.callId&&U.current)try{const Re=new RTCIceCandidate({candidate:Me.candidate,sdpMLineIndex:Me.sdpMLineIndex,sdpMid:Me.sdpMid});await U.current.addIceCandidate(Re)}catch{}},dt=Me=>{Me.callId===t.callId&&(d("declined"),q())},mt=Me=>{Me.callId===t.callId&&q()};return l.on("call-answered",ue),l.on("call-offer",je),l.on("call-answer-webrtc",$e),l.on("ice-candidate",Ge),l.on("call-declined",dt),l.on("call-ended",mt),()=>{l.off("call-answered",ue),l.off("call-offer",je),l.off("call-answer-webrtc",$e),l.off("ice-candidate",Ge),l.off("call-declined",dt),l.off("call-ended",mt)}},[l,t.callId]),h.useEffect(()=>{!n&&a==="outgoing"&&ae()},[n,a]),h.useEffect(()=>{a==="connected"&&O.current&&(O.current.muted=!1,O.current.volume=1,O.current.play().catch(ue=>{ue.name!=="AbortError"&&console.error(" Error playing remote audio after call connected:",ue)}),console.log(" Remote audio unmuted after call connected"))},[a]),h.useEffect(()=>()=>{ee(),U.current&&U.current.close(),K.current&&K.current.getTracks().forEach(ue=>ue.stop())},[]),n&&a==="incoming"?s.jsx("div",{className:"fixed z-50",style:{left:_.x,top:_.y},children:s.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl p-6 w-80 text-center shadow-2xl border border-gray-700 relative",children:[s.jsx("div",{className:"absolute top-2 right-2",children:s.jsx("button",{onMouseDown:Z,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:s.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})})}),s.jsx("div",{className:"mb-4",children:(G=t==null?void 0:t.caller)!=null&&G.avatar?s.jsx("img",{src:t.caller.avatar,alt:t.caller.name,className:"w-16 h-16 rounded-full mx-auto object-cover border-2 border-white"}):s.jsx("div",{className:"w-16 h-16 rounded-full mx-auto bg-green-500 text-white flex items-center justify-center text-lg font-bold border-2 border-white",children:((Ie=(he=t==null?void 0:t.caller)==null?void 0:he.name)==null?void 0:Ie.charAt(0))||"U"})}),s.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:((me=t==null?void 0:t.caller)==null?void 0:me.name)||"Unknown"}),s.jsx("p",{className:"text-gray-300 mb-6 text-sm",children:" Incoming voice call..."}),s.jsxs("div",{className:"flex justify-center gap-4",children:[s.jsx("button",{onClick:C,className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("button",{onClick:I,className:"w-12 h-12 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})})]})]})}):T?s.jsx("div",{className:"fixed z-50",style:{left:_.x,top:_.y},children:s.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl p-6 w-80 text-center shadow-2xl border border-gray-700 relative",children:[s.jsx("div",{className:"absolute top-2 right-2",children:s.jsx("button",{onMouseDown:Z,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:s.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})})}),s.jsx("div",{className:"text-4xl mb-3",children:""}),s.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Call Error"}),s.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:T}),s.jsx("button",{onClick:q,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:"Close"})]})}):s.jsx("div",{className:"fixed z-50",style:{left:_.x,top:_.y},children:s.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 p-6 w-80 text-center text-white relative",children:[s.jsx("div",{className:"absolute top-2 right-2",children:s.jsx("button",{onMouseDown:Z,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:s.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})})}),s.jsx("audio",{ref:L,muted:!0,autoPlay:!0}),s.jsx("audio",{ref:O,autoPlay:!0}),s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("h2",{className:"text-sm text-gray-300 mb-2",children:a==="connecting"?"Connecting...":a==="connected"?"Voice Call":a==="outgoing"?"Calling...":"Call"}),s.jsx("h1",{className:"text-lg font-semibold",children:((Ce=t==null?void 0:t.otherUser)==null?void 0:Ce.name)||((Oe=t==null?void 0:t.caller)==null?void 0:Oe.name)||"Unknown"}),a==="connected"&&s.jsx("p",{className:"text-gray-300 mt-1 text-sm",children:X(x)})]}),s.jsx("div",{className:"mb-6",children:(kt=t==null?void 0:t.otherUser)!=null&&kt.avatar||(Ne=t==null?void 0:t.caller)!=null&&Ne.avatar?s.jsx("img",{src:((At=t==null?void 0:t.otherUser)==null?void 0:At.avatar)||((Cn=t==null?void 0:t.caller)==null?void 0:Cn.avatar),alt:((qe=t==null?void 0:t.otherUser)==null?void 0:qe.name)||((qt=t==null?void 0:t.caller)==null?void 0:qt.name),className:"w-20 h-20 rounded-full object-cover shadow-2xl border-2 border-white mx-auto"}):s.jsx("div",{className:"w-20 h-20 rounded-full bg-green-500 flex items-center justify-center text-2xl font-bold shadow-2xl border-2 border-white mx-auto",children:((Je=((St=t==null?void 0:t.otherUser)==null?void 0:St.name)||((nt=t==null?void 0:t.caller)==null?void 0:nt.name))==null?void 0:Je.charAt(0))||"U"})}),s.jsxs("div",{className:"mb-4 text-center",children:[a==="outgoing"&&s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),s.jsx("span",{className:"text-gray-300 text-sm",children:"Calling..."})]}),a==="connecting"&&s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce"}),s.jsx("span",{className:"text-gray-300 text-sm",children:"Connecting..."})]}),a==="connected"&&s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),s.jsx("span",{className:"text-gray-300 text-sm",children:"Connected"})]})]}),s.jsxs("div",{className:"flex gap-4 justify-center",children:[a==="connected"&&s.jsx("button",{onClick:F,className:`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${f?"bg-red-500 hover:bg-red-600":"bg-white bg-opacity-20 hover:bg-opacity-30"}`,title:f?"Unmute":"Mute",children:f?s.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),s.jsx("button",{onClick:q,className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",title:"End Call",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a==="connected"&&s.jsxs("div",{className:"mt-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-1",children:[s.jsx("div",{className:"w-1 h-2 bg-green-400 rounded"}),s.jsx("div",{className:"w-1 h-3 bg-green-400 rounded"}),s.jsx("div",{className:"w-1 h-4 bg-green-400 rounded"}),s.jsx("div",{className:"w-1 h-3 bg-green-400 rounded"}),s.jsx("div",{className:"w-1 h-2 bg-green-400 rounded"})]}),s.jsx("span",{className:"text-xs text-gray-300 mt-1 block",children:"Good quality"})]})]})})},Ou=({user:e,callData:t,isIncoming:n=!1,onCallEnd:r,onCallAnswer:o,onCallDecline:i})=>{var Ce,Oe,kt,Ne,At,Cn,qe,qt,St,nt,Je,ue,je,$e,Ge,dt,mt,Me,Re,wt,rt,zt;const{socket:l,isConnected:a}=po(),[d,f]=h.useState(n?"incoming":"outgoing"),[g,x]=h.useState(!1),[b,T]=h.useState((t==null?void 0:t.callType)==="video"),[k,_]=h.useState(0),[w,m]=h.useState(null),v=h.useRef(null),y=h.useRef(null),M=h.useRef(null),L=h.useRef(null),O=h.useRef(null),U=h.useRef(null),K=h.useRef(!1),oe=h.useRef(null),ne=h.useRef(!1),Y=h.useRef(!1),ae=h.useRef([]),A=h.useRef(!1),X=(()=>{var we,bt,He,Zn,zn,er;const re=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}],be=(bt=(we=import.meta)==null?void 0:we.env)==null?void 0:bt.VITE_TURN_URL,Le=(Zn=(He=import.meta)==null?void 0:He.env)==null?void 0:Zn.VITE_TURN_USERNAME,Ct=(er=(zn=import.meta)==null?void 0:zn.env)==null?void 0:er.VITE_TURN_CREDENTIAL;return be&&Le&&Ct&&re.push({urls:be,username:Le,credential:Ct}),{iceServers:re}})();h.useEffect(()=>(console.log("WebRTCCall useEffect - callData:",t,"isIncoming:",n),t&&t.callId&&a&&!A.current&&Z(),()=>{Ie()}),[t==null?void 0:t.callId,a]),h.useEffect(()=>(d==="connected"&&O.current?U.current=setInterval(()=>{const re=Math.floor((Date.now()-O.current)/1e3);_(re)},1e3):U.current&&(clearInterval(U.current),U.current=null),()=>{U.current&&clearInterval(U.current)}),[d]),h.useEffect(()=>{window.remoteStream&&y.current&&b&&(console.log(" Restoring remote video stream after remount"),y.current.srcObject=window.remoteStream,y.current.play().catch(re=>{re.name!=="AbortError"&&console.error(" Error playing restored remote video:",re)}))},[b,y.current]),h.useEffect(()=>{window.remoteStream&&y.current&&!y.current.srcObject&&(console.log(" Video ref available, attaching stored remote stream"),y.current.srcObject=window.remoteStream,y.current.play().catch(re=>{re.name!=="AbortError"&&console.error(" Error playing stored remote video:",re)}))},[y.current]);const Z=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){console.error("WebRTC not supported in this browser or requires HTTPS"),m("Video calls require HTTPS connection or are not supported in this browser. Please use HTTPS or try a different browser.");return}if(typeof RTCPeerConnection>"u"){console.error("RTCPeerConnection not supported"),m("WebRTC is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");return}K.current=!1,oe.current=null,ne.current=!1,Y.current=!1,ae.current=[],A.current=!1;const re={audio:!0,video:b?{width:640,height:480}:!1};try{M.current=await navigator.mediaDevices.getUserMedia(re)}catch(we){we.name==="NotAllowedError"||we.name==="PermissionDeniedError"?m("Camera/microphone access denied. Please allow access and try again."):we.name==="NotFoundError"||we.name==="DevicesNotFoundError"?m("Camera/microphone not found. Please check your devices."):we.name==="NotReadableError"||we.name==="TrackStartError"?m("Camera/microphone is being used by another application."):we.name==="SecurityError"?m("Video calls require HTTPS connection. Please access the site via HTTPS."):m(`Media access failed: ${we.message}`);return}M.current.getAudioTracks().forEach(we=>{we.enabled=!0}),M.current.getVideoTracks().forEach(we=>{we.enabled=!0}),v.current&&(v.current.srcObject=M.current,v.current.play().catch(()=>{}));try{L.current=new RTCPeerConnection(X)}catch(we){m(`Failed to create peer connection: ${we.message}`);return}try{M.current.getTracks().forEach(we=>{L.current.addTrack(we,M.current)})}catch(we){m(`Failed to add tracks to peer connection: ${we.message}`);return}L.current.ontrack=we=>{if(console.log(" Remote track received:",we),console.log(" Event streams:",we.streams),console.log(" Remote video ref:",y.current),console.log(" isVideoEnabled:",b),we.streams&&we.streams[0]){const bt=we.streams[0];if(console.log(" Setting remote video stream:",bt),console.log(" Stream tracks:",bt.getTracks()),window.remoteStream||(window.remoteStream=bt),y.current)Ct(bt);else{console.log(" Remote video ref not available, waiting...");const He=()=>{y.current?(console.log(" Remote video ref now available, setting stream"),Ct(bt)):setTimeout(He,100)};He()}}else console.error(" No remote video ref or stream available")};const Ct=we=>{if(!y.current){console.error(" Cannot attach stream: remote video ref not available");return}console.log(" Attaching remote stream to video element"),(async()=>{try{y.current&&(y.current.srcObject=we,console.log(" Set srcObject on remote video element"),y.current.readyState>=2?(await y.current.play(),console.log(" Remote video playing successfully")):y.current.addEventListener("loadeddata",async()=>{try{y.current&&(await y.current.play(),console.log(" Remote video playing after load"))}catch(He){He.name!=="AbortError"&&console.error(" Error playing remote video after load:",He)}},{once:!0}))}catch(He){He.name!=="AbortError"&&console.error(" Error playing remote video:",He)}})(),we.getAudioTracks().forEach(He=>{He.enabled=!0,console.log(" Remote audio track enabled:",He)}),we.getVideoTracks().forEach(He=>{He.enabled=!0,console.log(" Remote video track enabled:",He)}),y.current&&y.current.volume!==void 0&&(y.current.volume=1),T(!0)};L.current.onicecandidate=we=>{we.candidate&&l&&l.emit("ice-candidate",{callId:t.callId,candidate:we.candidate.candidate,sdpMLineIndex:we.candidate.sdpMLineIndex,sdpMid:we.candidate.sdpMid})},L.current.onconnectionstatechange=()=>{const we=L.current.connectionState;console.log(" Connection state changed:",we),we==="connected"?(console.log(" WebRTC connection established"),f("connected"),O.current=Date.now()):(we==="disconnected"||we==="failed")&&(console.log(" WebRTC connection failed:",we),F())},ie(),A.current=!0,n||await I()}catch{A.current=!1,m("Failed to access camera/microphone. Please check permissions.")}},ie=()=>{if(l){if(console.log("Setting up socket listeners for call:",t.callId,"isIncoming:",n),A.current){console.log("Socket listeners already set up, skipping...");return}l.off("call-answered"),l.off("call-declined"),l.off("call-ended"),l.off("call-error"),l.off("call-offer"),l.off("ice-candidate"),l.on("call-answered",async re=>{if(console.log(" Call answered received:",re),re.callId===t.callId){if(oe.current===re.callId)return;try{if(re.answer&&L.current){const be=typeof re.answer=="string"?JSON.parse(re.answer):re.answer,Le=L.current.signalingState;console.log(" Processing answer, current state:",Le),Le==="have-local-offer"&&!K.current&&(await L.current.setRemoteDescription(be),console.log(" Set remote description, new state:",L.current.signalingState),K.current=!0,oe.current=re.callId,setTimeout(()=>{$()},100))}f("connected"),O.current=Date.now()}catch(be){console.error(" Failed to handle call answer:",be),m("Failed to handle call answer")}}}),l.on("call-declined",re=>{re.callId===t.callId&&(f("declined"),setTimeout(()=>{r&&r()},2e3))}),l.on("call-ended",re=>{re.callId===t.callId&&F()}),l.on("ice-candidate",async re=>{if(console.log(" ICE candidate received:",re),re.callId===t.callId&&L.current)try{const be=L.current.signalingState,Le=L.current.remoteDescription;console.log(" Current signaling state:",be),console.log(" Remote description:",Le?"set":"null"),Le&&(be==="stable"||be==="have-local-offer"||be==="have-remote-offer")?(await L.current.addIceCandidate({candidate:re.candidate,sdpMLineIndex:re.sdpMLineIndex,sdpMid:re.sdpMid}),console.log(" ICE candidate added successfully")):(console.log(" Queuing ICE candidate for later (remote description not set)"),ae.current.push({candidate:re.candidate,sdpMLineIndex:re.sdpMLineIndex,sdpMid:re.sdpMid}))}catch(be){console.error(" Failed to add ICE candidate:",be),console.log(" Queuing failed ICE candidate for later"),ae.current.push({candidate:re.candidate,sdpMLineIndex:re.sdpMLineIndex,sdpMid:re.sdpMid})}}),l.on("call-error",re=>{m(re.error)}),l.on("call-offer",async re=>{if(console.log("Received call-offer event:",re),re.callId===t.callId&&n)try{const be=typeof re.offer=="string"?JSON.parse(re.offer):re.offer;if(console.log("Parsed offer:",be),!L.current&&!A.current&&(console.log("Peer connection not ready, initializing WebRTC..."),await Z()),L.current){const Le=L.current.signalingState;console.log("Received offer, current state:",Le),Le==="stable"?(await L.current.setRemoteDescription(be),console.log("Set remote description, new state:",L.current.signalingState),setTimeout(()=>{$()},100)):console.log("Cannot set remote description in state:",Le)}else console.error("Peer connection not available when handling offer")}catch(be){console.error("Failed to handle call offer:",be),m("Failed to handle call offer")}})}},$=async()=>{if(ae.current.length>0&&L.current)if(console.log(" Processing queued ICE candidates:",ae.current.length),L.current.remoteDescription){for(const be of ae.current)try{await L.current.addIceCandidate(be),console.log(" Queued ICE candidate added successfully")}catch(Le){console.error(" Failed to add queued ICE candidate:",Le)}ae.current=[],console.log(" All queued ICE candidates processed")}else console.log(" Cannot process queued ICE candidates: remote description not set")},I=async()=>{try{if(!A.current){m("WebRTC not initialized yet");return}if(!L.current){m("Peer connection not available");return}if(!l||!l.connected){m("Socket connection not available");return}if(!t||!t.callId){m("Call data not available");return}if(Y.current)return;const re=L.current.signalingState;if(re!=="stable"){m(`Cannot create offer in state: ${re}`);return}const be=await L.current.createOffer();await L.current.setLocalDescription(be),Y.current=!0,console.log("Sending call-offer with offer:",be),l.emit("call-offer",{callId:t.callId,offer:be}),console.log("Call-offer sent for call:",t.callId),f("ringing")}catch(re){m(`Failed to create call offer: ${re.message}`)}},C=async()=>{try{if(L.current){const re=L.current.signalingState;if(console.log("Answering call, current state:",re),re==="have-remote-offer"){const be=await L.current.createAnswer();await L.current.setLocalDescription(be),l.emit("call-answer",{callId:t.callId,answer:be}),f("connected"),O.current=Date.now(),o&&o()}else re==="stable"?(console.log("Offer not set yet, this indicates a timing issue"),m("Call offer not processed yet. Please wait a moment and try again.")):(console.error("Cannot answer call in state:",re),m(`Cannot answer call in current state: ${re}`))}else m("Call connection not ready")}catch(re){console.error("Failed to answer call:",re),m("Failed to answer call")}},q=()=>{l&&l.emit("call-decline",{callId:t.callId}),f("declined"),i&&i(),setTimeout(()=>{r&&r()},1e3)},F=()=>{ne.current||(ne.current=!0,l&&l.emit("call-end",{callId:t.callId}),f("ended"),r&&r())},G=()=>{M.current&&(M.current.getAudioTracks().forEach(be=>{be.enabled=g}),x(!g))},he=()=>{if(M.current){const re=M.current.getVideoTracks(),be=!b;if(re.forEach(Le=>{Le.enabled=be}),T(be),be&&y.current){console.log("Video enabled, ensuring remote video is visible");const Le=window.remoteStream||y.current.srcObject;Le&&(y.current.srcObject=null,setTimeout(()=>{y.current&&(y.current.srcObject=Le,y.current.play().catch(Ct=>{Ct.name!=="AbortError"&&console.error("Error playing remote video after toggle:",Ct)}))},100))}}},Ie=()=>{window.remoteStream&&(window.remoteStream=null),M.current&&M.current.getTracks().forEach(re=>re.stop()),L.current&&L.current.close(),U.current&&clearInterval(U.current)},me=re=>{const be=Math.floor(re/60),Le=re%60;return`${be}:${Le.toString().padStart(2,"0")}`};return w?s.jsx("div",{className:"call-error-container",children:s.jsxs("div",{className:"call-error",children:[s.jsx("div",{className:"error-icon",children:""}),s.jsx("h3",{children:"Call Error"}),s.jsx("p",{children:w}),s.jsx("button",{className:"btn btn-primary",onClick:r,children:"Close"})]})}):s.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",children:s.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 overflow-hidden w-96",children:[s.jsx("div",{className:"bg-black bg-opacity-20 px-6 py-4 flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-200",children:(Ce=t==null?void 0:t.otherUser)!=null&&Ce.avatar||(Oe=t==null?void 0:t.receiver)!=null&&Oe.avatar||(kt=t==null?void 0:t.caller)!=null&&kt.avatar?s.jsx("img",{src:((Ne=t.otherUser)==null?void 0:Ne.avatar)||((At=t.receiver)==null?void 0:At.avatar)||((Cn=t.caller)==null?void 0:Cn.avatar),alt:((qe=t.otherUser)==null?void 0:qe.name)||((qt=t.receiver)==null?void 0:qt.name)||((St=t.caller)==null?void 0:St.name),className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold text-lg",children:(($e=(je=((nt=t==null?void 0:t.otherUser)==null?void 0:nt.name)||((Je=t==null?void 0:t.receiver)==null?void 0:Je.name)||((ue=t==null?void 0:t.caller)==null?void 0:ue.name))==null?void 0:je.charAt(0))==null?void 0:$e.toUpperCase())||"U"})})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-white text-lg",children:((Ge=t==null?void 0:t.otherUser)==null?void 0:Ge.name)||((dt=t==null?void 0:t.receiver)==null?void 0:dt.name)||((mt=t==null?void 0:t.caller)==null?void 0:mt.name)||"Unknown"}),s.jsxs("p",{className:"text-sm text-gray-300",children:[d==="incoming"&&"Incoming call...",d==="outgoing"&&"Calling...",d==="ringing"&&"Ringing...",d==="connected"&&`Connected - ${me(k)}`,d==="declined"&&"Call declined",d==="ended"&&"Call ended"]})]})]})}),s.jsx("div",{className:"relative h-80 bg-black",children:b?s.jsxs(s.Fragment,{children:[s.jsx("video",{ref:y,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),s.jsx("div",{className:"absolute bottom-3 right-3 w-24 h-20 bg-gray-800 rounded-lg overflow-hidden border-2 border-white",children:s.jsx("video",{ref:v,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"})})]}):s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-32 h-32 rounded-full bg-gray-700 flex items-center justify-center mb-4",children:s.jsx("span",{className:"text-3xl text-white",children:((zt=(rt=((Me=t==null?void 0:t.otherUser)==null?void 0:Me.name)||((Re=t==null?void 0:t.receiver)==null?void 0:Re.name)||((wt=t==null?void 0:t.caller)==null?void 0:wt.name))==null?void 0:rt.charAt(0))==null?void 0:zt.toUpperCase())||"U"})}),s.jsx("p",{className:"text-white text-sm",children:"Audio Only Call"})]})})}),s.jsx("div",{className:"bg-black bg-opacity-20 p-6",children:s.jsxs("div",{className:"flex justify-center space-x-4",children:[d==="incoming"&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:q,title:"Decline",children:s.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("button",{className:"w-16 h-16 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:C,title:"Answer",children:s.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})})]}),d==="connected"&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:`w-14 h-14 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${g?"bg-red-500 hover:bg-red-600 text-white":"bg-white bg-opacity-20 hover:bg-opacity-30 text-white"}`,onClick:G,title:g?"Unmute":"Mute",children:g?s.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),(t==null?void 0:t.callType)==="video"&&s.jsx("button",{className:`w-14 h-14 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${b?"bg-white bg-opacity-20 hover:bg-opacity-30 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,onClick:he,title:b?"Disable Video":"Enable Video",children:b?s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}):s.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]})}),s.jsx("button",{className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:F,title:"End Call",children:s.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(d==="outgoing"||d==="ringing")&&s.jsx("button",{className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:F,title:"Cancel Call",children:s.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]})})},$u=({user:e,callData:t,isIncoming:n=!1,onCallEnd:r,onCallAnswer:o,onCallDecline:i})=>{var Jr,Yt,Xe,Kt,Bt,Be;const{socket:l,isConnected:a}=po(),[d,f]=h.useState(n?"incoming":"outgoing"),[g,x]=h.useState(!1),[b,T]=h.useState((t==null?void 0:t.callType)==="video"),[k,_]=h.useState(0),[w,m]=h.useState(null),[v,y]=h.useState([]),[M,L]=h.useState(!1),[O,U]=h.useState({x:window.innerWidth-400,y:20}),[K,oe]=h.useState(!1),[ne,Y]=h.useState({x:0,y:0}),[ae,A]=h.useState(!1),[ee,X]=h.useState(!1),Z=h.useRef(null),ie=h.useRef(null),$=h.useRef(null),I=h.useRef(null),C=h.useRef(new Map),q=h.useRef(null),F=h.useRef(null),G=h.useRef(!1),he=h.useRef(null),Ie=h.useRef(!1),me=h.useRef(null),Ce=h.useRef(!1),Oe=h.useRef(!1),kt=h.useRef([]),Ne=h.useRef(new Map),At=h.useRef(new Set),qe=(()=>{var se,xe,Ee,le,ge,pt;const S=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}],W=(xe=(se=import.meta)==null?void 0:se.env)==null?void 0:xe.VITE_TURN_URL,V=(le=(Ee=import.meta)==null?void 0:Ee.env)==null?void 0:le.VITE_TURN_USERNAME,B=(pt=(ge=import.meta)==null?void 0:ge.env)==null?void 0:pt.VITE_TURN_CREDENTIAL;return W&&V&&B&&S.push({urls:W,username:V,credential:B}),{iceServers:S,iceCandidatePoolSize:10,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}})();h.useEffect(()=>(t&&t.callId&&t.groupId&&a?(console.log(" Initializing WebRTC for group call:",{callId:t.callId,groupId:t.groupId,callType:t.callType,isIncoming:n}),qt()):console.log(" Waiting for call data to initialize WebRTC:",{hasCallData:!!t,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId),isConnected:a}),()=>{Ct()}),[t,a]),h.useEffect(()=>{if(!(t!=null&&t.callId)||!a)return;const S=setInterval(()=>{mt()},3e3);return()=>clearInterval(S)},[v,a,t==null?void 0:t.callId]),h.useEffect(()=>(d==="connected"&&q.current?F.current=setInterval(()=>{const S=Math.floor((Date.now()-q.current)/1e3);_(S)},1e3):F.current&&(clearInterval(F.current),F.current=null),()=>{F.current&&clearInterval(F.current)}),[d]);const qt=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){console.error("WebRTC not supported in this browser or requires HTTPS"),m("Video calls require HTTPS connection or are not supported in this browser. Please use HTTPS or try a different browser.");return}if(typeof RTCPeerConnection>"u"){console.error("RTCPeerConnection not supported"),m("WebRTC is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");return}Ie.current=!1,me.current=null,Ce.current=!1,Oe.current=!1,kt.current=[],At.current.clear(),G.current=!1;const S={audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:1,latency:.01},video:b?{width:{ideal:640,max:1280},height:{ideal:480,max:720},frameRate:{ideal:30,max:60}}:!1};try{I.current=await navigator.mediaDevices.getUserMedia(S),console.log(" Media stream obtained successfully")}catch(B){console.error(" Media access error:",B),B.name==="NotAllowedError"||B.name==="PermissionDeniedError"?m("Camera/microphone access denied. Please allow access and try again."):B.name==="NotFoundError"||B.name==="DevicesNotFoundError"?m("Camera/microphone not found. Please check your devices."):B.name==="NotReadableError"||B.name==="TrackStartError"?m("Camera/microphone is being used by another application."):B.name==="SecurityError"?m("Video calls require HTTPS connection. Please access the site via HTTPS."):m(`Media access failed: ${B.message}`);return}if(I.current.getAudioTracks().forEach(B=>{B.enabled=!0}),I.current.getVideoTracks().forEach(B=>{B.enabled=b}),ie.current&&(ie.current.srcObject=I.current,ie.current.play().catch(()=>{})),$.current&&($.current.srcObject=I.current,$.current.muted=!0,$.current.play().catch(()=>{})),St(),G.current=!0,console.log(" Setting call as established to allow ICE candidates"),X(!0),!n)await Ge();else{console.log(" Incoming call - joining via API to get participants");try{await cr.join(t.callId)}catch(B){console.error("Error joining incoming call:",B)}}}catch{G.current=!1,m("Failed to access camera/microphone. Please check permissions.")}},St=()=>{l&&(l.off("group-call-initiated"),l.off("group-call-joined"),l.off("group-call-left"),l.off("group-call-ended"),l.off("group-call-error"),l.off("group-call-participant-joined"),l.off("group-call-participant-left"),l.off("group-call-offer"),l.off("group-call-answer"),l.off("group-call-ice-candidate"),l.on("group-call-initiated",S=>{S.callId===t.callId&&(console.log("Group call initiated:",S),f("ringing"))}),l.on("group-call-joined",async S=>{var W,V;if(S.callId===t.callId){console.log("Group call joined:",S),f("connected"),X(!0),q.current=Date.now();try{const B=await fetch(`/api/group-calls/${t.callId}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(B.ok){const se=await B.json(),Ee=(((V=(W=se==null?void 0:se.data)==null?void 0:W.call)==null?void 0:V.participants)||[]).filter(ge=>ge&&ge.isActive).map(ge=>{const pt=typeof ge.user=="object"&&ge.user?ge.user:typeof ge.user=="string"&&ge.user?{_id:ge.user}:typeof ge.userId=="string"&&ge.userId?{_id:ge.userId}:typeof ge.userId=="object"&&ge.userId?ge.userId:typeof ge._id=="string"&&ge._id?{_id:ge._id}:typeof ge.id=="string"&&ge.id?{_id:ge.id}:{},ht=pt._id||pt.id;return{...pt,id:ht,name:pt.name||ge.name}}).filter(ge=>ge.id&&ge.id!==e.id),le=Me(Ee);le.length>0?(console.log(" Found existing participants:",Ee),y(le),await dt(le)):console.log(" No existing participants found"),Z.current=setInterval(wt,5e3)}}catch(B){console.error("Error fetching call details:",B)}}}),l.on("group-call-left",S=>{S.callId===t.callId&&!ae&&(console.log("Group call left:",S),f("ended"),r&&r())}),l.on("group-call-ended",S=>{var W;S.callId===t.callId&&!ae&&(console.log("Group call ended:",S),S.reason==="Initiator left the call"?H.success(`Call ended - ${((W=S.endedBy)==null?void 0:W.name)||"Host"} left the call`):H.success("Call ended"),f("ended"),r&&r())}),l.on("group-call-error",S=>{console.error("Group call error:",S),m(S.error)}),l.on("group-call-participant-joined",S=>{var W,V;if(S.callId===t.callId){console.log(" Participant joined socket event:",{data:S,newParticipant:S.newParticipant,hasNewParticipant:!!S.newParticipant,newParticipantId:(W=S.newParticipant)==null?void 0:W.id,newParticipantName:(V=S.newParticipant)==null?void 0:V.name}),console.log(" Current participants before adding:",v),y(se=>{const xe={...S.newParticipant,id:S.newParticipant.id||S.newParticipant._id};if(se.some(ge=>ge.id===xe.id))return console.log(" Participant already exists, skipping duplicate"),se;const le=[...se,xe];return console.log(" Updated participants after adding:",le),le});const B={...S.newParticipant,id:S.newParticipant.id||S.newParticipant._id};Re(B)}}),l.on("group-call-participant-left",S=>{S.callId===t.callId&&(console.log(" Participant left:",S),y(W=>{const V=W.filter(B=>B.id!==S.leftParticipant.id);return console.log(" Updated participants after removal:",V),V}),Je(S.leftParticipant.id))}),l.on("group-call-offer",async S=>{S.callId===t.callId&&(console.log("Group call offer received:",S),await ue(S))}),l.on("group-call-answer",async S=>{S.callId===t.callId&&(console.log("Group call answer received:",S),await je(S))}),l.on("group-call-ice-candidate",async S=>{S.callId===t.callId&&(console.log("Group call ICE candidate received:",S),await $e(S))}))},nt=async S=>{try{console.log(" Creating peer connection for target user:",S);const W=new RTCPeerConnection(qe);if(I.current){const V=I.current.getAudioTracks(),B=I.current.getVideoTracks();V.forEach(se=>{se.enabled=!g;const xe=W.addTrack(se,I.current);if(console.log(" Added audio track to peer connection:",se.label,"enabled:",se.enabled),xe&&xe.getParameters){const Ee=xe.getParameters();Ee.encodings&&Ee.encodings[0]&&(Ee.encodings[0].maxBitrate=64e3,Ee.encodings[0].priority="high",xe.setParameters(Ee))}}),B.forEach(se=>{se.enabled=b;const xe=W.addTrack(se,I.current);if(console.log(" Added video track to peer connection:",se.label,"enabled:",se.enabled),xe&&xe.getParameters){const Ee=xe.getParameters();Ee.encodings&&Ee.encodings[0]&&(Ee.encodings[0].maxBitrate=1e6,Ee.encodings[0].maxFramerate=30,xe.setParameters(Ee))}})}return W.ontrack=V=>{console.log(" Remote track received from:",S),console.log(" Track details:",{kind:V.track.kind,label:V.track.label,enabled:V.track.enabled,readyState:V.track.readyState,streamsCount:V.streams.length});const B=V.streams[0];B&&(console.log(" Remote stream received:",{id:B.id,active:B.active,audioTracks:B.getAudioTracks().length,videoTracks:B.getVideoTracks().length}),B.getAudioTracks().forEach(xe=>{console.log(" Processing remote audio track:",xe.label,"enabled:",xe.enabled),xe.enabled=!0}),y(xe=>{const Ee=xe.map(le=>le.id===S?{...le,stream:B}:le);return console.log(" Updated participants with stream:",Ee),Ee}))},W.onicecandidate=V=>{if(V.candidate)if(console.log(" ICE candidate generated for:",S),S&&l&&(t!=null&&t.callId)&&(t!=null&&t.groupId)){const B={callId:t.callId,groupId:t.groupId,targetUserId:S,candidate:V.candidate.candidate,sdpMLineIndex:V.candidate.sdpMLineIndex,sdpMid:V.candidate.sdpMid};console.log(" Sending ICE candidate immediately"),l.emit("group-call-ice-candidate",B)}else{console.warn(" ICE candidate queued - missing data:",{hasTargetUserId:!!S,hasSocket:!!l,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId)});const B=String(S||"unknown");Ne.current.has(B)||Ne.current.set(B,[]),Ne.current.get(B).push({candidate:V.candidate.candidate,sdpMLineIndex:V.candidate.sdpMLineIndex,sdpMid:V.candidate.sdpMid})}else console.log(" ICE gathering completed for:",S)},W.onconnectionstatechange=()=>{const V=W.connectionState;console.log(` Connection state with ${S}:`,V),V==="connected"?(console.log(` Connected to ${S}`),y(B=>B.map(se=>se.id===S?{...se,isConnected:!0}:se))):V==="failed"||V==="closed"?(console.error(` Connection ${V} with ${S}`),y(B=>B.map(se=>se.id===S?{...se,isConnected:!1}:se)),V==="failed"&&C.current.has(S)&&(console.log(` Will attempt to reconnect to ${S} in 3 seconds`),setTimeout(()=>{if(C.current.has(S)){console.log(` Recreating connection to ${S}`),Je(S);const B=nt(S);B&&B.createOffer().then(se=>{B.setLocalDescription(se),l&&(t!=null&&t.callId)&&(t!=null&&t.groupId)&&l.emit("group-call-offer",{callId:t.callId,groupId:t.groupId,targetUserId:S,offer:se})}).catch(se=>console.error("Error recreating offer:",se))}},3e3))):V==="disconnected"&&(console.warn(` Temporarily disconnected from ${S}`),y(B=>B.map(se=>se.id===S?{...se,isConnected:!1}:se)))},W.oniceconnectionstatechange=()=>{var B;const V=W.iceConnectionState;console.log(` ICE state with ${S}:`,V),V==="connected"||V==="completed"?console.log(` ICE connected with ${S}`):V==="failed"?(console.error(` ICE failed with ${S}`),H.error(`Connection issue with ${((B=v.find(se=>se.id===S))==null?void 0:B.name)||"participant"}`)):V==="disconnected"&&console.warn(` ICE disconnected with ${S}`)},C.current.set(S,W),setTimeout(()=>{He(S)},100),W}catch(W){console.error("Error creating peer connection:",W)}},Je=S=>{const W=C.current.get(String(S));W&&(W.close(),C.current.delete(S))},ue=async S=>{var W,V,B,se;try{console.log(" Group call offer data received:",{data:S,from:S.from,hasFrom:!!S.from,fromId:(W=S.from)==null?void 0:W.id,fromName:(V=S.from)==null?void 0:V.name,hasOffer:!!S.offer});const xe=S.from.id||S.from._id;if(!xe){console.error(" Cannot handle offer: missing from user ID",{from:S.from,hasId:!!((B=S.from)!=null&&B.id),hasUnderscoreId:!!((se=S.from)!=null&&se._id)});return}const Ee=await nt(xe);if(Ee)try{await Ee.setRemoteDescription(S.offer);const le=await Ee.createAnswer();console.log(" Created answer for participant:",xe,{hasAnswer:!!le,answerType:le==null?void 0:le.type,answerSdp:le!=null&&le.sdp?le.sdp.substring(0,100)+"...":"No SDP"}),await Ee.setLocalDescription(le),t&&t.callId&&t.groupId&&le?(l.emit("group-call-answer",{callId:t.callId,groupId:t.groupId,targetUserId:xe,answer:le}),bt(xe),setTimeout(()=>{He(xe)},100)):console.warn("Skipping answer: call data not ready yet",{hasCallData:!!t,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId),hasAnswer:!!le})}catch(le){console.error("Error creating answer for participant:",xe,le)}}catch(xe){console.error("Error handling group call offer:",xe)}},je=async S=>{var W,V,B,se,xe,Ee,le;try{console.log(" Group call answer data received:",{data:S,from:S.from,hasFrom:!!S.from,fromId:(W=S.from)==null?void 0:W.id,fromUnderscoreId:(V=S.from)==null?void 0:V._id,fromName:(B=S.from)==null?void 0:B.name,hasAnswer:!!S.answer});const ge=S.from.id||S.from._id;if(!ge){console.error(" Cannot handle answer: missing from user ID",{from:S.from,hasId:!!((se=S.from)!=null&&se.id),hasUnderscoreId:!!((xe=S.from)!=null&&xe._id)});return}const pt=`${ge}-${((le=(Ee=S.answer)==null?void 0:Ee.sdp)==null?void 0:le.substring(0,50))||"unknown"}`;if(At.current.has(pt)){console.log(" Answer already processed, skipping duplicate:",pt);return}const ht=C.current.get(ge);if(ht)if(console.log(" Peer connection state for",ge,":",{connectionState:ht.connectionState,iceConnectionState:ht.iceConnectionState,signalingState:ht.signalingState,currentRemoteDescription:!!ht.currentRemoteDescription}),ht.signalingState==="have-local-offer"||ht.signalingState==="have-local-pranswer")try{await ht.setRemoteDescription(S.answer),At.current.add(pt),console.log(" Answer processed for participant:",ge),setTimeout(()=>{He(ge)},100)}catch(vr){console.error(" Failed to set remote description for",ge,":",vr)}else console.warn(" Cannot set remote description - wrong signaling state:",{participant:ge,signalingState:ht.signalingState,expectedStates:["have-local-offer","have-local-pranswer"]});else console.warn(" No peer connection found for participant:",ge)}catch(ge){console.error("Error handling group call answer:",ge)}},$e=async S=>{var W,V,B,se;try{console.log(" Received ICE candidate from:",((W=S.from)==null?void 0:W.name)||((V=S.from)==null?void 0:V.id));const xe=((B=S.from)==null?void 0:B.id)||((se=S.from)==null?void 0:se._id);if(!xe){console.error(" Cannot handle ICE candidate: missing from user ID");return}const Ee=C.current.get(xe);if(Ee&&Ee.remoteDescription)try{await Ee.addIceCandidate({candidate:S.candidate,sdpMLineIndex:S.sdpMLineIndex,sdpMid:S.sdpMid}),console.log(" ICE candidate added for:",xe)}catch(le){console.error(" Failed to add ICE candidate:",le.message)}else{console.log(" Queuing ICE candidate for:",xe);const le=String(xe);Ne.current.has(le)||Ne.current.set(le,[]),Ne.current.get(le).push({candidate:S.candidate,sdpMLineIndex:S.sdpMLineIndex,sdpMid:S.sdpMid})}}catch(xe){console.error("Error handling group call ICE candidate:",xe)}},Ge=async()=>{try{await cr.join(t.callId),l&&l.emit("group-call-join",{callId:t.callId,groupId:t.groupId})}catch(S){console.error("Error joining group call:",S),m("Failed to join group call")}},dt=async S=>{try{for(const W of S)if(W.id!==e.id&&W.isActive){console.log(`Creating mesh connection with ${W.name}`);const V=await nt(W.id);if(V)try{const B=await V.createOffer();console.log(" Created offer for participant:",W.id,{hasOffer:!!B,offerType:B==null?void 0:B.type,offerSdp:B!=null&&B.sdp?B.sdp.substring(0,100)+"...":"No SDP"}),await V.setLocalDescription(B),t&&t.callId&&t.groupId&&B?(l.emit("group-call-offer",{callId:t.callId,groupId:t.groupId,targetUserId:W.id,offer:B}),bt(W.id),setTimeout(()=>{He(W.id)},100)):console.warn("Skipping offer: call data not ready yet",{hasCallData:!!t,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId),hasOffer:!!B})}catch(B){console.error("Error creating offer for participant:",W.id,B)}}}catch(W){console.error("Error establishing mesh connections:",W)}},mt=async()=>{try{const S=v||[];for(const W of S){const V=W&&(W.id||W._id);if(!(!V||V===e.id)&&!C.current.get(V)){const B=await nt(V);if(B)try{const se=await B.createOffer();await B.setLocalDescription(se),t&&t.callId&&t.groupId&&se&&(l.emit("group-call-offer",{callId:t.callId,groupId:t.groupId,targetUserId:V,offer:se}),bt(V),setTimeout(()=>{He(V)},100))}catch(se){console.error("Error reconciling offer for participant:",V,se)}}}}catch(S){console.error("Error reconciling peer connections:",S)}},Me=S=>{const W=new Set,V=[];for(const B of S||[]){const se=B&&(B.id||B._id);se&&(W.has(se)||(W.add(se),V.push(B)))}return V},Re=async S=>{try{console.log(" New participant data received:",{newParticipant:S,hasId:!!(S!=null&&S.id),id:S==null?void 0:S.id,hasName:!!(S!=null&&S.name),name:S==null?void 0:S.name,currentUserId:e==null?void 0:e.id});const W=S.id||S._id;if(W&&W!==e.id){console.log(`New participant joined: ${S.name} (ID: ${W})`);const V=await nt(W);if(V)try{const B=await V.createOffer();console.log(" Created offer for new participant:",W,{hasOffer:!!B,offerType:B==null?void 0:B.type,offerSdp:B!=null&&B.sdp?B.sdp.substring(0,100)+"...":"No SDP"}),await V.setLocalDescription(B),t&&t.callId&&t.groupId&&B?(l.emit("group-call-offer",{callId:t.callId,groupId:t.groupId,targetUserId:W,offer:B}),bt(W),setTimeout(()=>{He(W)},100)):console.warn("Skipping offer: call data not ready yet",{hasCallData:!!t,hasCallId:!!(t!=null&&t.callId),hasGroupId:!!(t!=null&&t.groupId),hasOffer:!!B})}catch(B){console.error("Error creating offer for new participant:",W,B)}}}catch(W){console.error("Error handling participant joined:",W)}},wt=async()=>{var S,W;if(t!=null&&t.callId)try{const V=await fetch(`/api/group-calls/${t.callId}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(V.ok){const B=await V.json(),xe=(((W=(S=B==null?void 0:B.data)==null?void 0:S.call)==null?void 0:W.participants)||[]).filter(le=>le&&le.isActive).map(le=>{const ge=typeof le.user=="object"&&le.user?le.user:typeof le.user=="string"&&le.user?{_id:le.user}:typeof le.userId=="string"&&le.userId?{_id:le.userId}:typeof le.userId=="object"&&le.userId?le.userId:typeof le._id=="string"&&le._id?{_id:le._id}:typeof le.id=="string"&&le.id?{_id:le.id}:{},pt=ge._id||ge.id;return{...ge,id:pt,name:ge.name||le.name}}).filter(le=>le.id&&le.id!==e.id),Ee=Me(xe);Ee.length>0&&y(Ee)}}catch(V){console.error("Error refreshing participants:",V)}},rt=async()=>{try{await Ge(),await wt(),Z.current=setInterval(wt,5e3),o&&o()}catch(S){console.error("Error answering group call:",S),m("Failed to answer group call")}},zt=()=>{l&&l.emit("group-call-leave",{callId:t.callId,groupId:t.groupId}),f("declined"),i&&i(),setTimeout(()=>{r&&r()},1e3)},re=()=>{ae||(A(!0),X(!1),Ct(),Z.current&&(clearInterval(Z.current),Z.current=null),l&&l.emit("group-call-leave",{callId:t.callId,groupId:t.groupId}),f("ended"),r&&r())},be=()=>{if(I.current){const S=I.current.getAudioTracks(),W=!g;S.forEach(V=>{V.enabled=!W}),x(W),cr.updateMuteStatus(t.callId,W).then(()=>console.log(" Mute status updated on server")).catch(V=>console.error("Error updating mute status:",V))}},Le=()=>{if(I.current){const S=I.current.getVideoTracks(),W=!b;S.forEach(V=>{V.enabled=W}),T(W),cr.updateVideoStatus(t.callId,W).then(()=>console.log(" Video status updated on server")).catch(V=>console.error("Error updating video status:",V))}},Ct=()=>{window.remoteStreams&&(window.remoteStreams=new Map),I.current&&I.current.getTracks().forEach(S=>S.stop()),C.current&&(C.current.forEach(S=>{S.close()}),C.current.clear()),At.current.clear(),F.current&&clearInterval(F.current)},we=S=>{const W=Math.floor(S/60),V=S%60;return`${W}:${V.toString().padStart(2,"0")}`},bt=S=>{const W=Ne.current.get(String(S))||Ne.current.get("unknown");W&&W.length>0&&l&&t&&(console.log(` Sending ${W.length} queued ICE candidates for ${S}`),W.forEach(B=>{const se={callId:t.callId,groupId:t.groupId,targetUserId:S,candidate:B.candidate,sdpMLineIndex:B.sdpMLineIndex,sdpMid:B.sdpMid};l.emit("group-call-ice-candidate",se)}),Ne.current.delete(S));const V=Ne.current.get("unknown");V&&V.length>0&&l&&t&&(console.log(` Sending ${V.length} 'unknown' queued ICE candidates to ${S}`),V.forEach(B=>{const se={callId:t.callId,groupId:t.groupId,targetUserId:S,candidate:B.candidate,sdpMLineIndex:B.sdpMLineIndex,sdpMid:B.sdpMid};l.emit("group-call-ice-candidate",se)}))},He=async S=>{const W=C.current.get(S);if(!W){console.warn(" No peer connection found to process queued candidates for:",S);return}const V=Ne.current.get(S);if(!V||V.length===0){console.log(" No queued ICE candidates to process for:",S);return}console.log(` Processing ${V.length} queued ICE candidates for ${S}`);for(const B of V)try{await W.addIceCandidate({candidate:B.candidate,sdpMLineIndex:B.sdpMLineIndex,sdpMid:B.sdpMid}),console.log(" Queued ICE candidate added for:",S)}catch(se){console.error(" Failed to add queued ICE candidate for:",S,se)}Ne.current.delete(String(S)),Ne.current.delete("unknown"),console.log(` Finished processing queued ICE candidates for ${S}`)},Zn=S=>{if(S.target.closest(".call-controls"))return;oe(!0);const W=he.current.getBoundingClientRect();Y({x:S.clientX-W.left,y:S.clientY-W.top})},zn=S=>{if(!K)return;const W=S.clientX-ne.x,V=S.clientY-ne.y,B=window.innerWidth-400,se=window.innerHeight-300;U({x:Math.max(0,Math.min(W,B)),y:Math.max(0,Math.min(V,se))})},er=()=>{oe(!1)};return h.useEffect(()=>{if(K)return document.addEventListener("mousemove",zn),document.addEventListener("mouseup",er),()=>{document.removeEventListener("mousemove",zn),document.removeEventListener("mouseup",er)}},[K,ne]),h.useEffect(()=>{I.current&&$.current&&($.current.srcObject=I.current,$.current.muted=!0,$.current.play().catch(()=>{}))},[I.current,$.current]),w?s.jsx("div",{className:"fixed bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 p-6 z-50 transition-all duration-300",style:{left:O.x,top:O.y,width:"400px",height:"300px"},children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-4xl mb-3",children:""}),s.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Group Call Error"}),s.jsx("p",{className:"text-sm text-gray-300 mb-4",children:w}),s.jsx("button",{onClick:r,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:"Close"})]})}):M?s.jsx("div",{ref:he,className:"fixed bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 z-50 transition-all duration-300 hover:shadow-3xl",style:{left:O.x,top:O.y,width:"320px",height:"80px"},children:s.jsxs("div",{className:"flex items-center justify-between p-3",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:(Jr=t==null?void 0:t.group)!=null&&Jr.avatar?s.jsx("img",{src:t.group.avatar,alt:t.group.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-blue-500 flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold text-sm",children:"G"})})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-white text-sm",children:((Yt=t==null?void 0:t.group)==null?void 0:Yt.name)||"Group Call"}),s.jsx("p",{className:"text-xs text-gray-300",children:d==="connected"?`${v.length+1} participants`:"Group call..."})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onMouseDown:Zn,className:"p-1.5 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:s.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})}),s.jsx("button",{onClick:S=>{S.stopPropagation(),L(!1)},className:"p-1.5 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:"Expand",children:s.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),s.jsx("button",{onClick:S=>{S.stopPropagation(),re()},className:"p-1.5 bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors",title:"End Call",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})}):s.jsxs("div",{ref:he,className:"fixed bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-gray-700 overflow-hidden z-50 transition-all duration-300",style:{left:O.x,top:O.y,width:"500px",height:"600px"},children:[s.jsxs("div",{className:"bg-black bg-opacity-20 px-4 py-3 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:(Xe=t==null?void 0:t.group)!=null&&Xe.avatar?s.jsx("img",{src:t.group.avatar,alt:t.group.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-blue-500 flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold",children:"G"})})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-white text-sm",children:((Kt=t==null?void 0:t.group)==null?void 0:Kt.name)||"Group Call"}),s.jsxs("p",{className:"text-xs text-gray-300",children:[d==="incoming"&&"Incoming group call...",d==="outgoing"&&"Joining group call...",d==="ringing"&&"Ringing...",d==="connected"&&`Connected - ${we(k)}`,d==="declined"&&"Call declined",d==="ended"&&"Call ended"]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onMouseDown:Zn,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors cursor-move",title:"Drag to move call window",children:s.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16M8 4v16M16 4v16"})})}),s.jsx("button",{onClick:S=>{S.stopPropagation(),L(!0)},className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:"Minimize",children:s.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),s.jsx("button",{onClick:S=>{S.stopPropagation(),r()},className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",title:"Close",children:s.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),s.jsx("audio",{ref:$,muted:!0,autoPlay:!0,style:{display:"none"}}),v.map((S,W)=>S.stream&&s.jsx("audio",{autoPlay:!0,playsInline:!0,ref:V=>{V&&S.stream&&(V.srcObject=S.stream,V.volume=1,V.muted=!1,V.play().catch(B=>console.log("Audio play error:",B)))},style:{display:"none"}},`audio-${S.id}-${W}`)),s.jsx("div",{className:"relative h-80 bg-black",children:b?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"absolute bottom-3 right-3 w-24 h-20 bg-gray-800 rounded-lg overflow-hidden border-2 border-white",children:s.jsx("video",{ref:ie,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"})}),s.jsx("div",{className:"grid grid-cols-2 gap-2 p-2 h-full",children:v.map((S,W)=>{var V,B,se,xe;return s.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:S.stream?s.jsx(s.Fragment,{children:t.callType==="video"?s.jsx("video",{autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover",ref:Ee=>{Ee&&S.stream&&(Ee.srcObject=S.stream)}}):s.jsx("div",{className:"w-full h-full flex items-center justify-center relative",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center mb-2",children:s.jsx("span",{className:"text-white text-xl font-semibold",children:((B=(V=S.name)==null?void 0:V.charAt(0))==null?void 0:B.toUpperCase())||"U"})}),s.jsx("p",{className:"text-white text-sm font-medium",children:S.name}),s.jsxs("div",{className:"flex items-center justify-center mt-2",children:[s.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),s.jsx("span",{className:"text-green-400 text-xs ml-1",children:"Speaking"})]})]})})}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-600 flex items-center justify-center mb-2",children:s.jsx("span",{className:"text-white text-lg",children:((xe=(se=S.name)==null?void 0:se.charAt(0))==null?void 0:xe.toUpperCase())||"U"})}),s.jsx("p",{className:"text-white text-xs",children:S.name})]})})},`${S.id}-${W}`)})})]}):s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsx("div",{className:"flex items-center justify-center py-4 border-b border-gray-700",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center mb-2 mx-auto",children:s.jsx("span",{className:"text-2xl text-white",children:"G"})}),s.jsx("p",{className:"text-white text-sm font-medium",children:"Group Audio Call"}),s.jsxs("p",{className:"text-gray-300 text-xs mt-1",children:[v.length+1," participant",v.length+1!==1?"s":""]})]})}),s.jsx("div",{className:"flex-1 p-4 overflow-y-auto",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-800 rounded-lg",children:[s.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${g?"bg-red-600":"bg-green-600"}`,children:s.jsx("span",{className:"text-white text-sm font-semibold",children:((Be=(Bt=e.name)==null?void 0:Bt.charAt(0))==null?void 0:Be.toUpperCase())||"U"})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("p",{className:"text-white text-sm font-medium",children:[e.name," (You)"]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${g?"bg-red-500":"bg-green-500 animate-pulse"}`}),s.jsx("span",{className:`text-xs ml-1 ${g?"text-red-400":"text-green-400"}`,children:g?"Muted":"Speaking"})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-gray-300 text-xs",children:"Host"}),g&&s.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mt-1"})]})]}),v.map((S,W)=>{var V,B;return s.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-800 rounded-lg",children:[s.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${S.stream?"bg-blue-600":"bg-gray-600"}`,children:s.jsx("span",{className:"text-white text-sm font-semibold",children:((B=(V=S.name)==null?void 0:V.charAt(0))==null?void 0:B.toUpperCase())||"U"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-white text-sm font-medium",children:S.name}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${S.stream?"bg-green-500 animate-pulse":"bg-yellow-500"}`}),s.jsx("span",{className:`text-xs ml-1 ${S.stream?"text-green-400":"text-yellow-400"}`,children:S.stream?"Speaking":"Connecting..."})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-gray-300 text-xs",children:"Participant"}),S.stream&&s.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-1 animate-pulse"})]})]},`${S.id}-${W}`)}),v.length===0&&s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-gray-400 text-sm",children:"Waiting for other participants..."})})]})})]})}),s.jsxs("div",{className:"bg-black bg-opacity-20 p-4",children:[s.jsxs("div",{className:"call-controls flex justify-center space-x-3",onMouseDown:S=>S.stopPropagation(),children:[d==="incoming"&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:zt,title:"Decline",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("button",{className:"w-12 h-12 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:rt,title:"Answer",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})})]}),d==="connected"&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${g?"bg-red-500 hover:bg-red-600 text-white":"bg-white bg-opacity-20 hover:bg-opacity-30 text-white"}`,onClick:be,title:g?"Unmute":"Mute",children:g?s.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),(t==null?void 0:t.callType)==="video"&&s.jsx("button",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl ${b?"bg-white bg-opacity-20 hover:bg-opacity-30 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,onClick:Le,title:b?"Disable Video":"Enable Video",children:b?s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}):s.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]})}),s.jsx("button",{className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:re,title:"End Call",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(d==="outgoing"||d==="ringing")&&s.jsx("button",{className:"w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",onClick:re,title:"Cancel Call",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),d==="connected"&&!b&&s.jsxs("div",{className:"mt-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-1 mb-2",children:[s.jsx("div",{className:"w-1 h-2 bg-green-400 rounded"}),s.jsx("div",{className:"w-1 h-3 bg-green-400 rounded"}),s.jsx("div",{className:"w-1 h-4 bg-green-400 rounded"}),s.jsx("div",{className:"w-1 h-3 bg-green-400 rounded"}),s.jsx("div",{className:"w-1 h-2 bg-green-400 rounded"})]}),s.jsx("span",{className:"text-xs text-gray-300",children:"Good audio quality"})]})]})]})},Fu=({user:e,callData:t,onCallEnd:n})=>{var ee,X;const[r,o]=h.useState(1),[i,l]=h.useState(""),[a,d]=h.useState(!1),[f,g]=h.useState(!1),[x,b]=h.useState(!1),[T,k]=h.useState(!1),[_,w]=h.useState({x:100,y:100}),[m,v]=h.useState({width:800,height:600}),y=h.useRef(null),M=h.useRef({x:0,y:0}),L=h.useRef({x:0,y:0,width:0,height:0});h.useEffect(()=>{var F;const Z=(t==null?void 0:t.roomName)||`group-${t==null?void 0:t.groupId}-${Date.now()}`,ie=`vpaas-magic-cookie-06fa758e7c18435681a16b81d4c43676/${Z}`,$=encodeURIComponent((e==null?void 0:e.name)||"User"),I=encodeURIComponent((e==null?void 0:e.email)||""),C=`https://8x8.vc/${ie}?displayName=${$}&email=${I}&config.startWithAudioMuted=false&config.startWithVideoMuted=${(t==null?void 0:t.callType)==="voice"}&config.prejoinPageEnabled=true`;console.log(" ========================================"),console.log(" JITSI VIDEO CALL"),console.log(" Room:",Z),console.log(" Full Room:",ie),console.log(" User:",e==null?void 0:e.name),console.log(" URL:",C),console.log(" ========================================"),l(C),H.success(`Joining ${((F=t==null?void 0:t.group)==null?void 0:F.name)||"group call"}`,{icon:"",duration:2e3});const q=setTimeout(()=>{o(G=>G+1),console.log(" Participant count updated (simulated)")},3e4);return()=>clearTimeout(q)},[t,e]);const O=Z=>{f||(b(!0),M.current={x:Z.clientX-_.x,y:Z.clientY-_.y})},U=Z=>{if(x&&!f&&w({x:Z.clientX-M.current.x,y:Z.clientY-M.current.y}),T&&!f){const ie=Math.max(400,L.current.width+(Z.clientX-L.current.x)),$=Math.max(300,L.current.height+(Z.clientY-L.current.y));v({width:ie,height:$})}},K=()=>{b(!1),k(!1)},oe=Z=>{f||(Z.stopPropagation(),k(!0),L.current={x:Z.clientX,y:Z.clientY,width:m.width,height:m.height})};h.useEffect(()=>{if(x||T)return window.addEventListener("mousemove",U),window.addEventListener("mouseup",K),()=>{window.removeEventListener("mousemove",U),window.removeEventListener("mouseup",K)}},[x,T,_,m]);const ne=()=>{console.log(" Ending call"),n&&n()},Y=()=>{d(!a)},ae=()=>{g(!f)};if(!i)return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-gray-900 rounded-xl p-8 text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-500 border-t-transparent mx-auto mb-4"}),s.jsx("p",{className:"text-white text-lg",children:"Preparing call..."})]})});if(a)return s.jsx("div",{className:"fixed bottom-4 right-4 z-50 bg-gradient-to-r from-gray-900 to-gray-800 rounded-xl shadow-2xl cursor-pointer hover:shadow-3xl transition-all",onClick:Y,children:s.jsxs("div",{className:"px-6 py-4 flex items-center gap-4",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center animate-pulse",children:s.jsx(ur,{size:24,className:"text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-bold text-white text-sm",children:((ee=t==null?void 0:t.group)==null?void 0:ee.name)||"Video Call"}),s.jsxs("p",{className:"text-xs text-gray-300 flex items-center gap-2",children:[s.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Call in progress"]})]})]})});const A=f?{position:"fixed",inset:0,width:"100%",height:"100%"}:{position:"fixed",left:_.x,top:_.y,width:m.width,height:m.height};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 z-40"}),s.jsxs("div",{ref:y,className:`z-50 bg-gray-900 rounded-xl shadow-2xl overflow-hidden flex flex-col ${x?"cursor-grabbing":""} ${f?"":"border-2 border-gray-700"}`,style:A,children:[s.jsxs("div",{className:`bg-gradient-to-r from-gray-900 to-gray-800 px-4 py-3 flex items-center justify-between border-b border-gray-700 shadow-lg ${f?"":"cursor-grab active:cursor-grabbing"}`,onMouseDown:O,children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow-lg",children:s.jsx(ln,{size:20,className:"text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-bold text-white text-sm",children:((X=t==null?void 0:t.group)==null?void 0:X.name)||"Video Call"}),s.jsxs("p",{className:"text-xs text-gray-300 flex items-center gap-2",children:[s.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Group ",(t==null?void 0:t.callType)==="voice"?"Voice":"Video"," Call"]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:Y,className:"p-2 hover:bg-gray-700 rounded-lg transition-all text-gray-400 hover:text-white",title:"Minimize",children:s.jsx(pb,{size:18})}),s.jsx("button",{onClick:ae,className:"p-2 hover:bg-gray-700 rounded-lg transition-all text-gray-400 hover:text-white",title:f?"Exit Fullscreen":"Fullscreen",children:s.jsx(mb,{size:18})}),s.jsxs("button",{onClick:ne,className:"px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg transition-all text-white font-semibold shadow-lg hover:shadow-xl flex items-center gap-2",title:"End Call",children:[s.jsx(gi,{size:16}),"End"]})]})]}),s.jsx("div",{className:"flex-1 relative bg-black",children:s.jsx("iframe",{src:i,allow:"camera; microphone; fullscreen; display-capture; autoplay",className:"w-full h-full border-0",title:"Jitsi Meet",onLoad:()=>{console.log(" Jitsi iframe loaded successfully"),H.success("Call connected",{icon:"",duration:2e3})},onError:()=>{console.error(" Jitsi iframe load error"),H.error("Failed to load call")}})}),!f&&s.jsx("div",{className:"absolute bottom-0 right-0 w-8 h-8 cursor-nwse-resize hover:bg-blue-500 hover:bg-opacity-30 transition-all",onMouseDown:oe,title:"Drag to resize",children:s.jsxs("div",{className:"absolute bottom-1 right-1 flex flex-col gap-0.5",children:[s.jsxs("div",{className:"flex gap-0.5 justify-end",children:[s.jsx("div",{className:"w-1 h-1 bg-gray-500 rounded-full"}),s.jsx("div",{className:"w-1 h-1 bg-gray-500 rounded-full"})]}),s.jsx("div",{className:"flex gap-0.5 justify-end",children:s.jsx("div",{className:"w-1 h-1 bg-gray-500 rounded-full"})})]})}),!f&&s.jsx("div",{className:"absolute top-3 right-1/2 transform translate-x-1/2 flex gap-1 pointer-events-none",children:s.jsx(hb,{size:16,className:"text-gray-500"})})]})]})},zu=({callData:e,onAccept:t,onDecline:n})=>{var l,a;const r=((l=e==null?void 0:e.group)==null?void 0:l.name)||(e==null?void 0:e.groupName)||"Group Call",o=((a=e==null?void 0:e.initiator)==null?void 0:a.name)||"Someone",i=(e==null?void 0:e.callType)||"video";return s.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 animate-fadeIn",children:[s.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-800 rounded-2xl shadow-2xl p-8 w-96 text-center text-white animate-slideUp",children:[s.jsxs("div",{className:"relative mb-6",children:[s.jsx("div",{className:"w-24 h-24 rounded-full bg-white bg-opacity-20 flex items-center justify-center mx-auto animate-pulse",children:s.jsx(ur,{size:48,className:"text-white"})}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx("div",{className:"w-32 h-32 rounded-full border-4 border-white border-opacity-30 animate-ping"})})]}),s.jsx("h2",{className:"text-2xl font-bold mb-2",children:r}),s.jsxs("p",{className:"text-blue-100 mb-1",children:[o," is starting a ",i," call"]}),s.jsx("p",{className:"text-sm text-blue-200 mb-8",children:i==="video"?"Video call with screen sharing":"Voice call"}),s.jsxs("div",{className:"inline-flex items-center gap-2 bg-white bg-opacity-20 px-4 py-2 rounded-full mb-8",children:[s.jsx(ur,{size:16}),s.jsx("span",{className:"text-sm font-medium",children:i==="video"?"Video Call":"Voice Call"})]}),s.jsxs("div",{className:"flex gap-4 justify-center",children:[s.jsx("button",{onClick:n,className:"w-16 h-16 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-110 active:scale-95",title:"Decline",children:s.jsx(gb,{size:24})}),s.jsx("button",{onClick:t,className:"w-16 h-16 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-110 active:scale-95 animate-bounce",title:"Accept",children:s.jsx(hi,{size:24})})]}),s.jsxs("div",{className:"mt-6 flex items-center justify-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),s.jsx("span",{className:"text-sm text-blue-100",children:"Incoming call..."})]})]}),s.jsx("style",{dangerouslySetInnerHTML:{__html:`
        @keyframes fadeIn {
          from {
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }

        @keyframes slideUp {
          from {
            transform: translateY(100px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }

        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }

        .animate-slideUp {
          animation: slideUp 0.4s ease-out;
        }
      `}})]})},jb=()=>{const{user:e,logout:t}=Fn(),{socket:n,notifications:r,handleActivateUser:o,handleCloseNotification:i}=po(),[l,a]=h.useState({totalUsers:0,totalGroups:0,activeUsers:0,disabledUsers:0}),[d,f]=h.useState(!0),[g,x]=h.useState(!1),[b,T]=h.useState(!1),[k,_]=h.useState(!1),[w,m]=h.useState(null),[v,y]=h.useState(!1),[M,L]=h.useState(!1),[O,U]=h.useState(null),[K,oe]=h.useState(!1);h.useEffect(()=>{ne()},[]),h.useEffect(()=>{if(n)return console.log(" Setting up Admin Dashboard call listeners..."),n.off("incoming-call"),n.on("incoming-call",A=>{var ee;console.log(" Admin Dashboard - Incoming call received:",A),H.success(`Incoming ${A.callType} call from ${((ee=A.caller)==null?void 0:ee.name)||"Unknown"}`,{duration:5e3,icon:""}),y(!0),m({callId:A.callId,callType:A.callType,caller:A.caller}),_(!0)}),n.off("call-initiated"),n.on("call-initiated",A=>{console.log(" Admin Dashboard - Call initiated:",A),y(!1),m({callId:A.callId,callType:A.callType,otherUser:A.receiver}),_(!0)}),n.off("call-error"),n.on("call-error",A=>{console.error(" Admin Dashboard - Call error:",A),H.error(A.error||"Call failed",{duration:4e3})}),n.off("incoming-group-call"),n.on("incoming-group-call",A=>{var ee;console.log(" Admin Dashboard - Incoming group call received:",A),H.success(`Incoming group ${A.callType} call from ${((ee=A.initiator)==null?void 0:ee.name)||"Unknown"}`,{duration:5e3,icon:""}),oe(!0),U({callId:A.callId,callType:A.callType,groupId:A.groupId,roomName:A.roomName,group:A.group||{name:A.groupName},initiator:A.initiator}),L(!0)}),n.off("group-call-initiated"),n.on("group-call-initiated",A=>{console.log(" Admin Dashboard - Group call initiated:",A),oe(!1),U({callId:A.callId,callType:A.callType,groupId:A.groupId,roomName:A.roomName,group:A.group}),L(!0)}),n.off("group-call-error"),n.on("group-call-error",A=>{console.error(" Admin Dashboard - Group call error:",A),H.error(A.error||"Group call failed",{duration:4e3})}),()=>{n.off("incoming-call"),n.off("call-initiated"),n.off("call-error"),n.off("incoming-group-call"),n.off("group-call-initiated"),n.off("group-call-error")}},[n]),h.useEffect(()=>{const A=ee=>{if(g){const X=document.querySelector(".notification-panel");X&&!X.contains(ee.target)&&x(!1)}};return g&&document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[g]),h.useEffect(()=>{const A=ee=>{if(b){const X=document.querySelector(".account-menu-container");X&&!X.contains(ee.target)&&T(!1)}};return b&&document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[b]);const ne=async()=>{try{f(!0);const[A,ee]=await Promise.all([e.role==="user"?Vt.getActiveUsers():Vt.getUsers(),Rn.getMyGroups()]),X=Array.isArray(A.data)?A.data:[],Z=X.filter($=>($.isActive??!0)===!0).length,ie=X.filter($=>($.isActive??!0)===!1).length;a({totalUsers:X.length,totalGroups:ee.data.length,activeUsers:Z,disabledUsers:ie})}catch{H.error("Failed to load dashboard data")}finally{f(!1)}},Y=A=>{switch(A){case"superadmin":return s.jsx(Yl,{className:"w-5 h-5 text-yellow-600"});case"admin":return s.jsx(Ca,{className:"w-5 h-5 text-blue-600"});default:return s.jsx(fn,{className:"w-5 h-5 text-gray-600"})}},ae=A=>{switch(A){case"superadmin":return"bg-yellow-100 text-yellow-800";case"admin":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return d?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white shadow-sm border-b",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"flex justify-between items-center py-6",children:[s.jsx("div",{className:"flex items-center space-x-4",children:s.jsxs(Gl,{to:"/profile",className:"flex items-center space-x-3 hover:opacity-80 transition-opacity",children:[e.profileImage?s.jsx("img",{src:`${ze}${e.profileImage}`,alt:"Profile",className:"w-12 h-12 rounded-full object-cover"}):s.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-primary-600 font-medium text-lg",children:e.name.charAt(0).toUpperCase()})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),s.jsxs("p",{className:"text-gray-600",children:["Welcome back, ",e.name,"!"]})]})]})}),s.jsxs("div",{className:"flex items-center space-x-4",children:[(e.role==="admin"||e.role==="superadmin")&&s.jsx("div",{className:"relative",children:s.jsxs("button",{onClick:()=>x(!g),className:"relative p-2 text-gray-600 hover:text-primary-600 hover:bg-gray-100 rounded-full transition-colors",children:[s.jsx(lc,{className:"w-6 h-6"}),r.length>0&&s.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:r.length})]})}),s.jsxs("div",{className:"relative account-menu-container",children:[s.jsx("button",{onClick:()=>T(A=>!A),className:`px-3 py-1 rounded-full text-sm font-medium hover:opacity-90 transition ${ae(e.role)}`,children:s.jsxs("div",{className:"flex items-center space-x-1",children:[Y(e.role),s.jsx("span",{className:"capitalize",children:e.role})]})}),b&&s.jsx("div",{className:"absolute right-0 mt-2 w-44 bg-white border border-gray-200 rounded-md shadow-lg z-20",children:s.jsxs("button",{onClick:()=>{T(!1),t(),H.success("Logged out successfully")},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[s.jsx(Kg,{className:"w-4 h-4"}),s.jsx("span",{children:"Logout"})]})})]})]})]})})}),g&&(e.role==="admin"||e.role==="superadmin")&&s.jsx("div",{className:"notification-panel bg-white border-b shadow-sm",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(lc,{className:"w-5 h-5 text-primary-600"}),s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Notifications"}),r.length>0&&s.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:r.length})]}),s.jsx("button",{onClick:()=>x(!1),className:"text-gray-400 hover:text-gray-600",children:s.jsx(gi,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"space-y-3",children:r.length===0?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(lc,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),s.jsx("p",{children:"No notifications yet"})]}):r.map(A=>s.jsx("div",{className:"border border-orange-200 bg-orange-50 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:s.jsx(fn,{className:"w-4 h-4 text-orange-600"})})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"text-sm font-bold text-orange-700 flex items-center gap-2",children:[s.jsx("span",{children:""}),"Disabled User Login Attempt"]}),s.jsxs("div",{className:"mt-1 text-sm",children:[s.jsx("div",{className:"font-semibold text-gray-900",children:A.userName}),s.jsx("div",{className:"text-gray-600",children:A.userEmail}),s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Time: ",new Date(A.timestamp).toLocaleTimeString()]})]})]}),s.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[s.jsxs("button",{onClick:()=>o(A.userId),className:"flex items-center space-x-1 bg-green-600 text-white px-3 py-1.5 rounded-md text-xs font-medium hover:bg-green-700 transition-colors",children:[s.jsx(xd,{className:"w-3 h-3"}),s.jsx("span",{children:"Activate"})]}),s.jsxs("button",{onClick:()=>i(A.id),className:"flex items-center space-x-1 bg-gray-100 text-gray-700 px-3 py-1.5 rounded-md text-xs font-medium hover:bg-gray-200 transition-colors",children:[s.jsx(gi,{className:"w-3 h-3"}),s.jsx("span",{children:"Close"})]})]})]})},A.id))})]})}),s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[s.jsx("div",{className:"card p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:s.jsx(ln,{className:"w-6 h-6 text-blue-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.totalUsers})]})]})}),s.jsx("div",{className:"card p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-3 rounded-full bg-green-100",children:s.jsx(ms,{className:"w-6 h-6 text-green-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"My Groups"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.totalGroups})]})]})}),s.jsx("div",{className:"card p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-3 rounded-full bg-green-100",children:s.jsx(ln,{className:"w-6 h-6 text-green-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Users"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.activeUsers})]})]})}),s.jsx("div",{className:"card p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-3 rounded-full bg-red-100",children:s.jsx(ln,{className:"w-6 h-6 text-red-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Disabled Users"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.disabledUsers})]})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{className:"card p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quick Chat"}),s.jsx(ms,{className:"w-5 h-5 text-gray-400"})]}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Start chatting with other users or join group conversations."}),s.jsxs("a",{href:"/chat",className:"btn-primary inline-flex items-center",children:[s.jsx(ms,{className:"w-4 h-4 mr-2"}),"Open Chat"]})]}),e.role!=="user"&&s.jsxs("div",{className:"card p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Management"}),s.jsx(Pu,{className:"w-5 h-5 text-gray-400"})]}),s.jsx("p",{className:"text-gray-600 mb-4",children:e.role==="superadmin"?"Manage admins and view all users in the system.":"Manage users and create groups for team communication."}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("a",{href:"/users",className:"btn-secondary w-full inline-flex items-center justify-center",children:[s.jsx(Lu,{className:"w-4 h-4 mr-2"}),e.role==="superadmin"?"Manage Admins":"Manage Users"]}),e.role==="admin"&&s.jsxs("a",{href:"/groups",className:"btn-primary w-full inline-flex items-center justify-center",children:[s.jsx(Kl,{className:"w-4 h-4 mr-2"}),"Manage Groups"]})]})]}),s.jsxs("div",{className:"card p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Account Info"}),s.jsx(fn,{className:"w-5 h-5 text-gray-400"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Name:"}),s.jsx("span",{className:"ml-2 text-gray-900",children:e.name})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Email:"}),s.jsx("span",{className:"ml-2 text-gray-900",children:e.email})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Role:"}),s.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${ae(e.role)}`,children:e.role})]})]})]}),e.role==="superadmin"&&s.jsxs("div",{className:"card p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"System Overview"}),s.jsx(Yl,{className:"w-5 h-5 text-yellow-600"})]}),s.jsx("p",{className:"text-gray-600 mb-4",children:"You have full access to manage the entire system including admins and all users."}),s.jsxs("div",{className:"text-sm text-gray-500",children:[s.jsx("p",{children:" Create and manage admin accounts"}),s.jsx("p",{children:" View all system users"}),s.jsx("p",{children:" Monitor system activity"})]})]})]})]}),k&&w&&s.jsx(s.Fragment,{children:w.callType==="voice"?s.jsx(Uu,{user:e,callData:w,isIncoming:v,onCallEnd:()=>{_(!1),m(null),y(!1)},onCallAnswer:()=>{y(!1)},onCallDecline:()=>{_(!1),m(null),y(!1)}}):s.jsx(Ou,{user:e,callData:w,isIncoming:v,onCallEnd:()=>{_(!1),m(null),y(!1)},onCallAnswer:()=>{y(!1)},onCallDecline:()=>{_(!1),m(null),y(!1)}})}),M&&O&&K&&O.callType==="video"&&s.jsx(zu,{callData:O,onAccept:()=>{console.log(" Admin Dashboard - Accepting incoming video call"),oe(!1),n&&(O!=null&&O.callId)&&n.emit("group-call-join",{callId:O.callId,groupId:O.groupId})},onDecline:()=>{L(!1),U(null),oe(!1),n&&(O!=null&&O.callId)&&n.emit("group-call-decline",{callId:O.callId,groupId:O.groupId})}}),M&&O&&!K&&(O.callType==="video"?s.jsx(Fu,{user:e,callData:O,onCallEnd:()=>{L(!1),U(null),oe(!1)}}):s.jsx($u,{user:e,callData:O,isIncoming:K,onCallEnd:()=>{L(!1),U(null),oe(!1)},onCallAnswer:()=>{oe(!1)},onCallDecline:()=>{L(!1),U(null),oe(!1)}}))]})};class Nb{constructor(){this.socket=null,this.isConnected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.reconnectDelay=1e3,this.pingInterval=null,this.lastPingTime=Date.now(),this.currentUserId=null,this.listeners=new Map,this.isConnecting=!1}connect(){if(this.isConnecting)return this.socket;if(this.socket&&this.socket.connected)return this.socket;console.log(" Creating new socket connection..."),this.isConnecting=!0,this.socket&&(this.socket.disconnect(),this.socket=null);const t=localStorage.getItem("token");return this.socket=qo("https://internalchat.pizeonfly.com",{autoConnect:!0,reconnection:!0,reconnectionDelay:this.reconnectDelay,reconnectionAttempts:this.maxReconnectAttempts,maxReconnectionAttempts:this.maxReconnectAttempts,timeout:2e4,forceNew:!0,multiplex:!1,transports:["websocket","polling"],auth:{token:t}}),this.setupEventHandlers(),this.isConnecting=!1,this.socket}setupEventHandlers(){this.socket.on("connect",()=>{this.isConnected=!0,this.reconnectAttempts=0,this.lastPingTime=Date.now(),console.log(" ===== SOCKET CONNECTED ===== "),console.log(" Socket ID:",this.socket.id),console.log(" Connection URL:",this.socket.io.uri),console.log(" Transport:",this.socket.io.engine.transport.name),console.log(" Current User ID:",this.currentUserId),console.log(" Active listeners:",this.listeners.size),console.log("========================================"),this.currentUserId&&this.joinUserRoom(this.currentUserId),this.startPingMonitoring(),this.setupMessageListeners(),this.socket.emit("ping",{timestamp:Date.now()}),console.log(" Enhanced connection alive detection initiated")}),this.socket.on("disconnect",t=>{this.isConnected=!1,console.log(" ===== SOCKET DISCONNECTED ===== "),console.log(" Reason:",t),console.log(" Attempting reconnection..."),console.log("========================================"),this.stopPingMonitoring(),this.attemptReconnection()}),this.socket.on("connect_error",t=>{console.error(" ===== CONNECTION ERROR ===== "),console.error(" Error:",t.message),console.error(" URL:",t.type),console.error(" Status:",t.description),console.error("========================================="),this.attemptReconnection()}),this.socket.on("reconnect",t=>{console.log(" ===== RECONNECTION SUCCESSFUL ===== "),console.log(" Attempts tried:",t),console.log(" New Socket ID:",this.socket.id),console.log("==============================================")}),this.socket.on("ping",t=>{this.lastPingTime=Date.now(),console.log(" Ping received - Connection alive, timestamp:",new Date(this.lastPingTime).toLocaleTimeString())}),this.socket.on("pong",t=>{this.lastPingTime=Date.now(),console.log(" Pong received - Connection confirmed, timestamp:",new Date(this.lastPingTime).toLocaleTimeString())}),this.socket.on("connect_timeout",()=>{console.log(" ===== CONNECTION TIMEOUT ===== "),console.log(" Socket connection timed out"),console.log("======================================")}),this.socket.on("reconnect_error",t=>{console.error(" ===== RECONNECTION ERROR ===== "),console.error("Error:",t.message),console.error("========================================")}),this.socket.on("reconnect_failed",()=>{console.error(" ===== FAILED RECONNECTION ===== "),console.error(" Socket reconnection permanently failed"),console.error(" Attempting force reconnect..."),console.error("===========================================")})}setupMessageListeners(){console.log(" ===== SETTING UP MESSAGE LISTENERS ===== "),console.log(" Total listeners to register:",this.listeners.size);for(const[t,n]of this.listeners)this.socket&&(this.socket.removeAllListeners(t),this.socket.on(t,n),console.log(` Re-registered listener: ${t}`));console.log(" ===== ALL LISTENERS ACTIVE ===== "),console.log(" Socket ready for real-time messaging"),console.log("========================================")}maintainConnection(){console.log(" ===== MAINTAINING PERSISTENT CONNECTION ===== "),!this.isConnected||!this.socket?(console.log(" Socket disconnected, reconnecting..."),this.connect()):(console.log(" Socket is connected, maintaining listeners"),this.setupMessageListeners(),this.socket&&this.isConnected&&(this.socket.emit("ping",{timestamp:Date.now()}),this.lastPingTime=Date.now(),console.log("Keep-alive ping sent - Connection maintained"),setTimeout(()=>{this.socket&&this.isConnected&&this.socket.emit("pong",{timestamp:Date.now()})},100))),console.log("==============================================")}forceChatroomReception(){console.log(" FORCING CHATROOM MESSAGE RECEPTION"),this.socket&&this.isConnected?(this.setupMessageListeners(),console.log(" Chatroom reception listeners reinforced")):(console.log(" Socket not available for chatroom reinforcement"),this.connect()),console.log("=====")}startPingMonitoring(){this.pingInterval&&clearInterval(this.pingInterval),this.pingInterval=setInterval(()=>{const t=Date.now()-this.lastPingTime;if(console.log(` Health check: Time since last ping: ${t}ms`),this.socket&&this.isConnected&&t>45e3&&(console.log(" Proactive ping sent to prevent timeout"),this.socket.emit("ping",{timestamp:Date.now()}),this.lastPingTime=Date.now()),t>18e4){if(console.log(" Extended timeout reached - checking real disconnection"),this.socket&&this.socket.connected&&this.isConnected){console.log(" Socket connection verified alive, resetting timer"),this.lastPingTime=Date.now();return}console.log(" Real disconnection confirmed, force reconnecting..."),this.forceReconnect()}else console.log(` Socket health maintained: ${t}ms response time`)},25e3)}stopPingMonitoring(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null)}attemptReconnection(){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log(" ===== ATTEMPTING RECONNECTION ===== "),console.log(` Attempt: ${this.reconnectAttempts}/${this.maxReconnectAttempts}`),console.log(` Delay: ${this.reconnectDelay*this.reconnectAttempts}ms`),console.log("===================="),setTimeout(()=>{console.log(" Executing reconnection..."),this.connect()},this.reconnectDelay*this.reconnectAttempts)):(console.log(" ===== MAX ATTEMPTS REACHED ===== "),console.log(" Forcing socket reset..."),setTimeout(()=>{this.forceReconnect()},this.reconnectDelay*5),console.log("====================================="))}forceReconnect(){console.log(" Force reconnecting socket..."),this.stopPingMonitoring(),this.reconnectAttempts=0,this.socket&&(this.socket.disconnect(),this.socket=null),setTimeout(()=>{this.connect()},2e3)}disconnect(){this.stopPingMonitoring(),this.listeners.clear(),this.socket&&(this.socket.disconnect(),this.socket=null),this.isConnected=!1,this.currentUserId=null}joinUserRoom(t){this.currentUserId=t,this.socket&&this.isConnected?(this.socket.emit("join",t),console.log(" Joined user room:",t)):console.log(" Waiting to join user room after connection...")}joinGroupRoom(t){this.socket&&this.socket.emit("join-group",t)}leaveGroupRoom(t){this.socket&&this.socket.emit("leave-group",t)}sendPersonalMessage(t){var n;if(console.log(" ===== SENDING PERSONAL MESSAGE ===== "),console.log(" Data:",t),console.log(" Socket available:",!!this.socket),console.log(" Socket connected:",this.isConnected),console.log(" Socket ID:",(n=this.socket)==null?void 0:n.id),!this.socket||!this.isConnected){console.log(" Socket not connected, connecting first..."),this.connect(),setTimeout(()=>{this.socket&&this.isConnected?(console.log(" Retrying message send after connection"),this.socket.emit("send-message",t),console.log(" Personal message retry sent successfully")):console.error(" Still not connected after retry")},2e3);return}this.ensureConnected(),this.socket&&this.isConnected?(this.socket.emit("send-message",t),console.log(" Personal message sent successfully"),setTimeout(()=>{this.socket&&this.isConnected&&this.socket.emit("ping",{timestamp:Date.now()})},100)):console.error(" Socket lost connection before sending message"),console.log("=============================================")}sendGroupMessage(t){var n;if(console.log(" ===== SENDING GROUP MESSAGE ===== "),console.log(" Data:",t),console.log(" Socket available:",!!this.socket),console.log(" Socket connected:",this.isConnected),console.log(" Socket ID:",(n=this.socket)==null?void 0:n.id),!this.socket||!this.isConnected){console.log(" Socket not connected, connecting first..."),this.connect(),setTimeout(()=>{this.socket&&this.isConnected?(console.log(" Retrying group message send after connection"),this.socket.emit("send-group-message",t),console.log(" Group message retry sent successfully")):console.error(" Still not connected after retry")},2e3);return}this.socket.emit("send-group-message",t),console.log(" Group message sent successfully"),console.log("============================================")}onReceiveMessage(t){console.log(" Registering onReceiveMessage listener"),this.registerListener("receive-message",n=>{console.log(" Received message:",n);const r={...n,_isExternalMessage:!0,_timestamp:new Date().toISOString()};t(r)}),setTimeout(()=>{this.socket&&this.isConnected&&(this.socket.off("receive-message"),this.socket.on("receive-message",n=>{console.log(" Maintained receive-message listener:",n);const r={...n,_isExternalMessage:!0,_timestamp:new Date().toISOString()};t(r)}),console.log(" Listener re-registered for chatroom persistence"))},1e3)}onReceiveGroupMessage(t){console.log(" Registering onReceiveGroupMessage listener"),this.registerListener("receive-group-message",n=>{console.log(" Received group message:",n);const r={...n,_isExternalMessage:!0,_timestamp:new Date().toISOString()};t(r)})}onMessageSent(t){console.log(" Registering onMessageSent listener"),this.registerListener("message-sent",n=>{console.log(" Message sent confirmation:",n);const r={...n,_isOurMessage:!0,_isConfirmation:!0,_timestamp:new Date().toISOString()};t(r)})}registerListener(t,n){this.listeners.set(t,n),console.log(` Stored listener for event: ${t}`),this.socket&&this.isConnected?(this.socket.off(t),this.socket.on(t,n),console.log(` Listener immediately registered for event: ${t}`)):console.log(` Listener queued for event: ${t} (waiting for connection)`)}onGroupMessageSent(t){this.registerListener("group-message-sent",t)}onTyping(t){this.registerListener("user-typing",t)}sendTyping(t){this.socket&&this.isConnected&&this.socket.emit("typing",t)}onError(t){this.registerListener("error",t)}onAvatarUpdate(t){this.registerListener("avatar-updated",t)}onUserProfileUpdate(t){this.registerListener("user-profile-updated",t)}removeAllListeners(){this.listeners.clear(),this.socket&&(this.socket.removeAllListeners(),this.socket.on("connect",()=>{this.isConnected=!0,this.reconnectAttempts=0,this.lastPingTime=Date.now(),this.currentUserId&&this.joinUserRoom(this.currentUserId),this.startPingMonitoring(),this.setupMessageListeners()}))}ensureConnected(){return!this.socket||!this.isConnected?(console.log(" Ensuring socket connection..."),this.connect()):!0}getConnectionStatus(){var t;return{isConnected:this.isConnected,socketId:(t=this.socket)==null?void 0:t.id,lastPing:new Date(this.lastPingTime).toLocaleString(),listenersCount:this.listeners.size}}logConnectionStatus(){var t,n,r,o,i,l,a;console.log(" ===== SOCKET STATUS REPORT ===== "),console.log(" Is Connected:",this.isConnected?" YES":" NO"),console.log(" Socket ID:",((t=this.socket)==null?void 0:t.id)||"N/A"),console.log(" Connection URL:",((r=(n=this.socket)==null?void 0:n.io)==null?void 0:r.uri)||"N/A"),console.log(" Transport:",((a=(l=(i=(o=this.socket)==null?void 0:o.io)==null?void 0:i.engine)==null?void 0:l.transport)==null?void 0:a.name)||"N/A"),console.log(" Current User ID:",this.currentUserId||"Not set"),console.log(" Active Listeners:",this.listeners.size),console.log(" Reconnect Attempts:",this.reconnectAttempts),console.log(" Last Ping:",new Date(this.lastPingTime).toLocaleTimeString()),console.log(" Listeners registered:",Array.from(this.listeners.keys()).join(", ")||"None"),console.log("========================================")}testConnection(){console.log(" ===== TESTING SOCKET CONNECTION ===== "),this.logConnectionStatus(),this.socket&&(console.log(" Emitting test ping..."),this.socket.emit("ping")),console.log("============================================")}forceConnectionTest(){console.log(" ===== MANUAL CONNECTION FORCE TEST ===== "),this.connect(),setTimeout(()=>{this.testConnection()},3e3),console.log("=============================================")}reset(){console.log(" Resetting socket service..."),this.disconnect(),this.currentUserId=null,this.listeners.clear(),this.reconnectAttempts=0,this.isConnecting=!1,clearTimeout(this.reconnectTimeout)}}const Et=new Nb,Am=()=>{const{user:e,logout:t}=Fn(),{socket:n,isConnected:r,sendMessage:o,joinGroup:i,leaveGroup:l,onReceiveMessage:a,onReceiveGroupMessage:d,onMessageSent:f,getConnectionStatus:g,isUserOnline:x,getUserStatus:b}=po(),[T,k]=h.useState([]),[_,w]=h.useState([]),[m,v]=h.useState(null),[y,M]=h.useState([]),[L,O]=h.useState(""),[U,K]=h.useState(""),[oe,ne]=h.useState(!0),[Y,ae]=h.useState({}),[A,ee]=h.useState({}),[X,Z]=h.useState("all"),[ie,$]=h.useState(!1),[I,C]=h.useState(!1),q=50,[F,G]=h.useState(null),[he,Ie]=h.useState(null),[me,Ce]=h.useState(!1),[Oe,kt]=h.useState({}),[Ne,At]=h.useState(()=>{try{const u=sessionStorage.getItem("downloadedMessages");return u?JSON.parse(u):{}}catch{return{}}}),[Cn,qe]=h.useState(!1),[qt,St]=h.useState(null),[nt,Je]=h.useState(!1),[ue,je]=h.useState(null),[$e,Ge]=h.useState(null),[dt,mt]=h.useState(null),[Me,Re]=h.useState(null),[wt,rt]=h.useState(1),[zt,re]=h.useState({x:0,y:0}),[be,Le]=h.useState(!1),Ct=()=>{rt(u=>Math.min(u*1.25,4))},we=()=>{rt(u=>Math.max(u/1.25,.5))},bt=()=>{rt(1),re({x:0,y:0})},He=u=>{u.preventDefault(),Le(!0),re({x:u.clientX-zt.x,y:u.clientY-zt.y})},Zn=u=>{be&&(u.preventDefault(),re({x:u.clientX-zt.x,y:u.clientY-zt.y}))},zn=()=>{Le(!1)},er=u=>{Ge(u),rt(1),re({x:0,y:0})},[Jr,Yt]=h.useState(!1),[Xe,Kt]=h.useState(null),[Bt,Be]=h.useState(!1),S=u=>u&&(/^https?:\/\//i.test(u)?u:`${ze}${u}`),W=u=>{if(!u)return"";const j=new Date(u),c=new Date,p=new Date(c.getFullYear(),c.getMonth(),c.getDate()),E=new Date(p);E.setDate(E.getDate()-1);const N=new Date(j.getFullYear(),j.getMonth(),j.getDate());return N.getTime()===p.getTime()?j.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):N.getTime()===E.getTime()?"Yesterday":Math.floor((p-N)/(1e3*60*60*24))<7?j.toLocaleDateString([],{weekday:"short"}):j.toLocaleDateString([],{day:"numeric",month:"numeric",year:j.getFullYear()!==c.getFullYear()?"numeric":void 0})},V=u=>{if(!u)return"";const j=new Date(u),c=new Date,p=new Date(c.getFullYear(),c.getMonth(),c.getDate()),E=new Date(p);E.setDate(E.getDate()-1);const N=new Date(j.getFullYear(),j.getMonth(),j.getDate());return N.getTime()===p.getTime()?"Today":N.getTime()===E.getTime()?"Yesterday":Math.floor((p-N)/(1e3*60*60*24))<7?j.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric"}):j.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric",year:j.getFullYear()!==c.getFullYear()?"numeric":void 0})},B=u=>{if(!u)return"Last seen recently";const j=new Date,c=new Date(u),p=j-c,E=Math.floor(p/(1e3*60)),N=Math.floor(p/(1e3*60*60)),R=Math.floor(p/(1e3*60*60*24));return E<1?"Last seen just now":E<60?`Last seen ${E} minute${E===1?"":"s"} ago`:N<24?`Last seen ${N} hour${N===1?"":"s"} ago`:R===1?"Last seen yesterday":R<7?`Last seen ${R} day${R===1?"":"s"} ago`:`Last seen ${c.toLocaleDateString([],{month:"short",day:"numeric"})}`},[se,xe]=h.useState(null),[Ee,le]=h.useState(!1),[ge,pt]=h.useState(null),[ht,vr]=h.useState(null),[Xr,wr]=h.useState(""),[Pt,Zr]=h.useState(null),gt=u=>((u==null?void 0:u.id)||(u==null?void 0:u._id)||(u==null?void 0:u.messageId)||"").toString(),an=u=>{se&&clearTimeout(se);const j=setTimeout(()=>{pt(u),le(!0)},700);xe(j)},lt=()=>{se&&(clearTimeout(se),xe(null))},es=(u,j)=>{j.stopPropagation(),Zr(Pt===u?null:u)},Ye=(u,j)=>{switch(pt(j),Zr(null),u){case"copy":Bn(j);break;case"edit":go(j);break;case"forward":Qt(j);break}},Bn=async u=>{try{const j=(u==null?void 0:u.messageType)==="text"?(u==null?void 0:u.message)||"":S(u==null?void 0:u.fileUrl)||(u==null?void 0:u.fileName)||"";j&&(await navigator.clipboard.writeText(j),H.success("Copied to clipboard"))}catch(j){console.error("Copy failed:",j),H.error("Failed to copy")}},Qt=u=>{try{sessionStorage.setItem("forwardMessage",JSON.stringify({id:u.id||u._id,message:u.message,messageType:u.messageType,fileUrl:u.fileUrl,fileName:u.fileName,fileSize:u.fileSize,fileType:u.fileType})),H.success("Message ready to forward"),window.location.href="/forward"}catch(j){console.error("Forward setup failed:",j),H.error("Failed to prepare message for forwarding")}},go=u=>{var j,c,p,E;if(u&&u.messageType==="text"){const N=((j=u.sender)==null?void 0:j.id)||((c=u.sender)==null?void 0:c._id)||u.sender;N===e.id||N===e._id||N===((p=e.id)==null?void 0:p.toString())||N===((E=e._id)==null?void 0:E.toString())?(vr(u),wr(u.message||"")):H.error("You can only edit your own messages")}},gn=async()=>{if(!(!ht||!Xr.trim()))try{M(u=>u.map(j=>gt(j)===gt(ht)?{...j,message:Xr.trim(),isEdited:!0,editedAt:new Date().toISOString()}:j)),await at.editMessage(ht.id||ht._id,Xr.trim()),vr(null),wr("")}catch(u){console.error("Failed to edit message:",u),H.error("Failed to edit message")}},Ii=()=>{vr(null),wr("")},Ti=h.useRef(null),xo=h.useRef(!0),Jt=h.useRef(null),ts=h.useRef(0),br=h.useRef(null),jr=h.useRef(!1);h.useEffect(()=>((async()=>{try{console.log(" Loading chat state from database for UserDashboard...");const j=await at.getChatState(),{personalChats:c,groupChats:p}=j.data,E={},N={};c.forEach(R=>{var P,D,ce;R.unreadCount>0&&(E[R.chatId]=R.unreadCount),R.lastMessage&&R.lastMessage.message&&(N[R.chatId]={id:R.lastMessage._id||R.lastMessage.id,message:R.lastMessage.message,senderName:R.lastMessage.senderName||((P=R.lastMessage.sender)==null?void 0:P.name)||"User",senderId:R.lastMessage.senderId||((D=R.lastMessage.sender)==null?void 0:D._id)||((ce=R.lastMessage.sender)==null?void 0:ce.id),timestamp:R.lastMessage.createdAt||R.lastMessage.timestamp})}),p.forEach(R=>{var P,D,ce;R.unreadCount>0&&(E[R.chatId]=R.unreadCount),R.lastMessage&&R.lastMessage.message&&(N[R.chatId]={id:R.lastMessage._id||R.lastMessage.id,message:R.lastMessage.message,senderName:R.lastMessage.senderName||((P=R.lastMessage.sender)==null?void 0:P.name)||"User",senderId:R.lastMessage.senderId||((D=R.lastMessage.sender)==null?void 0:D._id)||((ce=R.lastMessage.sender)==null?void 0:ce.id),timestamp:R.lastMessage.createdAt||R.lastMessage.timestamp})}),ae(E),ee(N),console.log(" UserDashboard chat state loaded from database:",{unreadCounts:E,lastMessages:Object.keys(N).length})}catch(j){console.error("Error loading chat state from database:",j)}})(),ns(),yo(),()=>{}),[]),h.useEffect(()=>{if(n)return console.log(" Setting up PERSISTENT call listeners for UserDashboard..."),n.off("incoming-call"),n.on("incoming-call",u=>{var j;console.log(" UserDashboard - Incoming call received:",u),H.success(`Incoming ${u.callType} call from ${((j=u.caller)==null?void 0:j.name)||"Unknown"}`,{duration:5e3,icon:""}),Je(!0),St({callId:u.callId,callType:u.callType,caller:u.caller}),qe(!0)}),n.off("call-initiated"),n.on("call-initiated",u=>{console.log(" UserDashboard - Call initiated:",u),Je(!1),St({callId:u.callId,callType:u.callType,otherUser:u.receiver}),qe(!0)}),n.off("call-error"),n.on("call-error",u=>{console.error(" UserDashboard - Call error:",u),H.error(u.error||"Call failed",{duration:4e3})}),n.off("incoming-group-call"),n.on("incoming-group-call",u=>{var j,c;console.log(" ========================================"),console.log(" UserDashboard - INCOMING GROUP CALL RECEIVED!"),console.log(" Call ID:",u.callId),console.log(" Call Type:",u.callType),console.log(" Room Name:",u.roomName),console.log(" Group:",u.groupName),console.log(" Initiator:",(j=u.initiator)==null?void 0:j.name),console.log(" ========================================"),H.success(`Incoming group ${u.callType} call from ${((c=u.initiator)==null?void 0:c.name)||"Unknown"}`,{duration:5e3,icon:""}),Be(!0),Kt({callId:u.callId,callType:u.callType,groupId:u.groupId,roomName:u.roomName,group:u.group||{name:u.groupName},initiator:u.initiator}),Yt(!0)}),n.off("group-call-initiated"),n.on("group-call-initiated",u=>{console.log(" ========================================"),console.log(" UserDashboard - GROUP CALL INITIATED!"),console.log(" Call ID:",u.callId),console.log(" Room Name:",u.roomName),console.log(" Call Type:",u.callType),console.log(" ========================================"),Be(!1),Kt({callId:u.callId,callType:u.callType,groupId:u.groupId,roomName:u.roomName,group:u.group}),Yt(!0)}),n.off("group-call-error"),n.on("group-call-error",u=>{console.error(" UserDashboard - Group call error:",u),H.error(u.error||"Group call failed",{duration:4e3})}),()=>{console.log(" Cleaning up PERSISTENT call listeners..."),n.off("incoming-call"),n.off("call-initiated"),n.off("call-error"),n.off("incoming-group-call"),n.off("group-call-initiated"),n.off("group-call-error")}},[n]),h.useEffect(()=>(m&&(M([]),$(!1),C(!1),xo.current=!0,vo(),yo(),m.type==="group"&&(i(m.id),console.log(" UserDashboard joined group room for:",m.name))),()=>{Et.removeAllListeners(),m&&m.type==="group"&&(l(m.id),console.log(" UserDashboard left group room for:",m.name)),Et.healthCheckInterval&&(clearInterval(Et.healthCheckInterval),delete Et.healthCheckInterval)}),[m]),h.useEffect(()=>{if(y.length>0){if(xo.current)setTimeout(()=>{ks(!0),xo.current=!1},100);else if(jr.current)setTimeout(()=>{ks(!1),jr.current=!1},100);else if(Jt.current){const u=Jt.current,j=u.scrollHeight,c=u.scrollTop,p=u.clientHeight;j-c-p<200&&ks(!1)}}},[y]);const Xt=()=>{!Jt.current||I||!ie||!m||(br.current&&clearTimeout(br.current),br.current=setTimeout(()=>{var c,p;if(!Jt.current||I||!ie)return;const u=Jt.current;if(u.scrollTop<50&&y.length>0){ts.current=u.scrollHeight;const E=((c=y[0])==null?void 0:c._id)||((p=y[0])==null?void 0:p.id);E&&vo(E)}},150))};h.useEffect(()=>{const u=Jt.current;if(!(!u||!m))return u.addEventListener("scroll",Xt),()=>{u.removeEventListener("scroll",Xt),br.current&&clearTimeout(br.current)}},[y,I,ie,m]);const tr=async()=>{try{console.log(" Refreshing UserDashboard chat state from database...");const u=await at.getChatState(),{personalChats:j,groupChats:c}=u.data,p={},E={};j.forEach(N=>{var R,P,D;N.unreadCount>0&&(p[N.chatId]=N.unreadCount),N.lastMessage&&N.lastMessage.message&&(E[N.chatId]={id:N.lastMessage._id||N.lastMessage.id,message:N.lastMessage.message,senderName:N.lastMessage.senderName||((R=N.lastMessage.sender)==null?void 0:R.name)||"User",senderId:N.lastMessage.senderId||((P=N.lastMessage.sender)==null?void 0:P._id)||((D=N.lastMessage.sender)==null?void 0:D.id),timestamp:N.lastMessage.createdAt||N.lastMessage.timestamp})}),c.forEach(N=>{var R,P,D;N.unreadCount>0&&(p[N.chatId]=N.unreadCount),N.lastMessage&&N.lastMessage.message&&(E[N.chatId]={id:N.lastMessage._id||N.lastMessage.id,message:N.lastMessage.message,senderName:N.lastMessage.senderName||((R=N.lastMessage.sender)==null?void 0:R.name)||"User",senderId:N.lastMessage.senderId||((P=N.lastMessage.sender)==null?void 0:P._id)||((D=N.lastMessage.sender)==null?void 0:D.id),timestamp:N.lastMessage.createdAt||N.lastMessage.timestamp})}),ae(p),ee(E),console.log(" UserDashboard chat state refreshed from database")}catch(u){console.error("Error refreshing UserDashboard chat state:",u)}};h.useEffect(()=>{window.testSocketDashboard=()=>{Et.testConnection()},window.checkSocketDashboard=()=>{Et.logConnectionStatus()},window.forceSocketConnectDashboard=()=>{Et.forceConnectionTest()},console.log(" UserDashboard Socket debugging methods available:"),console.log(" - testSocketDashboard() - Test socket connection status"),console.log(" - checkSocketDashboard() - Show current socket status"),console.log(" - forceSocketConnectDashboard() - Force reconnection")},[]);const ns=async()=>{try{ne(!0);const[u,j]=await Promise.all([Vt.getActiveUsers(),Rn.getMyGroups()]);console.log(" UserDashboard Data Loaded:"),console.log(" Users:",u.data.length),console.log(" Groups:",j.data.length),console.log(" Group Details:",j.data.map(c=>{var p;return{id:c.id,name:c.name,members:((p=c.members)==null?void 0:p.length)||0,avatar:c.avatar?"Has Avatar":"No Avatar"}})),k(u.data.filter(c=>c.id!==e.id)),w(j.data)}catch(u){console.error("Error fetching dashboard data:",u),H.error("Failed to load dashboard data")}finally{ne(!1)}},yo=()=>{console.log(" Setting up enhanced UserDashboard socket listeners with Context API...");const u=g();console.log(" Current socket status:",u),a(j=>{var D,ce;console.log(" USERDASHBOARD CONTEXT - received message:",j);const c=typeof j.sender=="object"?j.sender.id||j.sender._id:j.sender,p=typeof j.receiver=="object"?j.receiver.id||j.receiver._id:j.receiver,E=j.id||j._id||j.messageId,N=j.message||j.content,R=c===e.id||c===e._id||c===((D=e.id)==null?void 0:D.toString())||c===((ce=e._id)==null?void 0:ce.toString());if(j._isConfirmation||j.isConfirmMessage||j.isMessageSentConfirmation){console.log(" Skipping confirmation message");return}const P=js(j,m,e);if(console.log(" ENHANCED USERDASHBOARD MESSAGE FILTERING:",{senderId:c,receiverId:p,messageId:E,messageText:N,selectedChatId:m==null?void 0:m.id,selectedChatType:m==null?void 0:m.type,currentUserId:e.id,isCurrentUserSender:R,isForCurrentChat:P,messageData:j}),P&&m)console.log(" Processing message for current active dashboard chat"),R?console.log(" Message from current user - handled by optimistic updates"):(console.log(" Adding external message to current dashboard chat immediately"),M(pe=>{if(pe.some(te=>{var Ze,et;const _e=te.id||te._id||te.messageId,Q=te.message||te.content,De=((Ze=te.sender)==null?void 0:Ze.id)||((et=te.sender)==null?void 0:et._id)||te.sender,Se=te.createdAt||te.timestamp,Fe=j.createdAt||j.timestamp;return!!(_e===E&&E||Q===N&&String(De)===String(c)&&Fe&&Se&&Math.abs(new Date(Fe)-new Date(Se))<5e3||te.isOptimistic&&Q===N&&String(De)===String(c)&&Fe&&Se&&Math.abs(new Date(Fe)-new Date(Se))<1e4)}))return console.log(" UserDashboard enhanced detection: Message already exists - confirmed duplicate",{messageId:E,messageText:N==null?void 0:N.substring(0,20),senderId:c,isDuplicate:!0}),pe;console.log(" REAL-TIME USERDASHBOARD: NEW message confirmed - Adding to active chat",{messageId:E,messageText:N==null?void 0:N.substring(0,20),senderId:c,isDuplicate:!1});const ye=_i(j,c);return Dn(m.id,j,c),setTimeout(()=>{tr()},100),[...pe,ye]}));else if(N&&!R){const pe=c||j.sender;pe&&pe!==e.id&&(console.log(" Incrementing unread count for dashboard chat:",pe),ae(ke=>({...ke,[pe]:(ke[pe]||0)+1})),Dn(pe,j,c),setTimeout(()=>{tr()},100))}}),f(j=>{console.log(" Dashboard message sent confirmation received:",j),j&&j.id&&M(c=>{const p=c.filter(N=>!N.isOptimistic),E={id:j.id,message:j.message,messageType:j.messageType||"text",fileUrl:j.fileUrl,fileName:j.fileName,fileSize:j.fileSize,fileType:j.fileType,sender:j.sender,createdAt:j.createdAt||j.timestamp,timestamp:j.timestamp,isOptimistic:!1};return[...p,E]})}),d(j=>{var D,ce,pe,ke;console.log(" USERDASHBOARD GROUP MESSAGE CONTEXT - received message:",j);const c=typeof j.sender=="object"?j.sender.id||j.sender._id:j.sender,p=j.groupId||((D=j.group)==null?void 0:D.id)||((ce=j.group)==null?void 0:ce._id),E=j.id||j._id||j.messageId,N=j.message||j.content,R=c===e.id||c===e._id||c===((pe=e.id)==null?void 0:pe.toString())||c===((ke=e._id)==null?void 0:ke.toString());if(j._isConfirmation||j.isConfirmMessage||j.isMessageSentConfirmation){console.log(" Skipping confirmation message");return}const P=m&&m.type==="group"&&(p===m.id||String(p)===String(m.id));if(console.log(" USERDASHBOARD GROUP MESSAGE FILTERING:",{senderId:c,groupId:p,messageId:E,messageText:N,selectedChatId:m==null?void 0:m.id,selectedChatType:m==null?void 0:m.type,currentUserId:e.id,isCurrentUserSender:R,isForCurrentGroup:P,messageData:j}),P&&m)console.log(" Processing group message for current UserDashboard group"),R?console.log(" Group message from current user - handled by optimistic updates"):(console.log(" Adding external group message to current dashboard chat immediately"),M(ye=>{if(ye.some(Q=>{var xn,Vn;const De=Q.id||Q._id||Q.messageId,Se=Q.message||Q.content,Fe=((xn=Q.sender)==null?void 0:xn.id)||((Vn=Q.sender)==null?void 0:Vn._id)||Q.sender,Ze=Q.createdAt||Q.timestamp,et=j.createdAt||j.timestamp;return!!(De===E&&E||Se===N&&String(Fe)===String(c)&&et&&Ze&&Math.abs(new Date(et)-new Date(Ze))<5e3||Q.isOptimistic&&Se===N&&String(Fe)===String(c)&&et&&Ze&&Math.abs(new Date(et)-new Date(Ze))<1e4)}))return console.log(" USERDASHBOARD GROUP duplicate detection: Message already exists",{messageId:E,messageText:N==null?void 0:N.substring(0,20),senderId:c==null?void 0:c.toString(),isDuplicate:!0}),ye;console.log(" USERDASHBOARD GROUP REAL-TIME: NEW message confirmed - Adding to active group",{messageId:E,messageText:N==null?void 0:N.substring(0,20),senderId:c,groupId:p});const _e=_i(j,c);return Dn(m.id,j,c),setTimeout(()=>{tr()},100),[...ye,_e]}));else if(N&&!R){const ye=p||j.groupId;ye&&(!m||m.type!=="group"||String(ye)!==String(m.id))&&(console.log(" UserDashboard incrementing unread count for group:",ye),ae(_e=>({..._e,[ye]:(_e[ye]||0)+1})),Dn(ye,j,c),setTimeout(()=>{tr()},100))}}),n&&(n.off("avatar-updated"),n.on("avatar-updated",j=>{var p,E;console.log(" Profile updated received:",j);const c=((p=j.userId)==null?void 0:p.toString())||j.userId;k(N=>N.map(R=>{var P;return((P=R.id||R._id)==null?void 0:P.toString())===c?{...R,profileImage:j.profileImage,name:j.name}:R})),m&&m.type==="personal"&&((E=m.id||m._id)==null?void 0:E.toString())===c&&v(N=>({...N,profileImage:j.profileImage,name:j.name})),M(N=>N.map(R=>{var D,ce,pe;return((pe=((D=R.sender)==null?void 0:D.id)||((ce=R.sender)==null?void 0:ce._id)||R.sender)==null?void 0:pe.toString())===c?{...R,sender:{...typeof R.sender=="object"?R.sender:{id:R.sender},profileImage:j.profileImage,name:j.name}}:R}))}),n.off("messages-seen"),n.on("messages-seen",j=>{console.log(" Messages seen by user:",j.readBy),m&&m.type==="personal"&&j.chatId===m.id&&M(c=>c.map(p=>{var N,R;return(((N=p.sender)==null?void 0:N.id)||((R=p.sender)==null?void 0:R._id)||p.sender)===e.id?{...p,isRead:!0,readBy:[{user:j.readBy,readAt:j.timestamp}]}:p}))}))},js=(u,j,c)=>{var R,P,D,ce;if(!j)return!1;const p=((R=u.sender)==null?void 0:R.id)||((P=u.sender)==null?void 0:P._id)||u.sender,E=((D=u.receiver)==null?void 0:D.id)||((ce=u.receiver)==null?void 0:ce._id)||u.receiver,N=u.chatId||u.chatRoom;return j.type==="personal"&&j.id&&(p===j.id&&E===c.id||p===c.id&&E===j.id||String(p)===String(j.id)||String(E)===String(j.id))?!0:j.type==="group"?N===j.id||u.groupId===j.id:!1},_i=(u,j)=>{var c,p;return{id:u.id||u._id||u.messageId,message:u.message||u.content,messageType:u.messageType||"text",fileUrl:u.fileUrl,fileName:u.fileName,fileSize:u.fileSize,fileType:u.fileType,sender:typeof u.sender=="object"?u.sender:{id:j,name:u.senderName||((c=u.sender)==null?void 0:c.name)||"User",profileImage:u.senderProfileImage||((p=u.sender)==null?void 0:p.profileImage)},createdAt:u.createdAt||u.timestamp||new Date().toISOString(),timestamp:u.timestamp||u.createdAt,isFromOtherUser:!(j===e.id||j===e._id)}},Dn=(u,j,c)=>{const p=c===e.id||c===e._id;ee(E=>{var N;return{...E,[u]:{id:j.id||j._id||j.messageId,message:j.message||j.content,senderName:p?"You":j.senderName||((N=j.sender)==null?void 0:N.name)||"User",senderId:c,timestamp:j.createdAt||j.timestamp||new Date().toISOString()}}})},vo=async(u=null)=>{var j;try{u&&C(!0);let c;const p={limit:q};if(u&&(p.before=u),m.type==="personal"){if(!m.id){console.error("User ID is undefined for personal chat");return}c=await at.getPersonalMessages(m.id,p)}else{if(!m.id){console.error("Group ID is undefined for group chat");return}c=await at.getGroupMessages(m.id,p)}let E,N;if(c.data&&typeof c.data=="object"?Array.isArray(c.data.messages)?(E=c.data.messages,N=c.data.hasMore||!1):Array.isArray(c.data)?(E=c.data,N=c.data.length>=q):(E=[],N=!1):(E=[],N=!1),u)M(R=>{const P=new Set(R.map(ce=>ce._id||ce.id));return[...E.filter(ce=>{const pe=ce._id||ce.id;return!P.has(pe)}),...R]}),$(N),C(!1),setTimeout(()=>{if(Jt.current&&ts.current>0){const P=Jt.current.scrollHeight-ts.current;Jt.current.scrollTop=P+100}},0);else if(M(E||[]),$(N),E&&E.length>0){const R=E[E.length-1];Dn(m.id,R,((j=R.sender)==null?void 0:j.id)||R.sender)}}catch(c){console.error("Error fetching messages:",c),H.error("Failed to load messages"),M([]),u&&C(!1)}},Ns=u=>{const j=document.createElement("input");j.type="file",j.style.display="none",u==="image"?j.accept="image/*":u==="video"?j.accept="video/*":u==="document"&&(j.accept=".pdf,.doc,.docx,.txt,.csv,.xls,.xlsx,.ppt,.pptx,.xlsm,.xlsx,.zip,.rar,.7z,.tar,.gz,.bz2,.xz,.iso,.dmg,.img,.bin,.exe,.msi,.dmg,.iso,.tar,.gz,.bz2,.xz,.img,.bin,.exe,.msi"),j.onchange=c=>{const p=c.target.files[0];if(p){if(G(p),p.type.startsWith("image/")){const E=new FileReader;E.onload=N=>Ie(N.target.result),E.readAsDataURL(p)}else Ie(null);Ce(!1)}},document.body.appendChild(j),j.click(),document.body.removeChild(j)},nr=()=>{G(null),Ie(null)},Nr=async(u,j,c)=>{try{kt(ye=>({...ye,[c]:{progress:0,downloading:!0}}));const p=await fetch(S(u)),E=p.headers.get("content-length"),N=parseInt(E,10);if(!p.ok)throw new Error("Download failed");const R=p.body.getReader(),P=[];let D=0;for(;;){const{done:ye,value:te}=await R.read();if(ye)break;P.push(te),D+=te.length;const _e=N?Math.round(D/N*100):0;kt(Q=>({...Q,[c]:{progress:_e,downloading:!0}}))}const ce=new Blob(P),pe=window.URL.createObjectURL(ce),ke=document.createElement("a");ke.href=pe,ke.download=j,document.body.appendChild(ke),ke.click(),document.body.removeChild(ke),window.URL.revokeObjectURL(pe),kt(ye=>({...ye,[c]:{progress:100,downloading:!1}})),At(ye=>{const te={...ye,[c]:!0};try{sessionStorage.setItem("downloadedMessages",JSON.stringify(te))}catch{}return te}),setTimeout(()=>{kt(ye=>{const te={...ye};return delete te[c],te})},2e3)}catch(p){console.error("Download failed:",p),kt(E=>({...E,[c]:{progress:0,downloading:!1,error:!0}}))}};h.useEffect(()=>{const u=j=>{me&&!j.target.closest(".file-options-container")&&Ce(!1),Pt&&!j.target.closest(".message-dropdown-container")&&Zr(null)};return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[me,Pt]);const wo=async u=>{if(u.preventDefault(),!L.trim()&&!F||!m)return;if(m.type==="personal"&&m.isActive===!1){H.error("Cannot send messages to disabled users");return}const j=L.trim();O("");try{let c={sender:e.id,message:j,messageType:"text"};if(m.type==="personal"?c.receiver=m.id:c.group=m.id,F){const p=new FormData;m.type==="personal"?p.append("receiver",m.id):p.append("group",m.id),p.append("message",j),p.append("file",F);let E="file";F.type.startsWith("image/")?E="image":F.type.startsWith("video/")&&(E="video");const N={id:Date.now(),message:j||F.name,messageType:E,fileUrl:URL.createObjectURL(F),fileName:F.name,fileSize:F.size,fileType:F.type,sender:{id:e.id,name:e.name,profileImage:e.profileImage},createdAt:new Date().toISOString(),timestamp:new Date().toISOString(),isOptimistic:!0};M(R=>[...R,N]),jr.current=!0,Dn(m.id,{id:N.id,message:N.message,createdAt:N.createdAt},e.id),m.type==="personal"?await at.sendPersonalMessage(p):await at.sendGroupMessage(p),nr()}else{const p={id:Date.now(),message:j,messageType:"text",sender:{id:e.id,name:e.name,profileImage:e.profileImage},createdAt:new Date().toISOString(),timestamp:new Date().toISOString(),isOptimistic:!0};if(M(E=>[...E,p]),jr.current=!0,Dn(m.id,{id:p.id,message:p.message,createdAt:p.createdAt},e.id),m.type==="personal")try{await o(m.id,j,"text",!1),console.log(" Dashboard message sent via context socket")}catch(E){console.warn("Context socket failed, trying API:",E),await at.sendPersonalMessage(c)}else try{await o(m.id,j,"text",!0),console.log(" Dashboard group message sent via context socket")}catch(E){console.warn("Context socket failed, trying API:",E),await at.sendGroupMessage({sender:e.id,group:m.id,message:j,timestamp:new Date().toISOString()})}}console.log(" Dashboard message sent successfully")}catch(c){console.error(" Failed to send dashboard message:",c),H.error("Failed to send message"),M(p=>p.filter(E=>!E.isOptimistic))}},ks=(u=!1)=>{var j;(j=Ti.current)==null||j.scrollIntoView({behavior:u?"instant":"smooth"})},Ss=()=>{t(),H.success("Logged out successfully")},Cs=[...T.map(u=>({id:u.id,name:u.name,email:u.email,type:"personal",avatar:u.name.charAt(0).toUpperCase(),profileImage:u.profileImage,lastMessage:A[u.id]||null,isActive:u.isActive})),..._.map(u=>{var j;return{id:u.id,name:u.name,email:`${((j=u.members)==null?void 0:j.length)||0} members`,type:"group",avatar:u.avatar?`${ze}${u.avatar}`:"G",profileImage:u.avatar,lastMessage:A[u.id]||null}})].sort((u,j)=>{var E,N;const c=(E=u.lastMessage)!=null&&E.timestamp?new Date(u.lastMessage.timestamp).getTime():0;return((N=j.lastMessage)!=null&&N.timestamp?new Date(j.lastMessage.timestamp).getTime():0)-c}),rs=(()=>{let u=Cs;switch(X){case"unread":u=Cs.filter(j=>Y[j.id]>0);break;case"groups":u=Cs.filter(j=>j.type==="group");break;case"all":default:u=Cs;break}return u.filter(j=>j.name.toLowerCase().includes(U.toLowerCase())||j.email.toLowerCase().includes(U.toLowerCase()))})();return oe?s.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"})}):s.jsxs("div",{className:"h-screen bg-gray-50 flex",children:[s.jsxs("div",{className:"w-full h-screen flex bg-white shadow-lg",children:[s.jsxs("div",{className:"w-1/3 min-w-[300px] max-w-[400px] bg-white border-r border-gray-200 flex flex-col",children:[s.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"User Dashboard"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Gl,{to:"/profile",className:"text-gray-500 hover:text-gray-700",children:s.jsx(Pu,{className:"w-5 h-5"})}),s.jsx("button",{onClick:Ss,className:"p-1 text-gray-500 hover:text-gray-700",title:"Logout",children:s.jsx(Kg,{className:"w-5 h-5"})})]})]}),s.jsx("div",{className:"flex items-center space-x-3 mb-3",children:s.jsxs(Gl,{to:"/profile",className:"flex items-center space-x-3 hover:opacity-80 transition-opacity",children:[e.profileImage?s.jsx("img",{src:`${ze}${e.profileImage}`,alt:"Profile",className:"w-10 h-10 rounded-full object-cover"}):s.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-white font-medium",children:e.name.charAt(0).toUpperCase()})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:e.name}),s.jsx("p",{className:"text-xs text-green-600",children:"Online"})]})]})}),s.jsxs("div",{className:"relative mb-3",children:[s.jsx(Sa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),s.jsx("input",{type:"text",placeholder:"Search or start new chat",value:U,onChange:u=>K(u.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-green-400"})]}),s.jsxs("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:[s.jsx("button",{onClick:()=>Z("all"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${X==="all"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"All"}),s.jsxs("button",{onClick:()=>Z("unread"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${X==="unread"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:["Unread",Object.values(Y).reduce((u,j)=>u+j,0)>0&&s.jsx("span",{className:"ml-1 bg-green-500 text-white text-xs rounded-full px-1.5 py-0.5",children:Object.values(Y).reduce((u,j)=>u+j,0)})]}),s.jsx("button",{onClick:()=>Z("groups"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${X==="groups"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Groups"})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto",children:[rs.map(u=>{var j;return s.jsx("div",{onClick:()=>{console.log("Selecting chat:",u),v({type:u.type,id:u.id,name:u.name,profileImage:u.profileImage,isActive:u.isActive!==!1}),Y[u.id]&&(ae(c=>{const p={...c};return delete p[u.id],p}),at.updateChatState({chatId:u.id,chatType:u.type,action:"clear_unread"}).catch(c=>{console.error("Error clearing unread count:",c)}))},className:`p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 ${(m==null?void 0:m.id)===u.id&&(m==null?void 0:m.type)===u.type?"bg-green-50":""} ${u.type==="personal"&&u.isActive===!1?"opacity-60 bg-red-50 border-l-4 border-red-300":""}`,title:u.type==="personal"&&u.isActive===!1?"Disabled User":"",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:`w-12 h-12 rounded-full overflow-hidden cursor-pointer hover:ring-2 hover:ring-green-400 transition-all ${u.type==="personal"&&u.isActive===!1?"bg-gray-300":"bg-gray-200"}`,onClick:c=>{c.stopPropagation(),u.profileImage&&je({image:u.type==="personal"?`${ze}${u.profileImage}`:u.avatar,name:u.name})},children:u.type==="personal"?u.profileImage?s.jsx("img",{src:`${ze}${u.profileImage}`,alt:u.name,className:`w-full h-full object-cover ${u.isActive===!1?"grayscale opacity-70":""}`}):s.jsx("div",{className:`w-full h-full ${u.isActive===!1?"bg-gray-400":"bg-green-500"} flex items-center justify-center`,children:s.jsx("span",{className:"text-white font-semibold text-lg",children:u.avatar})}):u.profileImage?s.jsx("img",{src:u.avatar,alt:u.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:s.jsx(ln,{className:"w-6 h-6 text-white"})})}),u.type==="personal"&&u.isActive===!1&&s.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-red-500 rounded-full border-2 border-white flex items-center justify-center",children:s.jsx("span",{className:"text-white text-xs font-bold",children:""})})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("h3",{className:`truncate ${u.type==="personal"&&u.isActive===!1?"font-medium text-red-700 line-through":"font-medium text-gray-900"}`,children:[u.name,u.type==="personal"&&u.isActive===!1&&s.jsx("span",{className:"ml-2 text-xs text-red-500",children:"(Disabled)"})]}),u.type==="group"&&s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Group"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-xs text-gray-500",children:(j=u.lastMessage)!=null&&j.timestamp?W(u.lastMessage.timestamp):""}),Y[u.id]&&Y[u.id]>0&&s.jsx("div",{className:"bg-green-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center",children:Y[u.id]>99?"99+":Y[u.id]})]})]}),s.jsx("p",{className:`text-sm truncate ${u.type==="personal"&&u.isActive===!1?"text-red-400":"text-gray-500"}`,children:u.type==="personal"&&u.isActive===!1?"User is disabled - cannot send new messages":u.lastMessage&&u.lastMessage.message?`${u.lastMessage.senderName||"You"}: ${u.lastMessage.message}`:"No messages yet"})]})]})},`${u.type}-${u.id}`)}),rs.length===0&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(ms,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-500 text-sm",children:U?"No chats found.":"No chats available."})]})]})]}),ue&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:()=>je(null),children:s.jsxs("div",{className:"relative max-w-2xl max-h-[90vh] p-4",children:[s.jsx("button",{onClick:()=>je(null),className:"absolute top-6 right-6 z-10 bg-white/10 hover:bg-white/20 text-white rounded-full p-2 transition-colors",title:"Close",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"bg-white rounded-lg overflow-hidden shadow-2xl",children:[s.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-4",children:s.jsx("h3",{className:"text-white text-xl font-semibold text-center",children:ue.name})}),s.jsx("img",{src:ue.image,alt:ue.name,className:"w-full h-auto max-h-[70vh] object-contain",onClick:u=>u.stopPropagation()})]})]})}),$e&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>Ge(null),onMouseMove:Zn,onMouseUp:zn,onMouseLeave:zn,children:s.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center overflow-hidden",children:[s.jsx("button",{onClick:()=>Ge(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("button",{onClick:u=>{u.stopPropagation();const j=document.createElement("a");j.href=$e.src,j.download=$e.alt,document.body.appendChild(j),j.click(),document.body.removeChild(j)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:s.jsx(bn,{className:"w-5 h-5"})}),s.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[s.jsx("button",{onClick:u=>{u.stopPropagation(),Ct()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Zoom In",children:s.jsx(t0,{className:"w-5 h-5"})}),s.jsx("button",{onClick:u=>{u.stopPropagation(),we()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Zoom Out",children:s.jsx(n0,{className:"w-5 h-5"})}),s.jsx("button",{onClick:u=>{u.stopPropagation(),bt()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Reset Zoom",children:s.jsx(Au,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"absolute bottom-4 left-4 z-10 bg-black/50 text-white px-3 py-2 rounded-lg text-sm",children:[Math.round(wt*100),"%"]}),s.jsx("img",{src:$e.src,alt:$e.alt,className:`object-contain transition-transform duration-200 ${be?"cursor-grabbing":"cursor-grab"}`,style:{transform:`translate(${zt.x}px, ${zt.y}px) scale(${wt})`,maxWidth:"none",maxHeight:"none",width:"auto",height:"auto"},onMouseDown:He,onClick:u=>u.stopPropagation(),draggable:!1})]})}),dt&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>mt(null),children:s.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center",children:[s.jsx("button",{onClick:()=>mt(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("button",{onClick:u=>{u.stopPropagation();const j=document.createElement("a");j.href=dt.src,j.download=dt.alt,document.body.appendChild(j),j.click(),document.body.removeChild(j)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:s.jsx(bn,{className:"w-5 h-5"})}),s.jsx("video",{src:dt.src,controls:!0,autoPlay:!0,className:"max-w-full max-h-full object-contain",onClick:u=>u.stopPropagation()})]})}),Me&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>Re(null),children:s.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center",children:[s.jsx("button",{onClick:()=>Re(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("button",{onClick:u=>{u.stopPropagation();const j=document.createElement("a");j.href=Me.src,j.download=Me.fileName,document.body.appendChild(j),j.click(),document.body.removeChild(j)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:s.jsx(bn,{className:"w-5 h-5"})}),s.jsx("div",{className:"bg-white rounded-lg shadow-2xl w-full h-full max-w-4xl max-h-[90vh] overflow-hidden",children:Me.fileType==="application/pdf"?s.jsx("iframe",{src:Me.src,className:"w-full h-full border-0",title:Me.fileName,onClick:u=>u.stopPropagation()}):s.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-8",children:[s.jsx(Ar,{className:"w-24 h-24 text-gray-400 mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:Me.fileName}),s.jsxs("p",{className:"text-gray-600 mb-4",children:[(Me.fileSize/1024/1024).toFixed(2)," MB"]}),s.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["This file type cannot be previewed in the browser.",s.jsx("br",{}),"Click the download button to save and view the file."]}),s.jsx("button",{onClick:u=>{u.stopPropagation();const j=document.createElement("a");j.href=Me.src,j.download=Me.fileName,document.body.appendChild(j),j.click(),document.body.removeChild(j)},className:"mt-4 bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors",children:"Download File"})]})})]})}),s.jsx("div",{className:"flex-1 flex flex-col",children:m?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:m.type==="personal"?m.profileImage?s.jsx("img",{src:`${ze}${m.profileImage}`,alt:m.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:s.jsx("span",{className:"text-white font-semibold",children:m.name.charAt(0).toUpperCase()})}):m.profileImage?s.jsx("img",{src:`${ze}${m.profileImage}`,alt:m.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:s.jsx(ln,{className:"w-5 h-5 text-white"})})}),s.jsxs("div",{className:`${m.type==="group"?"cursor-pointer hover:bg-gray-50 p-2 rounded-lg transition-colors":""}`,onClick:()=>{m.type==="group"&&(window.location.href=`/group/${m.id}`)},title:m.type==="group"?"Click to view group info":"",children:[s.jsxs("h3",{className:`font-semibold ${m.type==="personal"&&m.isActive===!1?"text-red-700":"text-gray-900"}`,children:[m.name,m.type==="personal"&&m.isActive===!1&&s.jsx("span",{className:"ml-2 text-xs text-red-500",children:"(Disabled)"})]}),s.jsx("p",{className:`text-xs ${m.type==="personal"&&m.isActive===!1?"text-red-400":"text-gray-500"}`,children:m.type==="personal"?m.isActive===!1?"User is disabled - viewing mode only":x(m.id)?s.jsx("span",{className:"text-green-600 font-medium",children:"Online"}):B(b(m.id).lastSeen):`${m.email}`})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[m.type==="personal"?s.jsxs(s.Fragment,{children:[s.jsx(Rm,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var u,j;if(!(!m||m.type!=="personal"))try{const p=(j=(u=(await pi.initiate(m.id,"voice")).data)==null?void 0:u.data)==null?void 0:j.call;p&&p._id&&(Je(!1),St({callId:p._id,callType:"voice",otherUser:p.otherUser}),qe(!0),n.emit("call-initiate",{receiverId:m.id,callType:"voice",callId:p._id}))}catch(c){console.error("Failed to initiate call",c)}}}),s.jsx(ur,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var u,j;if(!(!m||m.type!=="personal"))try{const p=(j=(u=(await pi.initiate(m.id,"video")).data)==null?void 0:u.data)==null?void 0:j.call;p&&p._id&&(Je(!1),St({callId:p._id,callType:"video",otherUser:p.otherUser}),qe(!0),n.emit("call-initiate",{receiverId:m.id,callType:"video",callId:p._id}))}catch(c){console.error("Failed to initiate video call",c)}}})]}):s.jsxs(s.Fragment,{children:[s.jsx(Rm,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var u,j,c,p,E;if(!(!m||m.type!=="group")){console.log(" Initiating group VOICE call for:",m.id,m.name);try{const R=(j=(u=(await cr.initiate(m.id,"voice")).data)==null?void 0:u.data)==null?void 0:j.call;console.log(" ========================================"),console.log(" VOICE CALL INITIATED!"),console.log(" Call ID:",R._id),console.log(" Room Name:",R.roomName),console.log(" Group:",m.name),console.log(" ========================================"),R&&R._id&&(Be(!1),Kt({callId:R._id,callType:"voice",groupId:m.id,roomName:R.roomName,group:{name:m.name,avatar:m.profileImage}}),Yt(!0),n.emit("group-call-initiate",{groupId:m.id,callType:"voice",callId:R._id}))}catch(N){console.error("Failed to initiate group call",N),console.error("Error response:",(c=N.response)==null?void 0:c.data);const R=((E=(p=N.response)==null?void 0:p.data)==null?void 0:E.message)||"Failed to initiate group call";H.error(R)}}}}),s.jsx(ur,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var u,j,c,p,E;if(!(!m||m.type!=="group")){console.log(" Initiating group VIDEO call for:",m.id,m.name);try{const R=(j=(u=(await cr.initiate(m.id,"video")).data)==null?void 0:u.data)==null?void 0:j.call;console.log(" ========================================"),console.log(" VIDEO CALL INITIATED!"),console.log(" Call ID:",R._id),console.log(" Room Name:",R.roomName),console.log(" Group:",m.name),console.log(" ========================================"),R&&R._id&&(Be(!1),Kt({callId:R._id,callType:"video",groupId:m.id,roomName:R.roomName,group:{name:m.name,avatar:m.profileImage}}),Yt(!0),n.emit("group-call-initiate",{groupId:m.id,callType:"video",callId:R._id}))}catch(N){console.error("Failed to initiate group video call",N),console.error("Error response:",(c=N.response)==null?void 0:c.data);const R=((E=(p=N.response)==null?void 0:p.data)==null?void 0:E.message)||"Failed to initiate group video call";H.error(R)}}}})]}),s.jsx(wd,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800"})]})]}),s.jsx("div",{ref:Jt,className:"flex-1 overflow-y-auto p-4 bg-gray-50 relative",children:s.jsxs("div",{className:"max-w-8xl mx-auto",children:[I&&s.jsx("div",{className:"flex justify-center py-2",children:s.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})}),!I&&ie&&y.length>0&&s.jsx("div",{className:"flex justify-center py-2",children:s.jsx("button",{onClick:()=>{var j,c,p;const u=((j=y[0])==null?void 0:j._id)||((c=y[0])==null?void 0:c.id);u&&(ts.current=((p=Jt.current)==null?void 0:p.scrollHeight)||0,vo(u))},className:"px-5 py-2.5 text-sm bg-gradient-to-br from-blue-400 to-blue-600 text-white rounded-full shadow-[3px_3px_10px_rgba(59,130,246,0.4),inset_-1px_-1px_6px_rgba(0,0,0,0.1),inset_1px_1px_6px_rgba(255,255,255,0.2)] hover:shadow-[4px_4px_14px_rgba(59,130,246,0.5),inset_-1px_-1px_6px_rgba(0,0,0,0.15),inset_1px_1px_6px_rgba(255,255,255,0.25)] hover:-translate-y-0.5 transition-all duration-200 font-medium",children:"Load Previous Messages"})}),Array.isArray(y)&&y.map((u,j)=>{var R,P,D,ce,pe,ke,ye;const c=j===0||(()=>{const te=new Date(u.createdAt||u.timestamp),_e=new Date(y[j-1].createdAt||y[j-1].timestamp),Q=new Date(te.getFullYear(),te.getMonth(),te.getDate()),De=new Date(_e.getFullYear(),_e.getMonth(),_e.getDate());return Q.getTime()!==De.getTime()})();let p=!1;if(typeof u.sender=="object"&&u.sender!==null){const te=u.sender._id||u.sender.id;p=te===e.id||te===e._id||te===((R=e.id)==null?void 0:R.toString())||te===((P=e._id)==null?void 0:P.toString())}else p=u.sender===e.id||u.sender===e._id||u.sender===((D=e.id)==null?void 0:D.toString())||u.sender===((ce=e._id)==null?void 0:ce.toString());const E=typeof u.sender=="object"?(pe=u.sender)==null?void 0:pe.name:"User",N=typeof u.sender=="object"?(ke=u.sender)==null?void 0:ke.profileImage:null;return s.jsxs(Xl.Fragment,{children:[c&&s.jsx("div",{className:"flex justify-center my-4",children:s.jsx("div",{className:"bg-gradient-to-br from-gray-200 to-gray-300 text-gray-700 text-xs px-4 py-2 rounded-full font-medium",children:V(u.createdAt||u.timestamp)})}),s.jsx("div",{className:`flex ${p?"justify-end":"justify-start"} mb-4`,children:s.jsxs("div",{className:`flex items-start gap-2 max-w-sm lg:max-w-md ${p?"flex-row-reverse":"flex-row"}`,children:[s.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-300 flex-shrink-0",children:p?e.profileImage?s.jsx("img",{src:`${ze}${e.profileImage}`,alt:e.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:s.jsx("span",{className:"text-white text-xs font-medium",children:e.name.charAt(0).toUpperCase()})}):N?s.jsx("img",{src:`${ze}${N}`,alt:E,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-gray-400 flex items-center justify-center",children:s.jsx("span",{className:"text-white text-xs font-medium",children:String(E).charAt(0).toUpperCase()})})}),s.jsxs("div",{className:`relative group flex flex-col px-4 py-3 rounded-2xl transition-all duration-200 ${p?"bg-gradient-to-br from-green-400 to-green-600 text-white rounded-br-md hover:-translate-y-0.5":"bg-gradient-to-br from-gray-100 to-gray-300 text-gray-900 rounded-bl-md hover:-translate-y-0.5"} ${Ee&&ge&&gt(ge)===gt(u)?"ring-2 ring-blue-400":""}`,onMouseDown:()=>an(u),onMouseUp:lt,onMouseLeave:lt,onTouchStart:()=>an(u),onTouchEnd:lt,onContextMenu:te=>{te.preventDefault(),pt(u),le(!0)},children:[u.messageType==="text"&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:te=>es(gt(u),te),className:`absolute top-1 right-1 z-10 p-1 rounded-full transition-all duration-200 ${p?"bg-green-600/80 hover:bg-green-700/80 text-white":"bg-gray-300/80 hover:bg-gray-400/80 text-gray-700"} ${Pt===gt(u)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:s.jsx(Ys,{className:"w-3 h-3"})}),Pt===gt(u)&&s.jsxs("div",{className:"message-dropdown-container absolute top-8 right-1 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[s.jsxs("button",{onClick:()=>Ye("copy",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Ks,{className:"w-4 h-4"}),"Copy"]}),(()=>{var Q,De,Se,Fe;const te=((Q=u.sender)==null?void 0:Q.id)||((De=u.sender)==null?void 0:De._id)||u.sender;return te===e.id||te===e._id||te===((Se=e.id)==null?void 0:Se.toString())||te===((Fe=e._id)==null?void 0:Fe.toString())?s.jsxs("button",{onClick:()=>Ye("edit",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Un,{className:"w-4 h-4"}),"Edit"]}):null})(),s.jsxs("button",{onClick:()=>Ye("forward",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Qs,{className:"w-4 h-4"}),"Forward"]})]})]}),u.fileUrl&&s.jsx("div",{className:"mb-2",children:u.messageType==="image"?s.jsxs("div",{className:"relative group",onMouseDown:()=>an(u),onMouseUp:lt,onMouseLeave:lt,onTouchStart:()=>an(u),onTouchEnd:lt,children:[s.jsx("button",{onClick:te=>es(gt(u),te),className:`absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 ${p?"bg-green-500/80 hover:bg-green-600/80 text-white":"bg-gray-500/80 hover:bg-gray-600/80 text-white"} ${Pt===gt(u)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:s.jsx(Ys,{className:"w-3 h-3"})}),Pt===gt(u)&&s.jsxs("div",{className:"message-dropdown-container absolute top-10 right-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[s.jsxs("button",{onClick:()=>Ye("copy",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Ks,{className:"w-4 h-4"}),"Copy"]}),u.messageType==="text"&&(()=>{var Q,De,Se,Fe;const te=((Q=u.sender)==null?void 0:Q.id)||((De=u.sender)==null?void 0:De._id)||u.sender;return te===e.id||te===e._id||te===((Se=e.id)==null?void 0:Se.toString())||te===((Fe=e._id)==null?void 0:Fe.toString())?s.jsxs("button",{onClick:()=>Ye("edit",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Un,{className:"w-4 h-4"}),"Edit"]}):null})(),s.jsxs("button",{onClick:()=>Ye("forward",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Qs,{className:"w-4 h-4"}),"Forward"]})]}),s.jsx("img",{src:S(u.fileUrl),alt:u.fileName,className:`max-w-xs rounded-lg ${!p&&!Ne[u.id||u._id]?"blur-sm cursor-pointer":"cursor-pointer"} hover:opacity-90`,onClick:()=>{var te;!p&&!Ne[u.id||u._id]?Nr(u.fileUrl,u.fileName,u.id||u._id):er({src:S(u.fileUrl),alt:u.fileName,sender:((te=u.sender)==null?void 0:te.name)||"User",timestamp:u.createdAt||u.timestamp})}}),!p&&!Ne[u.id||u._id]&&s.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-black/60 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1",children:[s.jsx(bn,{className:"w-3 h-3"}),((u.fileSize||0)/1024/1024).toFixed(1)," MB"]}),Oe[u.id||u._id]&&s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:s.jsxs("div",{className:"bg-black/60 rounded-lg px-3 py-2 text-center",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-2"}),s.jsxs("p",{className:"text-sm text-white",children:[Oe[u.id||u._id].progress,"%"]})]})})]}):u.messageType==="video"?s.jsxs("div",{className:"relative group",onMouseDown:()=>an(u),onMouseUp:lt,onMouseLeave:lt,onTouchStart:()=>an(u),onTouchEnd:lt,children:[s.jsx("button",{onClick:te=>es(gt(u),te),className:`absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 ${p?"bg-green-500/80 hover:bg-green-600/80 text-white":"bg-gray-500/80 hover:bg-gray-600/80 text-white"} ${Pt===gt(u)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:s.jsx(Ys,{className:"w-3 h-3"})}),Pt===gt(u)&&s.jsxs("div",{className:"message-dropdown-container absolute top-10 right-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[s.jsxs("button",{onClick:()=>Ye("copy",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Ks,{className:"w-4 h-4"}),"Copy"]}),u.messageType==="text"&&(()=>{var Q,De,Se,Fe;const te=((Q=u.sender)==null?void 0:Q.id)||((De=u.sender)==null?void 0:De._id)||u.sender;return te===e.id||te===e._id||te===((Se=e.id)==null?void 0:Se.toString())||te===((Fe=e._id)==null?void 0:Fe.toString())?s.jsxs("button",{onClick:()=>Ye("edit",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Un,{className:"w-4 h-4"}),"Edit"]}):null})(),s.jsxs("button",{onClick:()=>Ye("forward",u),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Qs,{className:"w-4 h-4"}),"Forward"]})]}),s.jsx("video",{src:S(u.fileUrl),controls:!0,className:`max-w-xs rounded-lg ${!p&&!Ne[u.id||u._id]?"blur-sm":""} cursor-pointer`,onClick:()=>{var te;!p&&!Ne[u.id||u._id]?Nr(u.fileUrl,u.fileName,u.id||u._id):mt({src:S(u.fileUrl),alt:u.fileName,sender:((te=u.sender)==null?void 0:te.name)||"User",timestamp:u.createdAt||u.timestamp})}}),!p&&!Ne[u.id||u._id]&&s.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-black/60 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1",children:[s.jsx(bn,{className:"w-3 h-3"}),((u.fileSize||0)/1024/1024).toFixed(1)," MB"]}),Oe[u.id||u._id]&&s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:s.jsxs("div",{className:"bg-black/60 rounded-lg px-3 py-2 text-center",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-2"}),s.jsxs("p",{className:"text-sm text-white",children:[Oe[u.id||u._id].progress,"%"]})]})})]}):s.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-white bg-opacity-20 rounded-lg relative cursor-pointer",onMouseDown:()=>an(u),onMouseUp:lt,onMouseLeave:lt,onTouchStart:()=>an(u),onTouchEnd:lt,onClick:()=>{var te;!p&&!Ne[u.id||u._id]?Nr(u.fileUrl,u.fileName,u.id||u._id):Re({src:S(u.fileUrl),fileName:u.fileName,fileSize:u.fileSize,fileType:u.fileType,sender:((te=u.sender)==null?void 0:te.name)||"User",timestamp:u.createdAt||u.timestamp})},children:[s.jsx(Ar,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium truncate",children:u.fileName}),s.jsxs("p",{className:"text-xs opacity-75",children:[(u.fileSize/1024/1024).toFixed(2)," MB"]})]}),!p&&!Ne[u.id||u._id]&&s.jsx("button",{onClick:te=>{te.stopPropagation(),Nr(u.fileUrl,u.fileName,u.id||u._id)},className:"p-1 hover:bg-white hover:bg-opacity-20 rounded",disabled:(ye=Oe[u.id||u._id])==null?void 0:ye.downloading,children:s.jsx(bn,{className:"w-4 h-4"})}),Oe[u.id||u._id]&&s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:s.jsxs("div",{className:"bg-white rounded-lg p-2 text-center",children:[s.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mx-auto mb-1"}),s.jsxs("p",{className:"text-xs text-white",children:[Oe[u.id||u._id].progress,"%"]})]})})]})}),u.message&&(ht&&gt(ht)===gt(u)?s.jsxs("div",{className:"mb-2",children:[s.jsx("input",{type:"text",value:Xr,onChange:te=>wr(te.target.value),className:"w-full px-2 py-1 text-sm bg-white bg-opacity-20 rounded border-none focus:outline-none focus:ring-1 focus:ring-white",autoFocus:!0,onKeyDown:te=>{te.key==="Enter"&&gn(),te.key==="Escape"&&Ii()}}),s.jsxs("div",{className:"flex gap-1 mt-1",children:[s.jsx("button",{onClick:gn,className:"text-xs px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700",children:"Save"}),s.jsx("button",{onClick:Ii,className:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Cancel"})]})]}):s.jsxs("p",{className:"text-sm mb-1 break-words",children:[u.message,(u.isEdited||u.editedAt)&&s.jsx("span",{className:"text-xs opacity-75 ml-1",children:"(edited)"})]})),s.jsxs("div",{className:`flex items-center gap-1 text-xs self-end ${p?"text-green-100":"text-gray-500"}`,children:[s.jsx("span",{children:new Date(u.createdAt||u.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),p&&s.jsx("span",{className:"ml-1 relative inline-flex items-center",title:u.isRead||u.readBy&&u.readBy.length>0?"Seen":"Delivered",children:u.isRead||u.readBy&&u.readBy.length>0?s.jsx("svg",{className:"w-4 h-4 text-blue-500",viewBox:"0 0 16 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z",fill:"currentColor"})}):s.jsx("svg",{className:"w-4 h-4 opacity-70",viewBox:"0 0 16 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z",fill:"currentColor"})})})]})]})]})})]},u.id||u._id||j)}),s.jsx("div",{ref:Ti})]})}),s.jsx("div",{className:"bg-white border-t border-gray-200 p-4",children:m.type==="personal"&&m.isActive===!1?s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg px-4 py-3 w-full text-center",children:s.jsx("p",{className:"text-red-600 text-sm font-medium",children:"This user is disabled. You can view previous messages but cannot send new ones."})})}):s.jsxs("div",{className:"relative",children:[me&&s.jsx("div",{className:"file-options-container absolute bottom-16 left-4 bg-white rounded-lg shadow-lg border border-gray-200 p-2 z-50",children:s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs("button",{onClick:()=>Ns("image"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[s.jsx(Ru,{className:"w-8 h-8 text-green-600 mb-1"}),s.jsx("span",{className:"text-xs text-gray-700",children:"Image"})]}),s.jsxs("button",{onClick:()=>Ns("video"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[s.jsx(ur,{className:"w-8 h-8 text-blue-600 mb-1"}),s.jsx("span",{className:"text-xs text-gray-700",children:"Video"})]}),s.jsxs("button",{onClick:()=>Ns("document"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[s.jsx(Ar,{className:"w-8 h-8 text-purple-600 mb-1"}),s.jsx("span",{className:"text-xs text-gray-700",children:"Document"})]})]})}),F&&s.jsx("div",{className:"mb-3 p-3 bg-gray-100 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[he?s.jsx("img",{src:he,alt:"Preview",className:"w-12 h-12 object-cover rounded"}):s.jsx(Ar,{className:"w-8 h-8 text-gray-500"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:F.name}),s.jsxs("p",{className:"text-xs text-gray-500",children:[(F.size/1024/1024).toFixed(2)," MB"]})]})]}),s.jsx("button",{onClick:nr,className:"text-gray-500 hover:text-gray-700",children:""})]})}),s.jsxs("form",{onSubmit:wo,className:"flex items-center space-x-3",children:[s.jsx("button",{type:"button",onClick:()=>Ce(!me),className:"p-2 text-gray-500 hover:text-gray-700",title:"Attach file",children:s.jsx(Jg,{className:"w-5 h-5"})}),s.jsx("div",{className:"flex-1 relative",children:s.jsx("input",{type:"text",value:L,onChange:u=>O(u.target.value),placeholder:"Type a message",className:"w-full py-2 px-4 bg-gray-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-green-400"})}),s.jsx("button",{type:"submit",disabled:!L.trim()&&!F,className:"bg-green-500 text-white p-2 rounded-full hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s.jsx(Xg,{className:"w-5 h-5"})})]})]})})]}):s.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:s.jsxs("div",{className:"text-center",children:[s.jsx(ms,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Welcome to WhatsApp Chat"}),s.jsx("p",{className:"text-gray-500 max-w-md",children:"Select a conversation from the sidebar to start messaging. Your conversations will appear on the left side."})]})})})]}),Cn&&qt&&s.jsx(s.Fragment,{children:qt.callType==="voice"?s.jsx(Uu,{user:e,callData:qt,isIncoming:nt,onCallEnd:()=>{qe(!1),St(null),Je(!1)},onCallAnswer:()=>{Je(!1)},onCallDecline:()=>{qe(!1),St(null),Je(!1)}}):s.jsx(Ou,{user:e,callData:qt,isIncoming:nt,onCallEnd:()=>{qe(!1),St(null),Je(!1)},onCallAnswer:()=>{Je(!1)},onCallDecline:()=>{qe(!1),St(null),Je(!1)}})}),Jr&&Xe&&Bt&&Xe.callType==="video"&&s.jsx(zu,{callData:Xe,onAccept:()=>{console.log(" ========================================"),console.log(" ACCEPTING INCOMING VIDEO CALL"),console.log(" Call ID:",Xe.callId),console.log(" Room Name:",Xe.roomName),console.log(" ========================================"),Be(!1),n&&(Xe!=null&&Xe.callId)&&(n.emit("group-call-join",{callId:Xe.callId,groupId:Xe.groupId}),console.log(" Socket notified - Jitsi will handle participants")),console.log(" Using Jitsi internal participant sync (no backend API needed)")},onDecline:()=>{Yt(!1),Kt(null),Be(!1),n&&(Xe!=null&&Xe.callId)&&n.emit("group-call-decline",{callId:Xe.callId,groupId:Xe.groupId})}}),Jr&&Xe&&!Bt&&(Xe.callType==="video"?s.jsx(Fu,{user:e,callData:Xe,onCallEnd:()=>{Yt(!1),Kt(null),Be(!1)}}):s.jsx($u,{user:e,callData:Xe,isIncoming:Bt,onCallEnd:()=>{Yt(!1),Kt(null),Be(!1)},onCallAnswer:()=>{Be(!1)},onCallDecline:()=>{Yt(!1),Kt(null),Be(!1)}}))]})},kb=()=>{const{user:e}=Fn(),{socket:t,isConnected:n,sendMessage:r,joinGroup:o,leaveGroup:i,onReceiveMessage:l,onReceiveGroupMessage:a,onMessageSent:d,getConnectionStatus:f,isUserOnline:g,getUserStatus:x}=po(),[b,T]=h.useState([]),[k,_]=h.useState([]),[w,m]=h.useState(null),[v,y]=h.useState([]),[M,L]=h.useState(""),[O,U]=h.useState(""),[K,oe]=h.useState(!0),[ne,Y]=h.useState({}),[ae,A]=h.useState({}),[ee,X]=h.useState("all"),[Z,ie]=h.useState(!1),[$,I]=h.useState(!1),C=50,[q,F]=h.useState(null),[G,he]=h.useState(null),[Ie,me]=h.useState(!1),[Ce,Oe]=h.useState({}),[kt,Ne]=h.useState(0),[At,Cn]=h.useState(!1),[qe,qt]=h.useState(()=>{try{const c=sessionStorage.getItem("downloadedMessages");return c?JSON.parse(c):{}}catch{return{}}}),[St,nt]=h.useState(!1),[Je,ue]=h.useState(null),[je,$e]=h.useState(!1),[Ge,dt]=h.useState(null),[mt,Me]=h.useState(null),[Re,wt]=h.useState(null),[rt,zt]=h.useState(null),[re,be]=h.useState(1),[Le,Ct]=h.useState({x:0,y:0}),[we,bt]=h.useState(!1),He=()=>{be(c=>Math.min(c*1.25,4))},Zn=()=>{be(c=>Math.max(c/1.25,.5))},zn=()=>{be(1),Ct({x:0,y:0})},er=c=>{c.preventDefault(),bt(!0),Ct({x:c.clientX-Le.x,y:c.clientY-Le.y})},Jr=c=>{we&&(c.preventDefault(),Ct({x:c.clientX-Le.x,y:c.clientY-Le.y}))},Yt=()=>{bt(!1)},Xe=c=>{Me(c),be(1),Ct({x:0,y:0})},[Kt,Bt]=h.useState(!1),[Be,S]=h.useState(null),[W,V]=h.useState(!1),B=c=>c&&(/^https?:\/\//i.test(c)?c:`${ze}${c}`),se=c=>c?c.includes("drive.google.com")||c.includes("googleapis.com"):!1,xe=c=>{if(!c)return"";const p=new Date(c),E=new Date,N=new Date(E.getFullYear(),E.getMonth(),E.getDate()),R=new Date(N);R.setDate(R.getDate()-1);const P=new Date(p.getFullYear(),p.getMonth(),p.getDate());return P.getTime()===N.getTime()?p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):P.getTime()===R.getTime()?"Yesterday":Math.floor((N-P)/(1e3*60*60*24))<7?p.toLocaleDateString([],{weekday:"short"}):p.toLocaleDateString([],{day:"numeric",month:"numeric",year:p.getFullYear()!==E.getFullYear()?"numeric":void 0})},Ee=c=>{if(!c)return"";const p=new Date(c),E=new Date,N=new Date(E.getFullYear(),E.getMonth(),E.getDate()),R=new Date(N);R.setDate(R.getDate()-1);const P=new Date(p.getFullYear(),p.getMonth(),p.getDate());return P.getTime()===N.getTime()?"Today":P.getTime()===R.getTime()?"Yesterday":Math.floor((N-P)/(1e3*60*60*24))<7?p.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric"}):p.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric",year:p.getFullYear()!==E.getFullYear()?"numeric":void 0})},le=c=>{if(!c)return"Last seen recently";const p=new Date,E=new Date(c),N=p-E,R=Math.floor(N/(1e3*60)),P=Math.floor(N/(1e3*60*60)),D=Math.floor(N/(1e3*60*60*24));return R<1?"Online":R<60?`Last seen ${R} minute${R===1?"":"s"} ago`:P<24?`Last seen ${P} hour${P===1?"":"s"} ago`:D===1?"Last seen yesterday":D<7?`Last seen ${D} day${D===1?"":"s"} ago`:`Last seen ${E.toLocaleDateString([],{month:"short",day:"numeric"})}`},[ge,pt]=h.useState(null),[ht,vr]=h.useState(!1),[Xr,wr]=h.useState(null),[Pt,Zr]=h.useState(null),[gt,an]=h.useState(""),[lt,es]=h.useState(null),Ye=c=>((c==null?void 0:c.id)||(c==null?void 0:c._id)||(c==null?void 0:c.messageId)||"").toString(),Bn=c=>{ge&&clearTimeout(ge);const p=setTimeout(()=>{wr(c),vr(!0)},700);pt(p)},Qt=()=>{ge&&(clearTimeout(ge),pt(null))},go=(c,p)=>{p.stopPropagation(),es(lt===c?null:c)},gn=(c,p)=>{switch(wr(p),es(null),c){case"copy":Ii(p);break;case"edit":xo(p);break;case"forward":Ti(p);break}},Ii=async c=>{try{const p=(c==null?void 0:c.messageType)==="text"?(c==null?void 0:c.message)||"":B(c==null?void 0:c.fileUrl)||(c==null?void 0:c.fileName)||"";p&&(await navigator.clipboard.writeText(p),H.success("Copied to clipboard"))}catch(p){console.error("Copy failed:",p),H.error("Failed to copy")}},Ti=c=>{try{sessionStorage.setItem("forwardMessage",JSON.stringify({id:c.id||c._id,message:c.message,messageType:c.messageType,fileUrl:c.fileUrl,fileName:c.fileName,fileSize:c.fileSize,fileType:c.fileType})),H.success("Message ready to forward"),window.location.href="/forward"}catch(p){console.error("Forward setup failed:",p),H.error("Failed to prepare message for forwarding")}},xo=c=>{var p,E,N,R;if(c&&c.messageType==="text"){const P=((p=c.sender)==null?void 0:p.id)||((E=c.sender)==null?void 0:E._id)||c.sender;P===e.id||P===e._id||P===((N=e.id)==null?void 0:N.toString())||P===((R=e._id)==null?void 0:R.toString())?(Zr(c),an(c.message||"")):H.error("You can only edit your own messages")}},Jt=async()=>{if(!(!Pt||!gt.trim()))try{y(c=>c.map(p=>Ye(p)===Ye(Pt)?{...p,message:gt.trim(),isEdited:!0,editedAt:new Date().toISOString()}:p)),await at.editMessage(Pt.id||Pt._id,gt.trim()),Zr(null),an("")}catch(c){console.error("Failed to edit message:",c),H.error("Failed to edit message")}},ts=()=>{Zr(null),an("")},br=h.useRef(null),jr=h.useRef(!0),Xt=h.useRef(null),tr=h.useRef(0),ns=h.useRef(null);h.useEffect(()=>((async()=>{try{console.log(" Loading chat state from database...");const p=await at.getChatState(),{personalChats:E,groupChats:N}=p.data,R={},P={};E.forEach(D=>{var ce,pe,ke;D.unreadCount>0?R[D.chatId]=D.unreadCount:delete R[D.chatId],D.lastMessage&&D.lastMessage.message&&(P[D.chatId]={id:D.lastMessage._id||D.lastMessage.id,message:D.lastMessage.message,senderName:D.lastMessage.senderName||((ce=D.lastMessage.sender)==null?void 0:ce.name)||"User",senderId:D.lastMessage.senderId||((pe=D.lastMessage.sender)==null?void 0:pe._id)||((ke=D.lastMessage.sender)==null?void 0:ke.id),timestamp:D.lastMessage.createdAt||D.lastMessage.timestamp})}),N.forEach(D=>{var ce,pe,ke;D.unreadCount>0?R[D.chatId]=D.unreadCount:delete R[D.chatId],D.lastMessage&&D.lastMessage.message&&(P[D.chatId]={id:D.lastMessage._id||D.lastMessage.id,message:D.lastMessage.message,senderName:D.lastMessage.senderName||((ce=D.lastMessage.sender)==null?void 0:ce.name)||"User",senderId:D.lastMessage.senderId||((pe=D.lastMessage.sender)==null?void 0:pe._id)||((ke=D.lastMessage.sender)==null?void 0:ke.id),timestamp:D.lastMessage.createdAt||D.lastMessage.timestamp})}),Y(R),A(P),console.log(" Chat state loaded from database:",{unreadCounts:R,lastMessages:Object.keys(P).length})}catch(p){console.error("Error loading chat state from database:",p)}})(),_i(),()=>{Et.removeAllListeners(),Et.healthCheckInterval&&(clearInterval(Et.healthCheckInterval),delete Et.healthCheckInterval)}),[]),h.useEffect(()=>{if(t)return console.log(" Setting up PERSISTENT call listeners for Chat Page..."),t.off("incoming-call"),t.on("incoming-call",c=>{var p;console.log(" Chat Page - Incoming call received:",c),H.success(`Incoming ${c.callType} call from ${((p=c.caller)==null?void 0:p.name)||"Unknown"}`,{duration:5e3,icon:""}),$e(!0),ue({callId:c.callId,callType:c.callType,caller:c.caller}),nt(!0)}),t.off("call-initiated"),t.on("call-initiated",c=>{console.log(" Chat Page - Call initiated:",c),$e(!1),ue({callId:c.callId,callType:c.callType,otherUser:c.receiver}),nt(!0)}),t.off("call-error"),t.on("call-error",c=>{console.error(" Chat Page - Call error:",c),H.error(c.error||"Call failed",{duration:4e3})}),t.off("incoming-group-call"),t.on("incoming-group-call",c=>{var p,E;console.log(" ========================================"),console.log(" Chat Page - INCOMING GROUP CALL RECEIVED!"),console.log(" Call ID:",c.callId),console.log(" Call Type:",c.callType),console.log(" Room Name:",c.roomName),console.log(" Group:",c.groupName),console.log(" Initiator:",(p=c.initiator)==null?void 0:p.name),console.log(" ========================================"),H.success(`Incoming group ${c.callType} call from ${((E=c.initiator)==null?void 0:E.name)||"Unknown"} in ${c.groupName}`,{duration:5e3,icon:""}),V(!0),S({callId:c.callId,callType:c.callType,groupId:c.groupId,roomName:c.roomName,group:c.group||{name:c.groupName},initiator:c.initiator}),Bt(!0)}),t.off("group-call-initiated"),t.on("group-call-initiated",c=>{console.log(" ========================================"),console.log(" Chat Page - GROUP CALL INITIATED!"),console.log(" Call ID:",c.callId),console.log(" Room Name:",c.roomName),console.log(" Call Type:",c.callType),console.log(" ========================================"),V(!1),S({callId:c.callId,callType:c.callType,groupId:c.groupId,roomName:c.roomName,group:c.group}),Bt(!0)}),t.off("group-call-error"),t.on("group-call-error",c=>{console.error(" Chat Page - Group call error:",c),H.error(c.error||"Group call failed",{duration:4e3})}),()=>{console.log(" Cleaning up PERSISTENT call listeners..."),t.off("incoming-call"),t.off("call-initiated"),t.off("call-error"),t.off("incoming-group-call"),t.off("group-call-initiated"),t.off("group-call-error")}},[t]),h.useEffect(()=>(w&&(y([]),ie(!1),I(!1),jr.current=!0,Nr(),Dn(),w.type==="group"&&(o(w.id),console.log(" Joined group room for:",w.name))),()=>{Et.removeAllListeners(),w&&w.type==="group"&&(i(w.id),console.log(" Left group room for:",w.name)),Et.healthCheckInterval&&(clearInterval(Et.healthCheckInterval),delete Et.healthCheckInterval)}),[w]),h.useEffect(()=>{if(v.length>0){if(jr.current)setTimeout(()=>{Ea(!0),jr.current=!1},100);else if(Xt.current){const c=Xt.current,p=c.scrollHeight,E=c.scrollTop,N=c.clientHeight;p-E-N<200&&Ea(!1)}}},[v]);const yo=()=>{!Xt.current||$||!Z||!w||(ns.current&&clearTimeout(ns.current),ns.current=setTimeout(()=>{var E,N;if(!Xt.current||$||!Z)return;const c=Xt.current;if(c.scrollTop<50&&v.length>0){tr.current=c.scrollHeight;const R=((E=v[0])==null?void 0:E._id)||((N=v[0])==null?void 0:N.id);R&&Nr(R)}},150))};h.useEffect(()=>{const c=Xt.current;if(!(!c||!w))return c.addEventListener("scroll",yo),()=>{c.removeEventListener("scroll",yo),ns.current&&clearTimeout(ns.current)}},[v,$,Z,w]);const js=async()=>{try{console.log(" Refreshing chat state from database...");const c=await at.getChatState(),{personalChats:p,groupChats:E}=c.data,N={},R={};p.forEach(P=>{var D,ce,pe;P.unreadCount>0&&(N[P.chatId]=P.unreadCount),P.lastMessage&&P.lastMessage.message&&(R[P.chatId]={id:P.lastMessage._id||P.lastMessage.id,message:P.lastMessage.message,senderName:P.lastMessage.senderName||((D=P.lastMessage.sender)==null?void 0:D.name)||"User",senderId:P.lastMessage.senderId||((ce=P.lastMessage.sender)==null?void 0:ce._id)||((pe=P.lastMessage.sender)==null?void 0:pe.id),timestamp:P.lastMessage.createdAt||P.lastMessage.timestamp})}),E.forEach(P=>{var D,ce,pe;P.unreadCount>0&&(N[P.chatId]=P.unreadCount),P.lastMessage&&P.lastMessage.message&&(R[P.chatId]={id:P.lastMessage._id||P.lastMessage.id,message:P.lastMessage.message,senderName:P.lastMessage.senderName||((D=P.lastMessage.sender)==null?void 0:D.name)||"User",senderId:P.lastMessage.senderId||((ce=P.lastMessage.sender)==null?void 0:ce._id)||((pe=P.lastMessage.sender)==null?void 0:pe.id),timestamp:P.lastMessage.createdAt||P.lastMessage.timestamp})}),Y(N),A(R),console.log(" Chat state refreshed from database")}catch(c){console.error("Error refreshing chat state:",c)}};h.useEffect(()=>{window.testSocket=()=>{Et.testConnection()},window.checkSocket=()=>{Et.logConnectionStatus()},window.forceSocketConnect=()=>{Et.forceConnectionTest()},console.log(" Socket debugging methods available:"),console.log(" - testSocket() - Test socket connection status"),console.log(" - checkSocket() - Show current socket status"),console.log(" - forceSocketConnect() - Force reconnection")},[]);const _i=async()=>{try{oe(!0);const[c,p]=await Promise.all([Vt.getActiveUsers(),Rn.getMyGroups()]);console.log(" Chat Data Loaded:"),console.log(" Users:",c.data.length),console.log(" Groups:",p.data.length),console.log(" Group Details:",p.data.map(E=>{var N;return{id:E.id,name:E.name,members:((N=E.members)==null?void 0:N.length)||0,avatar:E.avatar?"Has Avatar":"No Avatar"}})),T(c.data.filter(E=>E.id!==e.id)),_(p.data),Dn()}catch(c){console.error("Error fetching initial data:",c),H.error("Failed to load chat data")}finally{oe(!1)}},Dn=()=>{console.log(" Setting up enhanced socket listeners with Context API...");const c=f();console.log(" Current socket status:",c),l(p=>{var pe,ke;console.log(" CHATROOM CONTEXT - received message:",p);const E=typeof p.sender=="object"?p.sender.id||p.sender._id:p.sender,N=typeof p.receiver=="object"?p.receiver.id||p.receiver._id:p.receiver,R=p.id||p._id||p.messageId,P=p.message||p.content,D=E===e.id||E===e._id||E===((pe=e.id)==null?void 0:pe.toString())||E===((ke=e._id)==null?void 0:ke.toString());if(p._isConfirmation||p.isConfirmMessage||p.isMessageSentConfirmation){console.log(" Skipping confirmation message");return}const ce=vo(p,w,e);if(console.log(" ENHANCED MESSAGE FILTERING:",{senderId:E,receiverId:N,messageId:R,messageText:P,selectedChatId:w==null?void 0:w.id,selectedChatType:w==null?void 0:w.type,currentUserId:e.id,isCurrentUserSender:D,isForCurrentChat:ce,messageData:p}),ce&&w)console.log(" Processing message for current active chat"),D?console.log(" Message from current user - handled by optimistic updates"):(console.log(" Adding external message to current chat immediately"),y(ye=>{if(ye.some(Q=>{var xn,Vn;const De=Q.id||Q._id||Q.messageId,Se=Q.message||Q.content,Fe=((xn=Q.sender)==null?void 0:xn.id)||((Vn=Q.sender)==null?void 0:Vn._id)||Q.sender,Ze=Q.createdAt||Q.timestamp,et=p.createdAt||p.timestamp;return!!(De===R&&R||Se===P&&String(Fe)===String(E)&&et&&Ze&&Math.abs(new Date(et)-new Date(Ze))<5e3||Q.isOptimistic&&Se===P&&String(Fe)===String(E)&&et&&Ze&&Math.abs(new Date(et)-new Date(Ze))<1e4)}))return console.log(" Enhanced detection: Message already exists - confirmed duplicate",{messageId:R,messageText:P==null?void 0:P.substring(0,20),senderId:E,isDuplicate:!0}),ye;console.log(" REAL-TIME: NEW message confirmed - Adding to active chat",{messageId:R,messageText:P==null?void 0:P.substring(0,20),senderId:E,isDuplicate:!1});const _e=Ns(p,E);return nr(w.id,p,E),setTimeout(()=>{js()},100),[...ye,_e]}));else if(P&&!D){const ye=E||p.sender;ye&&ye!==e.id&&(console.log(" Incrementing unread count for chat:",ye),Y(te=>({...te,[ye]:(te[ye]||0)+1})),nr(ye,p,E),setTimeout(()=>{js()},100))}}),d(p=>{console.log(" Message sent confirmation received:",p),p&&p.id&&y(E=>{const N=E.filter(P=>!P.isOptimistic),R={id:p.id,message:p.message,messageType:p.messageType||"text",fileUrl:p.fileUrl,fileName:p.fileName,fileSize:p.fileSize,fileType:p.fileType,sender:p.sender,createdAt:p.createdAt||p.timestamp,timestamp:p.timestamp,isOptimistic:!1};return[...N,R]})}),a(p=>{var pe,ke,ye,te;console.log(" GROUP MESSAGE CONTEXT - received message:",p);const E=typeof p.sender=="object"?p.sender.id||p.sender._id:p.sender,N=p.groupId||((pe=p.group)==null?void 0:pe.id)||((ke=p.group)==null?void 0:ke._id),R=p.id||p._id||p.messageId,P=p.message||p.content,D=E===e.id||E===e._id||E===((ye=e.id)==null?void 0:ye.toString())||E===((te=e._id)==null?void 0:te.toString());if(p._isConfirmation||p.isConfirmMessage||p.isMessageSentConfirmation){console.log(" Skipping confirmation message");return}const ce=w&&w.type==="group"&&(N===w.id||String(N)===String(w.id));if(console.log(" GROUP MESSAGE FILTERING:",{senderId:E,groupId:N,messageId:R,messageText:P,selectedChatId:w==null?void 0:w.id,selectedChatType:w==null?void 0:w.type,currentUserId:e.id,isCurrentUserSender:D,isForCurrentGroup:ce,messageData:p}),ce&&w)console.log(" Processing group message for current group"),D?console.log(" Group message from current user - handled by optimistic updates"):(console.log(" Adding external group message to current chat immediately"),y(_e=>{if(_e.some(Se=>{var Es,Bu;const Fe=Se.id||Se._id||Se.messageId,Ze=Se.message||Se.content,et=((Es=Se.sender)==null?void 0:Es.id)||((Bu=Se.sender)==null?void 0:Bu._id)||Se.sender,xn=Se.createdAt||Se.timestamp,Vn=p.createdAt||p.timestamp;return!!(Fe===R&&R||Ze===P&&String(et)===String(E)&&Vn&&xn&&Math.abs(new Date(Vn)-new Date(xn))<5e3||Se.isOptimistic&&Ze===P&&String(et)===String(E)&&Vn&&xn&&Math.abs(new Date(Vn)-new Date(xn))<1e4)}))return console.log(" GROUP duplicate detection: Message already exists",{messageId:R,messageText:P==null?void 0:P.substring(0,20),senderId:E==null?void 0:E.toString(),isDuplicate:!0}),_e;console.log(" GROUP REAL-TIME: NEW message confirmed - Adding to active group",{messageId:R,messageText:P==null?void 0:P.substring(0,20),senderId:E,groupId:N});const De=Ns(p,E);return nr(w.id,p,E),setTimeout(()=>{js()},100),[..._e,De]}));else if(P&&!D){const _e=N||p.groupId;_e&&(!w||w.type!=="group"||String(_e)!==String(w.id))&&(console.log(" Incrementing unread count for group:",_e),Y(De=>({...De,[_e]:(De[_e]||0)+1})),nr(_e,p,E),setTimeout(()=>{js()},100))}}),t&&(t.off("avatar-updated"),t.on("avatar-updated",p=>{var N,R;console.log(" Profile updated received:",p);const E=((N=p.userId)==null?void 0:N.toString())||p.userId;T(P=>P.map(D=>{var ce;return((ce=D.id||D._id)==null?void 0:ce.toString())===E?{...D,profileImage:p.profileImage,name:p.name}:D})),w&&w.type==="personal"&&((R=w.id||w._id)==null?void 0:R.toString())===E&&m(P=>({...P,profileImage:p.profileImage,name:p.name})),y(P=>P.map(D=>{var pe,ke,ye;return((ye=((pe=D.sender)==null?void 0:pe.id)||((ke=D.sender)==null?void 0:ke._id)||D.sender)==null?void 0:ye.toString())===E?{...D,sender:{...typeof D.sender=="object"?D.sender:{id:D.sender},profileImage:p.profileImage,name:p.name}}:D}))}),t.off("messages-seen"),t.on("messages-seen",p=>{console.log(" Messages seen by user:",p.readBy),w&&w.type==="personal"&&p.chatId===w.id&&y(E=>E.map(N=>{var P,D;return(((P=N.sender)==null?void 0:P.id)||((D=N.sender)==null?void 0:D._id)||N.sender)===e.id?{...N,isRead:!0,readBy:[{user:p.readBy,readAt:p.timestamp}]}:N}))}))},vo=(c,p,E)=>{var D,ce,pe,ke;if(!p)return!1;const N=((D=c.sender)==null?void 0:D.id)||((ce=c.sender)==null?void 0:ce._id)||c.sender,R=((pe=c.receiver)==null?void 0:pe.id)||((ke=c.receiver)==null?void 0:ke._id)||c.receiver,P=c.chatId||c.chatRoom;return p.type==="personal"&&p.id&&(N===p.id&&R===E.id||N===E.id&&R===p.id||String(N)===String(p.id)||String(R)===String(p.id))?!0:p.type==="group"?P===p.id||c.groupId===p.id:!1},Ns=(c,p)=>{var E,N;return{id:c.id||c._id||c.messageId,message:c.message||c.content,messageType:c.messageType||"text",fileUrl:c.fileUrl,fileName:c.fileName,fileSize:c.fileSize,fileType:c.fileType,sender:typeof c.sender=="object"?c.sender:{id:p,name:c.senderName||((E=c.sender)==null?void 0:E.name)||"User",profileImage:c.senderProfileImage||((N=c.sender)==null?void 0:N.profileImage)},createdAt:c.createdAt||c.timestamp||new Date().toISOString(),timestamp:c.timestamp||c.createdAt,isFromOtherUser:!(p===e.id||p===e._id)}},nr=(c,p,E)=>{var P;const N=E===e.id||E===e._id,R={id:p.id||p._id||p.messageId,message:p.message||p.content,senderName:N?"You":p.senderName||((P=p.sender)==null?void 0:P.name)||"User",senderId:E,timestamp:p.createdAt||p.timestamp||new Date().toISOString()};A(D=>({...D,[c]:R}))},Nr=async(c=null)=>{var p;try{c&&I(!0);let E;const N={limit:C};if(c&&(N.before=c),w.type==="personal"){if(!w.id){console.error("User ID is undefined for personal chat");return}E=await at.getPersonalMessages(w.id,N)}else{if(!w.id){console.error("Group ID is undefined for group chat");return}E=await at.getGroupMessages(w.id,N)}let R,P;if(E.data&&typeof E.data=="object"?Array.isArray(E.data.messages)?(R=E.data.messages,P=E.data.hasMore||!1):Array.isArray(E.data)?(R=E.data,P=E.data.length>=C):(R=[],P=!1):(R=[],P=!1),c)y(D=>{const ce=new Set(D.map(ke=>ke._id||ke.id));return[...R.filter(ke=>{const ye=ke._id||ke.id;return!ce.has(ye)}),...D]}),ie(P),I(!1),setTimeout(()=>{if(Xt.current&&tr.current>0){const ce=Xt.current.scrollHeight-tr.current;Xt.current.scrollTop=ce+100}},0);else if(y(R||[]),ie(P),R&&R.length>0){const D=R[R.length-1];nr(w.id,D,((p=D.sender)==null?void 0:p.id)||D.sender)}}catch(E){console.error("Error fetching messages:",E),H.error("Failed to load messages"),y([]),c&&I(!1)}},wo=c=>{const p=document.createElement("input");p.type="file",p.style.display="none",c==="image"?p.accept="image/*":c==="video"?p.accept="video/*":c==="document"&&(p.accept=".pdf,.doc,.docx,.txt,.csv,.xls,.xlsx,.ppt,.pptx,.xlsm,.xlsx,.zip,.rar,.7z,.tar,.gz,.bz2,.xz,.iso,.dmg,.img,.bin,.exe,.msi,.dmg,.iso,.tar,.gz,.bz2,.xz,.img,.bin,.exe,.msi"),p.onchange=E=>{const N=E.target.files[0];if(N){if(F(N),N.type.startsWith("image/")){const R=new FileReader;R.onload=P=>he(P.target.result),R.readAsDataURL(N)}else he(null);me(!1)}},document.body.appendChild(p),p.click(),document.body.removeChild(p)},ks=()=>{F(null),he(null)},Ss=async(c,p,E)=>{try{Oe(_e=>({..._e,[E]:{progress:0,downloading:!0}}));const N=await fetch(B(c)),R=N.headers.get("content-length"),P=parseInt(R,10);if(!N.ok)throw new Error("Download failed");const D=N.body.getReader(),ce=[];let pe=0;for(;;){const{done:_e,value:Q}=await D.read();if(_e)break;ce.push(Q),pe+=Q.length;const De=P?Math.round(pe/P*100):0;Oe(Se=>({...Se,[E]:{progress:De,downloading:!0}}))}const ke=new Blob(ce),ye=window.URL.createObjectURL(ke),te=document.createElement("a");te.href=ye,te.download=p,document.body.appendChild(te),te.click(),document.body.removeChild(te),window.URL.revokeObjectURL(ye),Oe(_e=>({..._e,[E]:{progress:100,downloading:!1}})),qt(_e=>{const Q={..._e,[E]:!0};try{sessionStorage.setItem("downloadedMessages",JSON.stringify(Q))}catch{}return Q}),setTimeout(()=>{Oe(_e=>{const Q={..._e};return delete Q[E],Q})},2e3)}catch(N){console.error("Download failed:",N),Oe(R=>({...R,[E]:{progress:0,downloading:!1,error:!0}}))}};h.useEffect(()=>{const c=p=>{Ie&&!p.target.closest(".file-options-container")&&me(!1),lt&&!p.target.closest(".message-dropdown-container")&&es(null)};return document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[Ie,lt]);const Cs=async c=>{if(c.preventDefault(),!M.trim()&&!q||!w)return;const p=M.trim();L("");try{let E,N="text";q&&(q.type.startsWith("image/")?N="image":q.type.startsWith("video/")?N="video":N="file");const R={id:Date.now(),message:p||(q?q.name:""),messageType:N,fileUrl:q?URL.createObjectURL(q):null,fileName:q?q.name:null,fileSize:q?q.size:null,fileType:q?q.type:null,sender:{id:e.id,name:e.name,profileImage:e.profileImage},createdAt:new Date().toISOString(),timestamp:new Date().toISOString(),isOptimistic:!0};if(y(P=>[...P,R]),nr(w.id,{id:R.id,message:R.message,createdAt:R.createdAt},e.id),q){Cn(!0),Ne(0);const P=new FormData;P.append("file",q),P.append("message",p);const D=ce=>{const pe=Math.round(ce.loaded*100/ce.total);Ne(pe),console.log(` Upload progress: ${pe}%`)};try{w.type==="personal"?(P.append("receiver",w.id),E=await at.sendPersonalMessage(P,D)):(P.append("group",w.id),E=await at.sendGroupMessage(P,D)),H.success(`File uploaded successfully! (${(q.size/(1024*1024)).toFixed(2)}MB)`)}finally{Cn(!1),Ne(0),ks()}}else if(w.type==="personal")try{await r(w.id,p,"text",!1),console.log(" Message sent via context socket")}catch(P){console.warn("Context socket failed, trying API:",P),await at.sendPersonalMessage({sender:e.id,receiver:w.id,message:p,timestamp:new Date().toISOString()})}else try{await r(w.id,p,"text",!0),console.log(" Group message sent via context socket")}catch(P){console.warn("Context group socket failed, trying API:",P),await at.sendGroupMessage({sender:e.id,group:w.id,message:p,timestamp:new Date().toISOString()})}console.log(" Message sent successfully")}catch(E){console.error(" Failed to send message:",E),H.error("Failed to send message"),y(N=>N.filter(R=>!R.isOptimistic))}},Ea=(c=!1)=>{var p;(p=br.current)==null||p.scrollIntoView({behavior:c?"instant":"smooth"})},rs=[...b.map(c=>({id:c.id,name:c.name,email:c.email,type:"personal",avatar:c.name.charAt(0).toUpperCase(),profileImage:c.profileImage,lastMessage:ae[c.id]||null})),...k.map(c=>{var p;return{id:c.id,name:c.name,email:`${((p=c.members)==null?void 0:p.length)||0} members`,type:"group",avatar:c.avatar?`${ze}${c.avatar}`:"G",profileImage:c.avatar,lastMessage:ae[c.id]||null}})].sort((c,p)=>{var R,P;const E=(R=c.lastMessage)!=null&&R.timestamp?new Date(c.lastMessage.timestamp).getTime():0;return((P=p.lastMessage)!=null&&P.timestamp?new Date(p.lastMessage.timestamp).getTime():0)-E}),j=(()=>{let c=rs;switch(ee){case"unread":c=rs.filter(p=>ne[p.id]>0);break;case"groups":c=rs.filter(p=>p.type==="group");break;case"all":default:c=rs;break}return c.filter(p=>p.name.toLowerCase().includes(O.toLowerCase())||p.email.toLowerCase().includes(O.toLowerCase()))})();return K?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"})}):s.jsxs("div",{className:"h-screen bg-gray-50 flex",children:[s.jsxs("div",{className:"w-full h-screen flex bg-white shadow-lg",children:[s.jsxs("div",{className:"w-1/3 min-w-[300px] max-w-[400px] bg-white border-r border-gray-200 flex flex-col",children:[s.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("button",{onClick:()=>window.history.back(),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",title:"Go back",children:s.jsx(ho,{className:"w-5 h-5"})}),s.jsx("h2",{className:"text-lg text-start font-semibold text-gray-800",children:"Admin Chat"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:()=>window.location.href="/profile",className:"text-gray-500 hover:text-gray-700",title:"Profile",children:s.jsx(fn,{className:"w-5 h-5"})}),s.jsx(wd,{className:"w-5 h-5 text-gray-500 cursor-pointer hover:text-gray-700"})]})]}),s.jsx("div",{className:"flex items-center space-x-3 mb-3",children:s.jsxs("button",{onClick:()=>window.location.href="/profile",className:"flex items-center space-x-3 hover:opacity-80 transition-opacity",children:[e.profileImage?s.jsx("img",{src:`${ze}${e.profileImage}`,alt:"Profile",className:"w-10 h-10 rounded-full object-cover"}):s.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-white font-medium",children:e.name.charAt(0).toUpperCase()})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:e.name}),s.jsx("p",{className:"text-xs text-start text-green-600",children:"Online"})]})]})})]}),s.jsxs("div",{className:"p-3 bg-white border-b border-gray-200",children:[s.jsxs("div",{className:"relative mb-3",children:[s.jsx(Sa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),s.jsx("input",{type:"text",placeholder:"Search or start new chat",value:O,onChange:c=>U(c.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-green-400"})]}),s.jsxs("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:[s.jsx("button",{onClick:()=>X("all"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${ee==="all"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"All"}),s.jsxs("button",{onClick:()=>X("unread"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${ee==="unread"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:["Unread",Object.values(ne).reduce((c,p)=>c+p,0)>0&&s.jsx("span",{className:"ml-1 bg-green-500 text-white text-xs rounded-full px-1.5 py-0.5",children:Object.values(ne).reduce((c,p)=>c+p,0)})]}),s.jsx("button",{onClick:()=>X("groups"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${ee==="groups"?"bg-white text-green-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Groups"})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto",children:[j.map(c=>{var p;return s.jsx("div",{onClick:()=>{console.log("Selecting chat:",c),m({type:c.type,id:c.id,name:c.name,profileImage:c.profileImage}),ne[c.id]&&(Y(E=>{const N={...E};return delete N[c.id],N}),at.updateChatState({chatId:c.id,chatType:c.type,action:"clear_unread"}).catch(E=>{console.error("Error clearing unread count:",E)}))},className:`p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 ${(w==null?void 0:w.id)===c.id&&(w==null?void 0:w.type)===c.type?"bg-green-50":""}`,children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"relative",children:s.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-200 cursor-pointer hover:ring-2 hover:ring-green-400 transition-all",onClick:E=>{E.stopPropagation(),c.profileImage&&dt({image:c.type==="personal"?`${ze}${c.profileImage}`:c.avatar,name:c.name})},children:c.type==="personal"?c.profileImage?s.jsx("img",{src:`${ze}${c.profileImage}`,alt:c.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:s.jsx("span",{className:"text-white font-semibold text-lg",children:c.avatar})}):c.profileImage?s.jsx("img",{src:c.avatar,alt:c.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:s.jsx(ln,{className:"w-6 h-6 text-white"})})})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("h3",{className:"font-medium text-gray-900 truncate",children:c.name}),c.type==="group"&&s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Group"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-xs text-gray-500",children:(p=c.lastMessage)!=null&&p.timestamp?xe(c.lastMessage.timestamp):""}),ne[c.id]&&ne[c.id]>0&&s.jsx("div",{className:"bg-green-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center",children:ne[c.id]>99?"99+":ne[c.id]})]})]}),s.jsx("p",{className:"text-sm text-gray-500 truncate",children:c.lastMessage&&c.lastMessage.message?`${c.lastMessage.senderName||"You"}: ${c.lastMessage.message}`:"No messages yet"})]})]})},`${c.type}-${c.id}`)}),j.length===0&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(ms,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-500 text-sm",children:O?"No chats found.":"No chats available."})]})]})]}),Ge&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:()=>dt(null),children:s.jsxs("div",{className:"relative max-w-2xl max-h-[90vh] p-4",children:[s.jsx("button",{onClick:()=>dt(null),className:"absolute top-6 right-6 z-10 bg-white/10 hover:bg-white/20 text-white rounded-full p-2 transition-colors",title:"Close",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsxs("div",{className:"bg-white rounded-lg overflow-hidden shadow-2xl",children:[s.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-4",children:s.jsx("h3",{className:"text-white text-xl font-semibold text-center",children:Ge.name})}),s.jsx("img",{src:Ge.image,alt:Ge.name,className:"w-full h-auto max-h-[70vh] object-contain",onClick:c=>c.stopPropagation()})]})]})}),mt&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>Me(null),onMouseMove:Jr,onMouseUp:Yt,onMouseLeave:Yt,children:s.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center overflow-hidden",children:[s.jsx("button",{onClick:()=>Me(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("button",{onClick:c=>{c.stopPropagation();const p=document.createElement("a");p.href=mt.src,p.download=mt.alt,document.body.appendChild(p),p.click(),document.body.removeChild(p)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:s.jsx(bn,{className:"w-5 h-5"})}),s.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[s.jsx("button",{onClick:c=>{c.stopPropagation(),He()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Zoom In",children:s.jsx(t0,{className:"w-5 h-5"})}),s.jsx("button",{onClick:c=>{c.stopPropagation(),Zn()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Zoom Out",children:s.jsx(n0,{className:"w-5 h-5"})}),s.jsx("button",{onClick:c=>{c.stopPropagation(),zn()},className:"bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Reset Zoom",children:s.jsx(Au,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"absolute bottom-4 left-4 z-10 bg-black/50 text-white px-3 py-2 rounded-lg text-sm",children:[Math.round(re*100),"%"]}),s.jsx("img",{src:mt.src,alt:mt.alt,className:`object-contain transition-transform duration-200 ${we?"cursor-grabbing":"cursor-grab"}`,style:{transform:`translate(${Le.x}px, ${Le.y}px) scale(${re})`,maxWidth:"none",maxHeight:"none",width:"auto",height:"auto"},onMouseDown:er,onClick:c=>c.stopPropagation(),draggable:!1})]})}),Re&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>wt(null),children:s.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center",children:[s.jsx("button",{onClick:()=>wt(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("button",{onClick:c=>{c.stopPropagation();const p=document.createElement("a");p.href=Re.src,p.download=Re.alt,document.body.appendChild(p),p.click(),document.body.removeChild(p)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:s.jsx(bn,{className:"w-5 h-5"})}),s.jsx("video",{src:Re.src,controls:!0,autoPlay:!0,className:"max-w-full max-h-full object-contain",onClick:c=>c.stopPropagation()})]})}),rt&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",onClick:()=>zt(null),children:s.jsxs("div",{className:"relative w-[95vw] h-[95vh] flex items-center justify-center",children:[s.jsx("button",{onClick:()=>zt(null),className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Close",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("button",{onClick:c=>{c.stopPropagation();const p=document.createElement("a");p.href=rt.src,p.download=rt.fileName,document.body.appendChild(p),p.click(),document.body.removeChild(p)},className:"absolute top-4 right-16 z-10 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors",title:"Download",children:s.jsx(bn,{className:"w-5 h-5"})}),s.jsx("div",{className:"bg-white rounded-lg shadow-2xl w-full h-full max-w-4xl max-h-[90vh] overflow-hidden",children:rt.fileType==="application/pdf"?s.jsx("iframe",{src:rt.src,className:"w-full h-full border-0",title:rt.fileName,onClick:c=>c.stopPropagation()}):s.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-8",children:[s.jsx(Ar,{className:"w-24 h-24 text-gray-400 mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:rt.fileName}),s.jsxs("p",{className:"text-gray-600 mb-4",children:[(rt.fileSize/1024/1024).toFixed(2)," MB"]}),s.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["This file type cannot be previewed in the browser.",s.jsx("br",{}),"Click the download button to save and view the file."]}),s.jsx("button",{onClick:c=>{c.stopPropagation();const p=document.createElement("a");p.href=rt.src,p.download=rt.fileName,document.body.appendChild(p),p.click(),document.body.removeChild(p)},className:"mt-4 bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors",children:"Download File"})]})})]})}),s.jsx("div",{className:"flex-1 flex flex-col",children:w?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:w.type==="personal"?w.profileImage?s.jsx("img",{src:`${ze}${w.profileImage}`,alt:w.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:s.jsx("span",{className:"text-white font-semibold",children:w.name.charAt(0).toUpperCase()})}):w.profileImage?s.jsx("img",{src:`${ze}${w.profileImage}`,alt:w.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:s.jsx(ln,{className:"w-5 h-5 text-white"})})}),s.jsxs("div",{className:`cursor-pointer ${w.type==="group"?"hover:bg-gray-50 p-2 rounded-lg transition-colors":""}`,onClick:()=>{w.type==="group"&&(window.location.href=`/group/${w.id}`)},title:w.type==="group"?"Click to view group info":"",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:w.name}),s.jsx("p",{className:"text-xs text-gray-500",children:w.type==="personal"?g(w.id)?s.jsx("span",{className:"text-green-600 font-medium",children:"Online"}):le(x(w.id).lastSeen):`${w.email}`})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[w.type==="personal"?s.jsxs(s.Fragment,{children:[s.jsx(hi,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var c,p;if(!(!w||w.type!=="personal"))try{const N=(p=(c=(await pi.initiate(w.id,"voice")).data)==null?void 0:c.data)==null?void 0:p.call;N&&N._id&&($e(!1),ue({callId:N._id,callType:"voice",otherUser:N.otherUser}),nt(!0),t.emit("call-initiate",{receiverId:w.id,callType:"voice",callId:N._id}))}catch(E){console.error("Failed to initiate call",E)}}}),s.jsx(ur,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var c,p;if(!(!w||w.type!=="personal"))try{const N=(p=(c=(await pi.initiate(w.id,"video")).data)==null?void 0:c.data)==null?void 0:p.call;N&&N._id&&($e(!1),ue({callId:N._id,callType:"video",otherUser:N.otherUser}),nt(!0),t.emit("call-initiate",{receiverId:w.id,callType:"video",callId:N._id}))}catch(E){console.error("Failed to initiate video call",E)}}})]}):s.jsxs(s.Fragment,{children:[s.jsx(hi,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var c,p,E,N,R;if(!(!w||w.type!=="group")){console.log("Initiating group call for:",w.id,w.name);try{const D=(p=(c=(await cr.initiate(w.id,"voice")).data)==null?void 0:c.data)==null?void 0:p.call;D&&D._id&&(V(!1),S({callId:D._id,callType:"voice",groupId:w.id,group:{name:w.name,avatar:w.profileImage}}),Bt(!0),t.emit("group-call-initiate",{groupId:w.id,callType:"voice",callId:D._id}))}catch(P){console.error("Failed to initiate group call",P),console.error("Error response:",(E=P.response)==null?void 0:E.data);const D=((R=(N=P.response)==null?void 0:N.data)==null?void 0:R.message)||"Failed to initiate group call";H.error(D)}}}}),s.jsx(ur,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800",onClick:async()=>{var c,p,E,N,R;if(!(!w||w.type!=="group")){console.log("Initiating group video call for:",w.id,w.name);try{const D=(p=(c=(await cr.initiate(w.id,"video")).data)==null?void 0:c.data)==null?void 0:p.call;D&&D._id&&(V(!1),S({callId:D._id,callType:"video",groupId:w.id,group:{name:w.name,avatar:w.profileImage}}),Bt(!0),t.emit("group-call-initiate",{groupId:w.id,callType:"video",callId:D._id}))}catch(P){console.error("Failed to initiate group video call",P),console.error("Error response:",(E=P.response)==null?void 0:E.data);const D=((R=(N=P.response)==null?void 0:N.data)==null?void 0:R.message)||"Failed to initiate group video call";H.error(D)}}}})]}),s.jsx(wd,{className:"w-5 h-5 text-gray-600 cursor-pointer hover:text-gray-800"})]})]}),s.jsx("div",{ref:Xt,className:"flex-1 overflow-y-auto p-4 bg-gray-50 relative",children:s.jsxs("div",{className:"max-w-8xl mx-auto",children:[$&&s.jsx("div",{className:"flex justify-center py-2",children:s.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})}),!$&&Z&&v.length>0&&s.jsx("div",{className:"flex justify-center py-2",children:s.jsx("button",{onClick:()=>{var p,E,N;const c=((p=v[0])==null?void 0:p._id)||((E=v[0])==null?void 0:E.id);c&&(tr.current=((N=Xt.current)==null?void 0:N.scrollHeight)||0,Nr(c))},className:"px-4 py-2 text-sm bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors",children:"Load Previous Messages"})}),Array.isArray(v)&&v.map((c,p)=>{var D,ce,pe,ke,ye,te,_e;const E=p===0||(()=>{const Q=new Date(c.createdAt||c.timestamp),De=new Date(v[p-1].createdAt||v[p-1].timestamp),Se=new Date(Q.getFullYear(),Q.getMonth(),Q.getDate()),Fe=new Date(De.getFullYear(),De.getMonth(),De.getDate());return Se.getTime()!==Fe.getTime()})();let N=!1;if(typeof c.sender=="object"&&c.sender!==null){const Q=c.sender._id||c.sender.id;N=Q===e.id||Q===e._id||Q===((D=e.id)==null?void 0:D.toString())||Q===((ce=e._id)==null?void 0:ce.toString())}else N=c.sender===e.id||c.sender===e._id||c.sender===((pe=e.id)==null?void 0:pe.toString())||c.sender===((ke=e._id)==null?void 0:ke.toString());const R=typeof c.sender=="object"?(ye=c.sender)==null?void 0:ye.name:"User",P=typeof c.sender=="object"?(te=c.sender)==null?void 0:te.profileImage:null;return s.jsxs(Xl.Fragment,{children:[E&&s.jsx("div",{className:"flex justify-center my-4",children:s.jsx("div",{className:"bg-gray-200 text-gray-600 text-xs px-3 py-1 rounded-full",children:Ee(c.createdAt||c.timestamp)})}),s.jsx("div",{className:`flex ${N?"justify-end":"justify-start"} mb-4`,children:s.jsxs("div",{className:`flex items-start gap-2 max-w-sm lg:max-w-md ${N?"flex-row-reverse":"flex-row"}`,children:[s.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-300 flex-shrink-0",children:N?e.profileImage?s.jsx("img",{src:`${ze}${e.profileImage}`,alt:e.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:s.jsx("span",{className:"text-white text-xs font-medium",children:e.name.charAt(0).toUpperCase()})}):P?s.jsx("img",{src:`${ze}${P}`,alt:R,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-gray-400 flex items-center justify-center",children:s.jsx("span",{className:"text-white text-xs font-medium",children:String(R).charAt(0).toUpperCase()})})}),s.jsxs("div",{className:`relative group flex flex-col px-3 py-2 rounded-lg ${N?"bg-green-500 text-white rounded-br-none":"bg-gray-200 text-gray-900 rounded-bl-none"} ${ht&&Xr&&Ye(Xr)===Ye(c)?"ring-2 ring-blue-400":""}`,onMouseDown:()=>Bn(c),onMouseUp:Qt,onMouseLeave:Qt,onTouchStart:()=>Bn(c),onTouchEnd:Qt,onContextMenu:Q=>{Q.preventDefault(),wr(c),vr(!0)},children:[c.messageType==="text"&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:Q=>go(Ye(c),Q),className:`absolute top-1 right-1 z-10 p-1 rounded-full transition-all duration-200 ${N?"bg-green-600/80 hover:bg-green-700/80 text-white":"bg-gray-300/80 hover:bg-gray-400/80 text-gray-700"} ${lt===Ye(c)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:s.jsx(Ys,{className:"w-3 h-3"})}),lt===Ye(c)&&s.jsxs("div",{className:"message-dropdown-container absolute top-8 right-1 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[s.jsxs("button",{onClick:()=>gn("copy",c),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Ks,{className:"w-4 h-4"}),"Copy"]}),(()=>{var Se,Fe,Ze,et;const Q=((Se=c.sender)==null?void 0:Se.id)||((Fe=c.sender)==null?void 0:Fe._id)||c.sender;return Q===e.id||Q===e._id||Q===((Ze=e.id)==null?void 0:Ze.toString())||Q===((et=e._id)==null?void 0:et.toString())?s.jsxs("button",{onClick:()=>gn("edit",c),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Un,{className:"w-4 h-4"}),"Edit"]}):null})(),s.jsxs("button",{onClick:()=>gn("forward",c),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Qs,{className:"w-4 h-4"}),"Forward"]})]})]}),c.fileUrl&&s.jsx("div",{className:"mb-2",children:c.messageType==="image"?s.jsxs("div",{className:"relative group",onMouseDown:()=>Bn(c),onMouseUp:Qt,onMouseLeave:Qt,onTouchStart:()=>Bn(c),onTouchEnd:Qt,children:[s.jsx("button",{onClick:Q=>go(Ye(c),Q),className:`absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 ${N?"bg-green-500/80 hover:bg-green-600/80 text-white":"bg-gray-500/80 hover:bg-gray-600/80 text-white"} ${lt===Ye(c)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:s.jsx(Ys,{className:"w-3 h-3"})}),lt===Ye(c)&&s.jsxs("div",{className:"message-dropdown-container absolute top-10 right-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[s.jsxs("button",{onClick:()=>gn("copy",c),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Ks,{className:"w-4 h-4"}),"Copy"]}),c.messageType==="text"&&(()=>{var Se,Fe,Ze,et;const Q=((Se=c.sender)==null?void 0:Se.id)||((Fe=c.sender)==null?void 0:Fe._id)||c.sender;return Q===e.id||Q===e._id||Q===((Ze=e.id)==null?void 0:Ze.toString())||Q===((et=e._id)==null?void 0:et.toString())?s.jsxs("button",{onClick:()=>gn("edit",c),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Un,{className:"w-4 h-4"}),"Edit"]}):null})(),s.jsxs("button",{onClick:()=>gn("forward",c),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Qs,{className:"w-4 h-4"}),"Forward"]})]}),s.jsx("img",{src:B(c.fileUrl),alt:c.fileName,className:`max-w-xs rounded-lg ${!N&&!qe[c.id||c._id]?"blur-sm cursor-pointer":"cursor-pointer"} hover:opacity-90`,onClick:()=>{var Q;!N&&!qe[c.id||c._id]?Ss(c.fileUrl,c.fileName,c.id||c._id):Xe({src:B(c.fileUrl),alt:c.fileName,sender:((Q=c.sender)==null?void 0:Q.name)||"User",timestamp:c.createdAt||c.timestamp})}}),!N&&!qe[c.id||c._id]&&s.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-black/60 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1",children:[s.jsx(bn,{className:"w-3 h-3"}),((c.fileSize||0)/1024/1024).toFixed(1)," MB"]}),Ce[c.id||c._id]&&s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:s.jsxs("div",{className:"bg-black/60 rounded-lg px-3 py-2 text-center",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-2"}),s.jsxs("p",{className:"text-sm text-white",children:[Ce[c.id||c._id].progress,"%"]})]})})]}):c.messageType==="video"?s.jsxs("div",{className:"relative group",onMouseDown:()=>Bn(c),onMouseUp:Qt,onMouseLeave:Qt,onTouchStart:()=>Bn(c),onTouchEnd:Qt,children:[s.jsx("button",{onClick:Q=>go(Ye(c),Q),className:`absolute top-2 right-2 z-10 p-1.5 rounded-full transition-all duration-200 ${N?"bg-green-500/80 hover:bg-green-600/80 text-white":"bg-gray-500/80 hover:bg-gray-600/80 text-white"} ${lt===Ye(c)?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"More options",children:s.jsx(Ys,{className:"w-3 h-3"})}),lt===Ye(c)&&s.jsxs("div",{className:"message-dropdown-container absolute top-10 right-2 z-20 bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[120px]",children:[s.jsxs("button",{onClick:()=>gn("copy",c),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Ks,{className:"w-4 h-4"}),"Copy"]}),c.messageType==="text"&&(()=>{var Se,Fe,Ze,et;const Q=((Se=c.sender)==null?void 0:Se.id)||((Fe=c.sender)==null?void 0:Fe._id)||c.sender;return Q===e.id||Q===e._id||Q===((Ze=e.id)==null?void 0:Ze.toString())||Q===((et=e._id)==null?void 0:et.toString())?s.jsxs("button",{onClick:()=>gn("edit",c),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Un,{className:"w-4 h-4"}),"Edit"]}):null})(),s.jsxs("button",{onClick:()=>gn("forward",c),className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx(Qs,{className:"w-4 h-4"}),"Forward"]})]}),s.jsx("video",{src:B(c.fileUrl),controls:!0,className:`max-w-xs rounded-lg ${!N&&!qe[c.id||c._id]?"blur-sm":""} cursor-pointer`,onClick:()=>{var Q;!N&&!qe[c.id||c._id]?Ss(c.fileUrl,c.fileName,c.id||c._id):wt({src:B(c.fileUrl),alt:c.fileName,sender:((Q=c.sender)==null?void 0:Q.name)||"User",timestamp:c.createdAt||c.timestamp})}}),!N&&!qe[c.id||c._id]&&s.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-black/60 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1",children:[s.jsx(bn,{className:"w-3 h-3"}),((c.fileSize||0)/1024/1024).toFixed(1)," MB"]}),Ce[c.id||c._id]&&s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:s.jsxs("div",{className:"bg-black/60 rounded-lg px-3 py-2 text-center",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-2"}),s.jsxs("p",{className:"text-sm text-white",children:[Ce[c.id||c._id].progress,"%"]})]})})]}):s.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-white bg-opacity-20 rounded-lg relative cursor-pointer",onMouseDown:()=>Bn(c),onMouseUp:Qt,onMouseLeave:Qt,onTouchStart:()=>Bn(c),onTouchEnd:Qt,onClick:()=>{var Q;!N&&!qe[c.id||c._id]?Ss(c.fileUrl,c.fileName,c.id||c._id):zt({src:B(c.fileUrl),fileName:c.fileName,fileSize:c.fileSize,fileType:c.fileType,sender:((Q=c.sender)==null?void 0:Q.name)||"User",timestamp:c.createdAt||c.timestamp})},children:[s.jsx(Ar,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium truncate",children:c.fileName}),s.jsxs("p",{className:"text-xs opacity-75",children:[(c.fileSize/1024/1024).toFixed(2)," MB",se(c.fileUrl)&&s.jsx("span",{className:"ml-2 text-blue-400",children:" Google Drive"})]})]}),!N&&!qe[c.id||c._id]&&s.jsx("button",{onClick:Q=>{Q.stopPropagation(),se(c.fileUrl)?(window.open(c.fileUrl,"_blank"),H.success("Opening file in Google Drive...")):Ss(c.fileUrl,c.fileName,c.id||c._id)},className:"p-1 hover:bg-white hover:bg-opacity-20 rounded",disabled:(_e=Ce[c.id||c._id])==null?void 0:_e.downloading,children:s.jsx(bn,{className:"w-4 h-4"})}),Ce[c.id||c._id]&&s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:s.jsxs("div",{className:"bg-black/60 rounded-lg px-2 py-1 text-center",children:[s.jsx("div",{className:"w-6 h-6 border-2 border-white/40 border-t-white rounded-full animate-spin mx-auto mb-1"}),s.jsxs("p",{className:"text-xs text-white",children:[Ce[c.id||c._id].progress,"%"]})]})})]})}),c.message&&(Pt&&Ye(Pt)===Ye(c)?s.jsxs("div",{className:"mb-2",children:[s.jsx("input",{type:"text",value:gt,onChange:Q=>an(Q.target.value),className:"w-full px-2 py-1 text-sm bg-white bg-opacity-20 rounded border-none focus:outline-none focus:ring-1 focus:ring-white",autoFocus:!0,onKeyDown:Q=>{Q.key==="Enter"&&Jt(),Q.key==="Escape"&&ts()}}),s.jsxs("div",{className:"flex gap-1 mt-1",children:[s.jsx("button",{onClick:Jt,className:"text-xs px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700",children:"Save"}),s.jsx("button",{onClick:ts,className:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Cancel"})]})]}):s.jsxs("p",{className:"text-sm mb-1 break-words",children:[c.message,(c.isEdited||c.editedAt)&&s.jsx("span",{className:"text-xs opacity-75 ml-1",children:"(edited)"})]})),s.jsxs("div",{className:`flex items-center gap-1 text-xs self-end ${N?"text-green-100":"text-gray-500"}`,children:[s.jsx("span",{children:new Date(c.createdAt||c.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),N&&s.jsx("span",{className:"ml-1 relative inline-flex items-center",title:c.isRead||c.readBy&&c.readBy.length>0?"Seen":"Delivered",children:c.isRead||c.readBy&&c.readBy.length>0?s.jsx("svg",{className:"w-4 h-4 text-blue-500",viewBox:"0 0 16 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z",fill:"currentColor"})}):s.jsx("svg",{className:"w-4 h-4 opacity-70",viewBox:"0 0 16 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.484-.033l6.272-8.048a.366.366 0 0 0-.064-.512zm-4.1 0l-.478-.372a.365.365 0 0 0-.51.063L4.566 9.879a.32.32 0 0 1-.484.033L1.891 7.769a.366.366 0 0 0-.515.006l-.423.433a.364.364 0 0 0 .006.514l3.258 3.185c.143.14.361.125.484-.033l6.272-8.048a.365.365 0 0 0-.063-.51z",fill:"currentColor"})})})]})]})]})})]},c.id||c._id||p)}),s.jsx("div",{ref:br})]})}),q&&s.jsx("div",{className:"bg-gray-50 border-t border-gray-200 p-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[G?s.jsx("img",{src:G,alt:"Preview",className:"w-12 h-12 rounded-lg object-cover"}):s.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:s.jsx(Ar,{className:"w-6 h-6 text-gray-500"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:q.name}),s.jsxs("p",{className:"text-xs text-gray-500",children:[(q.size/1024/1024).toFixed(2)," MB"]})]})]}),s.jsx("button",{onClick:ks,className:"text-gray-500 hover:text-gray-700",children:s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),At&&s.jsx("div",{className:"bg-blue-50 border-t border-blue-200 p-4",children:s.jsx("div",{className:"flex items-center space-x-3",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Uploading file..."}),s.jsxs("p",{className:"text-sm font-medium text-blue-900",children:[kt,"%"]})]}),s.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2.5",children:s.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${kt}%`}})})]})})}),s.jsxs("div",{className:"bg-white border-t border-gray-200 p-4 relative",children:[s.jsxs("form",{onSubmit:Cs,className:"flex items-center space-x-3",children:[s.jsx("button",{type:"button",onClick:()=>me(!Ie),className:"p-2 text-gray-500 hover:text-gray-700",title:"Attach file",children:s.jsx(Jg,{className:"w-6 h-6"})}),s.jsx("div",{className:"flex-1 relative",children:s.jsx("input",{type:"text",value:M,onChange:c=>L(c.target.value),placeholder:"Type a message",className:"w-full py-2 px-4 bg-gray-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-green-400"})}),s.jsx("button",{type:"submit",disabled:!M.trim()&&!q||At,className:"bg-green-500 text-white p-2 rounded-full hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:At?s.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):s.jsx(Xg,{className:"w-5 h-5"})})]}),Ie&&s.jsx("div",{className:"file-options-container absolute bottom-16 left-4 bg-white rounded-lg shadow-lg border border-gray-200 p-2 z-50",children:s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs("button",{onClick:()=>wo("image"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[s.jsx(Ru,{className:"w-8 h-8 text-green-600 mb-1"}),s.jsx("span",{className:"text-xs text-gray-700",children:"Image"})]}),s.jsxs("button",{onClick:()=>wo("video"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[s.jsx(ur,{className:"w-8 h-8 text-blue-600 mb-1"}),s.jsx("span",{className:"text-xs text-gray-700",children:"Video"})]}),s.jsxs("button",{onClick:()=>wo("document"),className:"flex flex-col items-center p-3 hover:bg-gray-100 rounded-lg transition-colors",children:[s.jsx(Ar,{className:"w-8 h-8 text-purple-600 mb-1"}),s.jsx("span",{className:"text-xs text-gray-700",children:"Document"})]})]})})]})]}):s.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:s.jsxs("div",{className:"text-center",children:[s.jsx(ms,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Welcome to WhatsApp"}),s.jsx("p",{className:"text-gray-500 max-w-md",children:"Select a conversation from the sidebar to start messaging. Your conversations will appear on the left side."})]})})})]}),St&&Je&&s.jsx(s.Fragment,{children:Je.callType==="video"?s.jsx(Ou,{user:e,callData:Je,isIncoming:je,onCallEnd:()=>{nt(!1),ue(null)},onCallAnswer:()=>{},onCallDecline:()=>{nt(!1),ue(null)}}):s.jsx(Uu,{user:e,callData:Je,isIncoming:je,onCallEnd:()=>{nt(!1),ue(null)},onCallAnswer:()=>{},onCallDecline:()=>{nt(!1),ue(null)}})}),Kt&&Be&&W&&Be.callType==="video"&&s.jsx(zu,{callData:Be,onAccept:()=>{console.log(" Chat Page - Accepting incoming video call"),V(!1),t&&(Be!=null&&Be.callId)&&t.emit("group-call-join",{callId:Be.callId,groupId:Be.groupId})},onDecline:()=>{Bt(!1),S(null),V(!1),t&&(Be!=null&&Be.callId)&&t.emit("group-call-decline",{callId:Be.callId,groupId:Be.groupId})}}),Kt&&Be&&!W&&(Be.callType==="video"?s.jsx(Fu,{user:e,callData:Be,onCallEnd:()=>{Bt(!1),S(null),V(!1)}}):s.jsx($u,{user:e,callData:Be,isIncoming:W,onCallEnd:()=>{Bt(!1),S(null),V(!1)},onCallAnswer:()=>{V(!1)},onCallDecline:()=>{Bt(!1),S(null),V(!1)}}))]})},Sb=()=>{const{user:e}=Fn(),t=Ni(),[n,r]=h.useState([]),[o,i]=h.useState(!0),[l,a]=h.useState(""),[d,f]=h.useState(!1),[g,x]=h.useState(null),[b,T]=h.useState({name:"",email:"",password:"",role:"user",phone:"",designation:"",bio:"",isActive:!0}),[k,_]=h.useState(""),[w,m]=h.useState(!1),[v,y]=h.useState("list"),[M,L]=h.useState(new Set),O=C=>M.has(C),U=C=>{L(q=>{const F=new Set(q);return F.has(C)?F.delete(C):F.add(C),F})},K=()=>L(new Set),oe=()=>L(new Set(I.map(C=>C.id))),ne=async C=>{if(M.size===0)return;const q=C?"enable":"disable";if(window.confirm(`Are you sure you want to ${q} ${M.size} selected user(s)?`))try{const F=new Map(n.map(Ie=>[Ie.id,Ie]));let G=0,he=0;for(const Ie of M){const me=F.get(Ie);if(me){if(Ie===(e==null?void 0:e.id)){he++;continue}if(e.role==="admin"&&me.role==="admin"){he++;continue}if((me.isActive??!0)===C){he++;continue}try{await Vt.toggleUserStatus(Ie),G++}catch(Ce){console.error(`Failed to toggle user ${Ie}:`,Ce),he++}}}G>0&&H.success(`${G} user(s) ${q}d successfully`),he>0&&H.info(`${he} user(s) skipped (already in desired state or cannot be modified)`),K(),Y()}catch(F){console.error("Bulk toggle error",F),window.location.reload()}};h.useEffect(()=>{Y()},[]);const Y=async()=>{try{i(!0);const C=await Vt.getUsers();let q=C.data;e.role==="admin"&&(q=C.data.filter(F=>F.role!=="superadmin")),r(q)}catch(C){console.error("Error fetching users:",C),H.error("Failed to load users")}finally{i(!1)}},ae=async C=>{var q,F;if(C.preventDefault(),!b.name.trim()){H.error("Name is required");return}if(!b.email.trim()){H.error("Email is required");return}if(!g&&!b.password.trim()){H.error("Password is required");return}try{const G={name:b.name.trim(),email:b.email.trim(),role:b.role,phone:b.phone.trim(),designation:b.designation.trim(),bio:b.bio.trim(),isActive:b.isActive};g?(b.password.trim()&&(G.password=b.password),await Vt.updateUser(g.id,G),H.success("User updated successfully")):(G.password=b.password,await Vt.createUser(G),H.success("User created successfully")),f(!1),x(null),T({name:"",email:"",password:"",role:"user",phone:"",designation:"",bio:"",isActive:!0}),Y()}catch(G){console.error("User operation error:",G),H.error(((F=(q=G.response)==null?void 0:q.data)==null?void 0:F.message)||"Operation failed")}},A=async C=>{if(window.confirm("Are you sure you want to delete this user?"))try{await Vt.deleteUser(C),H.success("User deleted successfully"),Y()}catch{H.error("Failed to delete user")}},ee=async(C,q)=>{const F=q?"disable":"enable";if(window.confirm(`Are you sure you want to ${F} this user?`))try{await Vt.toggleUserStatus(C),H.success(`User ${F}d successfully`),Y()}catch{H.error(`Failed to ${F} user`)}},X=C=>{x(C),T({name:C.name||"",email:C.email||"",password:"",role:C.role||"user",phone:C.phone||"",designation:C.designation||"",bio:C.bio||"",isActive:C.isActive!==!1}),_(C.password||""),m(!1),f(!0)},Z=()=>{x(null),T({name:"",email:"",password:"",role:"user",phone:"",designation:"",bio:"",isActive:!0}),_(""),f(!0)},ie=C=>{switch(C){case"superadmin":return s.jsx(Yl,{className:"w-4 h-4 text-yellow-600"});case"admin":return s.jsx(Ca,{className:"w-4 h-4 text-blue-600"});default:return s.jsx(fn,{className:"w-4 h-4 text-gray-600"})}},$=C=>{switch(C){case"superadmin":return"bg-yellow-100 text-yellow-800";case"admin":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},I=n.filter(C=>{var q,F;return C.name.toLowerCase().includes(l.toLowerCase())||C.email.toLowerCase().includes(l.toLowerCase())||((q=C.designation)==null?void 0:q.toLowerCase().includes(l.toLowerCase()))||((F=C.phone)==null?void 0:F.includes(l))});return o?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white shadow-sm border-b",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"flex justify-between items-center py-6",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("button",{onClick:()=>window.history.back(),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",title:"Go back",children:s.jsx(ho,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),s.jsx("p",{className:"text-gray-600",children:e.role==="superadmin"?"Manage admins and users in the system":"Manage users in your organization"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"flex items-center rounded-md border border-gray-300 overflow-hidden",children:[s.jsx("button",{className:`px-3 py-2 text-sm ${v==="grid"?"bg-gray-200 text-gray-900":"bg-white text-gray-600"}`,onClick:()=>y("grid"),title:"Grid view",children:s.jsx(ub,{className:"w-4 h-4"})}),s.jsx("button",{className:`px-3 py-2 text-sm ${v==="list"?"bg-gray-200 text-gray-900":"bg-white text-gray-600"}`,onClick:()=>y("list"),title:"List view",children:s.jsx(fb,{className:"w-4 h-4"})})]}),s.jsxs("button",{onClick:()=>t("/time-management"),className:"btn-secondary inline-flex items-center",title:"Time Management Settings",children:[s.jsx(Yo,{className:"w-4 h-4 mr-2"}),"Time Settings"]}),s.jsxs("button",{onClick:Z,className:"btn-primary inline-flex items-center",children:[s.jsx(Lu,{className:"w-4 h-4 mr-2"}),"Add New User"]})]})]})})}),s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsx("div",{className:"card p-6 mb-6",children:s.jsxs("div",{className:"relative",children:[s.jsx(Sa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),s.jsx("input",{type:"text",placeholder:"Search users by name, email, designation, or phone...",value:l,onChange:C=>a(C.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),M.size>0&&s.jsxs("div",{className:"card p-4 mb-4 flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-gray-700",children:["Selected ",M.size," user(s)"]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:oe,className:"btn-secondary",children:"Select all"}),s.jsx("button",{onClick:K,className:"btn-secondary",children:"Clear"}),s.jsx("button",{onClick:()=>ne(!0),className:"btn-primary",children:"Enable selected"}),s.jsx("button",{onClick:()=>ne(!1),className:"btn-secondary text-red-700",children:"Disable selected"})]})]}),v==="grid"?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:I.map(C=>s.jsxs("div",{className:`relative card p-6 transition-all ${C.isActive?"hover:shadow-lg":"bg-gray-50 border-gray-300 opacity-75"}`,children:[s.jsx("label",{className:"absolute top-3 left-3 inline-flex items-center gap-2 bg-white/80 px-2 py-1 rounded shadow",children:s.jsx("input",{type:"checkbox",checked:O(C.id),onChange:()=>U(C.id)})}),s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:`w-12 h-12 ${C.isActive?"bg-primary-100":"bg-gray-100"} rounded-lg flex items-center justify-center overflow-hidden`,children:C.profileImage?s.jsx("img",{src:`${ze}${C.profileImage}`,alt:"Profile",className:`w-12 h-12 rounded-lg object-cover ${C.isActive?"":"grayscale"}`}):s.jsx(fn,{className:`w-6 h-6 ${C.isActive?"text-primary-600":"text-gray-400"}`})}),s.jsxs("div",{children:[s.jsx("h3",{className:`font-medium ${C.isActive?"text-gray-900":"text-gray-600"}`,children:C.name}),s.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[ie(C.role),s.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${$(C.role)}`,children:C.role})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[C.id!==(e==null?void 0:e.id)&&(C.role!=="superadmin"||(e==null?void 0:e.role)==="superadmin")&&s.jsxs("div",{className:"relative inline-flex bg-gray-200 rounded-full p-1 cursor-pointer",onClick:()=>ee(C.id,C.isActive),children:[s.jsx("div",{className:"absolute top-1 bg-white rounded-full shadow-sm transition-transform duration-300",style:{width:"50%",height:"calc(100% - 8px)",left:C.isActive?"4px":"calc(50% + 2px)",transform:"none"}}),s.jsxs("div",{className:`relative z-10 px-4 py-2 text-xs font-medium rounded-full flex items-center space-x-1 transition-colors duration-200 ${C.isActive?"text-primary-600":"text-gray-500"}`,children:[s.jsx(xd,{className:"w-3 h-3"}),s.jsx("span",{children:"Active"})]}),s.jsxs("div",{className:`relative z-10 px-4 py-2 text-xs font-medium rounded-full flex items-center space-x-1 transition-colors duration-200 ${C.isActive?"text-gray-500":"text-primary-600"}`,children:[s.jsx(xb,{className:"w-3 h-3"}),s.jsx("span",{children:"Disabled"})]})]}),s.jsx("button",{onClick:()=>X(C),className:"text-primary-600 hover:text-primary-900",title:"Edit user",children:s.jsx(Un,{className:"w-4 h-4"})}),C.role!=="superadmin"&&C.id!==(e==null?void 0:e.id)&&s.jsx("button",{onClick:()=>A(C.id),className:"text-red-600 hover:text-red-900",title:"Delete user",children:s.jsx(Ql,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[s.jsx(Qg,{className:"w-4 h-4 mr-2"}),s.jsx("span",{className:"truncate",children:C.email})]}),s.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[s.jsx(hi,{className:"w-4 h-4 mr-2"}),s.jsx("span",{children:C.phone||"Not provided"})]}),s.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[s.jsx(Pu,{className:"w-4 h-4 mr-2"}),s.jsx("span",{children:C.designation||"Not provided"})]})]}),s.jsx("div",{className:"mb-4",children:s.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:C.bio||"No bio provided"})}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[C.isActive?s.jsx(xd,{className:"w-4 h-4 text-green-600"}):s.jsx(wb,{className:"w-4 h-4 text-red-600"}),s.jsx("span",{className:`text-sm font-medium px-2 py-1 rounded-full ${C.isActive?"text-green-700 bg-green-100":"text-red-700 bg-red-100"}`,children:C.isActive?"Active":"Disabled"})]}),C.lastSeen&&s.jsxs("span",{className:"text-xs text-gray-500",children:["Last seen: ",new Date(C.lastSeen).toLocaleDateString()]})]}),!C.isActive&&C.disabledAt&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-2",children:[s.jsxs("div",{className:"flex items-center text-xs text-red-700",children:[s.jsx(Bs,{className:"w-3 h-3 mr-1"}),s.jsx("span",{className:"font-medium",children:"Disabled:"}),s.jsx("span",{className:"ml-1",children:new Date(C.disabledAt).toLocaleString()})]}),C.disableReason&&s.jsxs("div",{className:"flex items-center text-xs text-red-600 mt-1",children:[s.jsx("span",{className:"font-medium",children:"Reason:"}),s.jsx("span",{className:"ml-1 capitalize",children:C.disableReason==="auto"?"Auto-disabled":"Manually disabled"})]})]})]})]},C.id))}):s.jsx("div",{className:"card p-0 overflow-hidden",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s.jsx("input",{type:"checkbox",onChange:C=>C.target.checked?oe():K(),checked:M.size>0&&M.size===I.length})}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),s.jsx("th",{className:"px-4 py-3"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:I.map(C=>s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-4 py-3",children:s.jsx("input",{type:"checkbox",checked:O(C.id),onChange:()=>U(C.id)})}),s.jsx("td",{className:"px-4 py-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded bg-gray-100 overflow-hidden flex items-center justify-center",children:C.profileImage?s.jsx("img",{src:`${ze}${C.profileImage}`,alt:"Profile",className:"w-10 h-10 object-cover"}):s.jsx(fn,{className:"w-5 h-5 text-gray-400"})}),s.jsxs("div",{children:[s.jsx("div",{className:`font-medium ${C.isActive?"text-gray-900":"text-gray-600"}`,children:C.name}),s.jsx("div",{className:"text-xs text-gray-500",children:C.designation||""})]})]})}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${$(C.role)}`,children:C.role})}),s.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:C.email}),s.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:C.phone||""}),s.jsx("td",{className:"px-4 py-3",children:s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-full ${C.isActive?"text-green-700 bg-green-100":"text-red-700 bg-red-100"}`,children:C.isActive?"Active":"Disabled"}),!C.isActive&&C.disabledAt&&s.jsx("div",{className:"text-xs text-red-600",title:`Disabled at: ${new Date(C.disabledAt).toLocaleString()}`,children:C.disableReason==="auto"?" Auto":" Manual"})]})}),s.jsx("td",{className:"px-4 py-3",children:s.jsxs("div",{className:"flex items-center gap-2",children:[C.id!==(e==null?void 0:e.id)&&(C.role!=="superadmin"||(e==null?void 0:e.role)==="superadmin")&&s.jsx("button",{className:"text-gray-600 hover:text-gray-900",title:"Toggle status",onClick:()=>ee(C.id,C.isActive),children:C.isActive?s.jsx(e0,{className:"w-5 h-5 text-green-600"}):s.jsx(Zg,{className:"w-5 h-5 text-gray-400"})}),s.jsx("button",{className:"text-primary-600 hover:text-primary-900",title:"Edit",onClick:()=>X(C),children:s.jsx(Un,{className:"w-4 h-4"})}),C.role!=="superadmin"&&C.id!==(e==null?void 0:e.id)&&s.jsx("button",{className:"text-red-600 hover:text-red-900",title:"Delete",onClick:()=>A(C.id),children:s.jsx(Ql,{className:"w-4 h-4"})})]})})]},C.id))})]})})}),I.length===0&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(ln,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No users found"}),s.jsx("p",{className:"text-gray-500",children:l?"Try adjusting your search terms.":"No users have been created yet."})]})]}),d&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:g?"Edit User":"Create New User"}),s.jsxs("form",{onSubmit:ae,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),s.jsx("input",{type:"text",required:!0,value:b.name,onChange:C=>T({...b,name:C.target.value}),className:"input-field",placeholder:"Enter full name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),s.jsx("input",{type:"email",required:!0,value:b.email,onChange:C=>T({...b,email:C.target.value}),className:"input-field",placeholder:"Enter email address"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[g?"New Password":"Password",g&&s.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(leave blank to keep current)"})]}),s.jsx("input",{type:"password",required:!g,value:b.password,onChange:C=>T({...b,password:C.target.value}),className:"input-field",placeholder:g?"Enter new password (optional)":"Enter password"}),g&&s.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("label",{className:"block text-xs font-medium text-gray-600",children:"Current Password"}),s.jsxs("button",{type:"button",className:"text-xs text-primary-600 hover:text-primary-800 inline-flex items-center gap-1",onClick:()=>m(C=>!C),children:[w?s.jsx(yd,{className:"w-3 h-3"}):s.jsx(vd,{className:"w-3 h-3"}),w?"Hide":"Show"]})]}),s.jsx("input",{type:w?"text":"password",readOnly:!0,value:k||"[Password not available - please set new password]",className:"w-full input-field font-mono"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),s.jsxs("select",{value:b.role,onChange:C=>T({...b,role:C.target.value}),className:"input-field",children:[s.jsx("option",{value:"user",children:"User"}),e.role==="superadmin"&&s.jsx("option",{value:"admin",children:"Admin"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),s.jsx("input",{type:"tel",value:b.phone,onChange:C=>T({...b,phone:C.target.value}),className:"input-field",placeholder:"Enter phone number"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Designation"}),s.jsx("input",{type:"text",value:b.designation,onChange:C=>T({...b,designation:C.target.value}),className:"input-field",placeholder:"Enter designation"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bio"}),s.jsx("textarea",{value:b.bio,onChange:C=>T({...b,bio:C.target.value}),className:"input-field",rows:"3",placeholder:"Enter bio (optional)"})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:"isActive",checked:b.isActive,onChange:C=>T({...b,isActive:C.target.checked}),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("label",{htmlFor:"isActive",className:"ml-2 block text-sm text-gray-900",children:"User is active"})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[s.jsx("button",{type:"button",onClick:()=>f(!1),className:"btn-secondary",children:"Cancel"}),s.jsx("button",{type:"submit",className:"btn-primary",children:g?"Update User":"Create User"})]})]})]})})]})},Cb=()=>{Fn();const[e,t]=h.useState(!0),[n,r]=h.useState(new Date),[o,i]=h.useState(0),[l,a]=h.useState({offset:0,synced:!1}),[d,f]=h.useState([]),[g,x]=h.useState([]),[b,T]=h.useState(!1),[k,_]=h.useState(null),[w,m]=h.useState({name:"",enableTime:"",disableTime:"",users:[],applyToAllUsers:!1,days:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]}),v=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];h.useEffect(()=>{y(),M(),L();const I=setInterval(()=>{r(new Date(Date.now()+o))},1e3),C=setInterval(()=>{y()},5*60*1e3);return()=>{clearInterval(I),clearInterval(C)}},[o]);const y=async()=>{try{const I=await Rg.getCurrentTime(),C=new Date(I.data.timestamp),q=new Date,F=C.getTime()-q.getTime();i(F),r(C),I.data.usingGlobalTime?(a({offset:I.data.ntpOffset||0,synced:!0,systemTime:I.data.systemTime,diff:I.data.globalTimeDiff}),console.log(" Time synced with Global NTP Server (NOT system time)"),console.log(" NTP Offset:",I.data.globalTimeDiff),console.log(" IST Time:",I.data.formatted)):console.log(" Time synced with backend IST:",I.data.formatted)}catch(I){console.error("Failed to sync time with backend:",I),i(0),a({offset:0,synced:!1}),r(new Date)}},M=async()=>{try{const I=await is.getSchedules();f(I.data),t(!1)}catch(I){console.error("Error fetching schedules:",I),t(!1)}},L=async()=>{try{const C=(await Vt.getUsers()).data.filter(q=>q.role==="user");x(C)}catch(I){console.error("Error fetching users:",I)}},O=async I=>{var C,q;if(I.preventDefault(),!w.name.trim()){H.error("Please enter schedule name");return}if(!w.enableTime&&!w.disableTime){H.error("Please set at least one time (Enable or Disable)");return}if(!w.applyToAllUsers&&w.users.length===0){H.error('Please select at least one user or enable "Apply to all users"');return}try{k?(await is.updateSchedule(k._id,w),H.success("Schedule updated successfully")):(await is.createSchedule(w),H.success("Schedule created successfully")),T(!1),_(null),ae(),M()}catch(F){console.error("Schedule operation error:",F),H.error(((q=(C=F.response)==null?void 0:C.data)==null?void 0:q.message)||"Operation failed")}},U=async I=>{if(window.confirm("Are you sure you want to delete this schedule?"))try{await is.deleteSchedule(I),H.success("Schedule deleted successfully"),M()}catch{H.error("Failed to delete schedule")}},K=async I=>{try{await is.toggleSchedule(I),M()}catch{H.error("Failed to toggle schedule")}},oe=async(I,C)=>{if(window.confirm(`Reset "${C}"? This will allow it to trigger again today.`))try{await is.resetTrigger(I),H.success("Schedule reset - can trigger again today"),M()}catch{H.error("Failed to reset schedule")}},ne=I=>{_(I),m({name:I.name,enableTime:I.enableTime||"",disableTime:I.disableTime||"",users:I.users.map(C=>C._id),applyToAllUsers:I.applyToAllUsers,days:I.days}),T(!0)},Y=()=>{_(null),ae(),T(!0)},ae=()=>{m({name:"",enableTime:"",disableTime:"",users:[],applyToAllUsers:!1,days:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]})},A=I=>{m(C=>({...C,days:C.days.includes(I)?C.days.filter(q=>q!==I):[...C.days,I]}))},ee=I=>{m(C=>({...C,users:C.users.includes(I)?C.users.filter(q=>q!==I):[...C.users,I]}))},X=()=>{m(I=>({...I,users:g.map(C=>C.id)}))},Z=()=>{m(I=>({...I,users:[]}))},ie=I=>I.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}),$=I=>I.toLocaleDateString("en-IN",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return e?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading schedules..."})]})}):s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white shadow-sm border-b",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsx("div",{className:"flex justify-between items-center py-6",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("button",{onClick:()=>window.history.back(),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",title:"Go back",children:s.jsx(ho,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[s.jsx(Bs,{className:"w-7 h-7 mr-3 text-primary-600"}),"User Scheduler"]}),s.jsx("p",{className:"text-gray-600",children:"Automatically enable or disable selected users at scheduled times"})]})]})})})}),s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsx("div",{className:"card p-8 mb-6 bg-gradient-to-r from-primary-50 to-blue-50 border-primary-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(Bs,{className:"w-5 h-5 text-primary-600"}),s.jsx("p",{className:"text-sm text-gray-600 font-medium",children:$(n)})]}),s.jsx("h2",{className:"text-4xl font-bold text-gray-900",children:ie(n)}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Current IST Time (India)"}),s.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[s.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium",children:" Global NTP Time"}),l.synced&&s.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-medium",children:[" Offset: ",l.diff]})]})]}),s.jsx("div",{className:"bg-white rounded-full p-6 shadow-lg",children:s.jsx(Yo,{className:"w-16 h-16 text-primary-600"})})]})}),s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Scheduled Actions"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Create schedules to automatically enable or disable selected users"})]}),s.jsxs("button",{onClick:Y,className:"btn-primary inline-flex items-center",children:[s.jsx(Kl,{className:"w-4 h-4 mr-2"}),"Create Schedule"]})]}),d.length===0?s.jsxs("div",{className:"card p-12 text-center",children:[s.jsx(Bs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No schedules yet"}),s.jsx("p",{className:"text-gray-500 mb-4",children:"Create schedules to automatically enable or disable users at specific times"}),s.jsxs("button",{onClick:Y,className:"btn-primary inline-flex items-center",children:[s.jsx(Kl,{className:"w-4 h-4 mr-2"}),"Create Schedule"]})]}):s.jsx("div",{className:"grid gap-6",children:d.map(I=>s.jsx("div",{className:"card p-6",children:s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:I.name}),I.isActive?s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700",children:"Active"}):s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700",children:"Inactive"})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-600 mb-3",children:[I.enableTime&&s.jsxs("div",{className:"flex items-center bg-green-50 px-3 py-1.5 rounded-lg border border-green-200",children:[s.jsx("span",{className:"text-green-700 font-medium mr-1",children:""}),s.jsx(Yo,{className:"w-4 h-4 mr-1 text-green-600"}),s.jsx("span",{className:"font-medium text-green-700",children:I.enableTime}),s.jsx("span",{className:"ml-1 text-green-600 text-xs",children:"Enable"})]}),I.disableTime&&s.jsxs("div",{className:"flex items-center bg-red-50 px-3 py-1.5 rounded-lg border border-red-200",children:[s.jsx("span",{className:"text-red-700 font-medium mr-1",children:""}),s.jsx(Yo,{className:"w-4 h-4 mr-1 text-red-600"}),s.jsx("span",{className:"font-medium text-red-700",children:I.disableTime}),s.jsx("span",{className:"ml-1 text-red-600 text-xs",children:"Disable"})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(ln,{className:"w-4 h-4 mr-1"}),s.jsx("span",{children:I.applyToAllUsers?"All Users":`${I.users.length} Selected`})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(Bs,{className:"w-4 h-4 mr-1"}),s.jsx("span",{children:I.days.length===7?"Every day":`${I.days.length} days`})]})]}),!I.applyToAllUsers&&I.users.length>0&&s.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[I.users.slice(0,5).map(C=>s.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 rounded-full px-3 py-1",children:[s.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-100 flex items-center justify-center overflow-hidden",children:C.profileImage?s.jsx("img",{src:`${ze}${C.profileImage}`,alt:C.name,className:"w-6 h-6 object-cover"}):s.jsx(fn,{className:"w-3 h-3 text-primary-600"})}),s.jsx("span",{className:"text-xs text-gray-700",children:C.name})]},C._id)),I.users.length>5&&s.jsxs("span",{className:"text-xs text-gray-500 px-3 py-1",children:["+",I.users.length-5," more"]})]}),s.jsx("div",{className:"flex flex-wrap gap-1",children:v.map(C=>s.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${I.days.includes(C)?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-400"}`,children:C.slice(0,3)},C))}),(I.lastTriggeredEnable||I.lastTriggeredDisable)&&s.jsxs("div",{className:"mt-4 pt-4 border-t text-xs text-gray-500 space-y-1",children:[I.lastTriggeredEnable&&s.jsxs("div",{className:"flex items-center text-green-600",children:[s.jsx("span",{className:"font-medium mr-1",children:" Enable triggered:"}),new Date(I.lastTriggeredEnable).toLocaleString()]}),I.lastTriggeredDisable&&s.jsxs("div",{className:"flex items-center text-red-600",children:[s.jsx("span",{className:"font-medium mr-1",children:" Disable triggered:"}),new Date(I.lastTriggeredDisable).toLocaleString()]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[(I.lastTriggeredEnable||I.lastTriggeredDisable)&&s.jsx("button",{onClick:()=>oe(I._id,I.name),className:"text-orange-600 hover:text-orange-900",title:"Reset & allow re-trigger today",children:s.jsx(Au,{className:"w-5 h-5"})}),s.jsx("button",{onClick:()=>K(I._id),className:"text-gray-600 hover:text-gray-900",title:I.isActive?"Disable":"Enable",children:I.isActive?s.jsx(e0,{className:"w-6 h-6 text-green-600"}):s.jsx(Zg,{className:"w-6 h-6 text-gray-400"})}),s.jsx("button",{onClick:()=>ne(I),className:"text-primary-600 hover:text-primary-900",children:s.jsx(Un,{className:"w-5 h-5"})}),s.jsx("button",{onClick:()=>U(I._id),className:"text-red-600 hover:text-red-900",children:s.jsx(Ql,{className:"w-5 h-5"})})]})]})},I._id))}),s.jsxs("div",{className:"card p-6 mt-8 bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200",children:[s.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[s.jsx(db,{className:"w-5 h-5 mr-2 text-purple-600"}),"How it works"]}),s.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[s.jsx("p",{children:" System uses Global NTP Time Server (time.google.com or pool.ntp.org)"}),s.jsx("p",{children:" Computer/System time is IGNORED - only global internet time is used"}),s.jsx("p",{children:" Global time is converted to IST (Indian Standard Time)"}),s.jsx("p",{children:" The system runs a scheduled job every minute to check time"}),s.jsx("p",{children:" NTP sync happens automatically every hour for accuracy"}),s.jsx("p",{children:" Create schedules to automatically DISABLE selected users at specific times"}),s.jsx("p",{children:" Create schedules to automatically ENABLE selected users at specific times"}),s.jsx("p",{children:" Only selected users in schedules will be affected (not all users)"}),s.jsx("p",{children:" Disabled users are immediately logged out from all devices"})]})]})]}),b&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:s.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:k?"Edit Schedule":"Create New Schedule"}),s.jsxs("form",{onSubmit:O,className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Schedule Name"}),s.jsx("input",{type:"text",required:!0,value:w.name,onChange:I=>m({...w,name:I.target.value}),className:"input-field",placeholder:"e.g., Morning Auto-Enable"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[s.jsxs("label",{className:"block text-sm font-medium text-green-800 mb-1 flex items-center",children:[s.jsx("span",{className:"mr-2",children:""}),"Enable Time (IST)"]}),s.jsx("input",{type:"time",value:w.enableTime,onChange:I=>m({...w,enableTime:I.target.value}),className:"input-field text-lg font-mono",placeholder:"Optional"}),s.jsx("p",{className:"text-xs text-green-700 mt-1",children:"Users will be enabled at this time"})]}),s.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[s.jsxs("label",{className:"block text-sm font-medium text-red-800 mb-1 flex items-center",children:[s.jsx("span",{className:"mr-2",children:""}),"Disable Time (IST)"]}),s.jsx("input",{type:"time",value:w.disableTime,onChange:I=>m({...w,disableTime:I.target.value}),className:"input-field text-lg font-mono",placeholder:"Optional"}),s.jsx("p",{className:"text-xs text-red-700 mt-1",children:"Users will be disabled at this time"})]})]}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:s.jsxs("p",{className:"text-sm text-blue-800",children:[" ",s.jsx("strong",{children:"Tip:"})," Set both times to create a complete on/off schedule. Example: Enable at 09:00, Disable at 18:00"]})}),s.jsxs("div",{className:"flex items-center p-4 bg-gray-50 rounded-lg border border-gray-200",children:[s.jsx("input",{type:"checkbox",id:"applyToAll",checked:w.applyToAllUsers,onChange:I=>m({...w,applyToAllUsers:I.target.checked,users:[]}),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsxs("label",{htmlFor:"applyToAll",className:"ml-3 block text-sm",children:[s.jsx("span",{className:"font-medium text-gray-900",children:"Apply to all users"}),s.jsx("p",{className:"text-gray-600",children:"This schedule will apply to all regular users at the specified times"})]})]}),!w.applyToAllUsers&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Select Users (",w.users.length," selected)"]}),s.jsxs("div",{className:"space-x-2",children:[s.jsx("button",{type:"button",onClick:X,className:"text-xs text-primary-600 hover:text-primary-800",children:"Select All"}),s.jsx("button",{type:"button",onClick:Z,className:"text-xs text-gray-600 hover:text-gray-800",children:"Deselect All"})]})]}),s.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 max-h-64 overflow-y-auto",children:[s.jsxs("div",{className:"mb-3 pb-3 border-b flex items-center justify-between",children:[s.jsxs("div",{className:"text-xs text-gray-600",children:["Showing all users (Active: ",g.filter(I=>I.isActive!==!1).length,", Disabled: ",g.filter(I=>I.isActive===!1).length,")"]}),s.jsxs("div",{className:"flex gap-2 text-xs",children:[s.jsx("span",{className:"px-2 py-1 bg-green-50 text-green-700 rounded",children:" Active"}),s.jsx("span",{className:"px-2 py-1 bg-gray-50 text-gray-700 rounded",children:" Disabled"})]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:g.map(I=>s.jsxs("label",{className:`flex items-center space-x-3 p-3 rounded cursor-pointer transition-colors ${w.users.includes(I.id)?"bg-primary-50 border border-primary-200":I.isActive===!1?"hover:bg-gray-50 opacity-75":"hover:bg-gray-50"}`,children:[s.jsx("input",{type:"checkbox",checked:w.users.includes(I.id),onChange:()=>ee(I.id),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[s.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center overflow-hidden ${I.isActive===!1?"bg-gray-100":"bg-primary-100"}`,children:I.profileImage?s.jsx("img",{src:`${ze}${I.profileImage}`,alt:I.name,className:`w-8 h-8 object-cover ${I.isActive===!1?"grayscale":""}`}):s.jsx(fn,{className:`w-4 h-4 ${I.isActive===!1?"text-gray-400":"text-primary-600"}`})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`text-sm font-medium ${I.isActive===!1?"text-gray-600":"text-gray-900"}`,children:I.name}),I.isActive===!1?s.jsx("span",{className:"px-1.5 py-0.5 bg-gray-100 text-gray-600 rounded text-xs",children:"Disabled"}):s.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-600 rounded text-xs",children:"Active"})]}),s.jsx("div",{className:"text-xs text-gray-500",children:I.email})]})]})]},I.id))})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Active Days (",w.days.length," selected)"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(I=>s.jsx("button",{type:"button",onClick:()=>A(I),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${w.days.includes(I)?"bg-primary-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:I},I))})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[s.jsx("button",{type:"button",onClick:()=>{T(!1),_(null),ae()},className:"btn-secondary",children:"Cancel"}),s.jsx("button",{type:"submit",className:"btn-primary",children:k?"Update Schedule":"Create Schedule"})]})]})]})})]})},Eb=()=>{const{user:e}=Fn(),[t,n]=h.useState([]),[r,o]=h.useState([]),[i,l]=h.useState(!0),[a,d]=h.useState(""),[f,g]=h.useState(!1),[x,b]=h.useState(null),[T,k]=h.useState({name:"",description:"",members:[]}),[_,w]=h.useState(null),[m,v]=h.useState(null);h.useEffect(()=>{y()},[]);const y=async()=>{var A,ee;try{l(!0);const[X,Z]=await Promise.all([Rn.getGroups(),Vt.getActiveUsers()]);console.log("Groups response:",X.data),console.log("First group:",X.data[0]),console.log("First group ID:",(A=X.data[0])==null?void 0:A.id),console.log("First group _ID:",(ee=X.data[0])==null?void 0:ee._id);const ie=X.data.map($=>({...$,id:$.id||$._id}));console.log("Transformed groups:",ie),n(ie),o(Z.data.filter($=>$.id!==e.id))}catch(X){console.error("Error fetching data:",X),H.error("Failed to load data")}finally{l(!1)}},M=async A=>{var ee,X;if(A.preventDefault(),!T.name.trim()){H.error("Group name is required");return}if(T.members.length===0){H.error("Please add at least one member to the group");return}try{console.log("Submitting group data:",T),console.log("Editing group:",x),console.log("Editing group ID:",x==null?void 0:x.id);let Z;if(x){if(!x.id){console.error("No group ID found for editing:",x),H.error("Invalid group ID for editing");return}await Rn.updateGroup(x.id,T),Z=x.id,H.success("Group updated successfully")}else{const ie=await Rn.createGroup(T);console.log("Group creation result:",ie.data),Z=ie.data.group._id||ie.data.group.id,H.success("Group created successfully")}if(_&&Z)try{const ie=new FormData;ie.append("avatar",_),await Rn.uploadGroupAvatar(Z,ie),H.success("Group avatar uploaded successfully")}catch(ie){console.error("Avatar upload error:",ie),H.error("Group created but avatar upload failed")}g(!1),b(null),k({name:"",description:"",members:[]}),w(null),v(null),y()}catch(Z){console.error("Group operation error:",Z),H.error(((X=(ee=Z.response)==null?void 0:ee.data)==null?void 0:X.message)||"Operation failed")}},L=async A=>{if(window.confirm("Are you sure you want to delete this group?"))try{await Rn.deleteGroup(A),H.success("Group deleted successfully"),y()}catch{H.error("Failed to delete group")}},O=A=>{var ie;console.log("Editing group:",A),console.log("Group ID:",A.id),console.log("Group _id:",A._id),console.log("Group members:",A.members),console.log("Group avatar:",A.avatar);const ee=A.id||A._id;if(!ee){console.error("No valid group ID found:",A),H.error("Invalid group selected");return}const X={...A,id:ee};console.log("Group with ID:",X);const Z=((ie=A.members)==null?void 0:ie.map($=>{var C,q;let I;return typeof $.user=="string"?I=$.user:(C=$.user)!=null&&C.id?I=$.user.id:(q=$.user)!=null&&q._id?I=$.user._id:I=$.user,console.log("Extracted member userId:",I,"from:",$.user),{user:I,role:$.role}}))||[];console.log("Extracted members for formData:",Z),b(X),k({name:A.name,description:A.description||"",members:Z}),w(null),A.avatar?v(`${ze}${A.avatar}`):v(null),g(!0)},U=()=>{b(null),k({name:"",description:"",members:[]}),w(null),v(null),g(!0)},K=A=>{const ee=A.target.files[0];if(ee){w(ee);const X=new FileReader;X.onload=Z=>v(Z.target.result),X.readAsDataURL(ee)}},oe=A=>{if(console.log("Adding member:",A),console.log("Current members:",T.members),T.members.find(X=>{var ie,$;return(typeof X.user=="string"?X.user:((ie=X.user)==null?void 0:ie.id)||(($=X.user)==null?void 0:$._id))===A}))console.log("Member already exists"),H.info("Member already added");else{const X={user:A,role:"member"},Z=[...T.members,X];console.log("Updated members after add:",Z),k(ie=>({name:ie.name,description:ie.description,members:Z})),console.log("Member added successfully"),H.success("Member added successfully")}},ne=A=>{console.log("Removing member:",A),console.log("Current members before removal:",T.members);const ee=T.members.filter(X=>{var $,I;const Z=typeof X.user=="string"?X.user:(($=X.user)==null?void 0:$.id)||((I=X.user)==null?void 0:I._id),ie=Z!==A;return console.log("Member ID:",Z,"Remove ID:",A,"Should keep:",ie),ie});console.log("Updated members after removal:",ee),console.log("Length before:",T.members.length,"Length after:",ee.length),ee.length<T.members.length?(k(X=>({name:X.name,description:X.description,members:ee})),console.log("Member removed successfully"),H.success("Member removed successfully")):(console.log("Member not found for removal"),H.error("Failed to remove member"))},Y=t.filter(A=>{var ee;return A.name.toLowerCase().includes(a.toLowerCase())||((ee=A.description)==null?void 0:ee.toLowerCase().includes(a.toLowerCase()))}),ae=r.filter(A=>{const ee=T.members.find(X=>{var $,I;const Z=typeof X.user=="string"?X.user:(($=X.user)==null?void 0:$.id)||((I=X.user)==null?void 0:I._id),ie=A.id||A._id;return Z===ie});return f&&ee&&console.log("Filtering out user (already member):",A.name,"ID:",A.id),!ee});return i?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white shadow-sm border-b",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"flex justify-between items-center py-6",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("button",{onClick:()=>window.history.back(),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",title:"Go back",children:s.jsx(ho,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Group Management"}),s.jsx("p",{className:"text-gray-600",children:"Create and manage groups for team communication"})]})]}),s.jsxs("button",{onClick:U,className:"btn-primary inline-flex items-center",children:[s.jsx(Kl,{className:"w-4 h-4 mr-2"}),"Create Group"]})]})})}),s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsx("div",{className:"card p-6 mb-6",children:s.jsxs("div",{className:"relative",children:[s.jsx(Sa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),s.jsx("input",{type:"text",placeholder:"Search groups...",value:a,onChange:A=>d(A.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Y.map(A=>{var ee,X,Z;return s.jsxs("div",{className:"card p-6",children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center overflow-hidden",children:A.avatar?s.jsx("img",{src:`${ze}${A.avatar}`,alt:"Group avatar",className:"w-12 h-12 rounded-lg object-cover"}):s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(ln,{className:"w-6 h-6 text-green-600"})})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:A.name}),s.jsxs("p",{className:"text-sm text-gray-500",children:[((ee=A.members)==null?void 0:ee.length)||0," members"]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:()=>O(A),className:"text-primary-600 hover:text-primary-900",children:s.jsx(Un,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>L(A.id),className:"text-red-600 hover:text-red-900",children:s.jsx(Ql,{className:"w-4 h-4"})})]})]}),A.description&&s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:A.description}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Members:"}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[(X=A.members)==null?void 0:X.slice(0,3).map((ie,$)=>{var I,C,q;return s.jsxs("div",{className:"flex items-center space-x-1 bg-gray-100 rounded-full px-2 py-1",children:[s.jsx("div",{className:"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-xs font-medium text-primary-600",children:((C=(I=ie.user)==null?void 0:I.name)==null?void 0:C.charAt(0))||"U"})}),s.jsx("span",{className:"text-xs text-gray-700",children:((q=ie.user)==null?void 0:q.name)||"Unknown"})]},$)}),((Z=A.members)==null?void 0:Z.length)>3&&s.jsxs("span",{className:"text-xs text-gray-500",children:["+",A.members.length-3," more"]})]})]})]},A.id)})}),Y.length===0&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(ln,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No groups found"}),s.jsx("p",{className:"text-gray-500",children:a?"Try adjusting your search terms.":"Get started by creating your first group."})]})]}),f&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:x?"Edit Group":"Create Group"}),s.jsxs("form",{onSubmit:M,className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Group Name"}),s.jsx("input",{type:"text",required:!0,value:T.name,onChange:A=>k({...T,name:A.target.value}),className:"input-field",placeholder:"Enter group name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),s.jsx("textarea",{value:T.description,onChange:A=>k({...T,description:A.target.value}),className:"input-field",rows:"3",placeholder:"Enter group description (optional)"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Group Avatar"}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"flex-shrink-0",children:m?s.jsx("img",{src:m,alt:"Avatar preview",className:"w-16 h-16 rounded-lg object-cover border-2 border-gray-200"}):s.jsx("div",{className:"w-16 h-16 rounded-lg bg-gray-100 border-2 border-gray-200 flex items-center justify-center",children:s.jsx(Ru,{className:"w-6 h-6 text-gray-400"})})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("input",{type:"file",accept:"image/*",onChange:K,className:"hidden",id:"avatar-upload"}),s.jsxs("label",{htmlFor:"avatar-upload",className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 cursor-pointer transition-colors",children:[s.jsx(vb,{className:"w-4 h-4 mr-2"}),_?"Change Avatar":"Upload Avatar"]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PNG, JPG, GIF up to 5MB"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Members"}),T.members.length>0&&s.jsxs("div",{className:"mb-3",children:[s.jsxs("p",{className:"text-xs text-gray-600 mb-2",children:["Selected Members: (",T.members.length,")"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:T.members.map(A=>{var ie,$;const ee=typeof A.user=="string"?A.user:((ie=A.user)==null?void 0:ie.id)||(($=A.user)==null?void 0:$._id),X=r.find(I=>I.id===ee||I._id===ee),Z=(X==null?void 0:X.name)||(X==null?void 0:X.username)||"Unknown User";return console.log("Rendering member:",{userId:ee,userData:X==null?void 0:X.name,memberName:Z}),s.jsxs("div",{className:"flex items-center space-x-2 bg-primary-100 rounded-full px-3 py-1.5",children:[s.jsx("div",{className:"w-5 h-5 bg-primary-500 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-xs font-medium text-white",children:Z.charAt(0).toUpperCase()})}),s.jsx("span",{className:"text-sm font-medium text-primary-700",children:Z}),s.jsx("button",{type:"button",onClick:()=>{console.log("Remove button clicked for userId:",ee),ne(ee)},className:"text-primary-600 hover:text-primary-900 transition-colors",children:s.jsx(gi,{className:"w-3.5 h-3.5"})})]},ee)})})]}),s.jsxs("div",{className:"border border-gray-300 rounded-lg p-3",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Add Members: (No Limit)"}),s.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:ae.length>0?ae.map(A=>{var ee;return s.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded transition-colors",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-xs font-medium text-primary-600",children:((ee=A.name)==null?void 0:ee.charAt(0).toUpperCase())||"U"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:A.name||A.username||"Unknown"}),s.jsx("p",{className:"text-xs text-gray-500",children:A.email})]})]}),s.jsx("button",{type:"button",onClick:()=>{console.log("Add button clicked for userId:",A.id),oe(A.id)},className:"text-primary-600 hover:text-primary-800 transition-colors",title:`Add ${A.name||A.username}`,children:s.jsx(Lu,{className:"w-4 h-4"})})]},A.id)}):s.jsx("div",{className:"text-center py-4 text-sm text-gray-500",children:T.members.length>0?s.jsx("p",{children:"All available users have been added to this group."}):s.jsx("p",{children:"No users available to add."})})})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[s.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"}),s.jsx("button",{type:"submit",className:"btn-primary",children:x?"Update":"Create"})]})]})]})})]})},Ib=()=>{var b,T,k,_,w,m;const{groupId:e}=av(),t=Ni();Fn();const[n,r]=h.useState(null),[o,i]=h.useState(!0),[l,a]=h.useState(!1);h.useEffect(()=>{d()},[e]);const d=async()=>{try{i(!0);const y=(await Rn.getGroups()).data.find(M=>M.id===e);if(!y){H.error("Group not found"),t("/chat");return}r(y)}catch(v){console.error("Error fetching group details:",v),H.error("Failed to load group details"),t("/chat")}finally{i(!1)}},f=v=>{switch(v){case"admin":return s.jsx(Ca,{className:"w-4 h-4 text-blue-600"});default:return s.jsx(fn,{className:"w-4 h-4 text-gray-600"})}},g=v=>{switch(v){case"admin":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},x=v=>new Date(v).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return o?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):n?s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white shadow-sm border-b",children:s.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"flex items-center py-4",children:[s.jsx("button",{onClick:()=>t("/chat"),className:"mr-4 p-2 text-gray-600 hover:text-gray-900 transition-colors",title:"Back to chat",children:s.jsx(ho,{className:"w-5 h-5"})}),s.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Group Info"})]})})}),s.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsxs("div",{className:"card p-8 text-center mb-6",children:[s.jsx("div",{className:"flex justify-center mb-6",children:s.jsx("div",{className:"w-32 h-32 rounded-full overflow-hidden bg-gray-100 border-4 border-white shadow-lg",children:n.avatar?s.jsx("img",{src:`${ze}${n.avatar}`,alt:"Group avatar",className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-green-500 flex items-center justify-center",children:s.jsx(ln,{className:"w-16 h-16 text-white"})})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:n.name}),n.description&&s.jsx("p",{className:"text-gray-600 mb-4 max-w-md mx-auto",children:n.description}),s.jsxs("div",{className:"flex items-center justify-center space-x-6 text-sm text-gray-500 mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(ln,{className:"w-4 h-4"}),s.jsxs("span",{children:[((b=n.members)==null?void 0:b.length)||0," members"]})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(Bs,{className:"w-4 h-4"}),s.jsxs("span",{children:["Created ",x(n.createdAt)]})]})]})]}),s.jsxs("div",{className:"card p-6 mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Members"}),s.jsxs("button",{onClick:()=>a(!l),className:"text-primary-600 hover:text-primary-800 transition-colors",children:[l?"Hide":"Show"," (",((T=n.members)==null?void 0:T.length)||0,")"]})]}),l&&s.jsx("div",{className:"space-y-3",children:(k=n.members)==null?void 0:k.map((v,y)=>s.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:v.user.profileImage?s.jsx("img",{src:`${ze}${v.user.profileImage}`,alt:v.user.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full bg-primary-500 flex items-center justify-center",children:s.jsx("span",{className:"text-white font-semibold text-sm",children:v.user.name.charAt(0).toUpperCase()})})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:v.user.name}),s.jsxs("div",{className:"flex items-center space-x-1",children:[f(v.role),s.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${g(v.role)}`,children:v.role})]})]}),s.jsx("p",{className:"text-sm text-gray-500",children:v.user.email})]}),s.jsx("div",{className:"text-xs text-gray-400",children:s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(Yo,{className:"w-3 h-3"}),s.jsxs("span",{children:["Joined ",x(v.joinedAt)]})]})})]},y))})]}),s.jsxs("div",{className:"card p-6 mt-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Group Statistics"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-primary-600",children:((_=n.members)==null?void 0:_.length)||0}),s.jsx("div",{className:"text-sm text-gray-500",children:"Total Members"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:((w=n.members)==null?void 0:w.filter(v=>v.role==="admin").length)||0}),s.jsx("div",{className:"text-sm text-gray-500",children:"Admins"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Math.ceil((((m=n.members)==null?void 0:m.length)||0)/2)}),s.jsx("div",{className:"text-sm text-gray-500",children:"Active Conversations"})]})]})]})]})]}):s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Group not found"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"The group you're looking for doesn't exist."}),s.jsx("button",{onClick:()=>t("/chat"),className:"btn-primary",children:"Back to Chat"})]})})},Tb=()=>{const{user:e,setUser:t}=Fn(),[n,r]=h.useState({name:"",email:"",phone:"",designation:"",profileImage:"",bio:""}),[o,i]=h.useState(!1),[l,a]=h.useState(!1),[d,f]=h.useState(null),[g,x]=h.useState(null);h.useEffect(()=>{e&&(r({name:e.name||"",email:e.email||"",phone:e.phone||"",designation:e.designation||"",profileImage:e.profileImage||"",bio:e.bio||""}),f(e.profileImage||null))},[e]);const b=m=>{const{name:v,value:y}=m.target;r(M=>({...M,[v]:y}))},T=m=>{const v=m.target.files[0];if(v){x(v);const y=new FileReader;y.onload=M=>{f(M.target.result)},y.readAsDataURL(v)}},k=()=>{x(null),f(null),r(m=>({...m,profileImage:""}))},_=async m=>{var v,y,M,L,O;m.preventDefault(),a(!0);try{const U=new FormData;U.append("name",n.name),n.phone&&n.phone.trim()&&U.append("phone",n.phone.trim()),n.designation&&n.designation.trim()&&U.append("designation",n.designation.trim()),n.bio&&n.bio.trim()&&U.append("bio",n.bio.trim()),g&&U.append("profileImage",g);const oe=((v=(await Vt.updateProfile(U)).data)==null?void 0:v.user)||{};r(ne=>({...ne,name:oe.name??ne.name,phone:oe.phone??ne.phone,designation:oe.designation??ne.designation,bio:oe.bio??ne.bio,profileImage:oe.profileImage??ne.profileImage})),oe.profileImage&&f(oe.profileImage),t(ne=>ne?{...ne,...oe}:oe),H.success("Profile updated successfully"),i(!1),x(null),setTimeout(()=>{window.location.reload()},1e3)}catch(U){console.error("Profile update error:",U);const K=((M=(y=U.response)==null?void 0:y.data)==null?void 0:M.message)||((O=(L=U.response)==null?void 0:L.data)==null?void 0:O.error)||"Failed to update profile";H.error(K)}finally{a(!1)}},w=()=>{i(!1),r({name:e.name||"",email:e.email||"",phone:e.phone||"",designation:e.designation||"",profileImage:e.profileImage||"",bio:e.bio||""}),f(e.profileImage||null),x(null)};return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white shadow-sm border-b",children:s.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"flex items-center justify-between py-6",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(Gl,{to:"/dashboard",className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(ho,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile"}),s.jsx("p",{className:"text-gray-600",children:"Manage your profile information"})]})]}),!o&&s.jsxs("button",{onClick:()=>i(!0),className:"btn-primary inline-flex items-center",children:[s.jsx(Un,{className:"w-4 h-4 mr-2"}),"Edit Profile"]})]})})}),s.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsx("div",{className:"lg:col-span-1",children:s.jsx("div",{className:"card p-6",children:s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"relative inline-block",children:[d?s.jsx("img",{src:d.startsWith("http")||d.startsWith("data:")?d:`${ze}${d}`,alt:"Profile",className:"w-32 h-32 rounded-full object-cover mx-auto"}):s.jsx("div",{className:"w-32 h-32 bg-primary-100 rounded-full flex items-center justify-center mx-auto",children:s.jsx(fn,{className:"w-16 h-16 text-primary-600"})}),o&&s.jsx("div",{className:"absolute bottom-0 right-0",children:s.jsxs("label",{className:"bg-primary-600 text-white p-2.5 rounded-full cursor-pointer hover:bg-primary-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center border-2 border-white",children:[s.jsx(cb,{className:"w-4 h-4"}),s.jsx("input",{type:"file",accept:"image/*",onChange:T,className:"hidden"})]})})]}),s.jsx("h2",{className:"text-xl font-bold text-gray-900 mt-4",children:n.name}),s.jsx("p",{className:"text-gray-600",children:n.designation||"No designation"}),s.jsx("p",{className:"text-sm text-gray-500 mt-2",children:n.email}),o&&d&&s.jsxs("button",{onClick:k,className:"mt-2 text-red-600 hover:text-red-700 text-sm inline-flex items-center",children:[s.jsx(gi,{className:"w-4 h-4 mr-1"}),"Remove Image"]})]})})}),s.jsx("div",{className:"lg:col-span-2",children:s.jsxs("div",{className:"card p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:o?"Edit Profile Information":"Profile Information"}),o?s.jsxs("form",{onSubmit:_,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),s.jsx("input",{type:"text",name:"name",value:n.name,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),s.jsx("input",{type:"tel",name:"phone",value:n.phone,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"+1 (555) 123-4567"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designation"}),s.jsx("input",{type:"text",name:"designation",value:n.designation,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Software Developer"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),s.jsx("input",{type:"email",value:n.email,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),s.jsx("textarea",{name:"bio",value:n.bio,onChange:b,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Tell us about yourself..."})]}),s.jsxs("div",{className:"flex justify-end space-x-4",children:[s.jsx("button",{type:"button",onClick:w,className:"btn-secondary",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:l,className:"btn-primary inline-flex items-center",children:l?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):s.jsxs(s.Fragment,{children:[s.jsx(yb,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(fn,{className:"w-5 h-5 text-gray-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Name"}),s.jsx("p",{className:"text-sm text-gray-600",children:n.name||"Not provided"})]})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(hi,{className:"w-5 h-5 text-gray-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Phone"}),s.jsx("p",{className:"text-sm text-gray-600",children:n.phone||"Not provided"})]})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(ab,{className:"w-5 h-5 text-gray-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Designation"}),s.jsx("p",{className:"text-sm text-gray-600",children:n.designation||"Not provided"})]})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(Qg,{className:"w-5 h-5 text-gray-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Email"}),s.jsx("p",{className:"text-sm text-gray-600",children:n.email})]})]})]}),n.bio&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 mb-2",children:"Bio"}),s.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-4 rounded-lg",children:n.bio})]})]})]})})]})})]})};function _b(){const e=Ni(),[t,n]=h.useState(!0),[r,o]=h.useState([]),[i,l]=h.useState([]),[a,d]=h.useState(new Set),[f,g]=h.useState(new Set),[x,b]=h.useState(null),[T,k]=h.useState(!1),[_,w]=h.useState("users"),[m,v]=h.useState(""),y=Y=>Y&&(/^https?:\/\//i.test(Y)?Y:`${ze}${Y}`),M=Y=>{if(!Y&&Y!==0)return"";const ae=Y/1024/1024;return`${ae.toFixed(ae<.1?2:1)} MB`};h.useEffect(()=>{try{const Y=sessionStorage.getItem("forwardMessage");Y&&b(JSON.parse(Y))}catch{}},[]),h.useEffect(()=>{(async()=>{try{n(!0);const[ae,A]=await Promise.all([Vt.getActiveUsers(),Rn.getGroups()]);o(ae.data||[]),l((A.data||[]).filter(ee=>ee.isActive!==!1))}catch{}finally{n(!1)}})()},[]);const L=Y=>{d(ae=>{const A=new Set(ae);return A.has(Y)?A.delete(Y):A.add(Y),A})},O=Y=>{g(ae=>{const A=new Set(ae);return A.has(Y)?A.delete(Y):A.add(Y),A})},U=async()=>{if(!(!(x!=null&&x.id)&&!(x!=null&&x._id))&&!(a.size===0&&f.size===0))try{k(!0),await at.forwardMessage({messageId:x.id||x._id,targets:{users:Array.from(a),groups:Array.from(f)}}),sessionStorage.removeItem("forwardMessage"),e(-1)}catch{k(!1)}};if(t)return s.jsx("div",{className:"p-6",children:"Loading..."});const K=r.filter(Y=>Y.name.toLowerCase().includes(m.toLowerCase())||(Y.email||"").toLowerCase().includes(m.toLowerCase())),oe=i.filter(Y=>Y.name.toLowerCase().includes(m.toLowerCase())),ne=a.size+f.size;return s.jsxs("div",{className:"h-screen bg-white",children:[s.jsxs("div",{className:"sticky top-0 z-10 bg-gray-100 text-white",children:[s.jsx("div",{className:"max-w-3xl mx-auto px-4 pt-3",children:s.jsx("input",{value:m,onChange:Y=>v(Y.target.value),placeholder:"Search name or group",className:"w-full bg-white text-gray-800 rounded-full px-4 py-2 text-sm focus:outline-none",type:"text"})}),s.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-2 flex items-center justify-between gap-2",children:[s.jsxs("div",{className:"inline-flex bg-white rounded-full p-1",children:[s.jsx("button",{className:`px-4 py-1 text-sm rounded-full ${_==="users"?"bg-gray-200 text-gray-800":"text-gray-800"}`,onClick:()=>w("users"),children:"Chats"}),s.jsx("button",{className:`px-4 py-1 text-sm rounded-full ${_==="groups"?"bg-gray-200 text-gray-800":"text-gray-800"}`,onClick:()=>w("groups"),children:"Groups"})]}),s.jsx("div",{className:"flex-1 flex items-center justify-center",children:s.jsx("div",{className:"font-semibold -ml-4 whitespace-nowrap text-gray-800",children:"Forward"})}),s.jsxs("div",{className:"text-sm opacity-90 whitespace-nowrap text-gray-800",children:[ne," selected"]})]})]}),s.jsxs("div",{className:"max-w-3xl mx-auto px-4 pt-3 pb-24",children:[x&&s.jsx("div",{className:"mb-3",children:s.jsxs("div",{className:"bg-gray-100 rounded-2xl p-3 inline-block max-w-full",children:[s.jsx("div",{className:"flex items-center gap-2 mb-2",children:s.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Preview"})}),x.messageType==="image"?s.jsxs("div",{className:"max-w-[200px]",children:[s.jsx("img",{src:y(x.fileUrl),alt:x.fileName||"image",className:"rounded-lg w-full h-auto max-h-[150px] object-cover"}),x.message&&s.jsx("div",{className:"mt-2 text-sm text-gray-800 break-words",children:x.message}),s.jsxs("div",{className:"mt-2",children:[a.size>0&&f.size===0&&s.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700",children:"Personal"}),f.size>0&&a.size===0&&s.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700",children:"Group"})]})]}):x.messageType==="video"?s.jsxs("div",{className:"max-w-[200px]",children:[s.jsx("video",{src:y(x.fileUrl),controls:!0,className:"rounded-lg w-full h-auto max-h-[150px] object-cover"}),x.message&&s.jsx("div",{className:"mt-2 text-sm text-gray-800 break-words",children:x.message}),s.jsxs("div",{className:"mt-2",children:[a.size>0&&f.size===0&&s.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700",children:"Personal"}),f.size>0&&a.size===0&&s.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700",children:"Group"})]})]}):x.messageType&&x.messageType!=="text"?s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white rounded-lg shadow-sm",children:[s.jsx("svg",{className:"w-6 h-6 text-gray-600",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM8 18h8v2H8v-2zm0-4h8v2H8v-2zm6-7.5V9h3.5L14 6.5z"})}),s.jsxs("div",{className:"min-w-0",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:x.fileName||"Attachment"}),s.jsx("div",{className:"text-xs text-gray-500",children:M(x.fileSize)}),x.message&&s.jsx("div",{className:"text-sm text-gray-800 break-words mt-1",children:x.message})]})]}),s.jsxs("div",{className:"mt-2",children:[a.size>0&&f.size===0&&s.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700",children:"Personal"}),f.size>0&&a.size===0&&s.jsx("span",{className:"inline-block text-[10px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700",children:"Group"})]})]}):s.jsx("div",{className:"text-sm text-gray-800 break-words max-w-[200px]",children:x.message})]})}),_==="users"?s.jsxs("div",{className:"divide-y border rounded-xl overflow-hidden",children:[K.map(Y=>{var ae,A;return s.jsxs("button",{onClick:()=>L(Y.id),className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50",children:[s.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-green-500 text-white flex items-center justify-center",children:Y.profileImage?s.jsx("img",{src:`${ze}${Y.profileImage}`,alt:Y.name,className:"w-full h-full object-cover"}):s.jsx("span",{className:"font-semibold",children:(A=(ae=Y.name)==null?void 0:ae[0])==null?void 0:A.toUpperCase()})}),s.jsxs("div",{className:"flex-1 text-left min-w-0",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:Y.name}),s.jsx("div",{className:"text-xs text-gray-500 truncate",children:Y.email})]}),s.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${a.has(Y.id)?"bg-green-500 border-green-500":"border-gray-300"}`,children:a.has(Y.id)&&s.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.414l2.293 2.293 6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},Y.id)}),K.length===0&&s.jsx("div",{className:"p-6 text-center text-sm text-gray-500",children:"No chats found"})]}):s.jsxs("div",{className:"divide-y border rounded-xl overflow-hidden",children:[oe.map(Y=>{var A;const ae=Y.id||Y._id;return s.jsxs("button",{onClick:()=>O(ae),className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50",children:[s.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-green-500 text-white flex items-center justify-center",children:Y.avatar?s.jsx("img",{src:`${ze}${Y.avatar}`,alt:Y.name,className:"w-full h-full object-cover"}):s.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V20h14v-3.5C15 14.17 10.33 13 8 13zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V20h6v-3.5c0-2.33-4.67-3.5-7-3.5z"})})}),s.jsxs("div",{className:"flex-1 text-left min-w-0",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:Y.name}),s.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[((A=Y.members)==null?void 0:A.length)||0," members"]})]}),s.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${f.has(ae)?"bg-green-500 border-green-500":"border-gray-300"}`,children:f.has(ae)&&s.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.414l2.293 2.293 6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},ae)}),oe.length===0&&s.jsx("div",{className:"p-6 text-center text-sm text-gray-500",children:"No groups found"})]})]}),s.jsx("div",{className:"fixed bottom-0 inset-x-0 bg-white border-t",children:s.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-3 flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-gray-600",children:[ne," selected"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{className:"btn-secondary",onClick:()=>e(-1),children:"Cancel"}),s.jsx("button",{className:"btn-primary",disabled:T||ne===0,onClick:U,children:"Send"})]})]})})]})}const r0=({size:e="md"})=>{const t={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12",xl:"w-16 h-16"};return s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("div",{className:`${t[e]} animate-spin rounded-full border-4 border-gray-200 border-t-primary-600`})})};function sr({children:e,allowedRoles:t}){const{user:n,loading:r}=Fn();return r?s.jsx(r0,{}):n?t&&!t.includes(n.role)?s.jsx(Ho,{to:"/dashboard",replace:!0}):e:s.jsx(Ho,{to:"/login",replace:!0})}function Mb(){return s.jsx(a2,{children:s.jsx(_v,{children:s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx(b1,{position:"top-right"}),s.jsx(Rb,{})]})})})}function Rb(){const{user:e,loading:t}=Fn();return t?s.jsx(r0,{}):s.jsx(s.Fragment,{children:e?s.jsx(ob,{user:e,children:s.jsxs(sm,{children:[s.jsx(Zt,{path:"/login",element:s.jsx(Ho,{to:"/dashboard",replace:!0})}),s.jsx(Zt,{path:"/dashboard",element:s.jsx(sr,{children:e&&e.role==="user"?s.jsx(Am,{}):s.jsx(jb,{})})}),s.jsx(Zt,{path:"/user-dashboard",element:s.jsx(sr,{allowedRoles:["user"],children:s.jsx(Am,{})})}),s.jsx(Zt,{path:"/chat",element:s.jsx(sr,{children:s.jsx(kb,{})})}),s.jsx(Zt,{path:"/users",element:s.jsx(sr,{allowedRoles:["superadmin","admin"],children:s.jsx(Sb,{})})}),s.jsx(Zt,{path:"/time-management",element:s.jsx(sr,{allowedRoles:["superadmin","admin"],children:s.jsx(Cb,{})})}),s.jsx(Zt,{path:"/groups",element:s.jsx(sr,{allowedRoles:["admin"],children:s.jsx(Eb,{})})}),s.jsx(Zt,{path:"/group/:groupId",element:s.jsx(sr,{children:s.jsx(Ib,{})})}),s.jsx(Zt,{path:"/profile",element:s.jsx(sr,{children:s.jsx(Tb,{})})}),s.jsx(Zt,{path:"/forward",element:s.jsx(sr,{children:s.jsx(_b,{})})}),s.jsx(Zt,{path:"/",element:s.jsx(Ho,{to:"/dashboard",replace:!0})})]})}):s.jsxs(sm,{children:[s.jsx(Zt,{path:"/login",element:s.jsx(bb,{})}),s.jsx(Zt,{path:"*",element:s.jsx(Ho,{to:"/login",replace:!0})})]})})}ac.createRoot(document.getElementById("root")).render(s.jsx(Xl.StrictMode,{children:s.jsx(Mb,{})}));
